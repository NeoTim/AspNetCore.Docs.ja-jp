---
title: ASP.NET Core のルーティング
author: rick-anderson
description: ASP.NET Core ルーティングによって、HTTP 要求の照合と実行可能なエンドポイントへのディスパッチがどのように行われるかについて説明します。
monikerRange: '>= aspnetcore-2.1'
ms.author: riande
ms.custom: mvc
ms.date: 4/1/2020
no-loc:
- Blazor
- Blazor Server
- Blazor WebAssembly
- Identity
- Let's Encrypt
- Razor
- SignalR
uid: fundamentals/routing
ms.openlocfilehash: fcf79966abf7a023773ef892636530278b668c44
ms.sourcegitcommit: 5a36758cca2861aeb10840093e46d273a6e6e91d
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 07/28/2020
ms.locfileid: "87303613"
---
# <a name="routing-in-aspnet-core"></a><span data-ttu-id="36060-103">ASP.NET Core のルーティング</span><span class="sxs-lookup"><span data-stu-id="36060-103">Routing in ASP.NET Core</span></span>

<span data-ttu-id="36060-104">作成者: [Ryan Nowak](https://github.com/rynowak)、[Kirk Larkin](https://twitter.com/serpent5)、[Rick Anderson](https://twitter.com/RickAndMSFT)</span><span class="sxs-lookup"><span data-stu-id="36060-104">By [Ryan Nowak](https://github.com/rynowak), [Kirk Larkin](https://twitter.com/serpent5), and [Rick Anderson](https://twitter.com/RickAndMSFT)</span></span>

::: moniker range=">= aspnetcore-3.0"

<span data-ttu-id="36060-105">ルーティングの役割は、受信した HTTP 要求を照合し、それらの要求をアプリの実行可能なエンドポイントにディスパッチすることです。</span><span class="sxs-lookup"><span data-stu-id="36060-105">Routing is responsible for matching incoming HTTP requests and dispatching those requests to the app's executable endpoints.</span></span> <span data-ttu-id="36060-106">[エンドポイント](#endpoint)は、アプリの実行可能な要求処理コードの単位です。</span><span class="sxs-lookup"><span data-stu-id="36060-106">[Endpoints](#endpoint) are the app's units of executable request-handling code.</span></span> <span data-ttu-id="36060-107">エンドポイントはアプリで定義され、アプリの起動時に構成されます。</span><span class="sxs-lookup"><span data-stu-id="36060-107">Endpoints are defined in the app and configured when the app starts.</span></span> <span data-ttu-id="36060-108">エンドポイントの照合プロセスでは、要求の URL から値を抽出し、それらの値を要求の処理に提供できます。</span><span class="sxs-lookup"><span data-stu-id="36060-108">The endpoint matching process can extract values from the request's URL and provide those values for request processing.</span></span> <span data-ttu-id="36060-109">アプリからのルート情報を使用して、ルーティングでエンドポイントにマップする URL を生成することもできます。</span><span class="sxs-lookup"><span data-stu-id="36060-109">Using endpoint information from the app, routing is also able to generate URLs that map to endpoints.</span></span>

<span data-ttu-id="36060-110">アプリでは、次のものを使用してルーティングを構成できます。</span><span class="sxs-lookup"><span data-stu-id="36060-110">Apps can configure routing using:</span></span>

- <span data-ttu-id="36060-111">Controllers</span><span class="sxs-lookup"><span data-stu-id="36060-111">Controllers</span></span>
- <span data-ttu-id="36060-112">Razor Pages</span><span class="sxs-lookup"><span data-stu-id="36060-112">Razor Pages</span></span>
- SignalR
- <span data-ttu-id="36060-113">gRPC サービス</span><span class="sxs-lookup"><span data-stu-id="36060-113">gRPC Services</span></span>
- <span data-ttu-id="36060-114">エンドポイント対応の[ミドルウェア](xref:fundamentals/middleware/index) ([正常性チェックなど)](xref:host-and-deploy/health-checks)。</span><span class="sxs-lookup"><span data-stu-id="36060-114">Endpoint-enabled [middleware](xref:fundamentals/middleware/index) such as [Health Checks](xref:host-and-deploy/health-checks).</span></span>
- <span data-ttu-id="36060-115">ルーティングに登録されているデリゲートとラムダ。</span><span class="sxs-lookup"><span data-stu-id="36060-115">Delegates and lambdas registered with routing.</span></span>

<span data-ttu-id="36060-116">このドキュメントでは、ASP.NET Core のルーティングについて詳しく説明します。</span><span class="sxs-lookup"><span data-stu-id="36060-116">This document covers low-level details of ASP.NET Core routing.</span></span> <span data-ttu-id="36060-117">ルーティングの構成については、以下を参照してください。</span><span class="sxs-lookup"><span data-stu-id="36060-117">For information on configuring routing:</span></span>

* <span data-ttu-id="36060-118">コントローラーについては、<xref:mvc/controllers/routing> を参照してください。</span><span class="sxs-lookup"><span data-stu-id="36060-118">For controllers, see <xref:mvc/controllers/routing>.</span></span>
* <span data-ttu-id="36060-119">Razor Pages の規則については、「<xref:razor-pages/razor-pages-conventions>」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="36060-119">For Razor Pages conventions, see <xref:razor-pages/razor-pages-conventions>.</span></span>

<span data-ttu-id="36060-120">このドキュメントで説明されているエンドポイント ルーティング システムは、ASP.NET Core 3.0 以降に適用されます。</span><span class="sxs-lookup"><span data-stu-id="36060-120">The endpoint routing system described in this document applies to ASP.NET Core 3.0 and later.</span></span> <span data-ttu-id="36060-121"><xref:Microsoft.AspNetCore.Routing.IRouter> に基づく以前のルーティング システムについては、次のいずれかの方法を使用して ASP.NET Core 2.1 バージョンを選択してください。</span><span class="sxs-lookup"><span data-stu-id="36060-121">For information on the previous routing system based on <xref:Microsoft.AspNetCore.Routing.IRouter>, select the ASP.NET Core 2.1 version using one of the following approaches:</span></span>

* <span data-ttu-id="36060-122">以前のバージョンのバージョン セレクター。</span><span class="sxs-lookup"><span data-stu-id="36060-122">The version selector for a previous version.</span></span>
* <span data-ttu-id="36060-123">[ASP.NET Core 2.1 でのルーティング](https://docs.microsoft.com/aspnet/core/fundamentals/routing?view=aspnetcore-2.1)に関する記事を選択します。</span><span class="sxs-lookup"><span data-stu-id="36060-123">Select [ASP.NET Core 2.1 routing](https://docs.microsoft.com/aspnet/core/fundamentals/routing?view=aspnetcore-2.1).</span></span>

<span data-ttu-id="36060-124">[サンプル コードを表示またはダウンロード](https://github.com/aspnet/AspNetCore.Docs/tree/master/aspnetcore/fundamentals/routing/samples/3.x)します ([ダウンロード方法](xref:index#how-to-download-a-sample))。</span><span class="sxs-lookup"><span data-stu-id="36060-124">[View or download sample code](https://github.com/aspnet/AspNetCore.Docs/tree/master/aspnetcore/fundamentals/routing/samples/3.x) ([how to download](xref:index#how-to-download-a-sample))</span></span>

<span data-ttu-id="36060-125">このドキュメントのダウンロード サンプルは、特定の `Startup` クラスによって有効になります。</span><span class="sxs-lookup"><span data-stu-id="36060-125">The download samples for this document are enabled by a specific `Startup` class.</span></span> <span data-ttu-id="36060-126">特定のサンプルを実行するには、目的の `Startup` クラスを呼び出すように *Program.cs* を変更します。</span><span class="sxs-lookup"><span data-stu-id="36060-126">To run a specific sample, modify *Program.cs* to call the desired `Startup` class.</span></span>

## <a name="routing-basics"></a><span data-ttu-id="36060-127">ルーティングの基本</span><span class="sxs-lookup"><span data-stu-id="36060-127">Routing basics</span></span>

<span data-ttu-id="36060-128">すべての ASP.NET Core テンプレートには、生成されたコードでのルーティングが含まれます。</span><span class="sxs-lookup"><span data-stu-id="36060-128">All ASP.NET Core templates include routing in the generated code.</span></span> <span data-ttu-id="36060-129">ルーティングは、`Startup.Configure` で[ミドルウェア](xref:fundamentals/middleware/index) パイプラインに登録されます。</span><span class="sxs-lookup"><span data-stu-id="36060-129">Routing is registered in the [middleware](xref:fundamentals/middleware/index) pipeline in `Startup.Configure`.</span></span>

<span data-ttu-id="36060-130">次のコードでは、ルーティングの基本的な例を示します。</span><span class="sxs-lookup"><span data-stu-id="36060-130">The following code shows a basic example of routing:</span></span>

[!code-csharp[](routing/samples/3.x/RoutingSample/Startup.cs?name=snippet&highlight=8,10)]

<span data-ttu-id="36060-131">ルーティングでは、<xref:Microsoft.AspNetCore.Builder.EndpointRoutingApplicationBuilderExtensions.UseRouting*> と <xref:Microsoft.AspNetCore.Builder.EndpointRoutingApplicationBuilderExtensions.UseEndpoints*> によって登録されたミドルウェアのペアを使用します。</span><span class="sxs-lookup"><span data-stu-id="36060-131">Routing uses a pair of middleware, registered by <xref:Microsoft.AspNetCore.Builder.EndpointRoutingApplicationBuilderExtensions.UseRouting*> and <xref:Microsoft.AspNetCore.Builder.EndpointRoutingApplicationBuilderExtensions.UseEndpoints*>:</span></span>

* <span data-ttu-id="36060-132">`UseRouting` では、ルートの照合がミドルウェア パイプラインに追加されます。</span><span class="sxs-lookup"><span data-stu-id="36060-132">`UseRouting` adds route matching to the middleware pipeline.</span></span> <span data-ttu-id="36060-133">このミドルウェアによって、アプリで定義されているエンドポイントのセットが調べられ、要求に基づいて[最適な一致](#urlm)が選択されます。</span><span class="sxs-lookup"><span data-stu-id="36060-133">This middleware looks at the set of endpoints defined in the app, and selects the [best match](#urlm) based on the request.</span></span>
* <span data-ttu-id="36060-134">`UseEndpoints` では、エンドポイントの実行がミドルウェア パイプラインに追加されます。</span><span class="sxs-lookup"><span data-stu-id="36060-134">`UseEndpoints` adds endpoint execution to the middleware pipeline.</span></span> <span data-ttu-id="36060-135">選択されたエンドポイントに関連付けられているデリゲートが実行されます。</span><span class="sxs-lookup"><span data-stu-id="36060-135">It runs the delegate associated with the selected endpoint.</span></span>

<span data-ttu-id="36060-136">前の例には、[MapGet](xref:Microsoft.AspNetCore.Builder.EndpointRouteBuilderExtensions.MapGet*) メソッドを使用する "*コードへのルーティング*" エンドポイントが 1 つ含まれます。</span><span class="sxs-lookup"><span data-stu-id="36060-136">The preceding example includes a single *route to code* endpoint using the [MapGet](xref:Microsoft.AspNetCore.Builder.EndpointRouteBuilderExtensions.MapGet*) method:</span></span>

* <span data-ttu-id="36060-137">HTTP `GET` 要求がルート URL `/` に送信された場合:</span><span class="sxs-lookup"><span data-stu-id="36060-137">When an HTTP `GET` request is sent to the root URL `/`:</span></span>
  * <span data-ttu-id="36060-138">示されている要求デリゲートが実行されます。</span><span class="sxs-lookup"><span data-stu-id="36060-138">The request delegate shown executes.</span></span>
  * <span data-ttu-id="36060-139">`Hello World!` が HTTP 応答に書き込まれます。</span><span class="sxs-lookup"><span data-stu-id="36060-139">`Hello World!` is written to the HTTP response.</span></span> <span data-ttu-id="36060-140">既定では、ルート URL `/` は `https://localhost:5001/` です。</span><span class="sxs-lookup"><span data-stu-id="36060-140">By default, the root URL `/` is `https://localhost:5001/`.</span></span>
* <span data-ttu-id="36060-141">要求メソッドが `GET` ではない場合、またはルート URL が `/` ではない場合は、一致するルートはなく、HTTP 404 が返されます。</span><span class="sxs-lookup"><span data-stu-id="36060-141">If the request method is not `GET` or the root URL is not `/`, no route matches and an HTTP 404 is returned.</span></span>

### <a name="endpoint"></a><span data-ttu-id="36060-142">エンドポイント</span><span class="sxs-lookup"><span data-stu-id="36060-142">Endpoint</span></span>

<a name="endpoint"></a>

<span data-ttu-id="36060-143">**エンドポイント**を定義するには、`MapGet` メソッドが使用されます。</span><span class="sxs-lookup"><span data-stu-id="36060-143">The `MapGet` method is used to define an **endpoint**.</span></span> <span data-ttu-id="36060-144">エンドポイントとは、次のようなものです。</span><span class="sxs-lookup"><span data-stu-id="36060-144">An endpoint is something that can be:</span></span>

* <span data-ttu-id="36060-145">URL と HTTP メソッドを一致させることによって選択できます。</span><span class="sxs-lookup"><span data-stu-id="36060-145">Selected, by matching the URL and HTTP method.</span></span>
* <span data-ttu-id="36060-146">デリゲートを実行することによって実行できます。</span><span class="sxs-lookup"><span data-stu-id="36060-146">Executed, by running the delegate.</span></span>

<span data-ttu-id="36060-147">アプリによって一致させて実行できるエンドポイントは、`UseEndpoints` で構成します。</span><span class="sxs-lookup"><span data-stu-id="36060-147">Endpoints that can be matched and executed by the app are configured in `UseEndpoints`.</span></span> <span data-ttu-id="36060-148">たとえば、<xref:Microsoft.AspNetCore.Builder.EndpointRouteBuilderExtensions.MapGet*>、<xref:Microsoft.AspNetCore.Builder.EndpointRouteBuilderExtensions.MapPost*>、および[類似のメソッド](xref:Microsoft.AspNetCore.Builder.EndpointRouteBuilderExtensions)では、要求のデリゲートがルーティング システムに接続されます。</span><span class="sxs-lookup"><span data-stu-id="36060-148">For example, <xref:Microsoft.AspNetCore.Builder.EndpointRouteBuilderExtensions.MapGet*>, <xref:Microsoft.AspNetCore.Builder.EndpointRouteBuilderExtensions.MapPost*>, and [similar methods](xref:Microsoft.AspNetCore.Builder.EndpointRouteBuilderExtensions) connect request delegates to the routing system.</span></span>
<span data-ttu-id="36060-149">他のメソッドを使用して、ASP.NET Core フレームワークの機能をルーティング システムに接続できます。</span><span class="sxs-lookup"><span data-stu-id="36060-149">Additional methods can be used to connect ASP.NET Core framework features to the routing system:</span></span>
- <span data-ttu-id="36060-150">[Razor Pages 用の MapRazorPages](xref:Microsoft.AspNetCore.Builder.RazorPagesEndpointRouteBuilderExtensions.MapRazorPages*)</span><span class="sxs-lookup"><span data-stu-id="36060-150">[MapRazorPages for Razor Pages](xref:Microsoft.AspNetCore.Builder.RazorPagesEndpointRouteBuilderExtensions.MapRazorPages*)</span></span>
- [<span data-ttu-id="36060-151">コントローラー用の MapControllers</span><span class="sxs-lookup"><span data-stu-id="36060-151">MapControllers for controllers</span></span>](xref:Microsoft.AspNetCore.Builder.ControllerEndpointRouteBuilderExtensions.MapControllers*)
- <span data-ttu-id="36060-152">[SignalR 用の MapHub\<THub>](xref:Microsoft.AspNetCore.SignalR.HubRouteBuilder.MapHub*)</span><span class="sxs-lookup"><span data-stu-id="36060-152">[MapHub\<THub> for SignalR](xref:Microsoft.AspNetCore.SignalR.HubRouteBuilder.MapHub*)</span></span> 
- [<span data-ttu-id="36060-153">gRPC 用の MapGrpcService\<TService></span><span class="sxs-lookup"><span data-stu-id="36060-153">MapGrpcService\<TService> for gRPC</span></span>](xref:grpc/aspnetcore)

<span data-ttu-id="36060-154">次の例では、より高度なルート テンプレートによるルーティングを示します。</span><span class="sxs-lookup"><span data-stu-id="36060-154">The following example shows routing with a more sophisticated route template:</span></span>

[!code-csharp[](routing/samples/3.x/RoutingSample/RouteTemplateStartup.cs?name=snippet)]

<span data-ttu-id="36060-155">文字列 `/hello/{name:alpha}` は、**ルート テンプレート**です。</span><span class="sxs-lookup"><span data-stu-id="36060-155">The string `/hello/{name:alpha}` is a **route template**.</span></span> <span data-ttu-id="36060-156">これは、エンドポイントの一致方法を構成するために使用されます。</span><span class="sxs-lookup"><span data-stu-id="36060-156">It is used to configure how the endpoint is matched.</span></span> <span data-ttu-id="36060-157">この場合、テンプレートは次のものと一致します。</span><span class="sxs-lookup"><span data-stu-id="36060-157">In this case, the template matches:</span></span>

* <span data-ttu-id="36060-158">`/hello/Ryan` のような URL</span><span class="sxs-lookup"><span data-stu-id="36060-158">A URL like `/hello/Ryan`</span></span>
* <span data-ttu-id="36060-159">`/hello/` で始まり、その後に一連の英字が続く任意の URL パス。</span><span class="sxs-lookup"><span data-stu-id="36060-159">Any URL path that begins with `/hello/` followed by a sequence of alphabetic characters.</span></span>  <span data-ttu-id="36060-160">`:alpha` では、英字のみと一致するルート制約が適用されます。</span><span class="sxs-lookup"><span data-stu-id="36060-160">`:alpha` applies a route constraint that matches only alphabetic characters.</span></span> <span data-ttu-id="36060-161">[ルート制約](#route-constraint-reference)については、このドキュメントで後ほど説明します。</span><span class="sxs-lookup"><span data-stu-id="36060-161">[Route constraints](#route-constraint-reference) are explained later in this document.</span></span>

<span data-ttu-id="36060-162">URL パスの 2 番目のセグメント `{name:alpha}` は次のようになります。</span><span class="sxs-lookup"><span data-stu-id="36060-162">The second segment of the URL path, `{name:alpha}`:</span></span>

* <span data-ttu-id="36060-163">`name` パラメーターにバインドされます。</span><span class="sxs-lookup"><span data-stu-id="36060-163">Is bound to the `name` parameter.</span></span>
* <span data-ttu-id="36060-164">キャプチャされて [HttpRequest.RouteValues](xref:Microsoft.AspNetCore.Http.HttpRequest.RouteValues*) に格納されます。</span><span class="sxs-lookup"><span data-stu-id="36060-164">Is captured and stored in [HttpRequest.RouteValues](xref:Microsoft.AspNetCore.Http.HttpRequest.RouteValues*).</span></span>

<span data-ttu-id="36060-165">このドキュメントで説明されているエンドポイント ルーティング システムは、ASP.NET Core 3.0 での新機能です。</span><span class="sxs-lookup"><span data-stu-id="36060-165">The endpoint routing system described in this document is new as of ASP.NET Core 3.0.</span></span> <span data-ttu-id="36060-166">ただし、ASP.NET Core のすべてのバージョンで、同じルート テンプレート機能とルート制約のセットがサポートされます。</span><span class="sxs-lookup"><span data-stu-id="36060-166">However, all versions of ASP.NET Core support the same set of route template features and route constraints.</span></span>

<span data-ttu-id="36060-167">次の例では、[正常性チェック](xref:host-and-deploy/health-checks)と承認を使用するルーティングを示します。</span><span class="sxs-lookup"><span data-stu-id="36060-167">The following example shows routing with [health checks](xref:host-and-deploy/health-checks) and authorization:</span></span>

[!code-csharp[](routing/samples/3.x/RoutingSample/AuthorizationStartup.cs?name=snippet)]

[!INCLUDE[request localized comments](~/includes/code-comments-loc.md)]

<span data-ttu-id="36060-168">上の例では、次の方法が示されています。</span><span class="sxs-lookup"><span data-stu-id="36060-168">The preceding example demonstrates how:</span></span>

* <span data-ttu-id="36060-169">ルーティングで承認ミドルウェアを使用できます。</span><span class="sxs-lookup"><span data-stu-id="36060-169">The authorization middleware can be used with routing.</span></span>
* <span data-ttu-id="36060-170">エンドポイントを使用して、承認動作を構成できます。</span><span class="sxs-lookup"><span data-stu-id="36060-170">Endpoints can be used to configure authorization behavior.</span></span>

<span data-ttu-id="36060-171"><xref:Microsoft.AspNetCore.Builder.HealthCheckEndpointRouteBuilderExtensions.MapHealthChecks*> の呼び出しにより、正常性チェック エンドポイントが追加されます。</span><span class="sxs-lookup"><span data-stu-id="36060-171">The <xref:Microsoft.AspNetCore.Builder.HealthCheckEndpointRouteBuilderExtensions.MapHealthChecks*> call adds a health check endpoint.</span></span> <span data-ttu-id="36060-172">この呼び出しに <xref:Microsoft.AspNetCore.Builder.AuthorizationEndpointConventionBuilderExtensions.RequireAuthorization*> をチェーンすると、エンドポイントに承認ポリシーがアタッチされます。</span><span class="sxs-lookup"><span data-stu-id="36060-172">Chaining <xref:Microsoft.AspNetCore.Builder.AuthorizationEndpointConventionBuilderExtensions.RequireAuthorization*> on to this call attaches an authorization policy to the endpoint.</span></span>

<span data-ttu-id="36060-173"><xref:Microsoft.AspNetCore.Builder.AuthAppBuilderExtensions.UseAuthentication*> と <xref:Microsoft.AspNetCore.Builder.AuthorizationAppBuilderExtensions.UseAuthorization*> を呼び出すと、認証ミドルウェアと承認ミドルウェアが追加されます。</span><span class="sxs-lookup"><span data-stu-id="36060-173">Calling <xref:Microsoft.AspNetCore.Builder.AuthAppBuilderExtensions.UseAuthentication*> and <xref:Microsoft.AspNetCore.Builder.AuthorizationAppBuilderExtensions.UseAuthorization*> adds the authentication and authorization middleware.</span></span> <span data-ttu-id="36060-174">これらのミドルウェアは、次のことができるように <xref:Microsoft.AspNetCore.Builder.EndpointRoutingApplicationBuilderExtensions.UseRouting*> と `UseEndpoints` の間に配置されます。</span><span class="sxs-lookup"><span data-stu-id="36060-174">These middleware are placed between <xref:Microsoft.AspNetCore.Builder.EndpointRoutingApplicationBuilderExtensions.UseRouting*> and `UseEndpoints` so that they can:</span></span>

* <span data-ttu-id="36060-175">`UseRouting` によって選択されたエンドポイントを確認します。</span><span class="sxs-lookup"><span data-stu-id="36060-175">See which endpoint was selected by `UseRouting`.</span></span>
* <span data-ttu-id="36060-176"><xref:Microsoft.AspNetCore.Builder.EndpointRoutingApplicationBuilderExtensions.UseEndpoints*> によってエンドポイントにディスパッチされる前に、承認ポリシーを適用します。</span><span class="sxs-lookup"><span data-stu-id="36060-176">Apply an authorization policy before <xref:Microsoft.AspNetCore.Builder.EndpointRoutingApplicationBuilderExtensions.UseEndpoints*> dispatches to the endpoint.</span></span>

<a name="metadata"></a>

### <a name="endpoint-metadata"></a><span data-ttu-id="36060-177">エンドポイントのメタデータ</span><span class="sxs-lookup"><span data-stu-id="36060-177">Endpoint metadata</span></span>

<span data-ttu-id="36060-178">前の例には 2 つのエンドポイントがありますが、承認ポリシーがアタッチされているのは正常性チェック エンドポイントだけです。</span><span class="sxs-lookup"><span data-stu-id="36060-178">In the preceding example, there are two endpoints, but only the health check endpoint has an authorization policy attached.</span></span> <span data-ttu-id="36060-179">要求が正常性チェック エンドポイント `/healthz` と一致した場合、承認チェックが実行されます。</span><span class="sxs-lookup"><span data-stu-id="36060-179">If the request matches the health check endpoint, `/healthz`, an authorization check is performed.</span></span> <span data-ttu-id="36060-180">これは、エンドポイントに追加のデータをアタッチできることを示しています。</span><span class="sxs-lookup"><span data-stu-id="36060-180">This demonstrates that endpoints can have extra data attached to them.</span></span> <span data-ttu-id="36060-181">この追加データは、エンドポイントの**メタデータ**と呼ばれます。</span><span class="sxs-lookup"><span data-stu-id="36060-181">This extra data is called endpoint **metadata**:</span></span>

* <span data-ttu-id="36060-182">メタデータは、ルーティング対応ミドルウェアによって処理できます。</span><span class="sxs-lookup"><span data-stu-id="36060-182">The metadata can be processed by routing-aware middleware.</span></span>
* <span data-ttu-id="36060-183">メタデータには、任意の .NET 型を使用できます。</span><span class="sxs-lookup"><span data-stu-id="36060-183">The metadata can be of any .NET type.</span></span>

## <a name="routing-concepts"></a><span data-ttu-id="36060-184">ルーティングの概念</span><span class="sxs-lookup"><span data-stu-id="36060-184">Routing concepts</span></span>

<span data-ttu-id="36060-185">ルーティング システムは、ミドルウェア パイプラインを基にして、強力な**エンドポイント**概念を追加することにより、構築されています。</span><span class="sxs-lookup"><span data-stu-id="36060-185">The routing system builds on top of the middleware pipeline by adding the powerful **endpoint** concept.</span></span> <span data-ttu-id="36060-186">エンドポイントは、ルーティング、承認、および任意の数の ASP.NET Core システムに関して相互に独立している、アプリの機能の単位を表します。</span><span class="sxs-lookup"><span data-stu-id="36060-186">Endpoints represent units of the app's functionality that are distinct from each other in terms of routing, authorization, and any number of ASP.NET Core's systems.</span></span>

<a name="endpoint"></a>

### <a name="aspnet-core-endpoint-definition"></a><span data-ttu-id="36060-187">ASP.NET Core エンドポイントの定義</span><span class="sxs-lookup"><span data-stu-id="36060-187">ASP.NET Core endpoint definition</span></span>

<span data-ttu-id="36060-188">ASP.NET Core エンドポイントとは次のようなものです。</span><span class="sxs-lookup"><span data-stu-id="36060-188">An ASP.NET Core endpoint is:</span></span>

* <span data-ttu-id="36060-189">実行可能: <xref:Microsoft.AspNetCore.Http.Endpoint.RequestDelegate> を持っています。</span><span class="sxs-lookup"><span data-stu-id="36060-189">Executable: Has a <xref:Microsoft.AspNetCore.Http.Endpoint.RequestDelegate>.</span></span>
* <span data-ttu-id="36060-190">拡張可能: [Metadata](xref:Microsoft.AspNetCore.Http.Endpoint.Metadata*) コレクションを持っています。</span><span class="sxs-lookup"><span data-stu-id="36060-190">Extensible: Has a [Metadata](xref:Microsoft.AspNetCore.Http.Endpoint.Metadata*) collection.</span></span>
* <span data-ttu-id="36060-191">Selectable: 必要に応じて、[ルーティング情報](xref:Microsoft.AspNetCore.Routing.RouteEndpoint.RoutePattern*)を持ちます。</span><span class="sxs-lookup"><span data-stu-id="36060-191">Selectable: Optionally, has [routing information](xref:Microsoft.AspNetCore.Routing.RouteEndpoint.RoutePattern*).</span></span>
* <span data-ttu-id="36060-192">列挙可能: エンドポイントのコレクションの一覧は、[DI](xref:fundamentals/dependency-injection) から <xref:Microsoft.AspNetCore.Routing.EndpointDataSource> を取得することによって得られます。</span><span class="sxs-lookup"><span data-stu-id="36060-192">Enumerable: The collection of endpoints can be listed by retrieving the <xref:Microsoft.AspNetCore.Routing.EndpointDataSource> from [DI](xref:fundamentals/dependency-injection).</span></span>

<span data-ttu-id="36060-193">次のコードでは、エンドポイントを取得し、現在の要求と一致するものを検査する方法を示します。</span><span class="sxs-lookup"><span data-stu-id="36060-193">The following code shows how to retrieve and inspect the endpoint matching the current request:</span></span>

[!code-csharp[](routing/samples/3.x/RoutingSample/EndpointInspectorStartup.cs?name=snippet)]

<span data-ttu-id="36060-194">エンドポイントが選択されている場合は、`HttpContext` から取得できます。</span><span class="sxs-lookup"><span data-stu-id="36060-194">The endpoint, if selected, can be retrieved from the `HttpContext`.</span></span> <span data-ttu-id="36060-195">そのプロパティを検査できます。</span><span class="sxs-lookup"><span data-stu-id="36060-195">Its properties can be inspected.</span></span> <span data-ttu-id="36060-196">エンドポイント オブジェクトは不変であり、作成後に変更することはできません。</span><span class="sxs-lookup"><span data-stu-id="36060-196">Endpoint objects are immutable and cannot be modified after creation.</span></span> <span data-ttu-id="36060-197">最も一般的なエンドポイントの型は <xref:Microsoft.AspNetCore.Routing.RouteEndpoint> です。</span><span class="sxs-lookup"><span data-stu-id="36060-197">The most common type of endpoint is a <xref:Microsoft.AspNetCore.Routing.RouteEndpoint>.</span></span> <span data-ttu-id="36060-198">`RouteEndpoint` には、ルーティング システムによる選択を可能にする情報が含まれています。</span><span class="sxs-lookup"><span data-stu-id="36060-198">`RouteEndpoint` includes information that allows it to be to selected by the routing system.</span></span>

<span data-ttu-id="36060-199">上のコードでは、[app.Use](xref:Microsoft.AspNetCore.Builder.UseExtensions.Use*) によってインライン [ミドルウェア](xref:fundamentals/middleware/index)が構成されます。</span><span class="sxs-lookup"><span data-stu-id="36060-199">In the preceding code, [app.Use](xref:Microsoft.AspNetCore.Builder.UseExtensions.Use*) configures an in-line [middleware](xref:fundamentals/middleware/index).</span></span>

<a name="mt"></a>

<span data-ttu-id="36060-200">次のコードでは、パイプラインで `app.Use` が呼び出される場所によっては、エンドポイントが存在しない場合があることを示します。</span><span class="sxs-lookup"><span data-stu-id="36060-200">The following code shows that, depending on where `app.Use` is called in the pipeline, there may not be an endpoint:</span></span>

[!code-csharp[](routing/samples/3.x/RoutingSample/MiddlewareFlowStartup.cs?name=snippet)]

<span data-ttu-id="36060-201">前のサンプルでは、エンドポイントが選択されているかどうかを表示する `Console.WriteLine` ステートメントが追加されています。</span><span class="sxs-lookup"><span data-stu-id="36060-201">This preceding sample adds `Console.WriteLine` statements that display whether or not an endpoint has been selected.</span></span> <span data-ttu-id="36060-202">わかりやすくするため、このサンプルでは、指定された `/` エンドポイントに表示名が割り当てられています。</span><span class="sxs-lookup"><span data-stu-id="36060-202">For clarity, the sample assigns a display name to the provided `/` endpoint.</span></span>

<span data-ttu-id="36060-203">このコードを `/` の URL で実行すると、次のように表示されます。</span><span class="sxs-lookup"><span data-stu-id="36060-203">Running this code with a URL of `/` displays:</span></span>

```txt
1. Endpoint: (null)
2. Endpoint: Hello
3. Endpoint: Hello
```

<span data-ttu-id="36060-204">このコード他の URL で実行すると、次のように表示されます。</span><span class="sxs-lookup"><span data-stu-id="36060-204">Running this code with any other URL displays:</span></span>

```txt
1. Endpoint: (null)
2. Endpoint: (null)
4. Endpoint: (null)
```

<span data-ttu-id="36060-205">この出力は次のことを示しています。</span><span class="sxs-lookup"><span data-stu-id="36060-205">This output demonstrates that:</span></span>

* <span data-ttu-id="36060-206">`UseRouting` が呼び出される前は、エンドポイントは常に null になっています。</span><span class="sxs-lookup"><span data-stu-id="36060-206">The endpoint is always null before `UseRouting` is called.</span></span>
* <span data-ttu-id="36060-207">一致が見つかった場合、エンドポイントは `UseRouting` と <xref:Microsoft.AspNetCore.Builder.EndpointRoutingApplicationBuilderExtensions.UseEndpoints*> の間で null 以外の値になります。</span><span class="sxs-lookup"><span data-stu-id="36060-207">If a match is found, the endpoint is non-null between `UseRouting` and <xref:Microsoft.AspNetCore.Builder.EndpointRoutingApplicationBuilderExtensions.UseEndpoints*>.</span></span>
* <span data-ttu-id="36060-208">一致が見つかると、`UseEndpoints` ミドルウェアは**ターミナル**です。</span><span class="sxs-lookup"><span data-stu-id="36060-208">The `UseEndpoints` middleware is **terminal** when a match is found.</span></span> <span data-ttu-id="36060-209">[ターミナル ミドルウェア](#tm)については、このドキュメントで後ほど定義します。</span><span class="sxs-lookup"><span data-stu-id="36060-209">[Terminal middleware](#tm) is defined later in this document.</span></span>
* <span data-ttu-id="36060-210">`UseEndpoints` の後のミドルウェアは、一致が検出されなかった場合にのみ実行されます。</span><span class="sxs-lookup"><span data-stu-id="36060-210">The middleware after `UseEndpoints` execute only when no match is found.</span></span>

<span data-ttu-id="36060-211">`UseRouting` ミドルウェアでは、[SetEndpoint](xref:Microsoft.AspNetCore.Http.EndpointHttpContextExtensions.SetEndpoint*) メソッドを使用して、エンドポイントが現在のコンテキストにアタッチされます。</span><span class="sxs-lookup"><span data-stu-id="36060-211">The `UseRouting` middleware uses the [SetEndpoint](xref:Microsoft.AspNetCore.Http.EndpointHttpContextExtensions.SetEndpoint*) method to attach the endpoint to the current context.</span></span> <span data-ttu-id="36060-212">`UseRouting` ミドルウェアをカスタム ロジックに置き換えることができ、その場合でもエンドポイントを使用する利点を得られます。</span><span class="sxs-lookup"><span data-stu-id="36060-212">It's possible to replace the `UseRouting` middleware with custom logic and still get the benefits of using endpoints.</span></span> <span data-ttu-id="36060-213">エンドポイントはミドルウェアのような低レベルのプリミティブであり、ルーティングの実装には結合されません。</span><span class="sxs-lookup"><span data-stu-id="36060-213">Endpoints are a low-level primitive like middleware, and aren't coupled to the routing implementation.</span></span> <span data-ttu-id="36060-214">ほとんどのアプリでは、`UseRouting` をカスタム ロジックに置き換える必要はありません。</span><span class="sxs-lookup"><span data-stu-id="36060-214">Most apps don't need to replace `UseRouting` with custom logic.</span></span>

<span data-ttu-id="36060-215">`UseEndpoints` ミドルウェアは、`UseRouting` ミドルウェアと連携して使用するように設計されています。</span><span class="sxs-lookup"><span data-stu-id="36060-215">The `UseEndpoints` middleware is designed to be used in tandem with the `UseRouting` middleware.</span></span> <span data-ttu-id="36060-216">エンドポイントを実行するためのコア ロジックは複雑ではありません。</span><span class="sxs-lookup"><span data-stu-id="36060-216">The core logic to execute an endpoint isn't complicated.</span></span> <span data-ttu-id="36060-217"><xref:Microsoft.AspNetCore.Http.EndpointHttpContextExtensions.GetEndpoint*> を使用してエンドポイントを取得し、その <xref:Microsoft.AspNetCore.Http.Endpoint.RequestDelegate> プロパティを呼び出します。</span><span class="sxs-lookup"><span data-stu-id="36060-217">Use <xref:Microsoft.AspNetCore.Http.EndpointHttpContextExtensions.GetEndpoint*> to retrieve the endpoint, and then invoke its <xref:Microsoft.AspNetCore.Http.Endpoint.RequestDelegate> property.</span></span>

<span data-ttu-id="36060-218">次のコードでは、ミドルウェアがルーティングに与える影響またはルーティングに対応する方法を示します。</span><span class="sxs-lookup"><span data-stu-id="36060-218">The following code demonstrates how middleware can influence or react to routing:</span></span>

[!code-csharp[](routing/samples/3.x/RoutingSample/IntegratedMiddlewareStartup.cs?name=snippet)]

<span data-ttu-id="36060-219">前の例では、2 つの重要な概念が示されています。</span><span class="sxs-lookup"><span data-stu-id="36060-219">The preceding example demonstrates two important concepts:</span></span>

* <span data-ttu-id="36060-220">ミドルウェアは、`UseRouting` の前に実行して、ルーティングの動作に使用されるデータを変更できます。</span><span class="sxs-lookup"><span data-stu-id="36060-220">Middleware can run before `UseRouting` to modify the data that routing operates upon.</span></span>
    * <span data-ttu-id="36060-221">通常、ルーティングの前に出現するミドルウェアでは、<xref:Microsoft.AspNetCore.Builder.RewriteBuilderExtensions.UseRewriter*>、<xref:Microsoft.AspNetCore.Builder.HttpMethodOverrideExtensions.UseHttpMethodOverride*>、<xref:Microsoft.AspNetCore.Builder.UsePathBaseExtensions.UsePathBase*> などの要求のプロパティが変更されます。</span><span class="sxs-lookup"><span data-stu-id="36060-221">Usually middleware that appears before routing modifies some property of the request, such as <xref:Microsoft.AspNetCore.Builder.RewriteBuilderExtensions.UseRewriter*>, <xref:Microsoft.AspNetCore.Builder.HttpMethodOverrideExtensions.UseHttpMethodOverride*>, or <xref:Microsoft.AspNetCore.Builder.UsePathBaseExtensions.UsePathBase*>.</span></span>
* <span data-ttu-id="36060-222">ミドルウェアは、`UseRouting` と <xref:Microsoft.AspNetCore.Builder.EndpointRoutingApplicationBuilderExtensions.UseEndpoints*> の間で実行して、エンドポイントが実行される前にルーティングの結果を処理できます。</span><span class="sxs-lookup"><span data-stu-id="36060-222">Middleware can run between `UseRouting` and <xref:Microsoft.AspNetCore.Builder.EndpointRoutingApplicationBuilderExtensions.UseEndpoints*> to process the results of routing before the endpoint is executed.</span></span>
    * <span data-ttu-id="36060-223">`UseRouting` と `UseEndpoints` の間で実行されるミドルウェア:</span><span class="sxs-lookup"><span data-stu-id="36060-223">Middleware that runs between `UseRouting` and `UseEndpoints`:</span></span>
      * <span data-ttu-id="36060-224">通常、メタデータを検査してエンドポイントを認識します。</span><span class="sxs-lookup"><span data-stu-id="36060-224">Usually inspects metadata to understand the endpoints.</span></span>
      * <span data-ttu-id="36060-225">多くの場合、`UseAuthorization` や `UseCors` によって実行されるセキュリティに関する決定を行います。</span><span class="sxs-lookup"><span data-stu-id="36060-225">Often makes security decisions, as done by `UseAuthorization` and `UseCors`.</span></span>
    * <span data-ttu-id="36060-226">ミドルウェアとメタデータを組み合わせることで、エンドポイントごとにポリシーを構成できます。</span><span class="sxs-lookup"><span data-stu-id="36060-226">The combination of middleware and metadata allows configuring policies per-endpoint.</span></span>

<span data-ttu-id="36060-227">上のコードでは、エンドポイントごとのポリシーをサポートするカスタム ミドルウェアの例が示されています。</span><span class="sxs-lookup"><span data-stu-id="36060-227">The preceding code shows an example of a custom middleware that supports per-endpoint policies.</span></span> <span data-ttu-id="36060-228">ミドルウェアによって、機密データへのアクセスの "*監査ログ*" がコンソールに書き込まれます。</span><span class="sxs-lookup"><span data-stu-id="36060-228">The middleware writes an *audit log* of access to sensitive data to the console.</span></span> <span data-ttu-id="36060-229">`AuditPolicyAttribute` メタデータを使用して、エンドポイントを "*監査する*" ようにミドルウェアを構成できます。</span><span class="sxs-lookup"><span data-stu-id="36060-229">The middleware can be configured to *audit* an endpoint with the `AuditPolicyAttribute` metadata.</span></span> <span data-ttu-id="36060-230">このサンプルでは、機密としてマークされているエンドポイントのみが監査される "*オプトイン*" パターンを示します。</span><span class="sxs-lookup"><span data-stu-id="36060-230">This sample demonstrates an *opt-in* pattern where only endpoints that are marked as sensitive are audited.</span></span> <span data-ttu-id="36060-231">このロジックの逆を定義して、たとえば安全としてマークされていないすべてのものを監査することができます。</span><span class="sxs-lookup"><span data-stu-id="36060-231">It's possible to define this logic in reverse, auditing everything that isn't marked as safe, for example.</span></span> <span data-ttu-id="36060-232">エンドポイント メタデータ システムは柔軟です。</span><span class="sxs-lookup"><span data-stu-id="36060-232">The endpoint metadata system is flexible.</span></span> <span data-ttu-id="36060-233">ユース ケースに適したどのような方法でも、このロジックを設計できます。</span><span class="sxs-lookup"><span data-stu-id="36060-233">This logic could be designed in whatever way suits the use case.</span></span>

<span data-ttu-id="36060-234">前のサンプル コードは、エンドポイントの基本的な概念を示すことが意図されています。</span><span class="sxs-lookup"><span data-stu-id="36060-234">The preceding sample code is intended to demonstrate the basic concepts of endpoints.</span></span> <span data-ttu-id="36060-235">**サンプルは運用環境での使用は意図されていません**。</span><span class="sxs-lookup"><span data-stu-id="36060-235">**The sample is not intended for production use**.</span></span> <span data-ttu-id="36060-236">より完全なバージョンの "*監査ログ*" ミドルウェアでは、次のことが行われます。</span><span class="sxs-lookup"><span data-stu-id="36060-236">A more complete version of an *audit log* middleware would:</span></span>

* <span data-ttu-id="36060-237">ファイルまたはデータベースにログを記録します。</span><span class="sxs-lookup"><span data-stu-id="36060-237">Log to a file or database.</span></span>
* <span data-ttu-id="36060-238">ユーザー、IP アドレス、機密性の高いエンドポイントの名前などの詳細情報が追加されます。</span><span class="sxs-lookup"><span data-stu-id="36060-238">Include details such as the user, IP address, name of the sensitive endpoint, and more.</span></span>

<span data-ttu-id="36060-239">コントローラーや SignalR などのクラスベースのフレームワークで簡単に使用できるように、監査ポリシー メタデータ `AuditPolicyAttribute` は `Attribute` と定義されています。</span><span class="sxs-lookup"><span data-stu-id="36060-239">The audit policy metadata `AuditPolicyAttribute` is defined as an `Attribute` for easier use with class-based frameworks such as controllers and SignalR.</span></span> <span data-ttu-id="36060-240">"*コードへのルーティング*" を使用すると、次のようになります。</span><span class="sxs-lookup"><span data-stu-id="36060-240">When using *route to code*:</span></span>

* <span data-ttu-id="36060-241">メタデータがビルダー API にアタッチされます。</span><span class="sxs-lookup"><span data-stu-id="36060-241">Metadata is attached with a builder API.</span></span>
* <span data-ttu-id="36060-242">エンドポイントを作成するとき、クラス ベースのフレームワークに、対応するメソッドとクラスのすべての属性が組み込まれます。</span><span class="sxs-lookup"><span data-stu-id="36060-242">Class-based frameworks include all attributes on the corresponding method and class when creating endpoints.</span></span>

<span data-ttu-id="36060-243">メタデータの型に対するベスト プラクティスは、インターフェイスまたは属性として定義することです。</span><span class="sxs-lookup"><span data-stu-id="36060-243">The best practices for metadata types are to define them either as interfaces or attributes.</span></span> <span data-ttu-id="36060-244">インターフェイスと属性では、コードを再利用できます。</span><span class="sxs-lookup"><span data-stu-id="36060-244">Interfaces and attributes allow code reuse.</span></span> <span data-ttu-id="36060-245">メタデータ システムは柔軟であり、どのような制限もありません。</span><span class="sxs-lookup"><span data-stu-id="36060-245">The metadata system is flexible and doesn't impose any limitations.</span></span>

<a name="tm"></a>

### <a name="comparing-a-terminal-middleware-and-routing"></a><span data-ttu-id="36060-246">ターミナル ミドルウェアとルーティングの比較</span><span class="sxs-lookup"><span data-stu-id="36060-246">Comparing a terminal middleware and routing</span></span>

<span data-ttu-id="36060-247">次のコード サンプルでは、ミドルウェアの使用とルーティングの使用が比較されています。</span><span class="sxs-lookup"><span data-stu-id="36060-247">The following code sample contrasts using middleware with using routing:</span></span>

[!code-csharp[](routing/samples/3.x/RoutingSample/TerminalMiddlewareStartup.cs?name=snippet)]

<span data-ttu-id="36060-248">`Approach 1:` で示されているミドルウェアのスタイルは、**ターミナル ミドルウェア**です。</span><span class="sxs-lookup"><span data-stu-id="36060-248">The style of middleware shown with `Approach 1:` is **terminal middleware**.</span></span> <span data-ttu-id="36060-249">ターミナル ミドルウェアと呼ばれるのは、照合操作を実行するためです。</span><span class="sxs-lookup"><span data-stu-id="36060-249">It's called terminal middleware because it does a matching operation:</span></span>

* <span data-ttu-id="36060-250">前のサンプルの照合操作は、ミドルウェアの場合は `Path == "/"`、ルーティングの場合は `Path == "/Movie"` です。</span><span class="sxs-lookup"><span data-stu-id="36060-250">The matching operation in the preceding sample is `Path == "/"` for the middleware and `Path == "/Movie"` for routing.</span></span>
* <span data-ttu-id="36060-251">照合が成功すると、`next` ミドルウェアを呼び出すのではなく、一部の機能を実行して戻ります。</span><span class="sxs-lookup"><span data-stu-id="36060-251">When a match is successful, it executes some functionality and returns, rather than invoking the `next` middleware.</span></span>

<span data-ttu-id="36060-252">ターミナル ミドルウェアと呼ばれるのは、検索を終了し、いくつかの機能を実行してから制御を返すためです。</span><span class="sxs-lookup"><span data-stu-id="36060-252">It's called terminal middleware because it terminates the search, executes some functionality, and then returns.</span></span>

<span data-ttu-id="36060-253">ターミナル ミドルウェアとルーティングの比較:</span><span class="sxs-lookup"><span data-stu-id="36060-253">Comparing a terminal middleware and routing:</span></span>
* <span data-ttu-id="36060-254">どちらの方法でも、処理パイプラインを終了できます。</span><span class="sxs-lookup"><span data-stu-id="36060-254">Both approaches allow terminating the processing pipeline:</span></span>
    * <span data-ttu-id="36060-255">ミドルウェアでは、`next` を呼び出すのではなく、戻ることによってパイプラインが終了されます。</span><span class="sxs-lookup"><span data-stu-id="36060-255">Middleware terminates the pipeline by returning rather than invoking `next`.</span></span>
    * <span data-ttu-id="36060-256">エンドポイントは常にターミナルです。</span><span class="sxs-lookup"><span data-stu-id="36060-256">Endpoints are always terminal.</span></span>
* <span data-ttu-id="36060-257">ターミナル ミドルウェアを使用すると、パイプライン内の任意の場所にミドルウェアを配置できます。</span><span class="sxs-lookup"><span data-stu-id="36060-257">Terminal middleware allows positioning the middleware at an arbitrary place in the pipeline:</span></span>
    * <span data-ttu-id="36060-258">エンドポイントは、<xref:Microsoft.AspNetCore.Builder.EndpointRoutingApplicationBuilderExtensions.UseEndpoints*> の位置で実行されます。</span><span class="sxs-lookup"><span data-stu-id="36060-258">Endpoints execute at the position of <xref:Microsoft.AspNetCore.Builder.EndpointRoutingApplicationBuilderExtensions.UseEndpoints*>.</span></span>
* <span data-ttu-id="36060-259">ターミナル ミドルウェアでは、任意のコードを使用してミドルウェアが一致するかどうかを判定できます。</span><span class="sxs-lookup"><span data-stu-id="36060-259">Terminal middleware allows arbitrary code to determine when the middleware matches:</span></span>
    * <span data-ttu-id="36060-260">カスタム ルート一致コードは、冗長で、正しく記述するのが困難な場合があります。</span><span class="sxs-lookup"><span data-stu-id="36060-260">Custom route matching code can be verbose and difficult to write correctly.</span></span>
    * <span data-ttu-id="36060-261">ルーティングでは、一般的なアプリに対して簡単なソリューションが提供されます。</span><span class="sxs-lookup"><span data-stu-id="36060-261">Routing provides straightforward solutions for typical apps.</span></span> <span data-ttu-id="36060-262">ほとんどのアプリでは、カスタム ルート一致コードは必要ありません。</span><span class="sxs-lookup"><span data-stu-id="36060-262">Most apps don't require custom route matching code.</span></span>
* <span data-ttu-id="36060-263">`UseAuthorization` や `UseCors` などのミドルウェアを使用したエンドポイント インターフェイス。</span><span class="sxs-lookup"><span data-stu-id="36060-263">Endpoints interface with middleware such as `UseAuthorization` and `UseCors`.</span></span>
    * <span data-ttu-id="36060-264">`UseAuthorization` または `UseCors` でターミナル ミドルウェアを使用するには、承認システムとの手動インターフェイスが必要です。</span><span class="sxs-lookup"><span data-stu-id="36060-264">Using a terminal middleware with `UseAuthorization` or `UseCors` requires manual interfacing with the authorization system.</span></span>

<span data-ttu-id="36060-265">[エンドポイント](#endpoint) では、次の両方が定義されます。</span><span class="sxs-lookup"><span data-stu-id="36060-265">An [endpoint](#endpoint) defines both:</span></span>

* <span data-ttu-id="36060-266">要求を処理するためのデリゲート。</span><span class="sxs-lookup"><span data-stu-id="36060-266">A delegate to process requests.</span></span>
* <span data-ttu-id="36060-267">任意のメタデータのコレクション。</span><span class="sxs-lookup"><span data-stu-id="36060-267">A collection of arbitrary metadata.</span></span> <span data-ttu-id="36060-268">メタデータは、各エンドポイントにアタッチされている構成とポリシーに基づいて横断的な関心事を実装するために使用されます。</span><span class="sxs-lookup"><span data-stu-id="36060-268">The metadata is used to implement cross-cutting concerns based on policies and configuration attached to each endpoint.</span></span>

<span data-ttu-id="36060-269">ターミナル ミドルウェアは効果的なツールになる可能性がありますが、次のものが必要です。</span><span class="sxs-lookup"><span data-stu-id="36060-269">Terminal middleware can be an effective tool, but can require:</span></span>

* <span data-ttu-id="36060-270">大量のコーディングとテスト。</span><span class="sxs-lookup"><span data-stu-id="36060-270">A significant amount of coding and testing.</span></span>
* <span data-ttu-id="36060-271">必要なレベルの柔軟性を実現するための、他のシステムとの手作業による統合。</span><span class="sxs-lookup"><span data-stu-id="36060-271">Manual integration with other systems to achieve the desired level of flexibility.</span></span>

<span data-ttu-id="36060-272">ターミナル ミドルウェアを作成する前に、ルーティングとの統合を検討してください。</span><span class="sxs-lookup"><span data-stu-id="36060-272">Consider integrating with routing before writing a terminal middleware.</span></span>

<span data-ttu-id="36060-273">[Map](xref:fundamentals/middleware/index#branch-the-middleware-pipeline) または <xref:Microsoft.AspNetCore.Builder.MapWhenExtensions.MapWhen*> と統合されている既存のターミナル ミドルウェアは、通常、ルーティング対応のエンドポイントにすることができます。</span><span class="sxs-lookup"><span data-stu-id="36060-273">Existing terminal middleware that integrates with [Map](xref:fundamentals/middleware/index#branch-the-middleware-pipeline) or <xref:Microsoft.AspNetCore.Builder.MapWhenExtensions.MapWhen*> can usually be turned into a routing aware endpoint.</span></span> <span data-ttu-id="36060-274">[MapHealthChecks](https://github.com/aspnet/AspNetCore/blob/master/src/Middleware/HealthChecks/src/Builder/HealthCheckEndpointRouteBuilderExtensions.cs#L16) では、ルーターウェアのパターンが示されています。</span><span class="sxs-lookup"><span data-stu-id="36060-274">[MapHealthChecks](https://github.com/aspnet/AspNetCore/blob/master/src/Middleware/HealthChecks/src/Builder/HealthCheckEndpointRouteBuilderExtensions.cs#L16) demonstrates the pattern for router-ware:</span></span>
* <span data-ttu-id="36060-275"><xref:Microsoft.AspNetCore.Routing.IEndpointRouteBuilder> で拡張メソッドを作成します。</span><span class="sxs-lookup"><span data-stu-id="36060-275">Write an extension method on <xref:Microsoft.AspNetCore.Routing.IEndpointRouteBuilder>.</span></span>
* <span data-ttu-id="36060-276"><xref:Microsoft.AspNetCore.Routing.IEndpointRouteBuilder.CreateApplicationBuilder*> を使用して、入れ子になったミドルウェア パイプラインを作成します。</span><span class="sxs-lookup"><span data-stu-id="36060-276">Create a nested middleware pipeline using <xref:Microsoft.AspNetCore.Routing.IEndpointRouteBuilder.CreateApplicationBuilder*>.</span></span>
* <span data-ttu-id="36060-277">ミドルウェアを新しいパイプラインにアタッチします。</span><span class="sxs-lookup"><span data-stu-id="36060-277">Attach the middleware to the new pipeline.</span></span> <span data-ttu-id="36060-278">例では、 <xref:Microsoft.AspNetCore.Builder.HealthCheckApplicationBuilderExtensions.UseHealthChecks*>が使用されます。</span><span class="sxs-lookup"><span data-stu-id="36060-278">In this case, <xref:Microsoft.AspNetCore.Builder.HealthCheckApplicationBuilderExtensions.UseHealthChecks*>.</span></span>
* <span data-ttu-id="36060-279"><xref:Microsoft.AspNetCore.Http.RequestDelegate> にミドルウェア パイプラインを <xref:Microsoft.AspNetCore.Builder.IApplicationBuilder.Build*> します。</span><span class="sxs-lookup"><span data-stu-id="36060-279"><xref:Microsoft.AspNetCore.Builder.IApplicationBuilder.Build*> the middleware pipeline into a <xref:Microsoft.AspNetCore.Http.RequestDelegate>.</span></span>
* <span data-ttu-id="36060-280">`Map` を呼び出し、新しいミドルウェア パイプラインを提供します。</span><span class="sxs-lookup"><span data-stu-id="36060-280">Call `Map` and provide the new middleware pipeline.</span></span>
* <span data-ttu-id="36060-281">拡張メソッドから `Map` によって提供されるビルダー オブジェクトを返します。</span><span class="sxs-lookup"><span data-stu-id="36060-281">Return the builder object provided by `Map` from the extension method.</span></span>

<span data-ttu-id="36060-282">次のコードでは、[MapHealthChecks](xref:host-and-deploy/health-checks) の使用方法を示します。</span><span class="sxs-lookup"><span data-stu-id="36060-282">The following code shows use of [MapHealthChecks](xref:host-and-deploy/health-checks):</span></span>

[!code-csharp[](routing/samples/3.x/RoutingSample/AuthorizationStartup.cs?name=snippet)]

<span data-ttu-id="36060-283">前のサンプルでは、ビルダー オブジェクトを返すことが重要である理由が示されています。</span><span class="sxs-lookup"><span data-stu-id="36060-283">The preceding sample shows why returning the builder object is important.</span></span> <span data-ttu-id="36060-284">ビルダー オブジェクトを返すことで、アプリ開発者はエンドポイントの承認などのポリシーを構成できます。</span><span class="sxs-lookup"><span data-stu-id="36060-284">Returning the builder object allows the app developer to configure policies such as authorization for the endpoint.</span></span> <span data-ttu-id="36060-285">この例では、正常性チェック ミドルウェアと承認システムは直接統合されていません。</span><span class="sxs-lookup"><span data-stu-id="36060-285">In this example, the health checks middleware has no direct integration with the authorization system.</span></span>

<span data-ttu-id="36060-286">そのメタデータ システムは、ターミナル ミドルウェアを使用する機能拡張作成者によって、発生する問題に対応して作成されました。</span><span class="sxs-lookup"><span data-stu-id="36060-286">The metadata system was created in response to the problems encountered by extensibility authors using terminal middleware.</span></span> <span data-ttu-id="36060-287">各ミドルウェアで承認システムとの独自の統合を実装することには問題があります。</span><span class="sxs-lookup"><span data-stu-id="36060-287">It's problematic for each middleware to implement its own integration with the authorization system.</span></span>

<a name="urlm"></a>

### <a name="url-matching"></a><span data-ttu-id="36060-288">URL 一致</span><span class="sxs-lookup"><span data-stu-id="36060-288">URL matching</span></span>

* <span data-ttu-id="36060-289">ルーティングによって受信要求が[エンドポイント](#endpoint)と照合されるプロセスです。</span><span class="sxs-lookup"><span data-stu-id="36060-289">Is the process by which routing matches an incoming request to an [endpoint](#endpoint).</span></span>
* <span data-ttu-id="36060-290">URL パスとヘッダーのデータに基づいています。</span><span class="sxs-lookup"><span data-stu-id="36060-290">Is based on data in the URL path and headers.</span></span>
* <span data-ttu-id="36060-291">要求内の任意のデータを考慮するように拡張できます。</span><span class="sxs-lookup"><span data-stu-id="36060-291">Can be extended to consider any data in the request.</span></span>

<span data-ttu-id="36060-292">実行されたルーティング ミドルウェアでは、`Endpoint` が設定され、現在の要求からの <xref:Microsoft.AspNetCore.Http.HttpContext> で[要求機能](xref:fundamentals/request-features)に値がルーティングされます。</span><span class="sxs-lookup"><span data-stu-id="36060-292">When a routing middleware executes, it sets an `Endpoint` and route values to a [request feature](xref:fundamentals/request-features) on the <xref:Microsoft.AspNetCore.Http.HttpContext> from the current request:</span></span>

* <span data-ttu-id="36060-293">[HttpContext.GetEndpoint](<xref:Microsoft.AspNetCore.Http.EndpointHttpContextExtensions.GetEndpoint*>) を呼び出すと、エンドポイントが取得されます。</span><span class="sxs-lookup"><span data-stu-id="36060-293">Calling [HttpContext.GetEndpoint](<xref:Microsoft.AspNetCore.Http.EndpointHttpContextExtensions.GetEndpoint*>) gets the endpoint.</span></span>
* <span data-ttu-id="36060-294">`HttpRequest.RouteValues` では、ルート値のコレクションが取得されます。</span><span class="sxs-lookup"><span data-stu-id="36060-294">`HttpRequest.RouteValues` gets the collection of route values.</span></span>

<span data-ttu-id="36060-295">ルーティング ミドルウェアの後で実行された[ミドルウェア](xref:fundamentals/middleware/index)では、エンドポイントを調べて、アクションを実行することができます。</span><span class="sxs-lookup"><span data-stu-id="36060-295">[Middleware](xref:fundamentals/middleware/index) running after the routing middleware can inspect the endpoint and take action.</span></span> <span data-ttu-id="36060-296">たとえば、承認ミドルウェアでは、エンドポイントのメタデータ コレクションに対し、承認ポリシーを問い合わせることができます。</span><span class="sxs-lookup"><span data-stu-id="36060-296">For example, an authorization middleware can interrogate the endpoint's metadata collection for an authorization policy.</span></span> <span data-ttu-id="36060-297">要求処理パイプライン内のすべてのミドルウェアが実行された後、選択したエンドポイントのデリゲートが呼び出されます。</span><span class="sxs-lookup"><span data-stu-id="36060-297">After all of the middleware in the request processing pipeline is executed, the selected endpoint's delegate is invoked.</span></span>

<span data-ttu-id="36060-298">エンドポイント ルーティングのルーティング システムでは、配布に関するすべての決定が行われます。</span><span class="sxs-lookup"><span data-stu-id="36060-298">The routing system in endpoint routing is responsible for all dispatching decisions.</span></span> <span data-ttu-id="36060-299">ミドルウェアでは選択されたエンドポイントに基づいてポリシーが適用されるため、次のことが重要です。</span><span class="sxs-lookup"><span data-stu-id="36060-299">Because the middleware applies policies based on the selected endpoint, it's important that:</span></span>

* <span data-ttu-id="36060-300">ディスパッチまたはセキュリティ ポリシーの適用に影響を与える可能性のある決定は、ルーティング システム内で行われます。</span><span class="sxs-lookup"><span data-stu-id="36060-300">Any decision that can affect dispatching or the application of security policies is made inside the routing system.</span></span>

> [!WARNING]
> <span data-ttu-id="36060-301">後方互換性のために、コントローラーまたは Razor Pages エンドポイント デリゲートが実行されると、それまでに実行された要求処理に基づいて、[RouteContext.RouteData](xref:Microsoft.AspNetCore.Routing.RouteContext.RouteData) のプロパティが適切な値に設定されます。</span><span class="sxs-lookup"><span data-stu-id="36060-301">For backwards-compatibility, when a Controller or Razor Pages endpoint delegate is executed, the properties of [RouteContext.RouteData](xref:Microsoft.AspNetCore.Routing.RouteContext.RouteData) are set to appropriate values based on the request processing performed thus far.</span></span>
>
> <span data-ttu-id="36060-302">`RouteContext` の種類は、今後のリリースでは古いものとしてマークされます。</span><span class="sxs-lookup"><span data-stu-id="36060-302">The `RouteContext` type will be marked obsolete in a future release:</span></span>
>
> * <span data-ttu-id="36060-303">`RouteData.Values` を `HttpRequest.RouteValues` に移行します。</span><span class="sxs-lookup"><span data-stu-id="36060-303">Migrate `RouteData.Values` to `HttpRequest.RouteValues`.</span></span>
> * <span data-ttu-id="36060-304">`RouteData.DataTokens` を移行して、エンドポイント メタデータから [IDataTokensMetadata](xref:Microsoft.AspNetCore.Routing.IDataTokensMetadata) を取得します。</span><span class="sxs-lookup"><span data-stu-id="36060-304">Migrate `RouteData.DataTokens` to retrieve [IDataTokensMetadata](xref:Microsoft.AspNetCore.Routing.IDataTokensMetadata) from the endpoint metadata.</span></span>

<span data-ttu-id="36060-305">URL の照合は、構成可能な一連のフェーズで動作します。</span><span class="sxs-lookup"><span data-stu-id="36060-305">URL matching operates in a configurable set of phases.</span></span> <span data-ttu-id="36060-306">各フェーズでの出力は一致のセットとなります。</span><span class="sxs-lookup"><span data-stu-id="36060-306">In each phase, the output is a set of matches.</span></span> <span data-ttu-id="36060-307">一致のセットは、次のフェーズでさらに絞り込むことができます。</span><span class="sxs-lookup"><span data-stu-id="36060-307">The set of matches can be narrowed down further by the next phase.</span></span> <span data-ttu-id="36060-308">ルーティングの実装では、一致するエンドポイントの処理順序は保証されません。</span><span class="sxs-lookup"><span data-stu-id="36060-308">The routing implementation does not guarantee a processing order for matching endpoints.</span></span> <span data-ttu-id="36060-309">一致の可能性のあるものは一度に**すべて**処理されます。</span><span class="sxs-lookup"><span data-stu-id="36060-309">**All** possible matches are processed at once.</span></span> <span data-ttu-id="36060-310">URL 照合フェーズは、次の順序で発生します。</span><span class="sxs-lookup"><span data-stu-id="36060-310">The URL matching phases occur in the following order.</span></span> <span data-ttu-id="36060-311">ASP.NET Core:</span><span class="sxs-lookup"><span data-stu-id="36060-311">ASP.NET Core:</span></span>

1. <span data-ttu-id="36060-312">エンドポイントのセットおよびそれらのルート テンプレートに対して URL パスを処理し、**すべて**の一致を収集します。</span><span class="sxs-lookup"><span data-stu-id="36060-312">Processes the URL path against the set of endpoints and their route templates, collecting **all** of the matches.</span></span>
1. <span data-ttu-id="36060-313">前のリストを取得し、ルート制約が適用されると失敗する一致を削除します。</span><span class="sxs-lookup"><span data-stu-id="36060-313">Takes the preceding list and removes matches that fail with route constraints applied.</span></span>
1. <span data-ttu-id="36060-314">前のリストを取得し、[MatcherPolicy](xref:Microsoft.AspNetCore.Routing.MatcherPolicy) インスタンスのセットを失敗させる一致を削除します。</span><span class="sxs-lookup"><span data-stu-id="36060-314">Takes the preceding list and removes matches that fail the set of [MatcherPolicy](xref:Microsoft.AspNetCore.Routing.MatcherPolicy) instances.</span></span>
1. <span data-ttu-id="36060-315">[EndpointSelector](xref:Microsoft.AspNetCore.Routing.Matching.EndpointSelector) を使用して、前のリストから最終的な決定を行います。</span><span class="sxs-lookup"><span data-stu-id="36060-315">Uses the [EndpointSelector](xref:Microsoft.AspNetCore.Routing.Matching.EndpointSelector) to make a final decision from the preceding list.</span></span>

<span data-ttu-id="36060-316">エンドポイントのリストは、次の内容に従って優先度付けが行われます。</span><span class="sxs-lookup"><span data-stu-id="36060-316">The list of endpoints is prioritized according to:</span></span>

* <span data-ttu-id="36060-317">[RouteEndpoint.Order](xref:Microsoft.AspNetCore.Routing.RouteEndpoint.Order*)</span><span class="sxs-lookup"><span data-stu-id="36060-317">The [RouteEndpoint.Order](xref:Microsoft.AspNetCore.Routing.RouteEndpoint.Order*)</span></span>
* <span data-ttu-id="36060-318">[ルート テンプレートの優先順位](#rtp)</span><span class="sxs-lookup"><span data-stu-id="36060-318">The [route template precedence](#rtp)</span></span>

<span data-ttu-id="36060-319"><xref:Microsoft.AspNetCore.Routing.Matching.EndpointSelector> に到達するまで、各フェーズで一致するすべてのエンドポイントが処理されます。</span><span class="sxs-lookup"><span data-stu-id="36060-319">All matching endpoints are processed in each phase until the <xref:Microsoft.AspNetCore.Routing.Matching.EndpointSelector> is reached.</span></span> <span data-ttu-id="36060-320">`EndpointSelector` は最後のフェーズです。</span><span class="sxs-lookup"><span data-stu-id="36060-320">The `EndpointSelector` is the final phase.</span></span> <span data-ttu-id="36060-321">一致の中から最も優先度の高いエンドポイントが最適な一致として選択されます。</span><span class="sxs-lookup"><span data-stu-id="36060-321">It chooses the highest priority endpoint from the matches as the best match.</span></span> <span data-ttu-id="36060-322">最適な一致と優先度が同じである一致が他にもある場合は、あいまい一致の例外がスローされます。</span><span class="sxs-lookup"><span data-stu-id="36060-322">If there are other matches with the same priority as the best match, an ambiguous match exception is thrown.</span></span>

<span data-ttu-id="36060-323">ルートの優先順位は**より具体的な**ルート テンプレートに、より高い優先度が与えられることに基づいて算出されます。</span><span class="sxs-lookup"><span data-stu-id="36060-323">The route precedence is computed based on a **more specific** route template being given a higher priority.</span></span> <span data-ttu-id="36060-324">たとえば、テンプレート `/hello` と `/{message}` を検討してみます。</span><span class="sxs-lookup"><span data-stu-id="36060-324">For example, consider the templates `/hello` and `/{message}`:</span></span>

* <span data-ttu-id="36060-325">どちらも URL パス `/hello` と一致します。</span><span class="sxs-lookup"><span data-stu-id="36060-325">Both match the URL path `/hello`.</span></span>
* <span data-ttu-id="36060-326">`/hello` の方がより具体的なので、優先度が高くなります。</span><span class="sxs-lookup"><span data-stu-id="36060-326">`/hello`  is more specific and therefore higher priority.</span></span>

<span data-ttu-id="36060-327">一般に、ルートの優先順位は、実際に使用される URL スキームの種類として最適なものを選択するのに適しています。</span><span class="sxs-lookup"><span data-stu-id="36060-327">In general, route precedence does a good job of choosing the best match for the kinds of URL schemes used in practice.</span></span> <span data-ttu-id="36060-328"><xref:Microsoft.AspNetCore.Routing.RouteEndpoint.Order> は、あいまいさを避けるために必要な場合にのみ使用します。</span><span class="sxs-lookup"><span data-stu-id="36060-328">Use <xref:Microsoft.AspNetCore.Routing.RouteEndpoint.Order> only when necessary to avoid an ambiguity.</span></span>

<span data-ttu-id="36060-329">拡張性の種類がルーティングによって指定されるため、あいまいなルートを事前にルーティング システムによって計算することはできません。</span><span class="sxs-lookup"><span data-stu-id="36060-329">Due to the kinds of extensibility provided by routing, it isn't possible for the routing system to compute ahead of time the ambiguous routes.</span></span> <span data-ttu-id="36060-330">ルート テンプレート `/{message:alpha}` や `/{message:int}` などの例を考えてみましょう。</span><span class="sxs-lookup"><span data-stu-id="36060-330">Consider an example such as the route templates `/{message:alpha}` and `/{message:int}`:</span></span>

* <span data-ttu-id="36060-331">`alpha` 制約を使用すると、アルファベット文字のみと一致します。</span><span class="sxs-lookup"><span data-stu-id="36060-331">The `alpha` constraint matches only alphabetic characters.</span></span>
* <span data-ttu-id="36060-332">`int` 制約を使用すると、数値のみと一致します。</span><span class="sxs-lookup"><span data-stu-id="36060-332">The `int` constraint matches only numbers.</span></span>
* <span data-ttu-id="36060-333">これらのテンプレートのルート優先順位は同じですが、この両方と一致する単一の URL はありません。</span><span class="sxs-lookup"><span data-stu-id="36060-333">These templates have the same route precedence, but there's no single URL they both match.</span></span>
* <span data-ttu-id="36060-334">起動時にルーティング システムからあいまいエラーが報告された場合、それによってこの有効なユース ケースはブロックされます。</span><span class="sxs-lookup"><span data-stu-id="36060-334">If the routing system reported an ambiguity error at startup, it would block this valid use case.</span></span>

> [!WARNING]
>
> <span data-ttu-id="36060-335"><xref:Microsoft.AspNetCore.Builder.EndpointRoutingApplicationBuilderExtensions.UseEndpoints*> 内での処理の順序は、ルーティングの動作には影響しませんが、例外が 1 つあります。</span><span class="sxs-lookup"><span data-stu-id="36060-335">The order of operations inside <xref:Microsoft.AspNetCore.Builder.EndpointRoutingApplicationBuilderExtensions.UseEndpoints*> doesn't influence the behavior of routing, with one exception.</span></span> <span data-ttu-id="36060-336"><xref:Microsoft.AspNetCore.Builder.ControllerEndpointRouteBuilderExtensions.MapControllerRoute*> および <xref:Microsoft.AspNetCore.Builder.MvcAreaRouteBuilderExtensions.MapAreaRoute*> では、それぞれが呼び出された順序に基づいて、それぞれのエンドポイントに順序値が自動的に割り当てられます。</span><span class="sxs-lookup"><span data-stu-id="36060-336"><xref:Microsoft.AspNetCore.Builder.ControllerEndpointRouteBuilderExtensions.MapControllerRoute*> and <xref:Microsoft.AspNetCore.Builder.MvcAreaRouteBuilderExtensions.MapAreaRoute*> automatically assign an order value to their endpoints based on the order they are invoked.</span></span> <span data-ttu-id="36060-337">これにより、ルーティング システムでより古いルーティング実装と同じ保証を提供しなくても、コントローラーの長時間の動作がシミュレートされます。</span><span class="sxs-lookup"><span data-stu-id="36060-337">This simulates long-time behavior of controllers without the routing system providing the same guarantees as older routing implementations.</span></span>
>
> <span data-ttu-id="36060-338">ルーティングの従来の実装では、ルートの処理順序に依存するルーティング拡張性を実装することができます。</span><span class="sxs-lookup"><span data-stu-id="36060-338">In the legacy implementation of routing, it's possible to implement routing extensibility that has a dependency on the order in which routes are processed.</span></span> <span data-ttu-id="36060-339">ASP.NET Core 3.0 以降でのエンドポイントのルーティング:</span><span class="sxs-lookup"><span data-stu-id="36060-339">Endpoint routing in ASP.NET Core 3.0 and later:</span></span>
> 
> * <span data-ttu-id="36060-340">ルートの概念がありません。</span><span class="sxs-lookup"><span data-stu-id="36060-340">Doesn't have a concept of routes.</span></span>
> * <span data-ttu-id="36060-341">順序付けが保証されません。</span><span class="sxs-lookup"><span data-stu-id="36060-341">Doesn't provide ordering guarantees.</span></span> <span data-ttu-id="36060-342">すべてのエンドポイントが一度に処理されます。</span><span class="sxs-lookup"><span data-stu-id="36060-342">All endpoints are processed at once.</span></span>
>
> <span data-ttu-id="36060-343">これにより、従来のルーティング システムの使用に行き詰まっている場合、[GitHub のイシューを開いて支援を求めてください](https://github.com/dotnet/aspnetcore/issues)。</span><span class="sxs-lookup"><span data-stu-id="36060-343">If this means you're stuck using the legacy routing system, [open a GitHub issue for assistance](https://github.com/dotnet/aspnetcore/issues).</span></span>

<a name="rtp"></a>

### <a name="route-template-precedence-and-endpoint-selection-order"></a><span data-ttu-id="36060-344">ルート テンプレートの優先順位とエンドポイントの選択順序</span><span class="sxs-lookup"><span data-stu-id="36060-344">Route template precedence and endpoint selection order</span></span>

<span data-ttu-id="36060-345">[ルート テンプレートの優先順位](https://github.com/dotnet/aspnetcore/blob/master/src/Http/Routing/src/Template/RoutePrecedence.cs#L16)とは、どれほど具体的であるかに基づいて、各ルート テンプレートに値を割り当てるシステムです。</span><span class="sxs-lookup"><span data-stu-id="36060-345">[Route template precedence](https://github.com/dotnet/aspnetcore/blob/master/src/Http/Routing/src/Template/RoutePrecedence.cs#L16) is a system that assigns each route template a value based on how specific it is.</span></span> <span data-ttu-id="36060-346">ルート テンプレートの優先順位:</span><span class="sxs-lookup"><span data-stu-id="36060-346">Route template precedence:</span></span>

* <span data-ttu-id="36060-347">一般的なケースでは、エンドポイントの順序を調整する必要はなくなります。</span><span class="sxs-lookup"><span data-stu-id="36060-347">Avoids the need to adjust the order of endpoints in common cases.</span></span>
* <span data-ttu-id="36060-348">一般的に期待されるルーティング動作との一致が試みられます。</span><span class="sxs-lookup"><span data-stu-id="36060-348">Attempts to match the common-sense expectations of routing behavior.</span></span>

<span data-ttu-id="36060-349">たとえば、テンプレート `/Products/List` と `/Products/{id}` について考えてみます。</span><span class="sxs-lookup"><span data-stu-id="36060-349">For example, consider templates `/Products/List` and `/Products/{id}`.</span></span> <span data-ttu-id="36060-350">URL パス `/Products/List` に対しては、`/Products/List` の方が `/Products/{id}` よりも適していると想定するのが妥当です。</span><span class="sxs-lookup"><span data-stu-id="36060-350">It would be reasonable to assume that `/Products/List` is a better match than `/Products/{id}` for the URL path `/Products/List`.</span></span> <span data-ttu-id="36060-351">このように言えるのは、リテラル セグメント `/List` がパラメーター セグメント `/{id}` よりも優先順位が高いと見なされるためです。</span><span class="sxs-lookup"><span data-stu-id="36060-351">The works because the literal segment `/List` is considered to have better precedence than the parameter segment `/{id}`.</span></span>

<span data-ttu-id="36060-352">優先順位のしくみの詳細は、ルート テンプレートの定義方法と関連付けられています。</span><span class="sxs-lookup"><span data-stu-id="36060-352">The details of how precedence works are coupled to how route templates are defined:</span></span>

* <span data-ttu-id="36060-353">より多くのセグメントを持つテンプレートは、より具体的なものと見なされます。</span><span class="sxs-lookup"><span data-stu-id="36060-353">Templates with more segments are considered more specific.</span></span>
* <span data-ttu-id="36060-354">リテラル テキストを含むセグメントは、パラメーター セグメントよりも具体的であると見なされます。</span><span class="sxs-lookup"><span data-stu-id="36060-354">A segment with literal text is considered more specific than a parameter segment.</span></span>
* <span data-ttu-id="36060-355">制約が含まれるパラメーター セグメントは、それが含まれないものよりも具体的であると見なされます。</span><span class="sxs-lookup"><span data-stu-id="36060-355">A parameter segment with a constraint is considered more specific than one without.</span></span>
* <span data-ttu-id="36060-356">複雑なセグメントは、制約を含むパラメーター セグメントと同じくらい具体的であると見なされます。</span><span class="sxs-lookup"><span data-stu-id="36060-356">A complex segment is considered as specific as a parameter segment with a constraint.</span></span>
* <span data-ttu-id="36060-357">キャッチオール パラメーターは、まったく具体的ではありません。</span><span class="sxs-lookup"><span data-stu-id="36060-357">Catch-all parameters are the least specific.</span></span> <span data-ttu-id="36060-358">キャッチオール ルートに関する重要な情報については、「[ルート テンプレート参照](#rtr)」の**キャッチオール**を参照してください。</span><span class="sxs-lookup"><span data-stu-id="36060-358">See **catch-all** in the [Route template reference](#rtr) for important information on catch-all routes.</span></span>

<span data-ttu-id="36060-359">実際の値のリファレンスについては、[GitHub 上のソース コード](https://github.com/dotnet/aspnetcore/blob/master/src/Http/Routing/src/Template/RoutePrecedence.cs#L189)を参照してください。</span><span class="sxs-lookup"><span data-stu-id="36060-359">See the [source code on GitHub](https://github.com/dotnet/aspnetcore/blob/master/src/Http/Routing/src/Template/RoutePrecedence.cs#L189) for a reference of exact values.</span></span>

<a name="lg"></a>

### <a name="url-generation-concepts"></a><span data-ttu-id="36060-360">URL 生成の概念</span><span class="sxs-lookup"><span data-stu-id="36060-360">URL generation concepts</span></span>

<span data-ttu-id="36060-361">URL の生成:</span><span class="sxs-lookup"><span data-stu-id="36060-361">URL generation:</span></span>

* <span data-ttu-id="36060-362">ルーティングにおいて、一連のルート値に基づいて URL パスを作成するプロセスです。</span><span class="sxs-lookup"><span data-stu-id="36060-362">Is the process by which routing can create a URL path based on a set of route values.</span></span>
* <span data-ttu-id="36060-363">エンドポイントとそれにアクセスする URL を論理的に分離できます。</span><span class="sxs-lookup"><span data-stu-id="36060-363">Allows for a logical separation between endpoints and the URLs that access them.</span></span>

<span data-ttu-id="36060-364">エンドポイント ルーティングには、<xref:Microsoft.AspNetCore.Routing.LinkGenerator> API が含まれます。</span><span class="sxs-lookup"><span data-stu-id="36060-364">Endpoint routing includes the <xref:Microsoft.AspNetCore.Routing.LinkGenerator> API.</span></span> <span data-ttu-id="36060-365">`LinkGenerator` は [DI](xref:fundamentals/dependency-injection) から使用できるシングルトン サービスです。</span><span class="sxs-lookup"><span data-stu-id="36060-365">`LinkGenerator` is a singleton service available from [DI](xref:fundamentals/dependency-injection).</span></span> <span data-ttu-id="36060-366">`LinkGenerator` API は、実行中の要求のコンテキスト外で使用することができます。</span><span class="sxs-lookup"><span data-stu-id="36060-366">The `LinkGenerator` API can be used outside of the context of an executing request.</span></span> <span data-ttu-id="36060-367">[Mvc.IUrlHelper](xref:Microsoft.AspNetCore.Mvc.IUrlHelper) と、[タグ ヘルパー](xref:mvc/views/tag-helpers/intro)、HTML ヘルパー、[アクション結果](xref:mvc/controllers/actions)など、<xref:Microsoft.AspNetCore.Mvc.IUrlHelper> に依存するシナリオでは `LinkGenerator` API を内部的に使用して、リンク生成機能が提供されます。</span><span class="sxs-lookup"><span data-stu-id="36060-367">[Mvc.IUrlHelper](xref:Microsoft.AspNetCore.Mvc.IUrlHelper) and scenarios that rely on <xref:Microsoft.AspNetCore.Mvc.IUrlHelper>, such as [Tag Helpers](xref:mvc/views/tag-helpers/intro), HTML Helpers, and [Action Results](xref:mvc/controllers/actions), use the `LinkGenerator` API internally to provide link generating capabilities.</span></span>

<span data-ttu-id="36060-368">リンク ジェネレーターは、**アドレス** と**アドレス スキーム** の概念に基づいています。</span><span class="sxs-lookup"><span data-stu-id="36060-368">The link generator is backed by the concept of an **address** and **address schemes**.</span></span> <span data-ttu-id="36060-369">アドレス スキームは、リンク生成で考慮すべきエンドポイントを決定する方法です。</span><span class="sxs-lookup"><span data-stu-id="36060-369">An address scheme is a way of determining the endpoints that should be considered for link generation.</span></span> <span data-ttu-id="36060-370">たとえば、コントローラーおよび Razor Pages からの、多くのユーザーに馴染みのあるルート名やルート値シナリオは、アドレス スキームとして実装されます。</span><span class="sxs-lookup"><span data-stu-id="36060-370">For example, the route name and route values scenarios many users are familiar with from controllers and Razor Pages are implemented as an address scheme.</span></span>

<span data-ttu-id="36060-371">リンク ジェネレーターでは、次の拡張メソッドを介して、コントローラーおよび Razor Pages にリンクできます。</span><span class="sxs-lookup"><span data-stu-id="36060-371">The link generator can link to controllers and Razor Pages via the following extension methods:</span></span>

* <xref:Microsoft.AspNetCore.Routing.ControllerLinkGeneratorExtensions.GetPathByAction*>
* <xref:Microsoft.AspNetCore.Routing.ControllerLinkGeneratorExtensions.GetUriByAction*>
* <xref:Microsoft.AspNetCore.Routing.PageLinkGeneratorExtensions.GetPathByPage*>
* <xref:Microsoft.AspNetCore.Routing.PageLinkGeneratorExtensions.GetUriByPage*>

<span data-ttu-id="36060-372">これらのメソッドのオーバーロードでは、`HttpContext` を含む引数が受け入れられます。</span><span class="sxs-lookup"><span data-stu-id="36060-372">Overloads of these methods accept arguments that include the `HttpContext`.</span></span> <span data-ttu-id="36060-373">これらのメソッドは [Url.Action](xref:System.Web.Mvc.UrlHelper.Action*) および [Url.Page](xref:Microsoft.AspNetCore.Mvc.UrlHelperExtensions.Page*) と機能的には同等ですが、柔軟性とオプションがさらに提供されます。</span><span class="sxs-lookup"><span data-stu-id="36060-373">These methods are functionally equivalent to [Url.Action](xref:System.Web.Mvc.UrlHelper.Action*) and [Url.Page](xref:Microsoft.AspNetCore.Mvc.UrlHelperExtensions.Page*), but offer additional flexibility and options.</span></span>

<span data-ttu-id="36060-374">`GetPath*` メソッドは、絶対パスを含む URI を生成するという点で `Url.Action` および `Url.Page` に最も似ています。</span><span class="sxs-lookup"><span data-stu-id="36060-374">The `GetPath*` methods are most similar to `Url.Action` and `Url.Page`, in that they generate a URI containing an absolute path.</span></span> <span data-ttu-id="36060-375">`GetUri*` メソッドでは常に、スキームとホストを含む絶対 URI が生成されます。</span><span class="sxs-lookup"><span data-stu-id="36060-375">The `GetUri*` methods always generate an absolute URI containing a scheme and host.</span></span> <span data-ttu-id="36060-376">`HttpContext` を受け入れるメソッドでは、実行中の要求のコンテキストで URI が生成されます。</span><span class="sxs-lookup"><span data-stu-id="36060-376">The methods that accept an `HttpContext` generate a URI in the context of the executing request.</span></span> <span data-ttu-id="36060-377">実行中の要求からの[アンビエント](#ambient) ルート値、URL ベース パス、スキーム、およびホストは、オーバーライドされない限り使用されます。</span><span class="sxs-lookup"><span data-stu-id="36060-377">The [ambient](#ambient) route values, URL base path, scheme, and host from the executing request are used unless overridden.</span></span>

<span data-ttu-id="36060-378"><xref:Microsoft.AspNetCore.Routing.LinkGenerator> はアドレスと共に呼び出されます。</span><span class="sxs-lookup"><span data-stu-id="36060-378"><xref:Microsoft.AspNetCore.Routing.LinkGenerator> is called with an address.</span></span> <span data-ttu-id="36060-379">URI の生成は、次の 2 つの手順で行われます。</span><span class="sxs-lookup"><span data-stu-id="36060-379">Generating a URI occurs in two steps:</span></span>

1. <span data-ttu-id="36060-380">アドレスは、そのアドレスと一致するエンドポイントのリストにバインドされます。</span><span class="sxs-lookup"><span data-stu-id="36060-380">An address is bound to a list of endpoints that match the address.</span></span>
1. <span data-ttu-id="36060-381">各エンドポイントの <xref:Microsoft.AspNetCore.Routing.RouteEndpoint.RoutePattern> は、指定された値と一致するルート パターンが見つかるまで評価されます。</span><span class="sxs-lookup"><span data-stu-id="36060-381">Each endpoint's <xref:Microsoft.AspNetCore.Routing.RouteEndpoint.RoutePattern> is evaluated until a route pattern that matches the supplied values is found.</span></span> <span data-ttu-id="36060-382">結果の出力は、リンク ジェネレーターに指定された他の URI 部分と結合され、返されます。</span><span class="sxs-lookup"><span data-stu-id="36060-382">The resulting output is combined with the other URI parts supplied to the link generator and returned.</span></span>

<span data-ttu-id="36060-383"><xref:Microsoft.AspNetCore.Routing.LinkGenerator> によって提供されるメソッドでは、すべての種類のアドレスの標準的なリンク生成機能がサポートされます。</span><span class="sxs-lookup"><span data-stu-id="36060-383">The methods provided by <xref:Microsoft.AspNetCore.Routing.LinkGenerator> support standard link generation capabilities for any type of address.</span></span> <span data-ttu-id="36060-384">リンク ジェネレーターを使用する最も便利な方法は、特定のアドレスの種類の操作を実行する拡張メソッドを使用することです。</span><span class="sxs-lookup"><span data-stu-id="36060-384">The most convenient way to use the link generator is through extension methods that perform operations for a specific address type:</span></span>

| <span data-ttu-id="36060-385">拡張メソッド</span><span class="sxs-lookup"><span data-stu-id="36060-385">Extension Method</span></span> | <span data-ttu-id="36060-386">説明</span><span class="sxs-lookup"><span data-stu-id="36060-386">Description</span></span> |
| ---------------- | ----------- |
| <xref:Microsoft.AspNetCore.Routing.LinkGenerator.GetPathByAddress*> | <span data-ttu-id="36060-387">指定された値に基づき、絶対パスを含む URI を生成します。</span><span class="sxs-lookup"><span data-stu-id="36060-387">Generates a URI with an absolute path based on the provided values.</span></span> |
| <xref:Microsoft.AspNetCore.Routing.LinkGenerator.GetUriByAddress*> | <span data-ttu-id="36060-388">指定された値に基づき、絶対 URI を生成します。</span><span class="sxs-lookup"><span data-stu-id="36060-388">Generates an absolute URI based on the provided values.</span></span>             |

> [!WARNING]
> <span data-ttu-id="36060-389"><xref:Microsoft.AspNetCore.Routing.LinkGenerator> メソッド呼び出しによる次の影響に注意してください。</span><span class="sxs-lookup"><span data-stu-id="36060-389">Pay attention to the following implications of calling <xref:Microsoft.AspNetCore.Routing.LinkGenerator> methods:</span></span>
>
> * <span data-ttu-id="36060-390">受信要求の `Host` ヘッダーが確認されないアプリ構成では、`GetUri*` 拡張メソッドは注意して使用してください。</span><span class="sxs-lookup"><span data-stu-id="36060-390">Use `GetUri*` extension methods with caution in an app configuration that doesn't validate the `Host` header of incoming requests.</span></span> <span data-ttu-id="36060-391">受信要求の `Host` ヘッダーが確認されていない場合、信頼されていない要求入力を、ビューまたはページの URI でクライアントに送り返すことができます。</span><span class="sxs-lookup"><span data-stu-id="36060-391">If the `Host` header of incoming requests isn't validated, untrusted request input can be sent back to the client in URIs in a view or page.</span></span> <span data-ttu-id="36060-392">すべての運用アプリで、`Host` ヘッダーを既知の有効な値と照らし合わせて確認するようにサーバーを構成することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="36060-392">We recommend that all production apps configure their server to validate the `Host` header against known valid values.</span></span>
>
> * <span data-ttu-id="36060-393">ミドルウェアで `Map` または `MapWhen` と組み合わせて、<xref:Microsoft.AspNetCore.Routing.LinkGenerator> を使用する場合は注意してください。</span><span class="sxs-lookup"><span data-stu-id="36060-393">Use <xref:Microsoft.AspNetCore.Routing.LinkGenerator> with caution in middleware in combination with `Map` or `MapWhen`.</span></span> <span data-ttu-id="36060-394">`Map*` では、実行中の要求の基本パスが変更され、リンク生成の出力に影響します。</span><span class="sxs-lookup"><span data-stu-id="36060-394">`Map*` changes the base path of the executing request, which affects the output of link generation.</span></span> <span data-ttu-id="36060-395">すべての <xref:Microsoft.AspNetCore.Routing.LinkGenerator> API で基本パスを指定することができます。</span><span class="sxs-lookup"><span data-stu-id="36060-395">All of the <xref:Microsoft.AspNetCore.Routing.LinkGenerator> APIs allow specifying a base path.</span></span> <span data-ttu-id="36060-396">リンク生成への `Map*` の影響を元に戻すための空の基本パスを指定してください。</span><span class="sxs-lookup"><span data-stu-id="36060-396">Specify an empty base path to undo the `Map*` affect on link generation.</span></span>

### <a name="middleware-example"></a><span data-ttu-id="36060-397">ミドルウェアの例</span><span class="sxs-lookup"><span data-stu-id="36060-397">Middleware example</span></span>

<span data-ttu-id="36060-398">次の例では、ミドルウェアで <xref:Microsoft.AspNetCore.Routing.LinkGenerator> API を使用して、商品をリストするアクション メソッドへのリンクを作成します。</span><span class="sxs-lookup"><span data-stu-id="36060-398">In the following example, a middleware uses the <xref:Microsoft.AspNetCore.Routing.LinkGenerator> API to create a link to an action method that lists store products.</span></span> <span data-ttu-id="36060-399">リンク ジェネレーターは、クラスに挿入し、`GenerateLink` を呼び出すことで、アプリのどのクラスでも使用できます。</span><span class="sxs-lookup"><span data-stu-id="36060-399">Using the link generator by injecting it into a class and calling `GenerateLink` is available to any class in an app:</span></span>

[!code-csharp[](routing/samples/3.x/RoutingSample/Middleware/ProductsLinkMiddleware.cs?name=snippet)]

<a name="rtr"></a>

## <a name="route-template-reference"></a><span data-ttu-id="36060-400">ルート テンプレート参照</span><span class="sxs-lookup"><span data-stu-id="36060-400">Route template reference</span></span>

<span data-ttu-id="36060-401">`{}` 内のトークンでは、ルートが一致した場合にバインドされるルート パラメーターが定義されます。</span><span class="sxs-lookup"><span data-stu-id="36060-401">Tokens within `{}` define route parameters that are bound if the route is matched.</span></span> <span data-ttu-id="36060-402">1 つのルート セグメントに複数のルート パラメーターを定義できますが、各ルート パラメーターをリテラル値で区切る必要があります。</span><span class="sxs-lookup"><span data-stu-id="36060-402">More than one route parameter can be defined in a route segment, but route parameters  must be separated by a literal value.</span></span> <span data-ttu-id="36060-403">たとえば、`{controller=Home}{action=Index}` は有効なルートになりません。`{controller}` と `{action}` の間にリテラル値がないためです。</span><span class="sxs-lookup"><span data-stu-id="36060-403">For example, `{controller=Home}{action=Index}` isn't a valid route, since there's no literal value between `{controller}` and `{action}`.</span></span>  <span data-ttu-id="36060-404">ルート パラメーターには名前を付ける必要があります。付加的な属性を指定することもあります。</span><span class="sxs-lookup"><span data-stu-id="36060-404">Route parameters must have a name and may have additional attributes specified.</span></span>

<span data-ttu-id="36060-405">ルート パラメーター以外のリテラル テキスト (`{id}` など) とパス区切り `/` は URL のテキストに一致する必要があります。</span><span class="sxs-lookup"><span data-stu-id="36060-405">Literal text other than route parameters (for example, `{id}`) and the path separator `/` must match the text in the URL.</span></span> <span data-ttu-id="36060-406">テキスト照合は復号された URL のパスを基盤とし、大文字と小文字が区別されます。</span><span class="sxs-lookup"><span data-stu-id="36060-406">Text matching is case-insensitive and based on the decoded representation of the URL's path.</span></span> <span data-ttu-id="36060-407">リテラル ルート パラメーターの区切り記号 (`{` または `}`) を照合するには、文字を繰り返して区切り記号をエスケープします。</span><span class="sxs-lookup"><span data-stu-id="36060-407">To match a literal route parameter delimiter `{` or `}`, escape the delimiter by repeating the character.</span></span> <span data-ttu-id="36060-408">たとえば、`{{` または `}}` です。</span><span class="sxs-lookup"><span data-stu-id="36060-408">For example `{{` or `}}`.</span></span>

<span data-ttu-id="36060-409">アスタリスク `*` または二重アスタリスク`**`:</span><span class="sxs-lookup"><span data-stu-id="36060-409">Asterisk `*` or double asterisk `**`:</span></span>

* <span data-ttu-id="36060-410">ルート パラメーターのプレフィックスとして使用して、URI の残りの部分にバインドすることができます。</span><span class="sxs-lookup"><span data-stu-id="36060-410">Can be used as a prefix to a route parameter to bind to the rest of the URI.</span></span>
* <span data-ttu-id="36060-411">**キャッチオール** パラメーターと呼ばれています。</span><span class="sxs-lookup"><span data-stu-id="36060-411">Are called a **catch-all** parameters.</span></span> <span data-ttu-id="36060-412">`blog/{**slug}` の例を次に示します。</span><span class="sxs-lookup"><span data-stu-id="36060-412">For example, `blog/{**slug}`:</span></span>
  * <span data-ttu-id="36060-413">`/blog` で始まり、その後に任意の値が続く URI と一致します。</span><span class="sxs-lookup"><span data-stu-id="36060-413">Matches any URI that starts with `/blog` and has any value following it.</span></span>
  * <span data-ttu-id="36060-414">`/blog` に続く値は、[slug](https://developer.mozilla.org/docs/Glossary/Slug) ルート値に割り当てられます。</span><span class="sxs-lookup"><span data-stu-id="36060-414">The value following `/blog` is assigned to the [slug](https://developer.mozilla.org/docs/Glossary/Slug) route value.</span></span>

[!INCLUDE[](~/includes/catchall.md)]

<span data-ttu-id="36060-415">キャッチオール パラメーターは空の文字列に一致することもあります。</span><span class="sxs-lookup"><span data-stu-id="36060-415">Catch-all parameters can also match the empty string.</span></span>

<span data-ttu-id="36060-416">キャッチオール パラメーターでは、パス区切り `/` 文字を含め、URL の生成にルートが使用されるときに適切な文字がエスケープされます。</span><span class="sxs-lookup"><span data-stu-id="36060-416">The catch-all parameter escapes the appropriate characters when the route is used to generate a URL, including path separator `/` characters.</span></span> <span data-ttu-id="36060-417">たとえば、ルート値が `{ path = "my/path" }` のルート `foo/{*path}` では、`foo/my%2Fpath` が生成されます。</span><span class="sxs-lookup"><span data-stu-id="36060-417">For example, the route `foo/{*path}` with route values `{ path = "my/path" }` generates `foo/my%2Fpath`.</span></span> <span data-ttu-id="36060-418">エスケープされたスラッシュに注意してください。</span><span class="sxs-lookup"><span data-stu-id="36060-418">Note the escaped forward slash.</span></span> <span data-ttu-id="36060-419">パス区切り文字をラウンドトリップさせるには、`**` ルート パラメーター プレフィックスを使用します。</span><span class="sxs-lookup"><span data-stu-id="36060-419">To round-trip path separator characters, use the `**` route parameter prefix.</span></span> <span data-ttu-id="36060-420">`{ path = "my/path" }` のルート `foo/{**path}` では、`foo/my/path` が生成されます。</span><span class="sxs-lookup"><span data-stu-id="36060-420">The route `foo/{**path}` with `{ path = "my/path" }` generates `foo/my/path`.</span></span>

<span data-ttu-id="36060-421">任意のファイル拡張子が付いたファイル名のキャプチャを試行する URL パターンには、追加の考慮事項があります。</span><span class="sxs-lookup"><span data-stu-id="36060-421">URL patterns that attempt to capture a file name with an optional file extension have additional considerations.</span></span> <span data-ttu-id="36060-422">たとえば、テンプレート `files/{filename}.{ext?}` について考えてみます。</span><span class="sxs-lookup"><span data-stu-id="36060-422">For example, consider the template `files/{filename}.{ext?}`.</span></span> <span data-ttu-id="36060-423">`filename` と `ext` の両方の値が存在するときに、両方の値が入力されます。</span><span class="sxs-lookup"><span data-stu-id="36060-423">When values for both `filename` and `ext` exist, both values are populated.</span></span> <span data-ttu-id="36060-424">URL に `filename` の値だけが存在する場合、末尾の `.` は任意であるため、このルートは一致となります。</span><span class="sxs-lookup"><span data-stu-id="36060-424">If only a value for `filename` exists in the URL, the route matches because the trailing `.` is  optional.</span></span> <span data-ttu-id="36060-425">次の URL はこのルートに一致します。</span><span class="sxs-lookup"><span data-stu-id="36060-425">The following URLs match this route:</span></span>

* `/files/myFile.txt`
* `/files/myFile`

<span data-ttu-id="36060-426">ルート パラメーターには、**既定値** が含まれることがあります。パラメーター名の後に既定値を指定し、等号 (`=`) で区切ることで指定されます。</span><span class="sxs-lookup"><span data-stu-id="36060-426">Route parameters may have **default values** designated by specifying the default value after the parameter name separated by an equals sign (`=`).</span></span> <span data-ttu-id="36060-427">たとえば、`{controller=Home}` では、`controller` の既定値として `Home` が定義されます。</span><span class="sxs-lookup"><span data-stu-id="36060-427">For example, `{controller=Home}` defines `Home` as the default value for `controller`.</span></span> <span data-ttu-id="36060-428">パラメーターの URL に値がない場合、既定値が使用されます。</span><span class="sxs-lookup"><span data-stu-id="36060-428">The default value is used if no value is present in the URL for the parameter.</span></span> <span data-ttu-id="36060-429">ルート パラメーターは、パラメーター名の終わりに疑問符 (`?`) を追加することでオプションとして扱われます。</span><span class="sxs-lookup"><span data-stu-id="36060-429">Route parameters are made optional by appending a question mark (`?`) to the end of the parameter name.</span></span> <span data-ttu-id="36060-430">たとえば、`id?` のようにします。</span><span class="sxs-lookup"><span data-stu-id="36060-430">For example, `id?`.</span></span> <span data-ttu-id="36060-431">省略可能な値と既定のルート パラメーターの違いは次のとおりです。</span><span class="sxs-lookup"><span data-stu-id="36060-431">The difference between optional values and default route parameters is:</span></span>

* <span data-ttu-id="36060-432">既定値を持つルート パラメーターでは常に値が生成されます。</span><span class="sxs-lookup"><span data-stu-id="36060-432">A route parameter with a default value always produces a value.</span></span>
* <span data-ttu-id="36060-433">省略可能なパラメーターには、要求 URL によって値が指定された場合にのみ値が含められます。</span><span class="sxs-lookup"><span data-stu-id="36060-433">An optional parameter has a value only when a value is provided by the request URL.</span></span>

<span data-ttu-id="36060-434">ルート パラメーターには、URL からバインドされるルート値に一致しなければならないという制約が含まれることがあります。</span><span class="sxs-lookup"><span data-stu-id="36060-434">Route parameters may have constraints that must match the route value bound from the URL.</span></span> <span data-ttu-id="36060-435">`:` と制約名をルート パラメーター名の後に追加すると、ルート パラメーターのインライン制約が指定されます。</span><span class="sxs-lookup"><span data-stu-id="36060-435">Adding `:` and constraint name after the route parameter name specifies an inline constraint on a route parameter.</span></span> <span data-ttu-id="36060-436">その制約で引数が要求される場合、制約名の後にかっこ `(...)` で囲まれます。</span><span class="sxs-lookup"><span data-stu-id="36060-436">If the constraint requires arguments, they're enclosed in parentheses `(...)` after the constraint name.</span></span> <span data-ttu-id="36060-437">複数の "*インライン制約*" を指定するには、別の `:` と制約名を追加します。</span><span class="sxs-lookup"><span data-stu-id="36060-437">Multiple *inline constraints* can be specified by appending another `:` and constraint name.</span></span>

<span data-ttu-id="36060-438">制約名と引数が <xref:Microsoft.AspNetCore.Routing.IInlineConstraintResolver> サービスに渡され、URL 処理で使用する <xref:Microsoft.AspNetCore.Routing.IRouteConstraint> のインスタンスが作成されます。</span><span class="sxs-lookup"><span data-stu-id="36060-438">The constraint name and arguments are passed to the <xref:Microsoft.AspNetCore.Routing.IInlineConstraintResolver> service to create an instance of <xref:Microsoft.AspNetCore.Routing.IRouteConstraint> to use in URL processing.</span></span> <span data-ttu-id="36060-439">たとえば、ルート テンプレート `blog/{article:minlength(10)}` によって、制約 `minlength` と引数 `10` が指定されます。</span><span class="sxs-lookup"><span data-stu-id="36060-439">For example, the route template `blog/{article:minlength(10)}` specifies a `minlength` constraint with the argument `10`.</span></span> <span data-ttu-id="36060-440">ルート制約の詳細とこのフレームワークによって指定される制約のリストについては、「[ルート制約参照](#route-constraint-reference)」セクションを参照してください。</span><span class="sxs-lookup"><span data-stu-id="36060-440">For more information on route constraints and a list of the constraints provided by the framework, see the [Route constraint reference](#route-constraint-reference) section.</span></span>

<span data-ttu-id="36060-441">ルート パラメーターには、パラメーター トランスフォーマーを指定することもできます。</span><span class="sxs-lookup"><span data-stu-id="36060-441">Route parameters may also have parameter transformers.</span></span> <span data-ttu-id="36060-442">パラメーター トランスフォーマーを指定すると、リンクを生成し、アクションおよびページを URL と一致させるときにパラメーターの値が変換されます。</span><span class="sxs-lookup"><span data-stu-id="36060-442">Parameter transformers transform a parameter's value when generating links and matching actions and pages to URLs.</span></span> <span data-ttu-id="36060-443">制約と同様に、パラメーター トランスフォーマーをルート パラメーターにインラインで追加することができます。その場合、ルート パラメーター名の後に `:` とトランスフォーマー名を追加します。</span><span class="sxs-lookup"><span data-stu-id="36060-443">Like constraints, parameter transformers can be added inline to a route parameter by adding a `:` and transformer name after the route parameter name.</span></span> <span data-ttu-id="36060-444">たとえば、ルート テンプレート `blog/{article:slugify}` では、`slugify` トランスフォーマーが指定されます。</span><span class="sxs-lookup"><span data-stu-id="36060-444">For example, the route template `blog/{article:slugify}` specifies a `slugify` transformer.</span></span> <span data-ttu-id="36060-445">パラメーター トランスフォーマーの詳細については、「[パラメーター トランスフォーマー参照](#parameter-transformer-reference)」セクションを参照してください。</span><span class="sxs-lookup"><span data-stu-id="36060-445">For more information on parameter transformers, see the [Parameter transformer reference](#parameter-transformer-reference) section.</span></span>

<span data-ttu-id="36060-446">次の表に、ルート テンプレートの例とその動作を示します。</span><span class="sxs-lookup"><span data-stu-id="36060-446">The following table demonstrates example route templates and their behavior:</span></span>

| <span data-ttu-id="36060-447">ルート テンプレート</span><span class="sxs-lookup"><span data-stu-id="36060-447">Route Template</span></span>                           | <span data-ttu-id="36060-448">一致する URI の例</span><span class="sxs-lookup"><span data-stu-id="36060-448">Example Matching URI</span></span>    | <span data-ttu-id="36060-449">要求 URI&hellip;</span><span class="sxs-lookup"><span data-stu-id="36060-449">The request URI&hellip;</span></span>                                                    |
| ---------------------------------------- | ----------------------- | -------------------------------------------------------------------------- |
| `hello`                                  | `/hello`                | <span data-ttu-id="36060-450">単一パス `/hello` にのみ一致します。</span><span class="sxs-lookup"><span data-stu-id="36060-450">Only matches the single path `/hello`.</span></span>                                     |
| `{Page=Home}`                            | `/`                     | <span data-ttu-id="36060-451">一致し、`Page` が `Home` に設定されます。</span><span class="sxs-lookup"><span data-stu-id="36060-451">Matches and sets `Page` to `Home`.</span></span>                                         |
| `{Page=Home}`                            | `/Contact`              | <span data-ttu-id="36060-452">一致し、`Page` が `Contact` に設定されます。</span><span class="sxs-lookup"><span data-stu-id="36060-452">Matches and sets `Page` to `Contact`.</span></span>                                      |
| `{controller}/{action}/{id?}`            | `/Products/List`        | <span data-ttu-id="36060-453">`Products` コントローラーと `List` アクションにマッピングされます。</span><span class="sxs-lookup"><span data-stu-id="36060-453">Maps to the `Products` controller and `List` action.</span></span>                       |
| `{controller}/{action}/{id?}`            | `/Products/Details/123` | <span data-ttu-id="36060-454">`Products` コントローラーと `Details` アクションにマッピングされ、`id` は 123 に設定されます。</span><span class="sxs-lookup"><span data-stu-id="36060-454">Maps to the `Products` controller and  `Details` action with`id` set to 123.</span></span> |
| `{controller=Home}/{action=Index}/{id?}` | `/`                     | <span data-ttu-id="36060-455">`Home` コントローラーと `Index` メソッドにマッピングされます。</span><span class="sxs-lookup"><span data-stu-id="36060-455">Maps to the `Home` controller and `Index` method.</span></span> <span data-ttu-id="36060-456">`id` は無視されます。</span><span class="sxs-lookup"><span data-stu-id="36060-456">`id` is ignored.</span></span>        |
| `{controller=Home}/{action=Index}/{id?}` | `/Products`         | <span data-ttu-id="36060-457">`Products` コントローラーと `Index` メソッドにマッピングされます。</span><span class="sxs-lookup"><span data-stu-id="36060-457">Maps to the `Products` controller and `Index` method.</span></span> <span data-ttu-id="36060-458">`id` は無視されます。</span><span class="sxs-lookup"><span data-stu-id="36060-458">`id` is ignored.</span></span>        |

<span data-ttu-id="36060-459">一般的に、テンプレートの利用が最も簡単なルーティングの手法となります。</span><span class="sxs-lookup"><span data-stu-id="36060-459">Using a template is generally the simplest approach to routing.</span></span> <span data-ttu-id="36060-460">ルート テンプレート以外では、制約と既定値も指定できます。</span><span class="sxs-lookup"><span data-stu-id="36060-460">Constraints and defaults can also be specified outside the route template.</span></span>

### <a name="complex-segments"></a><span data-ttu-id="36060-461">複雑なセグメント</span><span class="sxs-lookup"><span data-stu-id="36060-461">Complex segments</span></span>

<span data-ttu-id="36060-462">複雑なセグメントは、リテラル区切り文字を右から左に[最短一致](#greedy)の方法で照合することによって処理されます。</span><span class="sxs-lookup"><span data-stu-id="36060-462">Complex segments are processed by matching up literal delimiters from right to left in a [non-greedy](#greedy) way.</span></span> <span data-ttu-id="36060-463">たとえば、`[Route("/a{b}c{d}")]` は複雑なセグメントです。</span><span class="sxs-lookup"><span data-stu-id="36060-463">For example, `[Route("/a{b}c{d}")]` is a complex segment.</span></span>
<span data-ttu-id="36060-464">複雑なセグメントは、それらを適切に使用する上で理解する必要がある特定の方法で機能します。</span><span class="sxs-lookup"><span data-stu-id="36060-464">Complex segments work in a particular way that must be understood to use them successfully.</span></span> <span data-ttu-id="36060-465">このセクションの例では、パラメーター値の中に区切り文字が含まれていない場合にのみ、複雑なセグメントが本当にうまく機能する理由を示します。</span><span class="sxs-lookup"><span data-stu-id="36060-465">The example in this section demonstrates why complex segments only really work well when the delimiter text doesn't appear inside the parameter values.</span></span> <span data-ttu-id="36060-466">より複雑なケースでは、[regex](/dotnet/standard/base-types/regular-expressions) を使用し、値を手動で抽出する必要があります。</span><span class="sxs-lookup"><span data-stu-id="36060-466">Using a [regex](/dotnet/standard/base-types/regular-expressions) and then manually extracting the values is needed for more complex cases.</span></span>

[!INCLUDE[](~/includes/regex.md)]

<span data-ttu-id="36060-467">これは、ルーティングがテンプレート `/a{b}c{d}` と URL パス `/abcd` を使用して実行するステップの概要です。</span><span class="sxs-lookup"><span data-stu-id="36060-467">This is a summary of the steps that routing performs with the template `/a{b}c{d}` and the URL path `/abcd`.</span></span> <span data-ttu-id="36060-468">`|` は、アルゴリズムの動作を視覚化するために使用されます。</span><span class="sxs-lookup"><span data-stu-id="36060-468">The `|` is used to help visualize how the algorithm works:</span></span>

* <span data-ttu-id="36060-469">最初のリテラル (右から左へ) は `c` です。</span><span class="sxs-lookup"><span data-stu-id="36060-469">The first literal, right to left, is `c`.</span></span> <span data-ttu-id="36060-470">そこで、`/abcd` は右から検索され、`/ab|c|d` となります。</span><span class="sxs-lookup"><span data-stu-id="36060-470">So `/abcd` is searched from right and finds `/ab|c|d`.</span></span>
* <span data-ttu-id="36060-471">ここで、右にあるすべてのもの (`d`) がルート パラメーター `{d}` と照合されます。</span><span class="sxs-lookup"><span data-stu-id="36060-471">Everything to the right (`d`) is now matched to the route parameter `{d}`.</span></span>
* <span data-ttu-id="36060-472">次のリテラル (右から左へ) は `a` です。</span><span class="sxs-lookup"><span data-stu-id="36060-472">The next literal, right to left, is `a`.</span></span> <span data-ttu-id="36060-473">そのため `/ab|c|d` は中断したところから検索されて、`a` が見つかり、`/|a|b|c|d` となります。</span><span class="sxs-lookup"><span data-stu-id="36060-473">So `/ab|c|d` is searched starting where we left off, then `a` is found `/|a|b|c|d`.</span></span>
* <span data-ttu-id="36060-474">ここで、右の値 (`b`) がルート パラメーター `{b}` と照合されます。</span><span class="sxs-lookup"><span data-stu-id="36060-474">The value to the right (`b`) is now matched to the route parameter `{b}`.</span></span>
* <span data-ttu-id="36060-475">残りのテキストも残りのルート テンプレートも存在しないため、これは一致となります。</span><span class="sxs-lookup"><span data-stu-id="36060-475">There is no remaining text and no remaining route template, so this is a match.</span></span>

<span data-ttu-id="36060-476">同じテンプレート `/a{b}c{d}` と、URL パス `/aabcd` を使用した場合の否定の例を次に示します。</span><span class="sxs-lookup"><span data-stu-id="36060-476">Here's an example of a negative case using the same template `/a{b}c{d}` and the URL path `/aabcd`.</span></span> <span data-ttu-id="36060-477">`|` は、アルゴリズムの動作を視覚化するために使用されます。</span><span class="sxs-lookup"><span data-stu-id="36060-477">The `|` is used to help visualize how the algorithm works.</span></span> <span data-ttu-id="36060-478">このケースは一致ではありませんが、同じアルゴリズムで説明します。</span><span class="sxs-lookup"><span data-stu-id="36060-478">This case isn't a match, which is explained by the same algorithm:</span></span>
* <span data-ttu-id="36060-479">最初のリテラル (右から左へ) は `c` です。</span><span class="sxs-lookup"><span data-stu-id="36060-479">The first literal, right to left, is `c`.</span></span> <span data-ttu-id="36060-480">そこで、`/aabcd` は右から検索され、`/aab|c|d` となります。</span><span class="sxs-lookup"><span data-stu-id="36060-480">So `/aabcd` is searched from right and finds `/aab|c|d`.</span></span>
* <span data-ttu-id="36060-481">ここで、右にあるすべてのもの (`d`) がルート パラメーター `{d}` と照合されます。</span><span class="sxs-lookup"><span data-stu-id="36060-481">Everything to the right (`d`) is now matched to the route parameter `{d}`.</span></span>
* <span data-ttu-id="36060-482">次のリテラル (右から左へ) は `a` です。</span><span class="sxs-lookup"><span data-stu-id="36060-482">The next literal, right to left, is `a`.</span></span> <span data-ttu-id="36060-483">そのため `/aab|c|d` は中断したところから検索されて、`a` が見つかり、`/a|a|b|c|d` となります。</span><span class="sxs-lookup"><span data-stu-id="36060-483">So `/aab|c|d` is searched starting where we left off, then `a` is found `/a|a|b|c|d`.</span></span>
* <span data-ttu-id="36060-484">ここで、右の値 (`b`) がルート パラメーター `{b}` と照合されます。</span><span class="sxs-lookup"><span data-stu-id="36060-484">The value to the right (`b`) is now matched to the route parameter `{b}`.</span></span>
* <span data-ttu-id="36060-485">この時点で、テキスト `a` が残っていますが、アルゴリズムは解析するためのルート テンプレートを使い果たしたので、これは一致とはなりません。</span><span class="sxs-lookup"><span data-stu-id="36060-485">At this point there is remaining text `a`, but the algorithm has run out of route template to parse, so this is not a match.</span></span>

<span data-ttu-id="36060-486">照合アルゴリズムは[最短一致](#greedy)のため、次のようになります。</span><span class="sxs-lookup"><span data-stu-id="36060-486">Since the matching algorithm is [non-greedy](#greedy):</span></span>

* <span data-ttu-id="36060-487">各ステップで可能な限りの最短のテキストに一致します。</span><span class="sxs-lookup"><span data-stu-id="36060-487">It matches the smallest amount of text possible in each step.</span></span>
* <span data-ttu-id="36060-488">パラメーター値の内部に区切り記号の値が表示されている場合は一致しません。</span><span class="sxs-lookup"><span data-stu-id="36060-488">Any case where the delimiter value appears inside the parameter values results in not matching.</span></span>

<span data-ttu-id="36060-489">正規表現を使用すると、一致の動作をより細かく制御できます。</span><span class="sxs-lookup"><span data-stu-id="36060-489">Regular expressions provide much more control over their matching behavior.</span></span>

<a name="greedy"></a>

<span data-ttu-id="36060-490">最長一致 ([遅延一致](https://wikipedia.org/wiki/Regular_expression#Lazy_matching) とも呼ばれる) を使用すると、可能な限り長い文字列と一致します。</span><span class="sxs-lookup"><span data-stu-id="36060-490">Greedy matching, also know as [lazy matching](https://wikipedia.org/wiki/Regular_expression#Lazy_matching), matches the largest possible string.</span></span> <span data-ttu-id="36060-491">最短一致は、可能な限り最短の文字列と一致します。</span><span class="sxs-lookup"><span data-stu-id="36060-491">Non-greedy matches the smallest possible string.</span></span>

## <a name="route-constraint-reference"></a><span data-ttu-id="36060-492">ルート制約参照</span><span class="sxs-lookup"><span data-stu-id="36060-492">Route constraint reference</span></span>

<span data-ttu-id="36060-493">ルート制約は、受信 URL と一致し、URL パスがルート値にトークン化されたときに実行されます。</span><span class="sxs-lookup"><span data-stu-id="36060-493">Route constraints execute when a match has occurred to the incoming URL and the URL path is tokenized into route values.</span></span> <span data-ttu-id="36060-494">ルート制約では、通常、ルート テンプレート経由で関連付けられるルート値を調べ、値が許容できるかどうかを true または false で決定します。</span><span class="sxs-lookup"><span data-stu-id="36060-494">Route constraints generally inspect the route value associated via the route template and make a true or false decision about whether the value is acceptable.</span></span> <span data-ttu-id="36060-495">一部のルート制約では、ルート値以外のデータを使用し、要求をルーティングできるかどうかが考慮されます。</span><span class="sxs-lookup"><span data-stu-id="36060-495">Some route constraints use data outside the route value to consider whether the request can be routed.</span></span> <span data-ttu-id="36060-496">たとえば、<xref:Microsoft.AspNetCore.Routing.Constraints.HttpMethodRouteConstraint> はその HTTP Verb に基づいて要求を承認または却下します。</span><span class="sxs-lookup"><span data-stu-id="36060-496">For example, the <xref:Microsoft.AspNetCore.Routing.Constraints.HttpMethodRouteConstraint> can accept or reject a request based on its HTTP verb.</span></span> <span data-ttu-id="36060-497">制約は、要求のルーティングとリンクの生成で使用されます。</span><span class="sxs-lookup"><span data-stu-id="36060-497">Constraints are used in routing requests and link generation.</span></span>

> [!WARNING]
> <span data-ttu-id="36060-498">入力の検証には制約を使用しないでください。</span><span class="sxs-lookup"><span data-stu-id="36060-498">Don't use constraints for input validation.</span></span> <span data-ttu-id="36060-499">入力の検証に制約を使用した場合、入力が無効だと "`404` 見つかりません" が返されます。</span><span class="sxs-lookup"><span data-stu-id="36060-499">If constraints are used for input validation, invalid input results in a `404` Not Found response.</span></span> <span data-ttu-id="36060-500">無効な入力の場合は、"`400` 要求が無効です" と適切なエラー メッセージが生成されます。</span><span class="sxs-lookup"><span data-stu-id="36060-500">Invalid input should produce a `400` Bad Request with an appropriate error message.</span></span> <span data-ttu-id="36060-501">ルート制約は、特定のルートに対する入力の妥当性を検証するためではなく、似たようなルートの違いを明らかにするために使用されます。</span><span class="sxs-lookup"><span data-stu-id="36060-501">Route constraints are used to disambiguate similar routes, not to validate the inputs for a particular route.</span></span>

<span data-ttu-id="36060-502">次の表では、ルート制約の例とそれに求められる動作をまとめています。</span><span class="sxs-lookup"><span data-stu-id="36060-502">The following table demonstrates example route constraints and their expected behavior:</span></span>

| <span data-ttu-id="36060-503">制約</span><span class="sxs-lookup"><span data-stu-id="36060-503">constraint</span></span> | <span data-ttu-id="36060-504">例</span><span class="sxs-lookup"><span data-stu-id="36060-504">Example</span></span> | <span data-ttu-id="36060-505">一致の例</span><span class="sxs-lookup"><span data-stu-id="36060-505">Example Matches</span></span> | <span data-ttu-id="36060-506">メモ</span><span class="sxs-lookup"><span data-stu-id="36060-506">Notes</span></span> |
| ---------- | ------- | --------------- | ----- |
| `int` | `{id:int}` | <span data-ttu-id="36060-507">`123456789`、`-123456789`</span><span class="sxs-lookup"><span data-stu-id="36060-507">`123456789`, `-123456789`</span></span> | <span data-ttu-id="36060-508">あらゆる整数に一致する</span><span class="sxs-lookup"><span data-stu-id="36060-508">Matches any integer</span></span> |
| `bool` | `{active:bool}` | <span data-ttu-id="36060-509">`true`、`FALSE`</span><span class="sxs-lookup"><span data-stu-id="36060-509">`true`, `FALSE`</span></span> | <span data-ttu-id="36060-510">`true` または `false` に一致する。</span><span class="sxs-lookup"><span data-stu-id="36060-510">Matches `true` or `false`.</span></span> <span data-ttu-id="36060-511">大文字と小文字は区別されない</span><span class="sxs-lookup"><span data-stu-id="36060-511">Case-insensitive</span></span> |
| `datetime` | `{dob:datetime}` | <span data-ttu-id="36060-512">`2016-12-31`、`2016-12-31 7:32pm`</span><span class="sxs-lookup"><span data-stu-id="36060-512">`2016-12-31`, `2016-12-31 7:32pm`</span></span> | <span data-ttu-id="36060-513">インバリアント カルチャの有効な `DateTime` 値に一致します。</span><span class="sxs-lookup"><span data-stu-id="36060-513">Matches a valid `DateTime` value in the invariant culture.</span></span> <span data-ttu-id="36060-514">前の警告を参照してください。</span><span class="sxs-lookup"><span data-stu-id="36060-514">See preceding warning.</span></span> |
| `decimal` | `{price:decimal}` | <span data-ttu-id="36060-515">`49.99`、`-1,000.01`</span><span class="sxs-lookup"><span data-stu-id="36060-515">`49.99`, `-1,000.01`</span></span> | <span data-ttu-id="36060-516">インバリアント カルチャの有効な `decimal` 値に一致します。</span><span class="sxs-lookup"><span data-stu-id="36060-516">Matches a valid `decimal` value in the invariant culture.</span></span> <span data-ttu-id="36060-517">前の警告を参照してください。</span><span class="sxs-lookup"><span data-stu-id="36060-517">See preceding warning.</span></span>|
| `double` | `{weight:double}` | <span data-ttu-id="36060-518">`1.234`、`-1,001.01e8`</span><span class="sxs-lookup"><span data-stu-id="36060-518">`1.234`, `-1,001.01e8`</span></span> | <span data-ttu-id="36060-519">インバリアント カルチャの有効な `double` 値に一致します。</span><span class="sxs-lookup"><span data-stu-id="36060-519">Matches a valid `double` value in the invariant culture.</span></span> <span data-ttu-id="36060-520">前の警告を参照してください。</span><span class="sxs-lookup"><span data-stu-id="36060-520">See preceding warning.</span></span>|
| `float` | `{weight:float}` | <span data-ttu-id="36060-521">`1.234`、`-1,001.01e8`</span><span class="sxs-lookup"><span data-stu-id="36060-521">`1.234`, `-1,001.01e8`</span></span> | <span data-ttu-id="36060-522">インバリアント カルチャの有効な `float` 値に一致します。</span><span class="sxs-lookup"><span data-stu-id="36060-522">Matches a valid `float` value in the invariant culture.</span></span> <span data-ttu-id="36060-523">前の警告を参照してください。</span><span class="sxs-lookup"><span data-stu-id="36060-523">See preceding warning.</span></span>|
| `guid` | `{id:guid}` | `CD2C1638-1638-72D5-1638-DEADBEEF1638` | <span data-ttu-id="36060-524">有効な `Guid` 値に一致する</span><span class="sxs-lookup"><span data-stu-id="36060-524">Matches a valid `Guid` value</span></span> |
| `long` | `{ticks:long}` | <span data-ttu-id="36060-525">`123456789`、`-123456789`</span><span class="sxs-lookup"><span data-stu-id="36060-525">`123456789`, `-123456789`</span></span> | <span data-ttu-id="36060-526">有効な `long` 値に一致する</span><span class="sxs-lookup"><span data-stu-id="36060-526">Matches a valid `long` value</span></span> |
| `minlength(value)` | `{username:minlength(4)}` | `Rick` | <span data-ttu-id="36060-527">4 文字以上の文字列であることが必要</span><span class="sxs-lookup"><span data-stu-id="36060-527">String must be at least 4 characters</span></span> |
| `maxlength(value)` | `{filename:maxlength(8)}` | `MyFile` | <span data-ttu-id="36060-528">8 文字以内の文字列であることが必要</span><span class="sxs-lookup"><span data-stu-id="36060-528">String must be no more than 8 characters</span></span> |
| `length(length)` | `{filename:length(12)}` | `somefile.txt` | <span data-ttu-id="36060-529">厳密に 12 文字の文字列であることが必要</span><span class="sxs-lookup"><span data-stu-id="36060-529">String must be exactly 12 characters long</span></span> |
| `length(min,max)` | `{filename:length(8,16)}` | `somefile.txt` | <span data-ttu-id="36060-530">8 文字以上、16 文字以内の文字列であることが必要</span><span class="sxs-lookup"><span data-stu-id="36060-530">String must be at least 8 and no more than 16 characters long</span></span> |
| `min(value)` | `{age:min(18)}` | `19` | <span data-ttu-id="36060-531">18 以上の整数値であることが必要</span><span class="sxs-lookup"><span data-stu-id="36060-531">Integer value must be at least 18</span></span> |
| `max(value)` | `{age:max(120)}` | `91` | <span data-ttu-id="36060-532">120 以下の整数値であることが必要</span><span class="sxs-lookup"><span data-stu-id="36060-532">Integer value must be no more than 120</span></span> |
| `range(min,max)` | `{age:range(18,120)}` | `91` | <span data-ttu-id="36060-533">18 以上、120 以下の整数値であることが必要</span><span class="sxs-lookup"><span data-stu-id="36060-533">Integer value must be at least 18 but no more than 120</span></span> |
| `alpha` | `{name:alpha}` | `Rick` | <span data-ttu-id="36060-534">文字列は 1 つまたは複数のアルファベット文字で構成されることが必要 (`a`-`z`、大文字と小文字は区別されません)。</span><span class="sxs-lookup"><span data-stu-id="36060-534">String must consist of one or more alphabetical characters, `a`-`z` and case-insensitive.</span></span> |
| `regex(expression)` | `{ssn:regex(^\\d{{3}}-\\d{{2}}-\\d{{4}}$)}` | `123-45-6789` | <span data-ttu-id="36060-535">文字列は正規表現と一致する必要があります。</span><span class="sxs-lookup"><span data-stu-id="36060-535">String must match the regular expression.</span></span> <span data-ttu-id="36060-536">正規表現の定義に関するヒントを参照してください。</span><span class="sxs-lookup"><span data-stu-id="36060-536">See tips about defining a regular expression.</span></span> |
| `required` | `{name:required}` | `Rick` | <span data-ttu-id="36060-537">URL 生成中、非パラメーターが提示されるように強制する</span><span class="sxs-lookup"><span data-stu-id="36060-537">Used to enforce that a non-parameter value is present during URL generation</span></span> |

[!INCLUDE[](~/includes/regex.md)]

<span data-ttu-id="36060-538">1 のパラメーターには、複数の制約をコロンで区切って適用できます。</span><span class="sxs-lookup"><span data-stu-id="36060-538">Multiple, colon delimited constraints can be applied to a single parameter.</span></span> <span data-ttu-id="36060-539">たとえば、次の制約では、パラメーターが 1 以上の整数値に制限されます。</span><span class="sxs-lookup"><span data-stu-id="36060-539">For example, the following constraint restricts a parameter to an integer value of 1 or greater:</span></span>

```csharp
[Route("users/{id:int:min(1)}")]
public User GetUserById(int id) { }
```

> [!WARNING]
> <span data-ttu-id="36060-540">URL の妥当性を検証し、CLR 型に変換するルート制約では、常にインバリアント カルチャが使用されます。</span><span class="sxs-lookup"><span data-stu-id="36060-540">Route constraints that verify the URL and are converted to a CLR type always use the invariant culture.</span></span> <span data-ttu-id="36060-541">たとえば、`int` または `DateTime` の CLR 型に変換される場合などです。</span><span class="sxs-lookup"><span data-stu-id="36060-541">For example, conversion to the CLR type `int` or `DateTime`.</span></span> <span data-ttu-id="36060-542">これらの制約では、URL のローカライズが不可であることが前提です。</span><span class="sxs-lookup"><span data-stu-id="36060-542">These constraints assume that the URL is not localizable.</span></span> <span data-ttu-id="36060-543">フレームワークから提供されるルート制約がルート値に格納されている値を変更することはありません。</span><span class="sxs-lookup"><span data-stu-id="36060-543">The framework-provided route constraints don't modify the values stored in route values.</span></span> <span data-ttu-id="36060-544">URL から解析されたルート値はすべて文字列として格納されます。</span><span class="sxs-lookup"><span data-stu-id="36060-544">All route values parsed from the URL are stored as strings.</span></span> <span data-ttu-id="36060-545">たとえば、`float` 制約はルート値を浮動小数に変換しますが、変換された値は、浮動小数に変換できることを検証するためにだけ利用されます。</span><span class="sxs-lookup"><span data-stu-id="36060-545">For example, the `float` constraint attempts to convert the route value to a float, but the converted value is used only to verify it can be converted to a float.</span></span>

### <a name="regular-expressions-in-constraints"></a><span data-ttu-id="36060-546">正規表現の制約</span><span class="sxs-lookup"><span data-stu-id="36060-546">Regular expressions in constraints</span></span>

[!INCLUDE[](~/includes/regex.md)]

<span data-ttu-id="36060-547">正規表現は、`regex(...)` ルート制約を使用して、インライン制約として指定できます。</span><span class="sxs-lookup"><span data-stu-id="36060-547">Regular expressions can be specified as inline constraints using the `regex(...)` route constraint.</span></span> <span data-ttu-id="36060-548"><xref:Microsoft.AspNetCore.Builder.ControllerEndpointRouteBuilderExtensions.MapControllerRoute*> ファミリのメソッドでも、制約のオブジェクト リテラルを取ります。</span><span class="sxs-lookup"><span data-stu-id="36060-548">Methods in the <xref:Microsoft.AspNetCore.Builder.ControllerEndpointRouteBuilderExtensions.MapControllerRoute*> family also accept an object literal of constraints.</span></span> <span data-ttu-id="36060-549">この形式が使用されている場合、文字列値は正規表現として解釈されます。</span><span class="sxs-lookup"><span data-stu-id="36060-549">If that form is used, string values are interpreted as regular expressions.</span></span>

<span data-ttu-id="36060-550">次のコードでは、インラインで regex 制約が使用されています。</span><span class="sxs-lookup"><span data-stu-id="36060-550">The following code uses an inline regex constraint:</span></span>

[!code-csharp[](routing/samples/3.x/RoutingSample/StartupRegex.cs?name=snippet)]

<span data-ttu-id="36060-551">次のコードでは、regex 制約の指定にオブジェクト リテラルが使用されています。</span><span class="sxs-lookup"><span data-stu-id="36060-551">The following code uses an object literal to specify a regex constraint:</span></span>

[!code-csharp[](routing/samples/3.x/RoutingSample/StartupRegex2.cs?name=snippet)]

<span data-ttu-id="36060-552">ASP.NET Core フレームワークでは、正規表現コンストラクターに `RegexOptions.IgnoreCase | RegexOptions.Compiled | RegexOptions.CultureInvariant` が追加されます。</span><span class="sxs-lookup"><span data-stu-id="36060-552">The ASP.NET Core framework adds `RegexOptions.IgnoreCase | RegexOptions.Compiled | RegexOptions.CultureInvariant` to the regular expression constructor.</span></span> <span data-ttu-id="36060-553">これらのメンバーの詳細については、「<xref:System.Text.RegularExpressions.RegexOptions>」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="36060-553">See <xref:System.Text.RegularExpressions.RegexOptions> for a description of these members.</span></span>

<span data-ttu-id="36060-554">正規表現では、ルーティングや C# 言語で使用されるものに似た区切り記号とトークンが使用されます。</span><span class="sxs-lookup"><span data-stu-id="36060-554">Regular expressions use delimiters and tokens similar to those used by routing and the C# language.</span></span> <span data-ttu-id="36060-555">正規表現トークンはエスケープする必要があります。</span><span class="sxs-lookup"><span data-stu-id="36060-555">Regular expression tokens must be escaped.</span></span> <span data-ttu-id="36060-556">インライン制約で正規表現 `^\d{3}-\d{2}-\d{4}$` を使用するには、次のいずれかを使用します。</span><span class="sxs-lookup"><span data-stu-id="36060-556">To use the regular expression `^\d{3}-\d{2}-\d{4}$` in an inline constraint, use one of the following:</span></span>

* <span data-ttu-id="36060-557">`\` 文字列エスケープ文字をエスケープするには、文字列で指定した `\` 文字を、C# ソース ファイル内の `\\` 文字に置き換えます。</span><span class="sxs-lookup"><span data-stu-id="36060-557">Replace `\` characters provided in the string as `\\` characters in the C# source file in order to escape the `\` string escape character.</span></span>
* <span data-ttu-id="36060-558">[逐語的文字列リテラル](/dotnet/csharp/language-reference/keywords/string)。</span><span class="sxs-lookup"><span data-stu-id="36060-558">[Verbatim string literals](/dotnet/csharp/language-reference/keywords/string).</span></span>

<span data-ttu-id="36060-559">ルーティング パラメーター区切り記号文字 (`{`、`}`、`[`、`]`) をエスケープするには、表現の文字を二重にします (例: `{{`、`}}`、`[[`、`]]`)。</span><span class="sxs-lookup"><span data-stu-id="36060-559">To escape routing parameter delimiter characters `{`, `}`, `[`, `]`, double the characters in the expression, for example, `{{`, `}}`, `[[`, `]]`.</span></span> <span data-ttu-id="36060-560">次の表に、正規表現とそれにエスケープを適用した後のものを示します。</span><span class="sxs-lookup"><span data-stu-id="36060-560">The following table shows a regular expression and its escaped version:</span></span>

| <span data-ttu-id="36060-561">正規表現</span><span class="sxs-lookup"><span data-stu-id="36060-561">Regular expression</span></span>    | <span data-ttu-id="36060-562">エスケープ適用後の正規表現</span><span class="sxs-lookup"><span data-stu-id="36060-562">Escaped regular expression</span></span>     |
| --------------------- | ------------------------------ |
| `^\d{3}-\d{2}-\d{4}$` | `^\\d{{3}}-\\d{{2}}-\\d{{4}}$` |
| `^[a-z]{2}$`          | `^[[a-z]]{{2}}$`               |

<span data-ttu-id="36060-563">ルーティングで使用される正規表現は、多くの場合、`^` 文字で始まり、これは文字列の開始位置と一致します。</span><span class="sxs-lookup"><span data-stu-id="36060-563">Regular expressions used in routing often start with the `^` character and match the starting position of the string.</span></span> <span data-ttu-id="36060-564">この式は、多くの場合、`$` 文字で終わり、文字列の末尾と一致します。</span><span class="sxs-lookup"><span data-stu-id="36060-564">The expressions often end with the `$` character and match the end of the string.</span></span> <span data-ttu-id="36060-565">`^` 文字と `$` 文字により、正規表現がルート パラメーター値全体に一致することが保証されます。</span><span class="sxs-lookup"><span data-stu-id="36060-565">The `^` and `$` characters ensure that the regular expression matches the entire route parameter value.</span></span> <span data-ttu-id="36060-566">`^` 文字と `$` 文字がなければ、意図に反し、正規表現は文字列内のあらゆる部分文字列に一致してしまいます。</span><span class="sxs-lookup"><span data-stu-id="36060-566">Without the `^` and `$` characters, the regular expression matches any substring within the string, which is often undesirable.</span></span> <span data-ttu-id="36060-567">下の表では、一致または不一致の理由を例を示し説明します。</span><span class="sxs-lookup"><span data-stu-id="36060-567">The following table provides examples and explains why they match or fail to match:</span></span>

| <span data-ttu-id="36060-568">式</span><span class="sxs-lookup"><span data-stu-id="36060-568">Expression</span></span>   | <span data-ttu-id="36060-569">String</span><span class="sxs-lookup"><span data-stu-id="36060-569">String</span></span>    | <span data-ttu-id="36060-570">一致したもの</span><span class="sxs-lookup"><span data-stu-id="36060-570">Match</span></span> | <span data-ttu-id="36060-571">コメント</span><span class="sxs-lookup"><span data-stu-id="36060-571">Comment</span></span>               |
| ------------ | --------- | :---: |  -------------------- |
| `[a-z]{2}`   | <span data-ttu-id="36060-572">hello</span><span class="sxs-lookup"><span data-stu-id="36060-572">hello</span></span>     | <span data-ttu-id="36060-573">はい</span><span class="sxs-lookup"><span data-stu-id="36060-573">Yes</span></span>   | <span data-ttu-id="36060-574">サブ文字列の一致</span><span class="sxs-lookup"><span data-stu-id="36060-574">Substring matches</span></span>     |
| `[a-z]{2}`   | <span data-ttu-id="36060-575">123abc456</span><span class="sxs-lookup"><span data-stu-id="36060-575">123abc456</span></span> | <span data-ttu-id="36060-576">はい</span><span class="sxs-lookup"><span data-stu-id="36060-576">Yes</span></span>   | <span data-ttu-id="36060-577">サブ文字列の一致</span><span class="sxs-lookup"><span data-stu-id="36060-577">Substring matches</span></span>     |
| `[a-z]{2}`   | <span data-ttu-id="36060-578">mz</span><span class="sxs-lookup"><span data-stu-id="36060-578">mz</span></span>        | <span data-ttu-id="36060-579">はい</span><span class="sxs-lookup"><span data-stu-id="36060-579">Yes</span></span>   | <span data-ttu-id="36060-580">一致する表現</span><span class="sxs-lookup"><span data-stu-id="36060-580">Matches expression</span></span>    |
| `[a-z]{2}`   | <span data-ttu-id="36060-581">MZ</span><span class="sxs-lookup"><span data-stu-id="36060-581">MZ</span></span>        | <span data-ttu-id="36060-582">はい</span><span class="sxs-lookup"><span data-stu-id="36060-582">Yes</span></span>   | <span data-ttu-id="36060-583">大文字と小文字の使い方が違う</span><span class="sxs-lookup"><span data-stu-id="36060-583">Not case sensitive</span></span>    |
| `^[a-z]{2}$` | <span data-ttu-id="36060-584">hello</span><span class="sxs-lookup"><span data-stu-id="36060-584">hello</span></span>     | <span data-ttu-id="36060-585">いいえ</span><span class="sxs-lookup"><span data-stu-id="36060-585">No</span></span>    | <span data-ttu-id="36060-586">上の `^` と `$` を参照</span><span class="sxs-lookup"><span data-stu-id="36060-586">See `^` and `$` above</span></span> |
| `^[a-z]{2}$` | <span data-ttu-id="36060-587">123abc456</span><span class="sxs-lookup"><span data-stu-id="36060-587">123abc456</span></span> | <span data-ttu-id="36060-588">いいえ</span><span class="sxs-lookup"><span data-stu-id="36060-588">No</span></span>    | <span data-ttu-id="36060-589">上の `^` と `$` を参照</span><span class="sxs-lookup"><span data-stu-id="36060-589">See `^` and `$` above</span></span> |

<span data-ttu-id="36060-590">正規表現構文の詳細については、[.NET Framework 正規表現](/dotnet/standard/base-types/regular-expression-language-quick-reference)に関するページを参照してください。</span><span class="sxs-lookup"><span data-stu-id="36060-590">For more information on regular expression syntax, see [.NET Framework Regular Expressions](/dotnet/standard/base-types/regular-expression-language-quick-reference).</span></span>

<span data-ttu-id="36060-591">既知の入力可能値の集まりにパラメーターを制限するには、正規表現を使用します。</span><span class="sxs-lookup"><span data-stu-id="36060-591">To constrain a parameter to a known set of possible values, use a regular expression.</span></span> <span data-ttu-id="36060-592">たとえば、`{action:regex(^(list|get|create)$)}` の場合、`action` ルート値は `list`、`get`、`create` とのみ照合されます。</span><span class="sxs-lookup"><span data-stu-id="36060-592">For example, `{action:regex(^(list|get|create)$)}` only matches the `action` route value to `list`, `get`, or `create`.</span></span> <span data-ttu-id="36060-593">制約ディクショナリに渡された場合、文字列 `^(list|get|create)$` で同じものになります。</span><span class="sxs-lookup"><span data-stu-id="36060-593">If passed into the constraints dictionary, the string `^(list|get|create)$` is equivalent.</span></span> <span data-ttu-id="36060-594">既知の制約に一致しない、制約ディクショナリに渡された制約も、正規表現として扱われます。</span><span class="sxs-lookup"><span data-stu-id="36060-594">Constraints that are passed in the constraints dictionary that don't match one of the known constraints are also treated as regular expressions.</span></span> <span data-ttu-id="36060-595">既知の制約に一致しない、テンプレート内で渡される制約は、正規表現としては扱われません。</span><span class="sxs-lookup"><span data-stu-id="36060-595">Constraints that are passed  within a template that don't match one of the known constraints are not treated as regular expressions.</span></span>

### <a name="custom-route-constraints"></a><span data-ttu-id="36060-596">カスタム ルート制約</span><span class="sxs-lookup"><span data-stu-id="36060-596">Custom route constraints</span></span>

<span data-ttu-id="36060-597">カスタム ルート制約は、<xref:Microsoft.AspNetCore.Routing.IRouteConstraint> インターフェイスを実装して作成できます。</span><span class="sxs-lookup"><span data-stu-id="36060-597">Custom route constraints can be created by implementing the <xref:Microsoft.AspNetCore.Routing.IRouteConstraint> interface.</span></span> <span data-ttu-id="36060-598">`IRouteConstraint` インターフェイスには、<xref:System.Web.Routing.IRouteConstraint.Match*> が含まれています。これでは、制約が満たされている場合は `true` を返し、それ以外の場合は `false` を返します。</span><span class="sxs-lookup"><span data-stu-id="36060-598">The `IRouteConstraint` interface contains <xref:System.Web.Routing.IRouteConstraint.Match*>, which returns `true` if the constraint is satisfied and `false` otherwise.</span></span>

<span data-ttu-id="36060-599">カスタム ルート制約は通常必要ありません。</span><span class="sxs-lookup"><span data-stu-id="36060-599">Custom route constraints are rarely needed.</span></span> <span data-ttu-id="36060-600">カスタム ルート制約を実装する前に、モデル バインドなどの代替手段を検討してください。</span><span class="sxs-lookup"><span data-stu-id="36060-600">Before implementing a custom route constraint, consider alternatives, such as model binding.</span></span>

<span data-ttu-id="36060-601">ASP.NET Core の [Constraints](https://github.com/dotnet/aspnetcore/tree/master/src/Http/Routing/src/Constraints) フォルダーには、制約を作成するための適切な例が用意されています。</span><span class="sxs-lookup"><span data-stu-id="36060-601">The ASP.NET Core [Constraints](https://github.com/dotnet/aspnetcore/tree/master/src/Http/Routing/src/Constraints) folder provides good examples of creating a constraints.</span></span> <span data-ttu-id="36060-602">たとえば、[GuidRouteConstraint](https://github.com/dotnet/aspnetcore/blob/master/src/Http/Routing/src/Constraints/GuidRouteConstraint.cs#L18) です。</span><span class="sxs-lookup"><span data-stu-id="36060-602">For example, [GuidRouteConstraint](https://github.com/dotnet/aspnetcore/blob/master/src/Http/Routing/src/Constraints/GuidRouteConstraint.cs#L18).</span></span>

<span data-ttu-id="36060-603">カスタムの `IRouteConstraint` を使うには、サービス コンテナー内の <xref:Microsoft.AspNetCore.Routing.RouteOptions.ConstraintMap> に、ルート制約の種類が登録されている必要があります。</span><span class="sxs-lookup"><span data-stu-id="36060-603">To use a custom `IRouteConstraint`, the route constraint type must be registered with the app's <xref:Microsoft.AspNetCore.Routing.RouteOptions.ConstraintMap> in the service container.</span></span> <span data-ttu-id="36060-604">`ConstraintMap` は、ルート制約キーを、その制約を検証する `IRouteConstraint` の実装にマッピングするディクショナリです。</span><span class="sxs-lookup"><span data-stu-id="36060-604">A `ConstraintMap` is a dictionary that maps route constraint keys to `IRouteConstraint` implementations that validate those constraints.</span></span> <span data-ttu-id="36060-605">アプリの `ConstraintMap` は、`Startup.ConfigureServices` で、[services.AddRouting](xref:Microsoft.Extensions.DependencyInjection.RoutingServiceCollectionExtensions.AddRouting*) 呼び出しの一部として、または `services.Configure<RouteOptions>` を使って <xref:Microsoft.AspNetCore.Routing.RouteOptions> を直接構成することで、更新できます。</span><span class="sxs-lookup"><span data-stu-id="36060-605">An app's `ConstraintMap` can be updated in `Startup.ConfigureServices` either as part of a [services.AddRouting](xref:Microsoft.Extensions.DependencyInjection.RoutingServiceCollectionExtensions.AddRouting*) call or by configuring <xref:Microsoft.AspNetCore.Routing.RouteOptions> directly with `services.Configure<RouteOptions>`.</span></span> <span data-ttu-id="36060-606">次に例を示します。</span><span class="sxs-lookup"><span data-stu-id="36060-606">For example:</span></span>

[!code-csharp[](routing/samples/3.x/RoutingSample/StartupConstraint.cs?name=snippet)]

<span data-ttu-id="36060-607">上記の制約は、次のコードに適用されます。</span><span class="sxs-lookup"><span data-stu-id="36060-607">The preceding constraint is applied in the following code:</span></span>

[!code-csharp[](routing/samples/3.x/RoutingSample/Controllers/TestController.cs?name=snippet&highlight=6,13)]

[!INCLUDE[](~/includes/MyDisplayRouteInfo.md)]

<span data-ttu-id="36060-608">`MyCustomConstraint` を実装することにより、ルート パラメーターに `0` が適用されなくなります。</span><span class="sxs-lookup"><span data-stu-id="36060-608">The implementation of `MyCustomConstraint` prevents `0` being applied to a route parameter:</span></span>

[!code-csharp[](routing/samples/3.x/RoutingSample/StartupConstraint.cs?name=snippet2)]

[!INCLUDE[](~/includes/regex.md)]

<span data-ttu-id="36060-609">上記のコードでは次の操作が行われます。</span><span class="sxs-lookup"><span data-stu-id="36060-609">The preceding code:</span></span>

* <span data-ttu-id="36060-610">ルートの `{id}` セグメントの `0` を禁止します。</span><span class="sxs-lookup"><span data-stu-id="36060-610">Prevents `0` in the `{id}` segment of the route.</span></span>
* <span data-ttu-id="36060-611">カスタム制約を実装する基本的な例を示しています。</span><span class="sxs-lookup"><span data-stu-id="36060-611">Is shown to provide a basic example of implementing a custom constraint.</span></span> <span data-ttu-id="36060-612">実稼働しているアプリでは使用しないでください。</span><span class="sxs-lookup"><span data-stu-id="36060-612">It should not be used in a production app.</span></span>

<span data-ttu-id="36060-613">次のコードは、`0` を含む `id` が処理されないようにする優れた方法です。</span><span class="sxs-lookup"><span data-stu-id="36060-613">The following code is a better approach to preventing an `id` containing a `0` from being processed:</span></span>

[!code-csharp[](routing/samples/3.x/RoutingSample/Controllers/TestController.cs?name=snippet2)]

<span data-ttu-id="36060-614">上記のコードには `MyCustomConstraint` アプローチに対し、次の利点があります。</span><span class="sxs-lookup"><span data-stu-id="36060-614">The preceding code has the following advantages over the `MyCustomConstraint` approach:</span></span>

* <span data-ttu-id="36060-615">カスタム制約が必要ありません。</span><span class="sxs-lookup"><span data-stu-id="36060-615">It doesn't require a custom constraint.</span></span>
* <span data-ttu-id="36060-616">ルート パラメーターに `0` が含まれている場合は、よりわかりやすいエラーが返されます。</span><span class="sxs-lookup"><span data-stu-id="36060-616">It returns a more descriptive error when the route parameter includes `0`.</span></span>

## <a name="parameter-transformer-reference"></a><span data-ttu-id="36060-617">パラメーター トランスフォーマー参照</span><span class="sxs-lookup"><span data-stu-id="36060-617">Parameter transformer reference</span></span>

<span data-ttu-id="36060-618">パラメーター トランスフォーマー:</span><span class="sxs-lookup"><span data-stu-id="36060-618">Parameter transformers:</span></span>

* <span data-ttu-id="36060-619"><xref:Microsoft.AspNetCore.Routing.LinkGenerator> を使用したリンクの生成時に実行されます。</span><span class="sxs-lookup"><span data-stu-id="36060-619">Execute when generating a link using <xref:Microsoft.AspNetCore.Routing.LinkGenerator>.</span></span>
* <span data-ttu-id="36060-620"><xref:Microsoft.AspNetCore.Routing.IOutboundParameterTransformer?displayProperty=fullName>を実装します。</span><span class="sxs-lookup"><span data-stu-id="36060-620">Implement <xref:Microsoft.AspNetCore.Routing.IOutboundParameterTransformer?displayProperty=fullName>.</span></span>
* <span data-ttu-id="36060-621"><xref:Microsoft.AspNetCore.Routing.RouteOptions.ConstraintMap> を使用して構成されます。</span><span class="sxs-lookup"><span data-stu-id="36060-621">Are configured using <xref:Microsoft.AspNetCore.Routing.RouteOptions.ConstraintMap>.</span></span>
* <span data-ttu-id="36060-622">パラメーターのルート値を取得し、それを新しい文字列値に変換します。</span><span class="sxs-lookup"><span data-stu-id="36060-622">Take the parameter's route value and transform it to a new string value.</span></span>
* <span data-ttu-id="36060-623">変換された値は生成されたリンクで使用されるようになります。</span><span class="sxs-lookup"><span data-stu-id="36060-623">Result in using the transformed value in the generated link.</span></span>

<span data-ttu-id="36060-624">たとえば、`Url.Action(new { article = "MyTestArticle" })` のルート パターン `blog\{article:slugify}` のカスタム `slugify` パラメーター トランスフォーマーでは、`blog\my-test-article` が生成されます。</span><span class="sxs-lookup"><span data-stu-id="36060-624">For example, a custom `slugify` parameter transformer in route pattern `blog\{article:slugify}` with `Url.Action(new { article = "MyTestArticle" })` generates `blog\my-test-article`.</span></span>

<span data-ttu-id="36060-625">`IOutboundParameterTransformer` の次の実装を見てみましょう。</span><span class="sxs-lookup"><span data-stu-id="36060-625">Consider the following `IOutboundParameterTransformer` implementation:</span></span>

[!code-csharp[](routing/samples/3.x/RoutingSample/StartupConstraint2.cs?name=snippet2)]

<span data-ttu-id="36060-626">ルート パターンでパラメーター トランスフォーマーを使用するには、これを `Startup.ConfigureServices` で <xref:Microsoft.AspNetCore.Routing.RouteOptions.ConstraintMap> を使用して構成します。</span><span class="sxs-lookup"><span data-stu-id="36060-626">To use a parameter transformer in a route pattern, configure it using <xref:Microsoft.AspNetCore.Routing.RouteOptions.ConstraintMap> in `Startup.ConfigureServices`:</span></span>

[!code-csharp[](routing/samples/3.x/RoutingSample/StartupConstraint2.cs?name=snippet)]

<span data-ttu-id="36060-627">ASP.NET Core フレームワークでは、エンドポイントを解決する URI の変換にパラメーター トランスフォーマーを使用します。</span><span class="sxs-lookup"><span data-stu-id="36060-627">The ASP.NET Core framework uses parameter transformers to transform the URI where an endpoint resolves.</span></span> <span data-ttu-id="36060-628">たとえば、パラメーター トランスフォーマーでは、`area`、`controller`、`action`、`page` を照合するために使用されるルート値が変換されます。</span><span class="sxs-lookup"><span data-stu-id="36060-628">For example, parameter transformers transform the route values used to match an `area`, `controller`, `action`, and `page`.</span></span>

```csharp
routes.MapControllerRoute(
    name: "default",
    template: "{controller:slugify=Home}/{action:slugify=Index}/{id?}");
```

<span data-ttu-id="36060-629">上記のルート テンプレートでは、アクション `SubscriptionManagementController.GetAll` は URI `/subscription-management/get-all` と照合されます。</span><span class="sxs-lookup"><span data-stu-id="36060-629">With the preceding route template, the action `SubscriptionManagementController.GetAll` is matched with the URI `/subscription-management/get-all`.</span></span> <span data-ttu-id="36060-630">パラメーター トランスフォーマーでは、リンクを生成するために使用されるルート値は変更されません。</span><span class="sxs-lookup"><span data-stu-id="36060-630">A parameter transformer doesn't change the route values used to generate a link.</span></span> <span data-ttu-id="36060-631">たとえば、`Url.Action("GetAll", "SubscriptionManagement")` では `/subscription-management/get-all` が出力されます。</span><span class="sxs-lookup"><span data-stu-id="36060-631">For example, `Url.Action("GetAll", "SubscriptionManagement")` outputs `/subscription-management/get-all`.</span></span>

<span data-ttu-id="36060-632">ASP.NET Core には、生成されたルートでパラメーター トランスフォーマーを使用する API 規則があります。</span><span class="sxs-lookup"><span data-stu-id="36060-632">ASP.NET Core provides API conventions for using parameter transformers with generated routes:</span></span>

* <span data-ttu-id="36060-633"><xref:Microsoft.AspNetCore.Mvc.ApplicationModels.RouteTokenTransformerConvention?displayProperty=fullName> MVC 規則では、指定されたパラメーター トランスフォーマーをアプリ内のすべての属性ルートに適用します。</span><span class="sxs-lookup"><span data-stu-id="36060-633">The <xref:Microsoft.AspNetCore.Mvc.ApplicationModels.RouteTokenTransformerConvention?displayProperty=fullName> MVC convention applies a specified parameter transformer to all attribute routes in the app.</span></span> <span data-ttu-id="36060-634">パラメーター トランスフォーマーでは、置き換えられる属性ルート トークンが変換されます。</span><span class="sxs-lookup"><span data-stu-id="36060-634">The parameter transformer transforms attribute route tokens as they are replaced.</span></span> <span data-ttu-id="36060-635">詳細については、「[パラメーター トランスフォーマーを使用してトークンの置換をカスタマイズする](xref:mvc/controllers/routing#use-a-parameter-transformer-to-customize-token-replacement)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="36060-635">For more information, see [Use a parameter transformer to customize token replacement](xref:mvc/controllers/routing#use-a-parameter-transformer-to-customize-token-replacement).</span></span>
* <span data-ttu-id="36060-636">Razor Pages には、<xref:Microsoft.AspNetCore.Mvc.ApplicationModels.PageRouteTransformerConvention> API 規則を使用しています。</span><span class="sxs-lookup"><span data-stu-id="36060-636">Razor Pages uses the <xref:Microsoft.AspNetCore.Mvc.ApplicationModels.PageRouteTransformerConvention> API convention.</span></span> <span data-ttu-id="36060-637">この規則では、指定されたパラメーター トランスフォーマーが、自動で検出されたすべての Razor Pages に適用されます。</span><span class="sxs-lookup"><span data-stu-id="36060-637">This convention applies a specified parameter transformer to all automatically discovered Razor Pages.</span></span> <span data-ttu-id="36060-638">パラメーター トランスフォーマーでは、Razor Pages ルートのフォルダーとファイル名のセグメントが変換されます。</span><span class="sxs-lookup"><span data-stu-id="36060-638">The parameter transformer transforms the folder and file name segments of Razor Pages routes.</span></span> <span data-ttu-id="36060-639">詳細については、[パラメーター トランスフォーマーを使用したページ ルートのカスタマイズ](xref:razor-pages/razor-pages-conventions#use-a-parameter-transformer-to-customize-page-routes)に関する記事をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="36060-639">For more information, see [Use a parameter transformer to customize page routes](xref:razor-pages/razor-pages-conventions#use-a-parameter-transformer-to-customize-page-routes).</span></span>

<a name="ugr"></a>

## <a name="url-generation-reference"></a><span data-ttu-id="36060-640">URL 生成参照</span><span class="sxs-lookup"><span data-stu-id="36060-640">URL generation reference</span></span>

<span data-ttu-id="36060-641">このセクションには、URL の生成で実装するアルゴリズムの参照情報が含まれています。</span><span class="sxs-lookup"><span data-stu-id="36060-641">This section contains a reference for the algorithm implemented by URL generation.</span></span> <span data-ttu-id="36060-642">実際には、URL 生成の最も複雑な例で、コントローラーまたは Razor Pages が使用されます。</span><span class="sxs-lookup"><span data-stu-id="36060-642">In practice, most complex examples of URL generation use controllers or Razor Pages.</span></span> <span data-ttu-id="36060-643">詳細については、[コントローラーでのルーティング](xref:mvc/controllers/routing)に関するページを参照してください。</span><span class="sxs-lookup"><span data-stu-id="36060-643">See  [routing in controllers](xref:mvc/controllers/routing) for additional information.</span></span>

<span data-ttu-id="36060-644">URL の生成プロセスは、[LinkGenerator. GetPathByAddress](xref:Microsoft.AspNetCore.Routing.LinkGenerator.GetPathByAddress*)、または類似のメソッドへの呼び出しで開始されます。</span><span class="sxs-lookup"><span data-stu-id="36060-644">The URL generation process begins with a call to [LinkGenerator.GetPathByAddress](xref:Microsoft.AspNetCore.Routing.LinkGenerator.GetPathByAddress*) or a similar method.</span></span> <span data-ttu-id="36060-645">このメソッドは、アドレス、一連のルート値、およびオプションで `HttpContext` からの現在の要求に関する情報と共に渡されます。</span><span class="sxs-lookup"><span data-stu-id="36060-645">The method is provided with an address, a set of route values, and optionally information about the current request from `HttpContext`.</span></span>

<span data-ttu-id="36060-646">まずは、アドレスを使用して、アドレスの型に一致する [`IEndpointAddressScheme<TAddress>`](xref:Microsoft.AspNetCore.Routing.IEndpointAddressScheme`1) を使用して、一連の候補のエンドポイントが解決されます。</span><span class="sxs-lookup"><span data-stu-id="36060-646">The first step is to use the address to resolve a set of candidate endpoints using an [`IEndpointAddressScheme<TAddress>`](xref:Microsoft.AspNetCore.Routing.IEndpointAddressScheme`1) that matches the address's type.</span></span>

<span data-ttu-id="36060-647">アドレス スキームによって一連の候補が検出されると、URL の生成操作が成功するまで、エンドポイントは順に並べ替えられ、処理されます。</span><span class="sxs-lookup"><span data-stu-id="36060-647">Once of set of candidates is found by the address scheme, the endpoints are ordered and processed iteratively until a URL generation operation succeeds.</span></span> <span data-ttu-id="36060-648">URL が生成される際には、あいまいさの確認は**行われず**、最初に返される結果が最終的な結果になります。</span><span class="sxs-lookup"><span data-stu-id="36060-648">URL generation does **not** check for ambiguities, the first result returned is the final result.</span></span>

### <a name="troubleshooting-url-generation-with-logging"></a><span data-ttu-id="36060-649">ログを使用した URL 生成のトラブルシューティング</span><span class="sxs-lookup"><span data-stu-id="36060-649">Troubleshooting URL generation with logging</span></span>

<span data-ttu-id="36060-650">URL の生成のトラブルシューティングを行う場合、まずは `Microsoft.AspNetCore.Routing` のログ記録レベルを `TRACE` に設定します。</span><span class="sxs-lookup"><span data-stu-id="36060-650">The first step in troubleshooting URL generation is setting the logging level of `Microsoft.AspNetCore.Routing` to `TRACE`.</span></span> <span data-ttu-id="36060-651">`LinkGenerator` では、問題のトラブルシューティングに役立つ、処理に関する多くの詳細がログに記録されます。</span><span class="sxs-lookup"><span data-stu-id="36060-651">`LinkGenerator` logs many details about its processing which can be useful to troubleshoot problems.</span></span>

<span data-ttu-id="36060-652">URL 生成の詳細については、「[URL 生成参照](#ugr)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="36060-652">See [URL generation reference](#ugr) for details on URL generation.</span></span>

### <a name="addresses"></a><span data-ttu-id="36060-653">アドレス</span><span class="sxs-lookup"><span data-stu-id="36060-653">Addresses</span></span>

<span data-ttu-id="36060-654">アドレスとは、リンク ジェネレーターへの呼び出しを一連の候補エンドポイントにバインドするために使用する、URL 生成の概念です。</span><span class="sxs-lookup"><span data-stu-id="36060-654">Addresses are the concept in URL generation used to bind a call into the link generator to a set of candidate endpoints.</span></span>

<span data-ttu-id="36060-655">アドレスとは、次の 2 つの実装を既定で備えた拡張可能な概念です。</span><span class="sxs-lookup"><span data-stu-id="36060-655">Addresses are an extensible concept that come with two implementations by default:</span></span>

* <span data-ttu-id="36060-656">アドレスとして "*エンドポイント名*" (`string`) を使用します。</span><span class="sxs-lookup"><span data-stu-id="36060-656">Using *endpoint name* (`string`) as the address:</span></span>
    * <span data-ttu-id="36060-657">MVC のルート名と同様の機能があります。</span><span class="sxs-lookup"><span data-stu-id="36060-657">Provides similar functionality to MVC's route name.</span></span>
    * <span data-ttu-id="36060-658"><xref:Microsoft.AspNetCore.Routing.IEndpointNameMetadata> メタデータ型を使用します。</span><span class="sxs-lookup"><span data-stu-id="36060-658">Uses the <xref:Microsoft.AspNetCore.Routing.IEndpointNameMetadata> metadata type.</span></span>
    * <span data-ttu-id="36060-659">指定された文字列を、登録されているすべてのエンドポイントのメタデータに対して解決します。</span><span class="sxs-lookup"><span data-stu-id="36060-659">Resolves the provided string against the metadata of all registered endpoints.</span></span>
    * <span data-ttu-id="36060-660">複数のエンドポイントが同じ名前を使用している場合は、起動時に例外をスローします。</span><span class="sxs-lookup"><span data-stu-id="36060-660">Throws an exception on startup if multiple endpoints use the same name.</span></span>
    * <span data-ttu-id="36060-661">コントローラーと Razor Pages 以外で汎用的に使用する場合にお勧めします。</span><span class="sxs-lookup"><span data-stu-id="36060-661">Recommended for general-purpose use outside of controllers and Razor Pages.</span></span>
* <span data-ttu-id="36060-662">*ルート値* (<xref:Microsoft.AspNetCore.Routing.RouteValuesAddress>) をアドレスとして使用すると、次のようになります。</span><span class="sxs-lookup"><span data-stu-id="36060-662">Using *route values* (<xref:Microsoft.AspNetCore.Routing.RouteValuesAddress>) as the address:</span></span>
    * <span data-ttu-id="36060-663">コントローラーおよび Razor Pages での従来の URL 生成と同様の機能があります。</span><span class="sxs-lookup"><span data-stu-id="36060-663">Provides similar functionality to controllers and Razor Pages legacy URL generation.</span></span>
    * <span data-ttu-id="36060-664">拡張およびデバッグする場合に非常に複雑です。</span><span class="sxs-lookup"><span data-stu-id="36060-664">Very complex to extend and debug.</span></span>
    * <span data-ttu-id="36060-665">`IUrlHelper`、タグ ヘルパー、HTML ヘルパー、アクションの結果などで使用される実装を提供します。</span><span class="sxs-lookup"><span data-stu-id="36060-665">Provides the implementation used by `IUrlHelper`, Tag Helpers, HTML Helpers, Action Results, etc.</span></span>

<span data-ttu-id="36060-666">アドレス スキームの役割は、任意の条件によって、アドレスと一致するエンドポイント間の関連付けを作成することです。</span><span class="sxs-lookup"><span data-stu-id="36060-666">The role of the address scheme is to make the association between the address and matching endpoints by arbitrary criteria:</span></span>

* <span data-ttu-id="36060-667">エンドポイント名スキームでは、基本的な辞書検索が実行されます。</span><span class="sxs-lookup"><span data-stu-id="36060-667">The endpoint name scheme performs a basic dictionary lookup.</span></span>
* <span data-ttu-id="36060-668">ルート値のスキームには、セット アルゴリズムの複雑な最良のサブセットがあります。</span><span class="sxs-lookup"><span data-stu-id="36060-668">The route values scheme has a complex best subset of set algorithm.</span></span>

<a name="ambient"></a>

### <a name="ambient-values-and-explicit-values"></a><span data-ttu-id="36060-669">アンビエント値と明示的な値</span><span class="sxs-lookup"><span data-stu-id="36060-669">Ambient values and explicit values</span></span>

<span data-ttu-id="36060-670">ルーティングは、現在の要求から現在の要求 `HttpContext.Request.RouteValues` のルート値にアクセスします。</span><span class="sxs-lookup"><span data-stu-id="36060-670">From the current request, routing accesses the route values of the current request `HttpContext.Request.RouteValues`.</span></span> <span data-ttu-id="36060-671">現在の要求に関連付けられている値は、**アンビエント値**と呼ばれます。</span><span class="sxs-lookup"><span data-stu-id="36060-671">The values associated with the current request are referred to as the **ambient values**.</span></span> <span data-ttu-id="36060-672">このドキュメントでは、わかりやすくするために、メソッドに渡されるルート値を**明示的な値**と呼びます。</span><span class="sxs-lookup"><span data-stu-id="36060-672">For the purpose of clarity, the documentation refers to the route values passed in to methods as **explicit values**.</span></span>

<span data-ttu-id="36060-673">次の例では、アンビエント値と明示的な値を示しています。</span><span class="sxs-lookup"><span data-stu-id="36060-673">The following example shows ambient values and explicit values.</span></span> <span data-ttu-id="36060-674">これでは、アンビエント値を現在の要求と明示的な値から提供します (`{ id = 17, }`)。</span><span class="sxs-lookup"><span data-stu-id="36060-674">It provides ambient values from the current request and explicit values: `{ id = 17, }`:</span></span>

[!code-csharp[](routing/samples/3.x/RoutingSample/Controllers/WidgetController.cs?name=snippet)]

<span data-ttu-id="36060-675">上記のコードでは次の操作が行われます。</span><span class="sxs-lookup"><span data-stu-id="36060-675">The preceding code:</span></span>

* <span data-ttu-id="36060-676">`/Widget/Index/17` を返します。</span><span class="sxs-lookup"><span data-stu-id="36060-676">Returns `/Widget/Index/17`</span></span>
* <span data-ttu-id="36060-677">[DI](xref:fundamentals/dependency-injection) を介して <xref:Microsoft.AspNetCore.Routing.LinkGenerator> を取得します。</span><span class="sxs-lookup"><span data-stu-id="36060-677">Gets <xref:Microsoft.AspNetCore.Routing.LinkGenerator> via [DI](xref:fundamentals/dependency-injection).</span></span>

<span data-ttu-id="36060-678">次のコードでは、アンビエント値と明示的な値は提供されていません (`{ controller = "Home", action = "Subscribe", id = 17, }`)。</span><span class="sxs-lookup"><span data-stu-id="36060-678">The following code provides no ambient values and explicit values: `{ controller = "Home", action = "Subscribe", id = 17, }`:</span></span>

[!code-csharp[](routing/samples/3.x/RoutingSample/Controllers/WidgetController.cs?name=snippet2)]

<span data-ttu-id="36060-679">上記のメソッドでは `/Home/Subscribe/17` が返されます。</span><span class="sxs-lookup"><span data-stu-id="36060-679">The preceding  method returns `/Home/Subscribe/17`</span></span>

<span data-ttu-id="36060-680">`WidgetController` の次のコードでは、`/Widget/Subscribe/17` が返されます。</span><span class="sxs-lookup"><span data-stu-id="36060-680">The following code in the `WidgetController` returns `/Widget/Subscribe/17`:</span></span>

[!code-csharp[](routing/samples/3.x/RoutingSample/Controllers/WidgetController.cs?name=snippet3)]

<span data-ttu-id="36060-681">次のコードは、現在の要求と明示的な値のアンビエント値 (`{ action = "Edit", id = 17, }`) からコントローラーを提供します。</span><span class="sxs-lookup"><span data-stu-id="36060-681">The following code provides the controller from ambient values in the current request and explicit values: `{ action = "Edit", id = 17, }`:</span></span>

[!code-csharp[](routing/samples/3.x/RoutingSample/Controllers/GadgetController.cs?name=snippet)]

<span data-ttu-id="36060-682">上のコードでは以下の操作が行われます。</span><span class="sxs-lookup"><span data-stu-id="36060-682">In the preceding code:</span></span>

* <span data-ttu-id="36060-683">`/Gadget/Edit/17` が返されます。</span><span class="sxs-lookup"><span data-stu-id="36060-683">`/Gadget/Edit/17` is returned.</span></span>
* <span data-ttu-id="36060-684"><xref:Microsoft.AspNetCore.Mvc.ControllerBase.Url> が <xref:Microsoft.AspNetCore.Mvc.IUrlHelper> を取得します。</span><span class="sxs-lookup"><span data-stu-id="36060-684"><xref:Microsoft.AspNetCore.Mvc.ControllerBase.Url> gets the <xref:Microsoft.AspNetCore.Mvc.IUrlHelper>.</span></span>
* <xref:Microsoft.AspNetCore.Mvc.UrlHelperExtensions.Action*>   
<span data-ttu-id="36060-685">が、アクション メソッドの絶対パスを使用して URL を生成します。</span><span class="sxs-lookup"><span data-stu-id="36060-685">generates a URL with an absolute path for an action method.</span></span> <span data-ttu-id="36060-686">URL には、指定した `action` 名と `route` 値が含まれます。</span><span class="sxs-lookup"><span data-stu-id="36060-686">The URL contains the specified `action` name and `route` values.</span></span>

<span data-ttu-id="36060-687">次のコードでは、現在の要求と明示的な値 (`{ page = "./Edit, id = 17, }`) からアンビエント値を提供します。</span><span class="sxs-lookup"><span data-stu-id="36060-687">The following code provides ambient values from the current request and explicit values: `{ page = "./Edit, id = 17, }`:</span></span>

[!code-csharp[](routing/samples/3.x/RoutingSample/Pages/Index.cshtml.cs?name=snippet)]

<span data-ttu-id="36060-688">前のコードでは、[Edit Razor Page]\(Razor ページの編集\) に次のページ ディレクティブが含まれている場合に、`url` を `/Edit/17` に設定します。</span><span class="sxs-lookup"><span data-stu-id="36060-688">The preceding code sets `url` to  `/Edit/17` when the Edit Razor Page contains the following page directive:</span></span>

 `@page "{id:int}"`

<span data-ttu-id="36060-689">[編集] ページに `"{id:int}"` ルート テンプレートが含まれない場合は、`url` は `/Edit?id=17` になります。</span><span class="sxs-lookup"><span data-stu-id="36060-689">If the Edit page doesn't contain the `"{id:int}"` route template, `url` is `/Edit?id=17`.</span></span>

<span data-ttu-id="36060-690">MVC の <xref:Microsoft.AspNetCore.Mvc.IUrlHelper> の動作により、ここで説明するルールに加えて、複雑なレイヤーが追加されます。</span><span class="sxs-lookup"><span data-stu-id="36060-690">The behavior of MVC's <xref:Microsoft.AspNetCore.Mvc.IUrlHelper> adds a layer of complexity in addition to the rules described here:</span></span>

* <span data-ttu-id="36060-691">`IUrlHelper` は、常に現在の要求からルート値をアンビエント値として提供します。</span><span class="sxs-lookup"><span data-stu-id="36060-691">`IUrlHelper` always provides the route values from the current request as ambient values.</span></span>
* <span data-ttu-id="36060-692">[IUrlHelper.Action](xref:Microsoft.AspNetCore.Mvc.UrlHelperExtensions.Action*) は、開発者がオーバーライドしない場合を除き、常に現在の `action` と `controller` ルート値を明示的な値としてコピーします。</span><span class="sxs-lookup"><span data-stu-id="36060-692">[IUrlHelper.Action](xref:Microsoft.AspNetCore.Mvc.UrlHelperExtensions.Action*) always copies the current `action` and `controller` route values as explicit values unless overridden by the developer.</span></span>
* <span data-ttu-id="36060-693">[IUrlHelper.Page](xref:Microsoft.AspNetCore.Mvc.UrlHelperExtensions.Page*) は、オーバーライドされない場合を除き、常に現在の `page` ルート値を明示的な値としてコピーします。</span><span class="sxs-lookup"><span data-stu-id="36060-693">[IUrlHelper.Page](xref:Microsoft.AspNetCore.Mvc.UrlHelperExtensions.Page*) always copies the current `page` route value as an explicit value unless overridden.</span></span> <!--by the user-->
* <span data-ttu-id="36060-694">`IUrlHelper.Page` は、オーバーライドされない場合を除き、常に現在の `handler` ルート値を明示的な値として `null` にオーバーライドします。</span><span class="sxs-lookup"><span data-stu-id="36060-694">`IUrlHelper.Page` always overrides the current `handler` route value with `null` as an explicit values unless overridden.</span></span>

<span data-ttu-id="36060-695">ユーザーは、MVC が独自のルールに従っていないように見えるため、アンビエント値の動作の詳細にしばしば驚きます。</span><span class="sxs-lookup"><span data-stu-id="36060-695">Users are often surprised by the behavioral details of ambient values, because MVC doesn't seem to follow its own rules.</span></span> <span data-ttu-id="36060-696">これまでの経緯および互換性の理由により、`action`、`controller`、`page`、`handler` などの特定のルート値には、独自の特殊な動作があります。</span><span class="sxs-lookup"><span data-stu-id="36060-696">For historical and compatibility reasons, certain route values such as `action`, `controller`, `page`, and `handler` have their own special-case behavior.</span></span>

<span data-ttu-id="36060-697">`LinkGenerator.GetPathByAction` と `LinkGenerator.GetPathByPage` の同等の機能では、互換性のために `IUrlHelper` のこの異常と同じ動作が行われます。</span><span class="sxs-lookup"><span data-stu-id="36060-697">The equivalent functionality provided by `LinkGenerator.GetPathByAction` and `LinkGenerator.GetPathByPage` duplicates these anomalies of `IUrlHelper` for compatibility.</span></span>

### <a name="url-generation-process"></a><span data-ttu-id="36060-698">URL の生成処理</span><span class="sxs-lookup"><span data-stu-id="36060-698">URL generation process</span></span>

<span data-ttu-id="36060-699">一連の候補エンドポイントが見つかると、URL の生成アルゴリズムでは次が実行されます。</span><span class="sxs-lookup"><span data-stu-id="36060-699">Once the set of candidate endpoints are found, the URL generation algorithm:</span></span>

* <span data-ttu-id="36060-700">エンドポイントが反復処理されます。</span><span class="sxs-lookup"><span data-stu-id="36060-700">Processes the endpoints iteratively.</span></span>
* <span data-ttu-id="36060-701">最初に成功した結果が返されます。</span><span class="sxs-lookup"><span data-stu-id="36060-701">Returns the first successful result.</span></span>

<span data-ttu-id="36060-702">このプロセスの最初の手順は**ルート値の無効化**と呼ばれます。</span><span class="sxs-lookup"><span data-stu-id="36060-702">The first step in this process is called **route value invalidation**.</span></span>  <span data-ttu-id="36060-703">ルート値の無効化は、アンビエント値からどのルート値を使用する必要があり、無視する必要があるかをルーティングが決定するプロセスです。</span><span class="sxs-lookup"><span data-stu-id="36060-703">Route value invalidation is the process by which routing decides which route values from the ambient values should be used and which should be ignored.</span></span> <span data-ttu-id="36060-704">各アンビエント値が検討され、明示的な値と組み合わされるか、または無視されます。</span><span class="sxs-lookup"><span data-stu-id="36060-704">Each ambient value is considered and either combined with the explicit values, or ignored.</span></span>

<span data-ttu-id="36060-705">アンビエント値の役割について一番わかりやすい考え方は、一部の一般的なケースでアプリケーション開発者の入力作業が省かれるということです。</span><span class="sxs-lookup"><span data-stu-id="36060-705">The best way to think about the role of ambient values is that they attempt to save application developers typing, in some common cases.</span></span> <span data-ttu-id="36060-706">従来、アンビエント値が役に立つシナリオは MVC に関連しています。</span><span class="sxs-lookup"><span data-stu-id="36060-706">Traditionally, the scenarios where ambient values are helpful are related to MVC:</span></span>

* <span data-ttu-id="36060-707">同じコントローラー内の別のアクションにリンクする場合、コントローラー名を指定する必要はありません。</span><span class="sxs-lookup"><span data-stu-id="36060-707">When linking to another action in the same controller, the controller name doesn't need to be specified.</span></span>
* <span data-ttu-id="36060-708">同じ領域内の別のコントローラーにリンクする場合、領域名を指定する必要はありません。</span><span class="sxs-lookup"><span data-stu-id="36060-708">When linking to another controller in the same area, the area name doesn't need to be specified.</span></span>
* <span data-ttu-id="36060-709">同じアクション メソッドにリンクする場合は、ルート値を指定する必要はありません。</span><span class="sxs-lookup"><span data-stu-id="36060-709">When linking to the same action method, route values don't need to be specified.</span></span>
* <span data-ttu-id="36060-710">アプリの別の部分にリンクする場合は、アプリのその部分には意味のないルート値は引き継ぎません。</span><span class="sxs-lookup"><span data-stu-id="36060-710">When linking to another part of the app, you don't want to carry over route values that have no meaning in that part of the app.</span></span>

<span data-ttu-id="36060-711">`null` を返す `LinkGenerator` または `IUrlHelper` の呼び出しは、通常、ルート値の無効化について理解していないことが原因で発生します。</span><span class="sxs-lookup"><span data-stu-id="36060-711">Calls to `LinkGenerator` or `IUrlHelper` that return `null` are usually caused by not understanding route value invalidation.</span></span> <span data-ttu-id="36060-712">ルート値の無効化のトラブルシューティングを行うには、さらにルート値を明示的に指定して、これにより問題が解決されるかどうかを確認します。</span><span class="sxs-lookup"><span data-stu-id="36060-712">Troubleshoot route value invalidation by explicitly specifying more of the route values to see if that solves the problem.</span></span>

<span data-ttu-id="36060-713">ルート値の無効化は、アプリの URL スキームが階層的であり、階層が左から右に形成されていることを前提として機能します。</span><span class="sxs-lookup"><span data-stu-id="36060-713">Route value invalidation works on the assumption that the app's URL scheme is hierarchical, with a hierarchy formed from left-to-right.</span></span> <span data-ttu-id="36060-714">基本的なコントローラー ルート テンプレート `{controller}/{action}/{id?}` について考えてみましょう。これが実際にどのように動作するかを直感的に理解できます。</span><span class="sxs-lookup"><span data-stu-id="36060-714">Consider the basic controller route template `{controller}/{action}/{id?}` to get an intuitive sense of how this works in practice.</span></span> <span data-ttu-id="36060-715">値に対する**変更**により、右側に表示されるすべてのルート値が**無効化**されます。</span><span class="sxs-lookup"><span data-stu-id="36060-715">A **change** to a value **invalidates** all of the route values that appear to the right.</span></span> <span data-ttu-id="36060-716">これには、階層に関する前提が反映されています。</span><span class="sxs-lookup"><span data-stu-id="36060-716">This reflects the assumption about hierarchy.</span></span> <span data-ttu-id="36060-717">アプリに `id` のアンビエント値があり、操作によって `controller` に対して異なる値が指定された場合、</span><span class="sxs-lookup"><span data-stu-id="36060-717">If the app has an ambient value for `id`, and the operation specifies a different value for the `controller`:</span></span>

* <span data-ttu-id="36060-718">`{controller}` が `{id?}` の左側にあるため、`id` は再利用されません。</span><span class="sxs-lookup"><span data-stu-id="36060-718">`id` won't be reused because `{controller}` is to the left of `{id?}`.</span></span>

<span data-ttu-id="36060-719">この原則を示すいくつかの例を次に示します。</span><span class="sxs-lookup"><span data-stu-id="36060-719">Some examples demonstrating this principle:</span></span>

* <span data-ttu-id="36060-720">明示的な値に `id` の値が含まれている場合、`id` のアンビエント値は無視されます。</span><span class="sxs-lookup"><span data-stu-id="36060-720">If the explicit values contain a value for `id`, the ambient value for `id` is ignored.</span></span> <span data-ttu-id="36060-721">`controller` と `action` のアンビエント値を使用できます。</span><span class="sxs-lookup"><span data-stu-id="36060-721">The ambient values for `controller` and `action` can be used.</span></span>
* <span data-ttu-id="36060-722">明示的な値に `action` の値が含まれている場合、`action` のアンビエント値はすべて無視されます。</span><span class="sxs-lookup"><span data-stu-id="36060-722">If the explicit values contain a value for `action`, any ambient value for `action` is ignored.</span></span> <span data-ttu-id="36060-723">`controller` のアンビエント値を使用できます。</span><span class="sxs-lookup"><span data-stu-id="36060-723">The ambient values for `controller` can be used.</span></span> <span data-ttu-id="36060-724">`action` の明示的な値が `action` のアンビエント値と異なる場合、`id` 値は使用されません。</span><span class="sxs-lookup"><span data-stu-id="36060-724">If the explicit value for `action` is different from the ambient value for `action`, the `id` value won't be used.</span></span>  <span data-ttu-id="36060-725">`action` の明示的な値が `action` のアンビエント値と同じ場合、`id` 値を使用できます。</span><span class="sxs-lookup"><span data-stu-id="36060-725">If the explicit value for `action` is the same as the ambient value for `action`, the `id` value can be used.</span></span>
* <span data-ttu-id="36060-726">明示的な値に `controller` の値が含まれている場合、`controller` のアンビエント値はすべて無視されます。</span><span class="sxs-lookup"><span data-stu-id="36060-726">If the explicit values contain a value for `controller`, any ambient value for `controller` is ignored.</span></span> <span data-ttu-id="36060-727">`controller` の明示的な値が `controller` のアンビエント値と異なる場合、`action` と `id` の値は使用されません。</span><span class="sxs-lookup"><span data-stu-id="36060-727">If the explicit value for `controller` is different from the ambient value for `controller`, the `action` and `id` values won't be used.</span></span> <span data-ttu-id="36060-728">`controller` の明示的な値が `controller` のアンビエント値と同じ場合、`action` と `id` の値を使用できます。</span><span class="sxs-lookup"><span data-stu-id="36060-728">If the explicit value for `controller` is the same as the ambient value for `controller`, the `action` and `id` values can be used.</span></span>

<span data-ttu-id="36060-729">このプロセスは、属性ルートと専用規則ルートが存在することでさらに複雑になります。</span><span class="sxs-lookup"><span data-stu-id="36060-729">This process is further complicated by the existence of attribute routes and dedicated conventional routes.</span></span> <span data-ttu-id="36060-730">`{controller}/{action}/{id?}` などのコントローラーの規則ルートでは、ルート パラメーターを使用して階層が指定されます。</span><span class="sxs-lookup"><span data-stu-id="36060-730">Controller conventional routes such as `{controller}/{action}/{id?}` specify a hierarchy using route parameters.</span></span> <span data-ttu-id="36060-731">コントローラーと Razor Pages に対する[専用規則ルート](xref:mvc/controllers/routing#dcr)と[属性ルート](xref:mvc/controllers/routing#ar)の場合、</span><span class="sxs-lookup"><span data-stu-id="36060-731">For [dedicated conventional routes](xref:mvc/controllers/routing#dcr) and [attribute routes](xref:mvc/controllers/routing#ar) to controllers and Razor Pages:</span></span>

* <span data-ttu-id="36060-732">ルート値の階層があります。</span><span class="sxs-lookup"><span data-stu-id="36060-732">There is a hierarchy of route values.</span></span>
* <span data-ttu-id="36060-733">テンプレートには表示されません。</span><span class="sxs-lookup"><span data-stu-id="36060-733">They don't appear in the template.</span></span>

<span data-ttu-id="36060-734">このような場合は、URL の生成によって**必要な値**の概念が定義されます。</span><span class="sxs-lookup"><span data-stu-id="36060-734">For these cases, URL generation defines the **required values** concept.</span></span> <span data-ttu-id="36060-735">コントローラーおよび Razor Pages によって作成されたエンドポイントには、ルート値の無効化を機能させるために必要な値が指定されています。</span><span class="sxs-lookup"><span data-stu-id="36060-735">Endpoints created by controllers and Razor Pages have required values specified that allow route value invalidation to work.</span></span>

<span data-ttu-id="36060-736">ルート値の無効化アルゴリズムの詳細は次のとおりです。</span><span class="sxs-lookup"><span data-stu-id="36060-736">The route value invalidation algorithm in detail:</span></span>

* <span data-ttu-id="36060-737">必要な値の名前がルート パラメーターと組み合わされ、左から右に処理されます。</span><span class="sxs-lookup"><span data-stu-id="36060-737">The required value names are combined with the route parameters, then processed from left-to-right.</span></span>
* <span data-ttu-id="36060-738">各パラメーターについて、アンビエント値と明示的な値が比較されます。</span><span class="sxs-lookup"><span data-stu-id="36060-738">For each parameter, the ambient value and explicit value are compared:</span></span>
    * <span data-ttu-id="36060-739">アンビエント値と明示的な値が同じ場合、プロセスは続行されます。</span><span class="sxs-lookup"><span data-stu-id="36060-739">If the ambient value and explicit value are the same, the process continues.</span></span>
    * <span data-ttu-id="36060-740">アンビエント値が存在し、明示的な値が存在しない場合は、URL を生成するときにアンビエント値が使用されます。</span><span class="sxs-lookup"><span data-stu-id="36060-740">If the ambient value is present and the explicit value isn't, the ambient value is used when generating the URL.</span></span>
    * <span data-ttu-id="36060-741">アンビエント値が存在せず、明示的な値が存在する場合は、そのアンビエント値とそれ以降のすべてのアンビエント値が拒否されます。</span><span class="sxs-lookup"><span data-stu-id="36060-741">If the ambient value isn't present and the explicit value is, reject the ambient value and all subsequent ambient values.</span></span>
    * <span data-ttu-id="36060-742">アンビエント値と明示的な値が存在し、2 つの値が異なる場合は、そのアンビエント値とそれ以降のすべてのアンビエント値が拒否されます。</span><span class="sxs-lookup"><span data-stu-id="36060-742">If the ambient value and the explicit value are present, and the two values are different, reject the ambient value and all subsequent ambient values.</span></span>

<span data-ttu-id="36060-743">この時点で、URL の生成操作はルート制約を評価する準備ができています。</span><span class="sxs-lookup"><span data-stu-id="36060-743">At this point, the URL generation operation is ready to evaluate route constraints.</span></span> <span data-ttu-id="36060-744">許容可能な値のセットがパラメーターの既定値と組み合わされ、制約に提供されます。</span><span class="sxs-lookup"><span data-stu-id="36060-744">The set of accepted values is combined with the parameter default values, which is provided to constraints.</span></span> <span data-ttu-id="36060-745">すべての制約について合格した場合、操作が続行されます。</span><span class="sxs-lookup"><span data-stu-id="36060-745">If the constraints all pass, the operation continues.</span></span>

<span data-ttu-id="36060-746">次に、**許容可能な値**を使用してルート テンプレートを展開できます。</span><span class="sxs-lookup"><span data-stu-id="36060-746">Next, the **accepted values** can be used to expand the route template.</span></span> <span data-ttu-id="36060-747">ルート テンプレートは次のように処理されます。</span><span class="sxs-lookup"><span data-stu-id="36060-747">The route template is processed:</span></span>

* <span data-ttu-id="36060-748">左から右。</span><span class="sxs-lookup"><span data-stu-id="36060-748">From left-to-right.</span></span>
* <span data-ttu-id="36060-749">各パラメーターに、許容可能な値が代入されます。</span><span class="sxs-lookup"><span data-stu-id="36060-749">Each parameter has its accepted value substituted.</span></span>
* <span data-ttu-id="36060-750">次の特殊なケースがあります。</span><span class="sxs-lookup"><span data-stu-id="36060-750">With the following special cases:</span></span>
  * <span data-ttu-id="36060-751">許容可能な値がなく、パラメーターに既定値がある場合は、既定値が使用されます。</span><span class="sxs-lookup"><span data-stu-id="36060-751">If the accepted values is missing a value and the parameter has a default value, the default value is used.</span></span>
  * <span data-ttu-id="36060-752">許容可能な値がなく、パラメーターが省略可能な場合は、処理が続行されます。</span><span class="sxs-lookup"><span data-stu-id="36060-752">If the accepted values is missing a value and the parameter is optional, processing continues.</span></span>
  * <span data-ttu-id="36060-753">存在しない省略可能なパラメーターの右側にあるルート パラメーターのいずれかに値がある場合、操作は失敗します。</span><span class="sxs-lookup"><span data-stu-id="36060-753">If any route parameter to the right of a missing optional parameter has a value, the operation fails.</span></span>
  * <!-- review default-valued parameters optional parameters --> <span data-ttu-id="36060-754">連続する既定値パラメーターと省略可能なパラメーターは、可能な場合、折りたたまれています。</span><span class="sxs-lookup"><span data-stu-id="36060-754">Contiguous default-valued parameters and optional parameters are collapsed where possible.</span></span>

<span data-ttu-id="36060-755">ルートのセグメントと一致しない明示的に指定された値は、クエリ文字列に追加されます。</span><span class="sxs-lookup"><span data-stu-id="36060-755">Values explicitly provided that don't match a segment of the route are added to the query string.</span></span> <span data-ttu-id="36060-756">次の表は、ルート テンプレート `{controller}/{action}/{id?}` の使用時の結果をまとめたものです。</span><span class="sxs-lookup"><span data-stu-id="36060-756">The following table shows the result when using the route template `{controller}/{action}/{id?}`.</span></span>

| <span data-ttu-id="36060-757">アンビエント値</span><span class="sxs-lookup"><span data-stu-id="36060-757">Ambient Values</span></span>                     | <span data-ttu-id="36060-758">明示的な値</span><span class="sxs-lookup"><span data-stu-id="36060-758">Explicit Values</span></span>                        | <span data-ttu-id="36060-759">結果</span><span class="sxs-lookup"><span data-stu-id="36060-759">Result</span></span>                  |
| ---------------------------------- | -------------------------------------- | ----------------------- |
| <span data-ttu-id="36060-760">controller = "Home"</span><span class="sxs-lookup"><span data-stu-id="36060-760">controller = "Home"</span></span>                | <span data-ttu-id="36060-761">action = "About"</span><span class="sxs-lookup"><span data-stu-id="36060-761">action = "About"</span></span>                       | `/Home/About`           |
| <span data-ttu-id="36060-762">controller = "Home"</span><span class="sxs-lookup"><span data-stu-id="36060-762">controller = "Home"</span></span>                | <span data-ttu-id="36060-763">controller = "Order", action = "About"</span><span class="sxs-lookup"><span data-stu-id="36060-763">controller = "Order", action = "About"</span></span> | `/Order/About`          |
| <span data-ttu-id="36060-764">controller = "Home", color = "Red"</span><span class="sxs-lookup"><span data-stu-id="36060-764">controller = "Home", color = "Red"</span></span> | <span data-ttu-id="36060-765">action = "About"</span><span class="sxs-lookup"><span data-stu-id="36060-765">action = "About"</span></span>                       | `/Home/About`           |
| <span data-ttu-id="36060-766">controller = "Home"</span><span class="sxs-lookup"><span data-stu-id="36060-766">controller = "Home"</span></span>                | <span data-ttu-id="36060-767">action = "About", color = "Red"</span><span class="sxs-lookup"><span data-stu-id="36060-767">action = "About", color = "Red"</span></span>        | `/Home/About?color=Red` |

### <a name="problems-with-route-value-invalidation"></a><span data-ttu-id="36060-768">ルート値の無効化に関する問題</span><span class="sxs-lookup"><span data-stu-id="36060-768">Problems with route value invalidation</span></span>

<span data-ttu-id="36060-769">ASP.NET Core 3.0 の時点では、以前の ASP.NET Core バージョンで使用されている一部の URL 生成スキームが URL の生成においてうまく機能しません。</span><span class="sxs-lookup"><span data-stu-id="36060-769">As of ASP.NET Core 3.0, some URL generation schemes used in earlier ASP.NET Core versions don't work well with URL generation.</span></span> <span data-ttu-id="36060-770">ASP.NET Core チームは、今後のリリースでこれらのニーズに対応する機能を追加することを計画しています。</span><span class="sxs-lookup"><span data-stu-id="36060-770">The ASP.NET Core team plans to add features to address these needs in a future release.</span></span> <span data-ttu-id="36060-771">当面は、従来のルーティングを使用することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="36060-771">For now the best solution is to use legacy routing.</span></span>

<span data-ttu-id="36060-772">次のコードは、ルーティングでサポートされていない URL 生成スキームの例を示しています。</span><span class="sxs-lookup"><span data-stu-id="36060-772">The following code shows an example of a URL generation scheme that's not supported by routing.</span></span>

[!code-csharp[](routing/samples/3.x/RoutingSample/StartupUnsupported.cs?name=snippet)]

<span data-ttu-id="36060-773">上記のコードでは、`culture` ルート パラメーターがローカライズに使用されています。</span><span class="sxs-lookup"><span data-stu-id="36060-773">In the preceding code, the `culture` route parameter is used for localization.</span></span> <span data-ttu-id="36060-774">`culture` パラメーターを常にアンビエント値として許容されるようにすることが望まれます。</span><span class="sxs-lookup"><span data-stu-id="36060-774">The desire is to have the `culture` parameter always accepted as an ambient value.</span></span> <span data-ttu-id="36060-775">しかし、必要な値の動作方法が理由で、`culture` パラメーターはアンビエント値として許容されません。</span><span class="sxs-lookup"><span data-stu-id="36060-775">However, the `culture` parameter is not accepted as an ambient value because of the way required values work:</span></span>

* <span data-ttu-id="36060-776">`"default"` ルート テンプレートでは、`culture` ルート パラメーターは `controller` の左側にあるため、`controller` を変更しても `culture` は無効になりません。</span><span class="sxs-lookup"><span data-stu-id="36060-776">In the `"default"` route template, the `culture` route parameter is to the left of `controller`, so changes to `controller` won't invalidate `culture`.</span></span>
* <span data-ttu-id="36060-777">`"blog"` ルート テンプレートでは、`culture` ルート パラメーターは `controller` の右側にあると見なされ、必要な値に表示されます。</span><span class="sxs-lookup"><span data-stu-id="36060-777">In the `"blog"` route template, the `culture` route parameter is considered to be to the right of `controller`, which appears in the required values.</span></span>

## <a name="configuring-endpoint-metadata"></a><span data-ttu-id="36060-778">エンドポイント メタデータの構成</span><span class="sxs-lookup"><span data-stu-id="36060-778">Configuring endpoint metadata</span></span>

<span data-ttu-id="36060-779">次のリンクでは、エンドポイント メタデータの構成に関する情報を提供します。</span><span class="sxs-lookup"><span data-stu-id="36060-779">The following links provide information on configuring endpoint metadata:</span></span>

* [<span data-ttu-id="36060-780">エンドポイント ルーティングで CORS を有効にする</span><span class="sxs-lookup"><span data-stu-id="36060-780">Enable Cors with endpoint routing</span></span>](xref:security/cors#enable-cors-with-endpoint-routing)
* <span data-ttu-id="36060-781">カスタム `[MinimumAgeAuthorize]` 属性を使用する [IAuthorizationPolicyProvider のサンプル](https://github.com/dotnet/AspNetCore/tree/release/3.1/src/Security/samples/CustomPolicyProvider)</span><span class="sxs-lookup"><span data-stu-id="36060-781">[IAuthorizationPolicyProvider sample](https://github.com/dotnet/AspNetCore/tree/release/3.1/src/Security/samples/CustomPolicyProvider) using a custom `[MinimumAgeAuthorize]` attribute</span></span>
* <span data-ttu-id="36060-782">[[Authorize] 属性を使用して認証をテストする](xref:security/authentication/identity#test-identity)</span><span class="sxs-lookup"><span data-stu-id="36060-782">[Test authentication with the [Authorize] attribute](xref:security/authentication/identity#test-identity)</span></span>
* <xref:Microsoft.AspNetCore.Builder.AuthorizationEndpointConventionBuilderExtensions.RequireAuthorization*>
* <span data-ttu-id="36060-783">[[Authorize] 属性を使用してスキームを選択する](xref:security/authorization/limitingidentitybyscheme#selecting-the-scheme-with-the-authorize-attribute)</span><span class="sxs-lookup"><span data-stu-id="36060-783">[Selecting the scheme with the [Authorize] attribute](xref:security/authorization/limitingidentitybyscheme#selecting-the-scheme-with-the-authorize-attribute)</span></span>
* <span data-ttu-id="36060-784">[[Authorize] 属性を使用してポリシーを適用する](xref:security/authorization/policies#apply-policies-to-mvc-controllers)</span><span class="sxs-lookup"><span data-stu-id="36060-784">[Apply policies using the [Authorize] attribute](xref:security/authorization/policies#apply-policies-to-mvc-controllers)</span></span>
* <xref:security/authorization/roles>

<a name="hostmatch"></a>

## <a name="host-matching-in-routes-with-requirehost"></a><span data-ttu-id="36060-785">RequireHost とルートが一致するホスト</span><span class="sxs-lookup"><span data-stu-id="36060-785">Host matching in routes with RequireHost</span></span>

<span data-ttu-id="36060-786"><xref:Microsoft.AspNetCore.Builder.RoutingEndpointConventionBuilderExtensions.RequireHost*> では、指定したホストが必要であるという制約がルートに適用されます。</span><span class="sxs-lookup"><span data-stu-id="36060-786"><xref:Microsoft.AspNetCore.Builder.RoutingEndpointConventionBuilderExtensions.RequireHost*> applies a constraint to the route which requires the specified host.</span></span> <span data-ttu-id="36060-787">`RequireHost` または [[Host]](xref:Microsoft.AspNetCore.Routing.HostAttribute) パラメーターには、次のいずれかを指定できます。</span><span class="sxs-lookup"><span data-stu-id="36060-787">The `RequireHost` or [[Host]](xref:Microsoft.AspNetCore.Routing.HostAttribute) parameter can be:</span></span>

* <span data-ttu-id="36060-788">ホスト: `www.domain.com`。任意のポートの `www.domain.com` と一致します。</span><span class="sxs-lookup"><span data-stu-id="36060-788">Host: `www.domain.com`, matches `www.domain.com` with any port.</span></span>
* <span data-ttu-id="36060-789">ホストとワイルドカード: `*.domain.com`。任意のポートの `www.domain.com`、`subdomain.domain.com`、または `www.subdomain.domain.com` と一致します。</span><span class="sxs-lookup"><span data-stu-id="36060-789">Host with wildcard: `*.domain.com`, matches `www.domain.com`, `subdomain.domain.com`, or `www.subdomain.domain.com` on any port.</span></span>
* <span data-ttu-id="36060-790">ポート: `*:5000`。任意のホストのポート 5000 と一致します。</span><span class="sxs-lookup"><span data-stu-id="36060-790">Port: `*:5000`, matches port 5000 with any host.</span></span>
* <span data-ttu-id="36060-791">ホストとポート: `www.domain.com:5000` または `*.domain.com:5000`。ホストとポートと一致します。</span><span class="sxs-lookup"><span data-stu-id="36060-791">Host and port: `www.domain.com:5000` or `*.domain.com:5000`, matches host and port.</span></span>

<span data-ttu-id="36060-792">`RequireHost` または `[Host]` を使用して、複数のパラメーターを指定できます。</span><span class="sxs-lookup"><span data-stu-id="36060-792">Multiple parameters can be specified using `RequireHost` or `[Host]`.</span></span> <span data-ttu-id="36060-793">制約は、いずれかのパラメーターに対して有効なホストと一致します。</span><span class="sxs-lookup"><span data-stu-id="36060-793">The constraint  matches hosts valid for any of the parameters.</span></span> <span data-ttu-id="36060-794">たとえば、`[Host("domain.com", "*.domain.com")]` は `domain.com`、`www.domain.com`、および `subdomain.domain.com` と一致します。</span><span class="sxs-lookup"><span data-stu-id="36060-794">For example, `[Host("domain.com", "*.domain.com")]` matches `domain.com`, `www.domain.com`, and `subdomain.domain.com`.</span></span>

<span data-ttu-id="36060-795">次のコードでは、`RequireHost` を使用して、指定したホストをルートに対して要求します。</span><span class="sxs-lookup"><span data-stu-id="36060-795">The following code uses `RequireHost` to require the specified host on the route:</span></span>

[!code-csharp[](routing/samples/3.x/RoutingSample/StartupRequireHost.cs?name=snippet)]

<span data-ttu-id="36060-796">次のコードでは、コントローラー上の `[Host]` 属性を使用して、指定したホストのいずれかを要求します。</span><span class="sxs-lookup"><span data-stu-id="36060-796">The following code uses the `[Host]` attribute on the controller to require any of the specified hosts:</span></span>

[!code-csharp[](routing/samples/3.x/RoutingSample/Controllers/ProductController.cs?name=snippet)]

<span data-ttu-id="36060-797">`[Host]` 属性がコントローラーとアクション メソッドの両方に適用される場合は、次のようになります。</span><span class="sxs-lookup"><span data-stu-id="36060-797">When the `[Host]` attribute is applied to both the controller and action method:</span></span>

* <span data-ttu-id="36060-798">アクションの属性が使用されます。</span><span class="sxs-lookup"><span data-stu-id="36060-798">The attribute on the action is used.</span></span>
* <span data-ttu-id="36060-799">コントローラーの属性は無視されます。</span><span class="sxs-lookup"><span data-stu-id="36060-799">The controller attribute is ignored.</span></span>

## <a name="performance-guidance-for-routing"></a><span data-ttu-id="36060-800">ルーティングに関するパフォーマンス ガイダンス</span><span class="sxs-lookup"><span data-stu-id="36060-800">Performance guidance for routing</span></span>

<span data-ttu-id="36060-801">ASP.NET Core 3.0 では、ほとんどのルーティングが更新され、パフォーマンスが向上しました。</span><span class="sxs-lookup"><span data-stu-id="36060-801">Most of routing was updated in ASP.NET Core 3.0 to increase performance.</span></span>

<span data-ttu-id="36060-802">アプリにパフォーマンス上の問題がある場合、多くの場合ルーティングが問題として疑われます。</span><span class="sxs-lookup"><span data-stu-id="36060-802">When an app has performance problems, routing is often suspected as the problem.</span></span> <span data-ttu-id="36060-803">ルーティングが疑われる理由は、コントローラーや Razor Pages などのフレームワークにより、フレームワーク内で費やされた時間がログ メッセージで報告されるためです。</span><span class="sxs-lookup"><span data-stu-id="36060-803">The reason routing is suspected is that frameworks like controllers and Razor Pages report the amount of time spent inside the framework in their logging messages.</span></span> <span data-ttu-id="36060-804">コントローラーによって報告された時間と要求の合計時間の間に大きな違いがある場合、次のようになります。</span><span class="sxs-lookup"><span data-stu-id="36060-804">When there's a significant difference between the time reported by controllers and the total time of the request:</span></span>

* <span data-ttu-id="36060-805">開発者は、問題の発生源としてアプリ コードを排除します。</span><span class="sxs-lookup"><span data-stu-id="36060-805">Developers eliminate their app code as the source of the problem.</span></span>
* <span data-ttu-id="36060-806">ルーティングが原因であると考えるのが一般的です。</span><span class="sxs-lookup"><span data-stu-id="36060-806">It's common to assume routing is the cause.</span></span>

<span data-ttu-id="36060-807">ルーティングは、数千のエンドポイントを使用してパフォーマンス テストされています。</span><span class="sxs-lookup"><span data-stu-id="36060-807">Routing is performance tested using thousands of endpoints.</span></span> <span data-ttu-id="36060-808">一般的なアプリでは、大きすぎるだけでパフォーマンスの問題が発生する可能性はほとんどありません。</span><span class="sxs-lookup"><span data-stu-id="36060-808">It's unlikely that a typical app will encounter a performance problem just by being too large.</span></span> <span data-ttu-id="36060-809">ルーティングのパフォーマンス低下の最も一般的な根本原因は、通常、正しく動作していないカスタム ミドルウェアです。</span><span class="sxs-lookup"><span data-stu-id="36060-809">The most common root cause of slow routing performance is usually a badly-behaving custom middleware.</span></span>

<span data-ttu-id="36060-810">次のコード サンプルは、遅延の原因を絞り込むための基本的な手法を示したものです。</span><span class="sxs-lookup"><span data-stu-id="36060-810">This following code sample demonstrates a basic technique for narrowing down the source of delay:</span></span>

[!code-csharp[](routing/samples/3.x/RoutingSample/StartupDelay.cs?name=snippet)]

<span data-ttu-id="36060-811">ルーティングの時間は次のように計ります。</span><span class="sxs-lookup"><span data-stu-id="36060-811">To time routing:</span></span>

* <span data-ttu-id="36060-812">各ミドルウェアを、上記のコードに示されている時間を計るミドルウェアのコピーでインターリーブします。</span><span class="sxs-lookup"><span data-stu-id="36060-812">Interleave each middleware with a copy of the timing middleware shown in the preceding code.</span></span>
* <span data-ttu-id="36060-813">計られた時間データをコードと関連付けるための一意の識別子を追加します。</span><span class="sxs-lookup"><span data-stu-id="36060-813">Add a unique identifier to correlate the timing data with the code.</span></span>

<span data-ttu-id="36060-814">これは、遅延が `10ms` を超えるなど顕著な場合に絞り込むための基本的な方法です。</span><span class="sxs-lookup"><span data-stu-id="36060-814">This is a basic way to narrow down the delay when it's significant, for example, more than `10ms`.</span></span>  <span data-ttu-id="36060-815">`Time 1` から `Time 2` を引くことで、`UseRouting` ミドルウェア内で費やされた時間を報告します。</span><span class="sxs-lookup"><span data-stu-id="36060-815">Subtracting `Time 2` from `Time 1` reports the time spent inside the `UseRouting` middleware.</span></span>

<span data-ttu-id="36060-816">次のコードでは、前の時間を計るコードに対して、よりコンパクトなアプローチを使用します。</span><span class="sxs-lookup"><span data-stu-id="36060-816">The following code uses a more compact approach to the preceding timing code:</span></span>

[!code-csharp[](routing/samples/3.x/RoutingSample/StartupSW.cs?name=snippetSW)]

[!code-csharp[](routing/samples/3.x/RoutingSample/StartupSW.cs?name=snippet)]

### <a name="potentially-expensive-routing-features"></a><span data-ttu-id="36060-817">潜在的にコストが高いルーティング機能</span><span class="sxs-lookup"><span data-stu-id="36060-817">Potentially expensive routing features</span></span>

<span data-ttu-id="36060-818">次の一覧に、基本的なルート テンプレートと比べて比較的コストが高いルーティング機能についての洞察を示します。</span><span class="sxs-lookup"><span data-stu-id="36060-818">The following list provides some insight into routing features that are relatively expensive compared with basic route templates:</span></span>

* <span data-ttu-id="36060-819">正規表現: 複雑な正規表現を作成すること、つまり少量の入力で長い実行時間を実現することができます。</span><span class="sxs-lookup"><span data-stu-id="36060-819">Regular expressions: It's possible to write regular expressions that are complex, or have long running time with a small amount of input.</span></span>

* <span data-ttu-id="36060-820">複雑なセグメント (`{x}-{y}-{z}`):</span><span class="sxs-lookup"><span data-stu-id="36060-820">Complex segments (`{x}-{y}-{z}`):</span></span> 
  * <span data-ttu-id="36060-821">通常の URL パス セグメントを解析するよりもかなりコストがかかります。</span><span class="sxs-lookup"><span data-stu-id="36060-821">Are significantly more expensive than parsing a regular URL path segment.</span></span>
  * <span data-ttu-id="36060-822">より多くの部分文字列が割り当てられることになります。</span><span class="sxs-lookup"><span data-stu-id="36060-822">Result in many more substrings being allocated.</span></span>
  * <span data-ttu-id="36060-823">ASP.NET Core 3.0 ルーティング パフォーマンスの更新では、複雑なセグメントのロジックは更新されませんでした。</span><span class="sxs-lookup"><span data-stu-id="36060-823">The complex segment logic was not updated in ASP.NET Core 3.0 routing performance update.</span></span>

* <span data-ttu-id="36060-824">同期データ アクセス: 多くの複雑なアプリでは、ルーティングの一部としてデータベースにアクセスします。</span><span class="sxs-lookup"><span data-stu-id="36060-824">Synchronous data access: Many complex apps have database access as part of their routing.</span></span> <span data-ttu-id="36060-825">ASP.NET Core 2.2 以前のルーティングでは、データベース アクセス ルーティングをサポートするための適切な拡張ポイントが提供されない場合があります。</span><span class="sxs-lookup"><span data-stu-id="36060-825">ASP.NET Core 2.2 and earlier routing might not provide the right extensibility points to support database access routing.</span></span> <span data-ttu-id="36060-826">たとえば、<xref:Microsoft.AspNetCore.Routing.IRouteConstraint> と <xref:Microsoft.AspNetCore.Mvc.ActionConstraints.IActionConstraint> は同期的です。</span><span class="sxs-lookup"><span data-stu-id="36060-826">For example, <xref:Microsoft.AspNetCore.Routing.IRouteConstraint>, and <xref:Microsoft.AspNetCore.Mvc.ActionConstraints.IActionConstraint> are synchronous.</span></span> <span data-ttu-id="36060-827"><xref:Microsoft.AspNetCore.Routing.MatcherPolicy> や <xref:Microsoft.AspNetCore.Routing.EndpointSelectorContext> などの拡張ポイントは非同期的です。</span><span class="sxs-lookup"><span data-stu-id="36060-827">Extensibility points such as <xref:Microsoft.AspNetCore.Routing.MatcherPolicy> and <xref:Microsoft.AspNetCore.Routing.EndpointSelectorContext> are asynchronous.</span></span>

## <a name="guidance-for-library-authors"></a><span data-ttu-id="36060-828">ライブラリ作成者向けのガイダンス</span><span class="sxs-lookup"><span data-stu-id="36060-828">Guidance for library authors</span></span>

<span data-ttu-id="36060-829">このセクションでは、ルーティングを基盤とするライブラリ作成者向けのガイダンスを示します。</span><span class="sxs-lookup"><span data-stu-id="36060-829">This section contains guidance for library authors building on top of routing.</span></span> <span data-ttu-id="36060-830">これらの詳細情報は、アプリの開発者が、ルーティングを拡張するライブラリとフレームワークを使用して優れたエクスペリエンスを実現できるようにすることを目的としています。</span><span class="sxs-lookup"><span data-stu-id="36060-830">These details are intended to ensure that app developers have a good experience using libraries and frameworks that extend routing.</span></span>

### <a name="define-endpoints"></a><span data-ttu-id="36060-831">エンドポイントを定義する</span><span class="sxs-lookup"><span data-stu-id="36060-831">Define endpoints</span></span>

<span data-ttu-id="36060-832">URL 照合にルーティングを使用するフレームワークを作成するには、まず <xref:Microsoft.AspNetCore.Builder.EndpointRoutingApplicationBuilderExtensions.UseEndpoints*> の上に構築されるユーザー エクスペリエンスを定義します。</span><span class="sxs-lookup"><span data-stu-id="36060-832">To create a framework that uses routing for URL matching, start by defining a user experience that builds on top of <xref:Microsoft.AspNetCore.Builder.EndpointRoutingApplicationBuilderExtensions.UseEndpoints*>.</span></span>

<span data-ttu-id="36060-833"><xref:Microsoft.AspNetCore.Routing.IEndpointRouteBuilder> の上に**構築します**。</span><span class="sxs-lookup"><span data-stu-id="36060-833">**DO** build on top of <xref:Microsoft.AspNetCore.Routing.IEndpointRouteBuilder>.</span></span> <span data-ttu-id="36060-834">これにより、ユーザーは、他の ASP.NET Core 機能と混同せずにフレームワークを構成できます。</span><span class="sxs-lookup"><span data-stu-id="36060-834">This allows users to compose your framework with other ASP.NET Core features without confusion.</span></span> <span data-ttu-id="36060-835">すべての ASP.NET Core テンプレートには、ルーティングが含まれます。</span><span class="sxs-lookup"><span data-stu-id="36060-835">Every ASP.NET Core template includes routing.</span></span> <span data-ttu-id="36060-836">ルーティングが存在し、ユーザーになじみのあるものとします。</span><span class="sxs-lookup"><span data-stu-id="36060-836">Assume routing is present and familiar for users.</span></span>

```csharp
app.UseEndpoints(endpoints =>
{
    // Your framework
    endpoints.MapMyFramework(...);

    endpoints.MapHealthChecks("/healthz");
});
```

<span data-ttu-id="36060-837"><xref:Microsoft.AspNetCore.Builder.IEndpointConventionBuilder> を実装する `MapMyFramework(...)` の呼び出しから、シールドの具象型を**返します**。</span><span class="sxs-lookup"><span data-stu-id="36060-837">**DO** return a sealed concrete type from a call to `MapMyFramework(...)` that implements <xref:Microsoft.AspNetCore.Builder.IEndpointConventionBuilder>.</span></span> <span data-ttu-id="36060-838">ほとんどのフレームワーク `Map...` メソッドは、このパターンに従います。</span><span class="sxs-lookup"><span data-stu-id="36060-838">Most framework `Map...` methods follow this pattern.</span></span> <span data-ttu-id="36060-839">`IEndpointConventionBuilder` インターフェイスは、</span><span class="sxs-lookup"><span data-stu-id="36060-839">The `IEndpointConventionBuilder` interface:</span></span>

* <span data-ttu-id="36060-840">メタデータの構成可能性を許可します。</span><span class="sxs-lookup"><span data-stu-id="36060-840">Allows composability of metadata.</span></span>
* <span data-ttu-id="36060-841">さまざまな拡張メソッドの対象とされています。</span><span class="sxs-lookup"><span data-stu-id="36060-841">Is targeted by a variety of extension methods.</span></span>

<span data-ttu-id="36060-842">独自の型を宣言すると、独自のフレームワーク固有の機能をビルダーに追加できます。</span><span class="sxs-lookup"><span data-stu-id="36060-842">Declaring your own type allows you to add your own framework-specific functionality to the builder.</span></span> <span data-ttu-id="36060-843">フレームワークで宣言されたビルダーをラップし、呼び出しを転送するのは問題ありません。</span><span class="sxs-lookup"><span data-stu-id="36060-843">It's ok to wrap a framework-declared builder and forward calls to it.</span></span>

```csharp
app.UseEndpoints(endpoints =>
{
    // Your framework
    endpoints.MapMyFramework(...).RequireAuthorization()
                                 .WithMyFrameworkFeature(awesome: true);

    endpoints.MapHealthChecks("/healthz");
});
```

<span data-ttu-id="36060-844">独自の <xref:Microsoft.AspNetCore.Routing.EndpointDataSource> を作成することを**検討します**。</span><span class="sxs-lookup"><span data-stu-id="36060-844">**CONSIDER** writing your own <xref:Microsoft.AspNetCore.Routing.EndpointDataSource>.</span></span> <span data-ttu-id="36060-845">`EndpointDataSource` は、エンドポイントのコレクションを宣言および更新するための低レベルのプリミティブです。</span><span class="sxs-lookup"><span data-stu-id="36060-845">`EndpointDataSource` is the low-level primitive for declaring and updating a collection of endpoints.</span></span> <span data-ttu-id="36060-846">`EndpointDataSource` は、コントローラーと Razor Pages によって使用される強力な API です。</span><span class="sxs-lookup"><span data-stu-id="36060-846">`EndpointDataSource` is a powerful API used by controllers and Razor Pages.</span></span>

<span data-ttu-id="36060-847">ルーティング テストには、更新されていないデータ ソースの[基本的な例](https://github.com/aspnet/AspNetCore/blob/master/src/Http/Routing/test/testassets/RoutingSandbox/Framework/FrameworkEndpointDataSource.cs#L17)があります。</span><span class="sxs-lookup"><span data-stu-id="36060-847">The routing tests have a [basic example](https://github.com/aspnet/AspNetCore/blob/master/src/Http/Routing/test/testassets/RoutingSandbox/Framework/FrameworkEndpointDataSource.cs#L17) of a non-updating data source.</span></span>

<span data-ttu-id="36060-848">既定では、`EndpointDataSource` の登録を**試行しないでください**。</span><span class="sxs-lookup"><span data-stu-id="36060-848">**DO NOT** attempt to register an `EndpointDataSource` by default.</span></span> <span data-ttu-id="36060-849"><xref:Microsoft.AspNetCore.Builder.EndpointRoutingApplicationBuilderExtensions.UseEndpoints*> にフレームワークを登録するようユーザーに要求してください。</span><span class="sxs-lookup"><span data-stu-id="36060-849">Require users to register your framework in <xref:Microsoft.AspNetCore.Builder.EndpointRoutingApplicationBuilderExtensions.UseEndpoints*>.</span></span> <span data-ttu-id="36060-850">ルーティングの原理では、既定では何も含まれておらず、`UseEndpoints` がエンドポイントを登録する場所です。</span><span class="sxs-lookup"><span data-stu-id="36060-850">The philosophy of routing is that nothing is included by default, and that `UseEndpoints` is the place to register endpoints.</span></span>

### <a name="creating-routing-integrated-middleware"></a><span data-ttu-id="36060-851">ルーティング統合ミドルウェアを作成する</span><span class="sxs-lookup"><span data-stu-id="36060-851">Creating routing-integrated middleware</span></span>

<span data-ttu-id="36060-852">メタデータ型をインターフェイスとして定義することを**検討します**。</span><span class="sxs-lookup"><span data-stu-id="36060-852">**CONSIDER** defining metadata types as an interface.</span></span>

<span data-ttu-id="36060-853">クラスおよびメソッドの属性としてメタデータ型を**使用できるようにします**。</span><span class="sxs-lookup"><span data-stu-id="36060-853">**DO** make it possible to use metadata types as an attribute on classes and methods.</span></span>

[!code-csharp[](routing/samples/3.x/RoutingSample/ICoolMetadata.cs?name=snippet2)]

<span data-ttu-id="36060-854">コントローラーや Razor Pages などのフレームワークでは、型およびメソッドへのメタデータ属性の適用がサポートされています。</span><span class="sxs-lookup"><span data-stu-id="36060-854">Frameworks like controllers and Razor Pages support applying metadata attributes to types and methods.</span></span> <span data-ttu-id="36060-855">メタデータ型を宣言する場合:</span><span class="sxs-lookup"><span data-stu-id="36060-855">If you declare metadata types:</span></span>

* <span data-ttu-id="36060-856">[属性](/dotnet/csharp/programming-guide/concepts/attributes/)としてアクセスできるようにします。</span><span class="sxs-lookup"><span data-stu-id="36060-856">Make them accessible as [attributes](/dotnet/csharp/programming-guide/concepts/attributes/).</span></span>
* <span data-ttu-id="36060-857">ほとんどのユーザーが属性の適用に精通しています。</span><span class="sxs-lookup"><span data-stu-id="36060-857">Most users are familiar with applying attributes.</span></span>

<span data-ttu-id="36060-858">メタデータ型をインターフェイスとして宣言すると、柔軟性の高いレイヤーがさらに追加されます。</span><span class="sxs-lookup"><span data-stu-id="36060-858">Declaring a metadata type as an interface adds another layer of flexibility:</span></span>

* <span data-ttu-id="36060-859">インターフェイスが構成可能です。</span><span class="sxs-lookup"><span data-stu-id="36060-859">Interfaces are composable.</span></span>
* <span data-ttu-id="36060-860">開発者は、複数のポリシーを結合する独自の型を宣言できます。</span><span class="sxs-lookup"><span data-stu-id="36060-860">Developers can declare their own types that combine multiple policies.</span></span>

<span data-ttu-id="36060-861">次の例に示すように、メタデータを**オーバーライドできるようにします**。</span><span class="sxs-lookup"><span data-stu-id="36060-861">**DO** make it possible to override metadata, as shown in the following example:</span></span>

[!code-csharp[](routing/samples/3.x/RoutingSample/ICoolMetadata.cs?name=snippet)]

<span data-ttu-id="36060-862">これらのガイドラインに従う最善の方法は、**マーカーのメタデータ**を定義しないようにすることです。</span><span class="sxs-lookup"><span data-stu-id="36060-862">The best way to follow these guidelines is to avoid defining **marker metadata**:</span></span>

* <span data-ttu-id="36060-863">メタデータ型が存在するかどうかを確認するだけで終わらせません。</span><span class="sxs-lookup"><span data-stu-id="36060-863">Don't just look for the presence of a metadata type.</span></span>
* <span data-ttu-id="36060-864">メタデータのプロパティを定義し、プロパティを確認します。</span><span class="sxs-lookup"><span data-stu-id="36060-864">Define a property on the metadata and check the property.</span></span>

<span data-ttu-id="36060-865">メタデータ コレクションが順序付けされ、優先順位によるオーバーライドがサポートされます。</span><span class="sxs-lookup"><span data-stu-id="36060-865">The metadata collection is ordered and supports overriding by priority.</span></span> <span data-ttu-id="36060-866">コントローラーの場合、アクション メソッドのメタデータが最も限定的です。</span><span class="sxs-lookup"><span data-stu-id="36060-866">In the case of controllers, metadata on the action method is most specific.</span></span>

<span data-ttu-id="36060-867">ルーティングを使用する場合もしない場合もミドルウェアが**役立つようにします**。</span><span class="sxs-lookup"><span data-stu-id="36060-867">**DO** make middleware useful with and without routing.</span></span>

```csharp
app.UseRouting();

app.UseAuthorization(new AuthorizationPolicy() { ... });

app.UseEndpoints(endpoints =>
{
    // Your framework
    endpoints.MapMyFramework(...).RequireAuthorization();
});
```

<span data-ttu-id="36060-868">このガイドラインの例として、`UseAuthorization` ミドルウェアを考えてみましょう。</span><span class="sxs-lookup"><span data-stu-id="36060-868">As an example of this guideline, consider the `UseAuthorization` middleware.</span></span> <span data-ttu-id="36060-869">この承認ミドルウェアを使用すると、フォールバック ポリシーを渡すことができます。</span><span class="sxs-lookup"><span data-stu-id="36060-869">The authorization middleware allows you to pass in a fallback policy.</span></span> <!-- shown where?  (shown here) --> <span data-ttu-id="36060-870">フォールバック ポリシーは、指定されている場合、次の両方に適用されます。</span><span class="sxs-lookup"><span data-stu-id="36060-870">The fallback policy, if specified, applies to both:</span></span>

* <span data-ttu-id="36060-871">指定されたポリシーのないエンドポイント。</span><span class="sxs-lookup"><span data-stu-id="36060-871">Endpoints without a specified policy.</span></span>
* <span data-ttu-id="36060-872">エンドポイントに一致しない要求。</span><span class="sxs-lookup"><span data-stu-id="36060-872">Requests that don't match an endpoint.</span></span>

<span data-ttu-id="36060-873">これにより、承認ミドルウェアはルーティングのコンテキストの外部で役に立ちます。</span><span class="sxs-lookup"><span data-stu-id="36060-873">This makes the authorization middleware useful outside of the context of routing.</span></span> <span data-ttu-id="36060-874">承認ミドルウェアは、従来のミドルウェア プログラミングに使用できます。</span><span class="sxs-lookup"><span data-stu-id="36060-874">The authorization middleware can be used for traditional middleware programming.</span></span>

[!INCLUDE[](~/includes/dbg-route.md)]

::: moniker-end

::: moniker range="= aspnetcore-2.2"

<span data-ttu-id="36060-875">ルーティングでは、要求 URI をエンドポイントにマッピングし、受信要求をそれらのエンドポイントに配布します。</span><span class="sxs-lookup"><span data-stu-id="36060-875">Routing is responsible for mapping request URIs to endpoints and dispatching incoming requests to those endpoints.</span></span> <span data-ttu-id="36060-876">ルートはアプリに定義され、アプリの起動時に構成されます。</span><span class="sxs-lookup"><span data-stu-id="36060-876">Routes are defined in the app and configured when the app starts.</span></span> <span data-ttu-id="36060-877">ルートは、要求に含まれている URL から値を任意で抽出できます。その値を要求処理に利用できます。</span><span class="sxs-lookup"><span data-stu-id="36060-877">A route can optionally extract values from the URL contained in the request, and these values can then be used for request processing.</span></span> <span data-ttu-id="36060-878">ルーティングでは、アプリからのルート情報を利用し、エンドポイントにマッピングする URL を生成することもできます。</span><span class="sxs-lookup"><span data-stu-id="36060-878">Using route information from the app, routing is also able to generate URLs that map to endpoints.</span></span>

<span data-ttu-id="36060-879">ASP.NET Core 2.2 で最新のルーティング シナリオを使用するには、`Startup.ConfigureServices` で[互換性バージョン](xref:mvc/compatibility-version)を MVC サービス登録に指定します。</span><span class="sxs-lookup"><span data-stu-id="36060-879">To use the latest routing scenarios in ASP.NET Core 2.2, specify the [compatibility version](xref:mvc/compatibility-version) to the MVC services registration in `Startup.ConfigureServices`:</span></span>

```csharp
services.AddMvc()
    .SetCompatibilityVersion(CompatibilityVersion.Version_2_2);
```

<span data-ttu-id="36060-880"><xref:Microsoft.AspNetCore.Mvc.MvcOptions.EnableEndpointRouting> オプションでは、ルーティングで内部的にエンドポイント ベースのロジックを使用するか、ASP.NET Core 2.1 以前の <xref:Microsoft.AspNetCore.Routing.IRouter> ベースのロジックを使用する必要があるかどうかを決定します。</span><span class="sxs-lookup"><span data-stu-id="36060-880">The <xref:Microsoft.AspNetCore.Mvc.MvcOptions.EnableEndpointRouting> option determines if routing should internally use endpoint-based logic or the <xref:Microsoft.AspNetCore.Routing.IRouter>-based logic of ASP.NET Core 2.1 or earlier.</span></span> <span data-ttu-id="36060-881">互換性バージョンが 2.2 以降に設定されている場合、既定値は `true` となります。</span><span class="sxs-lookup"><span data-stu-id="36060-881">When the compatibility version is set to 2.2 or later, the default value is `true`.</span></span> <span data-ttu-id="36060-882">以前のルーティング ロジックを使用する場合は、値を `false` に設定します。</span><span class="sxs-lookup"><span data-stu-id="36060-882">Set the value to `false` to use the prior routing logic:</span></span>

```csharp
// Use the routing logic of ASP.NET Core 2.1 or earlier:
services.AddMvc(options => options.EnableEndpointRouting = false)
    .SetCompatibilityVersion(CompatibilityVersion.Version_2_2);
```

<span data-ttu-id="36060-883"><xref:Microsoft.AspNetCore.Routing.IRouter> ベースのルーティングの詳細については、[このトピックの ASP.NET Core 2.1 バージョン](/aspnet/core/fundamentals/routing?view=aspnetcore-2.1)を参照してください。</span><span class="sxs-lookup"><span data-stu-id="36060-883">For more information on <xref:Microsoft.AspNetCore.Routing.IRouter>-based routing, see the [ASP.NET Core 2.1 version of this topic](/aspnet/core/fundamentals/routing?view=aspnetcore-2.1).</span></span>

> [!IMPORTANT]
> <span data-ttu-id="36060-884">本文では、ASP.NET Core ルーティングについて詳しく取り上げます。</span><span class="sxs-lookup"><span data-stu-id="36060-884">This document covers low-level ASP.NET Core routing.</span></span> <span data-ttu-id="36060-885">ASP.NET Core MVC ルーティングの詳細については、「<xref:mvc/controllers/routing>」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="36060-885">For information on ASP.NET Core MVC routing, see <xref:mvc/controllers/routing>.</span></span> <span data-ttu-id="36060-886">Razor Pages のルーティング規則については、「<xref:razor-pages/razor-pages-conventions>」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="36060-886">For information on routing conventions in Razor Pages, see <xref:razor-pages/razor-pages-conventions>.</span></span>

<span data-ttu-id="36060-887">[サンプル コードを表示またはダウンロード](https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/fundamentals/routing/samples)します ([ダウンロード方法](xref:index#how-to-download-a-sample))。</span><span class="sxs-lookup"><span data-stu-id="36060-887">[View or download sample code](https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/fundamentals/routing/samples) ([how to download](xref:index#how-to-download-a-sample))</span></span>

## <a name="routing-basics"></a><span data-ttu-id="36060-888">ルーティングの基本</span><span class="sxs-lookup"><span data-stu-id="36060-888">Routing basics</span></span>

<span data-ttu-id="36060-889">ほとんどのアプリでは、URL を読みやすくてわかりやすいものにするために、基本的なでわかりやすいルーティング スキームを選択する必要があります。</span><span class="sxs-lookup"><span data-stu-id="36060-889">Most apps should choose a basic and descriptive routing scheme so that URLs are readable and meaningful.</span></span> <span data-ttu-id="36060-890">既定の規則ルート `{controller=Home}/{action=Index}/{id?}`:</span><span class="sxs-lookup"><span data-stu-id="36060-890">The default conventional route `{controller=Home}/{action=Index}/{id?}`:</span></span>

* <span data-ttu-id="36060-891">基本的でわかりやすいルーティング スキームをサポートしています。</span><span class="sxs-lookup"><span data-stu-id="36060-891">Supports a basic and descriptive routing scheme.</span></span>
* <span data-ttu-id="36060-892">UI ベースのアプリの便利な開始点となります。</span><span class="sxs-lookup"><span data-stu-id="36060-892">Is a useful starting point for UI-based apps.</span></span>

<span data-ttu-id="36060-893">開発者は一般的に、特殊な状況でのアプリのトラフィックが多い領域に対しては、[属性ルーティング](xref:mvc/controllers/routing#attribute-routing)または専用規則ルートを使用して簡易ルートをさらに追加します。</span><span class="sxs-lookup"><span data-stu-id="36060-893">Developers commonly add additional terse routes to high-traffic areas of an app in specialized situations using [attribute routing](xref:mvc/controllers/routing#attribute-routing) or dedicated conventional routes.</span></span> <span data-ttu-id="36060-894">特殊な状況の例として、ブログや eコマース エンドポイントがあります。</span><span class="sxs-lookup"><span data-stu-id="36060-894">Specialized situations examples include, blog and ecommerce endpoints.</span></span>

<span data-ttu-id="36060-895">Web API では、属性ルーティングを使用して、HTTP 動詞で操作を表現するリソースのセットとしてアプリの機能をモデル化する必要があります。</span><span class="sxs-lookup"><span data-stu-id="36060-895">Web APIs should use attribute routing to model the app's functionality as a set of resources where operations are represented by HTTP verbs.</span></span> <span data-ttu-id="36060-896">つまり、同じ論理リソース上の多くの操作 (たとえば GET や POST) で、同じ URL が使用されます。</span><span class="sxs-lookup"><span data-stu-id="36060-896">This means that many operations, for example, GET, and POST, on the same logical resource use the same URL.</span></span> <span data-ttu-id="36060-897">属性ルーティングでは、API のパブリック エンドポイント レイアウトを慎重に設計するために必要となるコントロールのレベルが提供されます。</span><span class="sxs-lookup"><span data-stu-id="36060-897">Attribute routing provides a level of control that's needed to carefully design an API's public endpoint layout.</span></span>

<span data-ttu-id="36060-898">Razor Pages アプリでは、既定の規則ルーティングを使用して、アプリの *Pages* フォルダーの名前付きリソースを提供します。</span><span class="sxs-lookup"><span data-stu-id="36060-898">Razor Pages apps use default conventional routing to serve named resources in the *Pages* folder of an app.</span></span> <span data-ttu-id="36060-899">Razor Pages のルーティング動作をカスタマイズできる追加の規則を使用できます。</span><span class="sxs-lookup"><span data-stu-id="36060-899">Additional conventions are available that allow you to customize Razor Pages routing behavior.</span></span> <span data-ttu-id="36060-900">詳細については、次のトピックを参照してください。 <xref:razor-pages/index> および <xref:razor-pages/razor-pages-conventions></span><span class="sxs-lookup"><span data-stu-id="36060-900">For more information, see <xref:razor-pages/index> and <xref:razor-pages/razor-pages-conventions>.</span></span>

<span data-ttu-id="36060-901">URL 生成サポートを使用すると、アプリを相互にリンクする URL をハード コーディングすることなくアプリを開発できます。</span><span class="sxs-lookup"><span data-stu-id="36060-901">URL generation support allows the app to be developed without hard-coding URLs to link the app together.</span></span> <span data-ttu-id="36060-902">このサポートにより、基本的なルーティング構成を使用して作業を開始し、アプリのリソース レイアウトが決まった後でルートを変更することができます。</span><span class="sxs-lookup"><span data-stu-id="36060-902">This support allows for starting with a basic routing configuration and modifying the routes after the app's resource layout is determined.</span></span>

<span data-ttu-id="36060-903">ルーティングでは*エンドポイント* (`Endpoint`) を使用して、アプリの論理エンドポイントを表します。</span><span class="sxs-lookup"><span data-stu-id="36060-903">Routing uses *endpoints* (`Endpoint`) to represent logical endpoints in an app.</span></span>

<span data-ttu-id="36060-904">エンドポイントでは、要求と、任意のメタデータのコレクションを処理するデリゲートが定義されます。</span><span class="sxs-lookup"><span data-stu-id="36060-904">An endpoint defines a delegate to process requests and a collection of arbitrary metadata.</span></span> <span data-ttu-id="36060-905">メタデータは、各エンドポイントにアタッチされている構成とポリシーに基づいて横断的な関心事を実装するために使用されます。</span><span class="sxs-lookup"><span data-stu-id="36060-905">The metadata is used implement cross-cutting concerns based on policies and configuration attached to each endpoint.</span></span>

<span data-ttu-id="36060-906">ルーティング システムには次の特性があります。</span><span class="sxs-lookup"><span data-stu-id="36060-906">The routing system has the following characteristics:</span></span>

* <span data-ttu-id="36060-907">ルート テンプレート構文は、トークン化されたルート パラメーターでルートを定義するために使用されます。</span><span class="sxs-lookup"><span data-stu-id="36060-907">Route template syntax is used to define routes with tokenized route parameters.</span></span>
* <span data-ttu-id="36060-908">規則スタイルおよび属性スタイルのエンドポイント構成が許可されます。</span><span class="sxs-lookup"><span data-stu-id="36060-908">Conventional-style and attribute-style endpoint configuration is permitted.</span></span>
* <span data-ttu-id="36060-909"><xref:Microsoft.AspNetCore.Routing.IRouteConstraint> は、URL パラメーターに特定のエンドポイント制約で有効な値が含まれているかどうかを確認するために使用されます。</span><span class="sxs-lookup"><span data-stu-id="36060-909"><xref:Microsoft.AspNetCore.Routing.IRouteConstraint> is used to determine whether a URL parameter contains a valid value for a given endpoint constraint.</span></span>
* <span data-ttu-id="36060-910">MVC/Razor Pages などのアプリ モデルでは、ルーティング シナリオの予測可能な実装を持つ、すべてのエンドポイントを登録します。</span><span class="sxs-lookup"><span data-stu-id="36060-910">App models, such as MVC/Razor Pages, register all of their endpoints, which have a predictable implementation of routing scenarios.</span></span>
* <span data-ttu-id="36060-911">ルーティングの実装では、必要に応じて、ミドルウェア パイプラインでのルーティングに関する決定を行います。</span><span class="sxs-lookup"><span data-stu-id="36060-911">The routing implementation makes routing decisions wherever desired in the middleware pipeline.</span></span>
* <span data-ttu-id="36060-912">ルーティング ミドルウェアの後に表示されるミドルウェアでは、特定の要求 URI に関するルーティング ミドルウェアのエンドポイント決定の結果を検査できます。</span><span class="sxs-lookup"><span data-stu-id="36060-912">Middleware that appears after a Routing Middleware can inspect the result of the Routing Middleware's endpoint decision for a given request URI.</span></span>
* <span data-ttu-id="36060-913">ミドルウェア パイプラインの任意の場所でアプリのすべてのエンドポイントを列挙することができます。</span><span class="sxs-lookup"><span data-stu-id="36060-913">It's possible to enumerate all of the endpoints in the app anywhere in the middleware pipeline.</span></span>
* <span data-ttu-id="36060-914">アプリではルーティングを使用し、エンドポイント情報に基づいて URL (リダイレクトやリンクなど) を生成できます。そのため、URL をハードコーディングする必要がなく、保守管理が容易になります。</span><span class="sxs-lookup"><span data-stu-id="36060-914">An app can use routing to generate URLs (for example, for redirection or links) based on endpoint information and thus avoid hard-coded URLs, which helps maintainability.</span></span>
* <span data-ttu-id="36060-915">URL の生成は、任意の拡張機能をサポートする、アドレスに基づきます。</span><span class="sxs-lookup"><span data-stu-id="36060-915">URL generation is based on addresses, which support arbitrary extensibility:</span></span>

  * <span data-ttu-id="36060-916">リンク ジェネレーター API (<xref:Microsoft.AspNetCore.Routing.LinkGenerator>) は、URI を生成するために[依存関係挿入 (DI)](xref:fundamentals/dependency-injection) を使用して任意の場所で解決できます。</span><span class="sxs-lookup"><span data-stu-id="36060-916">The Link Generator API (<xref:Microsoft.AspNetCore.Routing.LinkGenerator>) can be resolved anywhere using [dependency injection (DI)](xref:fundamentals/dependency-injection) to generate URLs.</span></span>
  * <span data-ttu-id="36060-917">リンク ジェネレーター API を DI で使用できない場合、<xref:Microsoft.AspNetCore.Mvc.IUrlHelper> で URL を構築するためのメソッドが提供されます。</span><span class="sxs-lookup"><span data-stu-id="36060-917">Where the Link Generator API isn't available via DI, <xref:Microsoft.AspNetCore.Mvc.IUrlHelper> offers methods to build URLs.</span></span>

> [!NOTE]
> <span data-ttu-id="36060-918">ASP.NET Core 2.2 のエンドポイント ルーティングのリリースでは、エンドポイント リンクは、MVC/Razor Pages アクションおよびページに制限されます。</span><span class="sxs-lookup"><span data-stu-id="36060-918">With the release of endpoint routing in ASP.NET Core 2.2, endpoint linking is limited to MVC/Razor Pages actions and pages.</span></span> <span data-ttu-id="36060-919">エンドポイント リンク機能の拡張は、今後のリリースで予定されています。</span><span class="sxs-lookup"><span data-stu-id="36060-919">The expansions of endpoint-linking capabilities is planned for future releases.</span></span>

<span data-ttu-id="36060-920">ルーティングは <xref:Microsoft.AspNetCore.Builder.RouterMiddleware> クラスにより[ミドルウェア](xref:fundamentals/middleware/index) パイプラインに接続されます。</span><span class="sxs-lookup"><span data-stu-id="36060-920">Routing is connected to the [middleware](xref:fundamentals/middleware/index) pipeline by the <xref:Microsoft.AspNetCore.Builder.RouterMiddleware> class.</span></span> <span data-ttu-id="36060-921">[ASP.NET Core MVC](xref:mvc/overview) では、ミドルウェア パイプラインにその構成の一部としてルーティングが追加され、MVC および Razor Pages アプリでのルーティングが処理されます。</span><span class="sxs-lookup"><span data-stu-id="36060-921">[ASP.NET Core MVC](xref:mvc/overview) adds routing to the middleware pipeline as part of its configuration and handles routing in MVC and Razor Pages apps.</span></span> <span data-ttu-id="36060-922">スタンドアロン コンポーネントとしてルーティングを利用する方法については、「[ルーティング ミドルウェアの使用](#use-routing-middleware)」セクションを参照してください。</span><span class="sxs-lookup"><span data-stu-id="36060-922">To learn how to use routing as a standalone component, see the [Use Routing Middleware](#use-routing-middleware) section.</span></span>

### <a name="url-matching"></a><span data-ttu-id="36060-923">URL 一致</span><span class="sxs-lookup"><span data-stu-id="36060-923">URL matching</span></span>

<span data-ttu-id="36060-924">URL 一致というプロセスでは、ルーティングによって、受信要求が*エンドポイント*に配布されます。</span><span class="sxs-lookup"><span data-stu-id="36060-924">URL matching is the process by which routing dispatches an incoming request to an *endpoint*.</span></span> <span data-ttu-id="36060-925">このプロセスは URL パスのデータに基づきますが、要求内のあらゆるデータを考慮することもできます。</span><span class="sxs-lookup"><span data-stu-id="36060-925">This process is based on data in the URL path but can be extended to consider any data in the request.</span></span> <span data-ttu-id="36060-926">アプリの規模を大きくしたり、より複雑にしたりするとき、要求を個別のハンドラーに配布する機能が鍵となります。</span><span class="sxs-lookup"><span data-stu-id="36060-926">The ability to dispatch requests to separate handlers is key to scaling the size and complexity of an app.</span></span>

<span data-ttu-id="36060-927">エンドポイント ルーティングのルーティング システムでは、配布に関するすべての決定が行われます。</span><span class="sxs-lookup"><span data-stu-id="36060-927">The routing system in endpoint routing is responsible for all dispatching decisions.</span></span> <span data-ttu-id="36060-928">ミドルウェアでは選択されたエンドポイントに基づいてポリシーが適用されるため、セキュリティ ポリシーの適用や配布に影響する可能性のある決定は、ルーティング システム内で行うことが重要です。</span><span class="sxs-lookup"><span data-stu-id="36060-928">Since the middleware applies policies based on the selected endpoint, it's important that any decision that can affect dispatching or the application of security policies is made inside the routing system.</span></span>

<span data-ttu-id="36060-929">エンドポイントのデリゲートが実行されると、それまでに実行された要求処理に基づいて、[RouteContext.RouteData](xref:Microsoft.AspNetCore.Routing.RouteContext.RouteData) のプロパティが適切な値に設定されます。</span><span class="sxs-lookup"><span data-stu-id="36060-929">When the endpoint delegate is executed, the properties of [RouteContext.RouteData](xref:Microsoft.AspNetCore.Routing.RouteContext.RouteData) are set to appropriate values based on the request processing performed thus far.</span></span>

<span data-ttu-id="36060-930">[RouteData.Values](xref:Microsoft.AspNetCore.Routing.RouteData.Values*) は、ルートから生成された*ルート値*のディクショナリです。</span><span class="sxs-lookup"><span data-stu-id="36060-930">[RouteData.Values](xref:Microsoft.AspNetCore.Routing.RouteData.Values*) is a dictionary of *route values* produced from the route.</span></span> <span data-ttu-id="36060-931">この値は通常、URL のトークン化で決定されます。この値を利用してユーザー入力を受け取ったり、アプリ内で決定をさらに配布したりできます。</span><span class="sxs-lookup"><span data-stu-id="36060-931">These values are usually determined by tokenizing the URL and can be used to accept user input or to make further dispatching decisions inside the app.</span></span>

<span data-ttu-id="36060-932">[RouteData.DataTokens](xref:Microsoft.AspNetCore.Routing.RouteData.DataTokens*) は、一致したルートに関連する追加データのプロパティ バッグです。</span><span class="sxs-lookup"><span data-stu-id="36060-932">[RouteData.DataTokens](xref:Microsoft.AspNetCore.Routing.RouteData.DataTokens*) is a property bag of additional data related to the matched route.</span></span> <span data-ttu-id="36060-933">一致したルートに基づいてアプリで決定を行えるように、<xref:Microsoft.AspNetCore.Routing.RouteData.DataTokens*> が提供されます。これは状態データと各ルートの関連付けをサポートするためのものです。</span><span class="sxs-lookup"><span data-stu-id="36060-933"><xref:Microsoft.AspNetCore.Routing.RouteData.DataTokens*> are provided to support associating state data with each route so that the app can make decisions based on which route matched.</span></span> <span data-ttu-id="36060-934">この値は開発者が定義するものです。ルーティングの動作に影響を与えることは**ありません**。</span><span class="sxs-lookup"><span data-stu-id="36060-934">These values are developer-defined and do **not** affect the behavior of routing in any way.</span></span> <span data-ttu-id="36060-935">また、[RouteData.DataTokens](xref:Microsoft.AspNetCore.Routing.RouteData.DataTokens*) に一時退避される値はどのような型でも構いません。一方、[RouteData.Values](xref:Microsoft.AspNetCore.Routing.RouteData.Values) の場合は、文字列間で変換できる必要があります。</span><span class="sxs-lookup"><span data-stu-id="36060-935">Additionally, values stashed in [RouteData.DataTokens](xref:Microsoft.AspNetCore.Routing.RouteData.DataTokens*) can be of any type, in contrast to [RouteData.Values](xref:Microsoft.AspNetCore.Routing.RouteData.Values), which must be convertible to and from strings.</span></span>

<span data-ttu-id="36060-936">[RouteData.Routers](xref:Microsoft.AspNetCore.Routing.RouteData.Routers) は、過去に要求に一致したルートの一覧です。</span><span class="sxs-lookup"><span data-stu-id="36060-936">[RouteData.Routers](xref:Microsoft.AspNetCore.Routing.RouteData.Routers) is a list of the routes that took part in successfully matching the request.</span></span> <span data-ttu-id="36060-937">ルートはルートの中に入れ子にすることができます。</span><span class="sxs-lookup"><span data-stu-id="36060-937">Routes can be nested inside of one another.</span></span> <span data-ttu-id="36060-938"><xref:Microsoft.AspNetCore.Routing.RouteData.Routers> プロパティは、結果的に一致をもたらしたルートの論理ツリーを通るパスを表します。</span><span class="sxs-lookup"><span data-stu-id="36060-938">The <xref:Microsoft.AspNetCore.Routing.RouteData.Routers> property reflects the path through the logical tree of routes that resulted in a match.</span></span> <span data-ttu-id="36060-939">一般的に、<xref:Microsoft.AspNetCore.Routing.RouteData.Routers> の最初の項目はルート コレクションであり、これは URL 生成に使用するものです。</span><span class="sxs-lookup"><span data-stu-id="36060-939">Generally, the first item in <xref:Microsoft.AspNetCore.Routing.RouteData.Routers> is the route collection and should be used for URL generation.</span></span> <span data-ttu-id="36060-940"><xref:Microsoft.AspNetCore.Routing.RouteData.Routers> の最後の項目は、一致したルート ハンドラーです。</span><span class="sxs-lookup"><span data-stu-id="36060-940">The last item in <xref:Microsoft.AspNetCore.Routing.RouteData.Routers> is the route handler that matched.</span></span>

<a name="lg"></a>

### <a name="url-generation-with-linkgenerator"></a><span data-ttu-id="36060-941">LinkGenerator による URL の生成</span><span class="sxs-lookup"><span data-stu-id="36060-941">URL generation with LinkGenerator</span></span>

<span data-ttu-id="36060-942">URL 生成は、ルーティングにおいて、一連のルート値に基づいて URL パスを作成するプロセスです。</span><span class="sxs-lookup"><span data-stu-id="36060-942">URL generation is the process by which routing can create a URL path based on a set of route values.</span></span> <span data-ttu-id="36060-943">これにより、エンドポイントとそれにアクセスする URL を論理的に分離できます。</span><span class="sxs-lookup"><span data-stu-id="36060-943">This allows for a logical separation between your endpoints and the URLs that access them.</span></span>

<span data-ttu-id="36060-944">エンドポイント ルーティングには、リンク ジェネレーター API (<xref:Microsoft.AspNetCore.Routing.LinkGenerator>) が含まれています。</span><span class="sxs-lookup"><span data-stu-id="36060-944">Endpoint routing includes the Link Generator API (<xref:Microsoft.AspNetCore.Routing.LinkGenerator>).</span></span> <span data-ttu-id="36060-945"><xref:Microsoft.AspNetCore.Routing.LinkGenerator> は、[DI](xref:fundamentals/dependency-injection) から取得できるシングルトン サービスです。</span><span class="sxs-lookup"><span data-stu-id="36060-945"><xref:Microsoft.AspNetCore.Routing.LinkGenerator> is a singleton service that can be retrieved from [DI](xref:fundamentals/dependency-injection).</span></span> <span data-ttu-id="36060-946">API は、実行中の要求のコンテキスト外で使用することができます。</span><span class="sxs-lookup"><span data-stu-id="36060-946">The API can be used outside of the context of an executing request.</span></span> <span data-ttu-id="36060-947">MVC の <xref:Microsoft.AspNetCore.Mvc.IUrlHelper> と、[タグ ヘルパー](xref:mvc/views/tag-helpers/intro)、HTML ヘルパー、[アクション結果](xref:mvc/controllers/actions)など、<xref:Microsoft.AspNetCore.Mvc.IUrlHelper> に依存するシナリオではリンク ジェネレーターを使用して、リンク生成機能を提供します。</span><span class="sxs-lookup"><span data-stu-id="36060-947">MVC's <xref:Microsoft.AspNetCore.Mvc.IUrlHelper> and scenarios that rely on <xref:Microsoft.AspNetCore.Mvc.IUrlHelper>, such as [Tag Helpers](xref:mvc/views/tag-helpers/intro), HTML Helpers, and [Action Results](xref:mvc/controllers/actions), use the link generator to provide link generating capabilities.</span></span>

<span data-ttu-id="36060-948">リンク ジェネレーターは、*アドレス* と*アドレス スキーム* の概念に基づいています。</span><span class="sxs-lookup"><span data-stu-id="36060-948">The link generator is backed by the concept of an *address* and *address schemes*.</span></span> <span data-ttu-id="36060-949">アドレス スキームは、リンク生成で考慮すべきエンドポイントを決定する方法です。</span><span class="sxs-lookup"><span data-stu-id="36060-949">An address scheme is a way of determining the endpoints that should be considered for link generation.</span></span> <span data-ttu-id="36060-950">たとえば、MVC/Razor Pages からの、多くのユーザーに馴染みのあるルート名やルート値シナリオは、アドレス スキームとして実装されます。</span><span class="sxs-lookup"><span data-stu-id="36060-950">For example, the route name and route values scenarios many users are familiar with from MVC/Razor Pages are implemented as an address scheme.</span></span>

<span data-ttu-id="36060-951">リンク ジェネレーターでは、次の拡張メソッドを使用して、MVC/Razor Pages アクションおよびページにリンクできます。</span><span class="sxs-lookup"><span data-stu-id="36060-951">The link generator can link to MVC/Razor Pages actions and pages via the following extension methods:</span></span>

* <xref:Microsoft.AspNetCore.Routing.ControllerLinkGeneratorExtensions.GetPathByAction*>
* <xref:Microsoft.AspNetCore.Routing.ControllerLinkGeneratorExtensions.GetUriByAction*>
* <xref:Microsoft.AspNetCore.Routing.PageLinkGeneratorExtensions.GetPathByPage*>
* <xref:Microsoft.AspNetCore.Routing.PageLinkGeneratorExtensions.GetUriByPage*>

<span data-ttu-id="36060-952">これらのメソッドのオーバーロードでは、`HttpContext` を含む引数が受け入れられます。</span><span class="sxs-lookup"><span data-stu-id="36060-952">An overload of these methods accepts arguments that include the `HttpContext`.</span></span> <span data-ttu-id="36060-953">これらのメソッドは `Url.Action` および `Url.Page` と機能的には同等ですが、柔軟性とオプションがさらに提供されます。</span><span class="sxs-lookup"><span data-stu-id="36060-953">These methods are functionally equivalent to `Url.Action` and `Url.Page` but offer additional flexibility and options.</span></span>

<span data-ttu-id="36060-954">`GetPath*` メソッドは、絶対パスを含む URI を生成するという点で `Url.Action` および `Url.Page` に最も似ています。</span><span class="sxs-lookup"><span data-stu-id="36060-954">The `GetPath*` methods are most similar to `Url.Action` and `Url.Page` in that they generate a URI containing an absolute path.</span></span> <span data-ttu-id="36060-955">`GetUri*` メソッドでは常に、スキームとホストを含む絶対 URI が生成されます。</span><span class="sxs-lookup"><span data-stu-id="36060-955">The `GetUri*` methods always generate an absolute URI containing a scheme and host.</span></span> <span data-ttu-id="36060-956">`HttpContext` を受け入れるメソッドでは、実行中の要求のコンテキストで URI が生成されます。</span><span class="sxs-lookup"><span data-stu-id="36060-956">The methods that accept an `HttpContext` generate a URI in the context of the executing request.</span></span> <span data-ttu-id="36060-957">実行中の要求からのアンビエント ルート値、URL ベース パス、スキーム、およびホストは、オーバーライドされない限り使用されます。</span><span class="sxs-lookup"><span data-stu-id="36060-957">The ambient route values, URL base path, scheme, and host from the executing request are used unless overridden.</span></span>

<span data-ttu-id="36060-958"><xref:Microsoft.AspNetCore.Routing.LinkGenerator> はアドレスと共に呼び出されます。</span><span class="sxs-lookup"><span data-stu-id="36060-958"><xref:Microsoft.AspNetCore.Routing.LinkGenerator> is called with an address.</span></span> <span data-ttu-id="36060-959">URI の生成は、次の 2 つの手順で行われます。</span><span class="sxs-lookup"><span data-stu-id="36060-959">Generating a URI occurs in two steps:</span></span>

1. <span data-ttu-id="36060-960">アドレスは、そのアドレスと一致するエンドポイントのリストにバインドされます。</span><span class="sxs-lookup"><span data-stu-id="36060-960">An address is bound to a list of endpoints that match the address.</span></span>
1. <span data-ttu-id="36060-961">各エンドポイントの `RoutePattern` は、指定された値と一致するルート パターンが見つかるまで評価されます。</span><span class="sxs-lookup"><span data-stu-id="36060-961">Each endpoint's `RoutePattern` is evaluated until a route pattern that matches the supplied values is found.</span></span> <span data-ttu-id="36060-962">結果の出力は、リンク ジェネレーターに指定された他の URI 部分と結合され、返されます。</span><span class="sxs-lookup"><span data-stu-id="36060-962">The resulting output is combined with the other URI parts supplied to the link generator and returned.</span></span>

<span data-ttu-id="36060-963"><xref:Microsoft.AspNetCore.Routing.LinkGenerator> によって提供されるメソッドでは、すべての種類のアドレスの標準的なリンク生成機能がサポートされます。</span><span class="sxs-lookup"><span data-stu-id="36060-963">The methods provided by <xref:Microsoft.AspNetCore.Routing.LinkGenerator> support standard link generation capabilities for any type of address.</span></span> <span data-ttu-id="36060-964">リンク ジェネレーターを使用する最も便利な方法は、特定のアドレスの種類の操作を実行する拡張メソッドを使用することです。</span><span class="sxs-lookup"><span data-stu-id="36060-964">The most convenient way to use the link generator is through extension methods that perform operations for a specific address type.</span></span>

| <span data-ttu-id="36060-965">拡張メソッド</span><span class="sxs-lookup"><span data-stu-id="36060-965">Extension Method</span></span>   | <span data-ttu-id="36060-966">説明</span><span class="sxs-lookup"><span data-stu-id="36060-966">Description</span></span>                                                         |
| ------------------ | ------------------------------------------------------------------- |
| <xref:Microsoft.AspNetCore.Routing.LinkGenerator.GetPathByAddress*> | <span data-ttu-id="36060-967">指定された値に基づき、絶対パスを含む URI を生成します。</span><span class="sxs-lookup"><span data-stu-id="36060-967">Generates a URI with an absolute path based on the provided values.</span></span> |
| <xref:Microsoft.AspNetCore.Routing.LinkGenerator.GetUriByAddress*> | <span data-ttu-id="36060-968">指定された値に基づき、絶対 URI を生成します。</span><span class="sxs-lookup"><span data-stu-id="36060-968">Generates an absolute URI based on the provided values.</span></span>             |

> [!WARNING]
> <span data-ttu-id="36060-969"><xref:Microsoft.AspNetCore.Routing.LinkGenerator> メソッド呼び出しによる次の影響に注意してください。</span><span class="sxs-lookup"><span data-stu-id="36060-969">Pay attention to the following implications of calling <xref:Microsoft.AspNetCore.Routing.LinkGenerator> methods:</span></span>
>
> * <span data-ttu-id="36060-970">受信要求の `Host` ヘッダーが確認されないアプリ構成では、`GetUri*` 拡張メソッドは注意して使用してください。</span><span class="sxs-lookup"><span data-stu-id="36060-970">Use `GetUri*` extension methods with caution in an app configuration that doesn't validate the `Host` header of incoming requests.</span></span> <span data-ttu-id="36060-971">受信要求の `Host` ヘッダーが確認されていない場合、信頼されていない要求入力を、ビュー/ページの URI でクライアントに送り返すことができます。</span><span class="sxs-lookup"><span data-stu-id="36060-971">If the `Host` header of incoming requests isn't validated, untrusted request input can be sent back to the client in URIs in a view/page.</span></span> <span data-ttu-id="36060-972">すべての運用アプリで、`Host` ヘッダーを既知の有効な値と照らし合わせて確認するようにサーバーを構成することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="36060-972">We recommend that all production apps configure their server to validate the `Host` header against known valid values.</span></span>
>
> * <span data-ttu-id="36060-973">ミドルウェアで `Map` または `MapWhen` と組み合わせて、<xref:Microsoft.AspNetCore.Routing.LinkGenerator> を使用する場合は注意してください。</span><span class="sxs-lookup"><span data-stu-id="36060-973">Use <xref:Microsoft.AspNetCore.Routing.LinkGenerator> with caution in middleware in combination with `Map` or `MapWhen`.</span></span> <span data-ttu-id="36060-974">`Map*` では、実行中の要求の基本パスが変更され、リンク生成の出力に影響します。</span><span class="sxs-lookup"><span data-stu-id="36060-974">`Map*` changes the base path of the executing request, which affects the output of link generation.</span></span> <span data-ttu-id="36060-975">すべての <xref:Microsoft.AspNetCore.Routing.LinkGenerator> API で基本パスを指定することができます。</span><span class="sxs-lookup"><span data-stu-id="36060-975">All of the <xref:Microsoft.AspNetCore.Routing.LinkGenerator> APIs allow specifying a base path.</span></span> <span data-ttu-id="36060-976">リンク生成への `Map*` の影響を元に戻すための空の基本パスを必ず指定してください。</span><span class="sxs-lookup"><span data-stu-id="36060-976">Always specify an empty base path to undo `Map*`'s affect on link generation.</span></span>

## <a name="differences-from-earlier-versions-of-routing"></a><span data-ttu-id="36060-977">以前のバージョンのルーティングとの相違点</span><span class="sxs-lookup"><span data-stu-id="36060-977">Differences from earlier versions of routing</span></span>

<span data-ttu-id="36060-978">ASP.NET Core 2.2 以降でのエンドポイント ルーティングと、ASP.NET Core での以前のバージョンのルーティングには、次のようないくつかの違いがあります。</span><span class="sxs-lookup"><span data-stu-id="36060-978">A few differences exist between endpoint routing in ASP.NET Core 2.2 or later and earlier versions of routing in ASP.NET Core:</span></span>

* <span data-ttu-id="36060-979">エンドポイント ルーティング システムでは、<xref:Microsoft.AspNetCore.Routing.Route> からの継承を含む、<xref:Microsoft.AspNetCore.Routing.IRouter> ベースの拡張機能がサポートされません。</span><span class="sxs-lookup"><span data-stu-id="36060-979">The endpoint routing system doesn't support <xref:Microsoft.AspNetCore.Routing.IRouter>-based extensibility, including inheriting from <xref:Microsoft.AspNetCore.Routing.Route>.</span></span>

* <span data-ttu-id="36060-980">エンドポイント ルーティングでは [WebApiCompatShim](https://www.nuget.org/packages/Microsoft.AspNetCore.Mvc.WebApiCompatShim) がサポートされません。</span><span class="sxs-lookup"><span data-stu-id="36060-980">Endpoint routing doesn't support [WebApiCompatShim](https://www.nuget.org/packages/Microsoft.AspNetCore.Mvc.WebApiCompatShim).</span></span> <span data-ttu-id="36060-981">互換性 shim を引き続き使用するには、2.1 の[互換性バージョン](xref:mvc/compatibility-version) (`.SetCompatibilityVersion(CompatibilityVersion.Version_2_1)`) を使用します。</span><span class="sxs-lookup"><span data-stu-id="36060-981">Use the 2.1 [compatibility version](xref:mvc/compatibility-version) (`.SetCompatibilityVersion(CompatibilityVersion.Version_2_1)`) to continue using the compatibility shim.</span></span>

* <span data-ttu-id="36060-982">エンドポイント ルーティングでは、規則ルートを使用する場合に生成される URI の大文字と小文字の指定の動作が異なります。</span><span class="sxs-lookup"><span data-stu-id="36060-982">Endpoint Routing has different behavior for the casing of generated URIs when using conventional routes.</span></span>

  <span data-ttu-id="36060-983">次の既定のルート テンプレートについて考えてみます。</span><span class="sxs-lookup"><span data-stu-id="36060-983">Consider the following default route template:</span></span>

  ```csharp
  app.UseMvc(routes =>
  {
      routes.MapRoute("default", "{controller=Home}/{action=Index}/{id?}");
  });
  ```

  <span data-ttu-id="36060-984">次のルートを使用して、アクションへのリンクを生成するとします。</span><span class="sxs-lookup"><span data-stu-id="36060-984">Suppose you generate a link to an action using the following route:</span></span>

  ```csharp
  var link = Url.Action("ReadPost", "blog", new { id = 17, });
  ```

  <span data-ttu-id="36060-985"><xref:Microsoft.AspNetCore.Routing.IRouter> ベースのルーティングでは、このコードで `/blog/ReadPost/17` の URI が生成され、指定されたルート値の大文字と小文字の指定が優先されます。</span><span class="sxs-lookup"><span data-stu-id="36060-985">With <xref:Microsoft.AspNetCore.Routing.IRouter>-based routing, this code generates a URI of `/blog/ReadPost/17`, which respects the casing of the provided route value.</span></span> <span data-ttu-id="36060-986">ASP.NET Core 2.2 以降のエンドポイント ルーティングでは、`/Blog/ReadPost/17` ("Blog" の先頭は大文字) が生成されます。</span><span class="sxs-lookup"><span data-stu-id="36060-986">Endpoint routing in ASP.NET Core 2.2 or later produces `/Blog/ReadPost/17` ("Blog" is capitalized).</span></span> <span data-ttu-id="36060-987">エンドポイント ルーティングでは `IOutboundParameterTransformer` インターフェイスが提供されます。それを使用して、この動作をグローバルにカスタマイズしたり、URL のマッピングで異なる規則を適用したりすることができます。</span><span class="sxs-lookup"><span data-stu-id="36060-987">Endpoint routing provides the `IOutboundParameterTransformer` interface that can be used to customize this behavior globally or to apply different conventions for mapping URLs.</span></span>

  <span data-ttu-id="36060-988">詳細については、「[パラメーター トランスフォーマー参照](#parameter-transformer-reference)」セクションを参照してください。</span><span class="sxs-lookup"><span data-stu-id="36060-988">For more information, see the [Parameter transformer reference](#parameter-transformer-reference) section.</span></span>

* <span data-ttu-id="36060-989">存在しないコントローラー/アクションまたはページへのリンクを試みる場合、規則ルートがある MVC/Razor Pages によって使用されるリンク生成の動作は異なります。</span><span class="sxs-lookup"><span data-stu-id="36060-989">Link Generation used by MVC/Razor Pages with conventional routes behaves differently when attempting to link to an controller/action or page that doesn't exist.</span></span>

  <span data-ttu-id="36060-990">次の既定のルート テンプレートについて考えてみます。</span><span class="sxs-lookup"><span data-stu-id="36060-990">Consider the following default route template:</span></span>

  ```csharp
  app.UseMvc(routes =>
  {
      routes.MapRoute("default", "{controller=Home}/{action=Index}/{id?}");
  });
  ```

  <span data-ttu-id="36060-991">次のように既定のテンプレートを使用して、アクションへのリンクを生成するとします。</span><span class="sxs-lookup"><span data-stu-id="36060-991">Suppose you generate a link to an action using the default template with the following:</span></span>

  ```csharp
  var link = Url.Action("ReadPost", "Blog", new { id = 17, });
  ```

  <span data-ttu-id="36060-992">`IRouter` ベースのルーティングでは、`BlogController` が存在しない場合や `ReadPost` アクション メソッドがない場合でも、結果は常に `/Blog/ReadPost/17` となります。</span><span class="sxs-lookup"><span data-stu-id="36060-992">With `IRouter`-based routing, the result is always `/Blog/ReadPost/17`, even if the `BlogController` doesn't exist or doesn't have a `ReadPost` action method.</span></span> <span data-ttu-id="36060-993">予想どおり、アクション メソッドが存在する場合は、ASP.NET Core 2.2 以降のエンドポイント ルーティングで `/Blog/ReadPost/17` が生成されます。</span><span class="sxs-lookup"><span data-stu-id="36060-993">As expected, endpoint routing in ASP.NET Core 2.2 or later produces `/Blog/ReadPost/17` if the action method exists.</span></span> <span data-ttu-id="36060-994">*しかし、アクションが存在しない場合は、エンドポイント ルーティングで空の文字列が生成されます。*</span><span class="sxs-lookup"><span data-stu-id="36060-994">*However, endpoint routing produces an empty string if the action doesn't exist.*</span></span> <span data-ttu-id="36060-995">概念的には、エンドポイント ルーティングでは、アクションが存在しない場合はエンドポイントが存在するとは見なされません。</span><span class="sxs-lookup"><span data-stu-id="36060-995">Conceptually, endpoint routing doesn't assume that the endpoint exists if the action doesn't exist.</span></span>

* <span data-ttu-id="36060-996">エンドポイント ルーティングで使用する場合は、リンク生成の*アンビエント値の無効化アルゴリズム* の動作が異なります。</span><span class="sxs-lookup"><span data-stu-id="36060-996">The link generation *ambient value invalidation algorithm* behaves differently when used with endpoint routing.</span></span>

  <span data-ttu-id="36060-997">*アンビエント値の無効化* は、現在実行中の要求からのルート値 (アンビエント値) のうち、どちらがリンク生成操作で使用できのかを判断するアルゴリズムです。</span><span class="sxs-lookup"><span data-stu-id="36060-997">*Ambient value invalidation* is the algorithm that decides which route values from the currently executing request (the ambient values) can be used in link generation operations.</span></span> <span data-ttu-id="36060-998">規則ルーティングでは、異なるアクションへのリンク時に余分なルート値が常に無効化されました。</span><span class="sxs-lookup"><span data-stu-id="36060-998">Conventional routing always invalidated extra route values when linking to a different action.</span></span> <span data-ttu-id="36060-999">属性ルーティングは、ASP.NET Core 2.2 のリリースより前ではこのように動作しませんでした。</span><span class="sxs-lookup"><span data-stu-id="36060-999">Attribute routing didn't have this behavior prior to the release of ASP.NET Core 2.2.</span></span> <span data-ttu-id="36060-1000">以前のバージョンの ASP.NET Core では、同じルート パラメーター名を使用する別のアクションへのリンクでリンク生成エラーが発生しました。</span><span class="sxs-lookup"><span data-stu-id="36060-1000">In earlier versions of ASP.NET Core, links to another action that use the same route parameter names resulted in link generation errors.</span></span> <span data-ttu-id="36060-1001">ASP.NET Core 2.2 以降では、両方の形式のルーティングで、別のアクションへのリンク時に値が無効化されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1001">In ASP.NET Core 2.2 or later, both forms of routing invalidate values when linking to another action.</span></span>

  <span data-ttu-id="36060-1002">ASP.NET Core 2.1 以前での次の例について考えてみます。</span><span class="sxs-lookup"><span data-stu-id="36060-1002">Consider the following example in ASP.NET Core 2.1 or earlier.</span></span> <span data-ttu-id="36060-1003">別のアクション (または別のページ) にリンクする場合、好ましくない方法でルート値が再利用される可能性があります。</span><span class="sxs-lookup"><span data-stu-id="36060-1003">When linking to another action (or another page), route values can be reused in undesirable ways.</span></span>

  <span data-ttu-id="36060-1004">*/Pages/Store/Product.cshtml* の場合:</span><span class="sxs-lookup"><span data-stu-id="36060-1004">In */Pages/Store/Product.cshtml*:</span></span>

  ```cshtml
  @page "{id}"
  @Url.Page("/Login")
  ```

  <span data-ttu-id="36060-1005">*/Pages/Login.cshtml* の場合:</span><span class="sxs-lookup"><span data-stu-id="36060-1005">In */Pages/Login.cshtml*:</span></span>

  ```cshtml
  @page "{id?}"
  ```

  <span data-ttu-id="36060-1006">ASP.NET Core 2.1 以前で URI が `/Store/Product/18` である場合、`@Url.Page("/Login")` によって Store/Info ページに生成されるリンクは `/Login/18` となります。</span><span class="sxs-lookup"><span data-stu-id="36060-1006">If the URI is `/Store/Product/18` in ASP.NET Core 2.1 or earlier, the link generated on the Store/Info page by `@Url.Page("/Login")` is `/Login/18`.</span></span> <span data-ttu-id="36060-1007">リンク先が完全にアプリの異なる部分であっても、18 という `id` の値が再利用されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1007">The `id` value of 18 is reused, even though the link destination is different part of the app entirely.</span></span> <span data-ttu-id="36060-1008">`/Login` ページのコンテキスト内の `id` ルート値は、商品 ID 値ではなく、ユーザー ID 値であると考えられます。</span><span class="sxs-lookup"><span data-stu-id="36060-1008">The `id` route value in the context of the `/Login` page is probably a user ID value, not a store product ID value.</span></span>

  <span data-ttu-id="36060-1009">ASP.NET Core 2.2 以降でのエンドポイント ルーティングでは、結果は `/Login` となります。</span><span class="sxs-lookup"><span data-stu-id="36060-1009">In endpoint routing with ASP.NET Core 2.2 or later, the result is `/Login`.</span></span> <span data-ttu-id="36060-1010">リンク先が異なるアクションやページである場合、アンビエント値は再利用されません。</span><span class="sxs-lookup"><span data-stu-id="36060-1010">Ambient values aren't reused when the linked destination is a different action or page.</span></span>

* <span data-ttu-id="36060-1011">ラウンド トリップ ルート パラメーターの構文: 二重アスタリスク (`**`) キャッチオール パラメーター構文を使用する場合、スラッシュはエンコードされません。</span><span class="sxs-lookup"><span data-stu-id="36060-1011">Round-tripping route parameter syntax: Forward slashes aren't encoded when using a double-asterisk (`**`) catch-all parameter syntax.</span></span>

  <span data-ttu-id="36060-1012">リンクの生成中に、ルーティング システムでは、スラッシュを除く二重アスタリスク (`**`) キャッチオール パラメーター (`{**myparametername}` など) でキャプチャされた値をエンコードします。</span><span class="sxs-lookup"><span data-stu-id="36060-1012">During link generation, the routing system encodes the value captured in a double-asterisk (`**`) catch-all parameter (for example, `{**myparametername}`) except the forward slashes.</span></span> <span data-ttu-id="36060-1013">二重アスタリスク キャッチオールは、ASP.NET Core 2.2 以降の `IRouter` ベース ルーティングでサポートされます。</span><span class="sxs-lookup"><span data-stu-id="36060-1013">The double-asterisk catch-all is supported with `IRouter`-based routing in ASP.NET Core 2.2 or later.</span></span>

  <span data-ttu-id="36060-1014">以前のバージョンの ASP.NET Core での単一のアスタリスク キャッチオール パラメーター構文 (`{*myparametername}`) は引き続きサポートされ、スラッシュはエンコードされます。</span><span class="sxs-lookup"><span data-stu-id="36060-1014">The single asterisk catch-all parameter syntax in prior versions of ASP.NET Core (`{*myparametername}`) remains supported, and forward slashes are encoded.</span></span>

  | <span data-ttu-id="36060-1015">ルート</span><span class="sxs-lookup"><span data-stu-id="36060-1015">Route</span></span>              | <span data-ttu-id="36060-1016">以下で生成されるリンク</span><span class="sxs-lookup"><span data-stu-id="36060-1016">Link generated with</span></span><br>`Url.Action(new { category = "admin/products" })`&hellip; |
  | ------------------ | --------------------------------------------------------------------- |
  | `/search/{*page}`  | <span data-ttu-id="36060-1017">`/search/admin%2Fproducts` (スラッシュはエンコードされます)</span><span class="sxs-lookup"><span data-stu-id="36060-1017">`/search/admin%2Fproducts` (the forward slash is encoded)</span></span>             |
  | `/search/{**page}` | `/search/admin/products`                                              |

### <a name="middleware-example"></a><span data-ttu-id="36060-1018">ミドルウェアの例</span><span class="sxs-lookup"><span data-stu-id="36060-1018">Middleware example</span></span>

<span data-ttu-id="36060-1019">次の例では、ミドルウェアで <xref:Microsoft.AspNetCore.Routing.LinkGenerator> API を使用して、商品をリストするアクション メソッドへのリンクを作成します。</span><span class="sxs-lookup"><span data-stu-id="36060-1019">In the following example, a middleware uses the <xref:Microsoft.AspNetCore.Routing.LinkGenerator> API to create link to an action method that lists store products.</span></span> <span data-ttu-id="36060-1020">リンク ジェネレーターは、クラスに挿入し、`GenerateLink` を呼び出すことで、アプリのどのクラスでも使用できます。</span><span class="sxs-lookup"><span data-stu-id="36060-1020">Using the link generator by injecting it into a class and calling `GenerateLink` is available to any class in an app.</span></span>

```csharp
using Microsoft.AspNetCore.Routing;

public class ProductsLinkMiddleware
{
    private readonly LinkGenerator _linkGenerator;

    public ProductsLinkMiddleware(RequestDelegate next, LinkGenerator linkGenerator)
    {
        _linkGenerator = linkGenerator;
    }

    public async Task InvokeAsync(HttpContext httpContext)
    {
        var url = _linkGenerator.GetPathByAction("ListProducts", "Store");

        httpContext.Response.ContentType = "text/plain";

        await httpContext.Response.WriteAsync($"Go to {url} to see our products.");
    }
}
```

### <a name="create-routes"></a><span data-ttu-id="36060-1021">ルートを作成する</span><span class="sxs-lookup"><span data-stu-id="36060-1021">Create routes</span></span>

<span data-ttu-id="36060-1022">ほとんどのアプリは、<xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> を呼び出すか、<xref:Microsoft.AspNetCore.Routing.IRouteBuilder> で定義されている同様の拡張メソッドの 1 つを呼び出してルートを作成します。</span><span class="sxs-lookup"><span data-stu-id="36060-1022">Most apps create routes by calling <xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> or one of the similar extension methods defined on <xref:Microsoft.AspNetCore.Routing.IRouteBuilder>.</span></span> <span data-ttu-id="36060-1023">いずれの <xref:Microsoft.AspNetCore.Routing.IRouteBuilder> 拡張メソッドでも、<xref:Microsoft.AspNetCore.Routing.Route> のインスタンスが作成され、それがルート コレクションに追加されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1023">Any of the <xref:Microsoft.AspNetCore.Routing.IRouteBuilder> extension methods create an instance of <xref:Microsoft.AspNetCore.Routing.Route> and add it to the route collection.</span></span>

<span data-ttu-id="36060-1024"><xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> では、ルート ハンドラー パラメーターは受け入れられません。</span><span class="sxs-lookup"><span data-stu-id="36060-1024"><xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> doesn't accept a route handler parameter.</span></span> <span data-ttu-id="36060-1025"><xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> は、<xref:Microsoft.AspNetCore.Routing.RouteBuilder.DefaultHandler*> によって処理されるルートを追加するだけです。</span><span class="sxs-lookup"><span data-stu-id="36060-1025"><xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> only adds routes that are handled by the <xref:Microsoft.AspNetCore.Routing.RouteBuilder.DefaultHandler*>.</span></span> <span data-ttu-id="36060-1026">MVC でのルーティングの詳細については、「<xref:mvc/controllers/routing>」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="36060-1026">To learn more about routing in MVC, see <xref:mvc/controllers/routing>.</span></span>

<span data-ttu-id="36060-1027">次のコード例は、一般的な ASP.NET Core MVC ルート定義によって使用される <xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> 呼び出しの例です。</span><span class="sxs-lookup"><span data-stu-id="36060-1027">The following code example is an example of a <xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> call used by a typical ASP.NET Core MVC route definition:</span></span>

```csharp
routes.MapRoute(
    name: "default",
    template: "{controller=Home}/{action=Index}/{id?}");
```

<span data-ttu-id="36060-1028">このテンプレートでは URL パスが照合され、ルート値が抽出されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1028">This template matches a URL path and extracts the route values.</span></span> <span data-ttu-id="36060-1029">たとえば、`/Products/Details/17` というパスでは、`{ controller = Products, action = Details, id = 17 }` というルート値が生成されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1029">For example, the path `/Products/Details/17` generates the following route values: `{ controller = Products, action = Details, id = 17 }`.</span></span>

<span data-ttu-id="36060-1030">ルート値は、URL パスをセグメントに分割し、各セグメントと、ルート テンプレートの*ルート パラメーター* 名を照合することで決定されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1030">Route values are determined by splitting the URL path into segments and matching each segment with the *route parameter* name in the route template.</span></span> <span data-ttu-id="36060-1031">ルート パラメーターが指定されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1031">Route parameters are named.</span></span> <span data-ttu-id="36060-1032">パラメーターは、中かっこ `{ ... }` でパラメーター名を囲むことで定義されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1032">The parameters defined by enclosing the parameter name in braces `{ ... }`.</span></span>

<span data-ttu-id="36060-1033">上のテンプレートでは URL パス `/` の照合も行い、`{ controller = Home, action = Index }` という値を生成します。</span><span class="sxs-lookup"><span data-stu-id="36060-1033">The preceding template could also match the URL path `/` and produce the values `{ controller = Home, action = Index }`.</span></span> <span data-ttu-id="36060-1034">これは、ルート パラメーターの `{controller}` と `{action}` に既定値が与えられ、`id` ルート パラメーターが任意であるためです。</span><span class="sxs-lookup"><span data-stu-id="36060-1034">This occurs because the `{controller}` and `{action}` route parameters have default values and the `id` route parameter is optional.</span></span> <span data-ttu-id="36060-1035">ルート パラメーター名の後の等号 (`=`) とそれに続く値により、パラメーターの既定値が定義されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1035">An equals sign (`=`) followed by a value after the route parameter name defines a default value for the parameter.</span></span> <span data-ttu-id="36060-1036">ルート パラメーター名の後の疑問符 (`?`) により、オプションのパラメーターが定義されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1036">A question mark (`?`) after the route parameter name defines an optional parameter.</span></span>

<span data-ttu-id="36060-1037">既定値のルート パラメーターはルートが一致するとルート値を*常に*生成します。</span><span class="sxs-lookup"><span data-stu-id="36060-1037">Route parameters with a default value *always* produce a route value when the route matches.</span></span> <span data-ttu-id="36060-1038">省略可能なパラメーターでは、対応する URL パス セグメントがない場合、ルート値は生成されません。</span><span class="sxs-lookup"><span data-stu-id="36060-1038">Optional parameters don't produce a route value if there is no corresponding URL path segment.</span></span> <span data-ttu-id="36060-1039">ルート テンプレートのシナリオと構文の詳しい説明については、「[ルート テンプレート参照](#route-template-reference)」セクションを参照してください。</span><span class="sxs-lookup"><span data-stu-id="36060-1039">See the [Route template reference](#route-template-reference) section for a thorough description of route template scenarios and syntax.</span></span>

<span data-ttu-id="36060-1040">次の例では、ルート パラメーター定義 `{id:int}` により、`id` ルート パラメーターの[ルート制約](#route-constraint-reference)が定義されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1040">In the following example, the route parameter definition `{id:int}` defines a [route constraint](#route-constraint-reference) for the `id` route parameter:</span></span>

```csharp
routes.MapRoute(
    name: "default",
    template: "{controller=Home}/{action=Index}/{id:int}");
```

<span data-ttu-id="36060-1041">このテンプレートは `/Products/Details/Apples` ではなく、`/Products/Details/17` のような URL パスを照合します。</span><span class="sxs-lookup"><span data-stu-id="36060-1041">This template matches a URL path like `/Products/Details/17` but not `/Products/Details/Apples`.</span></span> <span data-ttu-id="36060-1042">ルート制約は <xref:Microsoft.AspNetCore.Routing.IRouteConstraint> を実装し、ルート値を調べて正しいことを確認します。</span><span class="sxs-lookup"><span data-stu-id="36060-1042">Route constraints implement <xref:Microsoft.AspNetCore.Routing.IRouteConstraint> and inspect route values to verify them.</span></span> <span data-ttu-id="36060-1043">この例では、ルート値 `id` は整数に変換できなければなりません。</span><span class="sxs-lookup"><span data-stu-id="36060-1043">In this example, the route value `id` must be convertible to an integer.</span></span> <span data-ttu-id="36060-1044">フレームワークによって提供されるルート制約については、「[ルート制約参照](#route-constraint-reference)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="36060-1044">See [route-constraint-reference](#route-constraint-reference) for an explanation of route constraints provided by the framework.</span></span>

<span data-ttu-id="36060-1045"><xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> の追加オーバーロードは、`constraints`、`dataTokens`、`defaults` の値を受け取ります。</span><span class="sxs-lookup"><span data-stu-id="36060-1045">Additional overloads of <xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> accept values for `constraints`, `dataTokens`, and `defaults`.</span></span> <span data-ttu-id="36060-1046">このようなパラメーターは一般的に、匿名型のオブジェクトを渡し、匿名型のプロパティ名がルート パラメーター名と一致するというような使われ方をします。</span><span class="sxs-lookup"><span data-stu-id="36060-1046">The typical usage of these parameters is to pass an anonymously typed object, where the property names of the anonymous type match route parameter names.</span></span>

<span data-ttu-id="36060-1047">次の <xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> 例では、同等のルートを作成します。</span><span class="sxs-lookup"><span data-stu-id="36060-1047">The following <xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> examples create equivalent routes:</span></span>

```csharp
routes.MapRoute(
    name: "default_route",
    template: "{controller}/{action}/{id?}",
    defaults: new { controller = "Home", action = "Index" });

routes.MapRoute(
    name: "default_route",
    template: "{controller=Home}/{action=Index}/{id?}");
```

> [!TIP]
> <span data-ttu-id="36060-1048">制約と既定値を定義するインライン構文は単純なルートの場合に便利です。</span><span class="sxs-lookup"><span data-stu-id="36060-1048">The inline syntax for defining constraints and defaults can be convenient for simple routes.</span></span> <span data-ttu-id="36060-1049">しかし、インライン構文でサポートされていない、データ トークンなどのシナリオがあります。</span><span class="sxs-lookup"><span data-stu-id="36060-1049">However, there are scenarios, such as data tokens, that aren't supported by inline syntax.</span></span>

<span data-ttu-id="36060-1050">次の例では、その他のいくつかのシナリオを示します。</span><span class="sxs-lookup"><span data-stu-id="36060-1050">The following example demonstrates a few additional scenarios:</span></span>

```csharp
routes.MapRoute(
    name: "blog",
    template: "Blog/{**article}",
    defaults: new { controller = "Blog", action = "ReadArticle" });
```

<span data-ttu-id="36060-1051">上記のテンプレートでは `/Blog/All-About-Routing/Introduction` のような URL パスを照合し、値 `{ controller = Blog, action = ReadArticle, article = All-About-Routing/Introduction }` を抽出します。</span><span class="sxs-lookup"><span data-stu-id="36060-1051">The preceding template matches a URL path like `/Blog/All-About-Routing/Introduction` and extracts the values `{ controller = Blog, action = ReadArticle, article = All-About-Routing/Introduction }`.</span></span> <span data-ttu-id="36060-1052">`controller` と `action` の既定のルート値は、テンプレートに対応するルート パラメーターがなくても、ルートにより生成されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1052">The default route values for `controller` and `action` are produced by the route even though there are no corresponding route parameters in the template.</span></span> <span data-ttu-id="36060-1053">既定値はルート テンプレートで指定できます。</span><span class="sxs-lookup"><span data-stu-id="36060-1053">Default values can be specified in the route template.</span></span> <span data-ttu-id="36060-1054">`article` ルート パラメーターは、ルート パラメーター名の前に二重アスタリスク (`**`) があるときに、*キャッチオール* として定義されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1054">The `article` route parameter is defined as a *catch-all* by the appearance of an double asterisk (`**`) before the route parameter name.</span></span> <span data-ttu-id="36060-1055">キャッチオール ルート パラメーターは、URL パスの残りの部分をキャプチャします。空の文字列も照合できます。</span><span class="sxs-lookup"><span data-stu-id="36060-1055">Catch-all route parameters capture the remainder of the URL path and can also match the empty string.</span></span>

<span data-ttu-id="36060-1056">次の例では、ルート制約とデータ トークンを追加します。</span><span class="sxs-lookup"><span data-stu-id="36060-1056">The following example adds route constraints and data tokens:</span></span>

```csharp
routes.MapRoute(
    name: "us_english_products",
    template: "en-US/Products/{id}",
    defaults: new { controller = "Products", action = "Details" },
    constraints: new { id = new IntRouteConstraint() },
    dataTokens: new { locale = "en-US" });
```

<span data-ttu-id="36060-1057">上記のテンプレートでは `/en-US/Products/5` のような URL パスを照合し、値 `{ controller = Products, action = Details, id = 5 }` とデータ トークン `{ locale = en-US }` を抽出します。</span><span class="sxs-lookup"><span data-stu-id="36060-1057">The preceding template matches a URL path like `/en-US/Products/5` and extracts the values `{ controller = Products, action = Details, id = 5 }` and the data tokens `{ locale = en-US }`.</span></span>

![ローカル変数ウィンドウ トークン](routing/_static/tokens.png)

### <a name="route-class-url-generation"></a><span data-ttu-id="36060-1059">ルート クラス URL の生成</span><span class="sxs-lookup"><span data-stu-id="36060-1059">Route class URL generation</span></span>

<span data-ttu-id="36060-1060"><xref:Microsoft.AspNetCore.Routing.Route> クラスは、一連のルート値をそのルート テンプレートと組み合わせる方法でも URL を生成できます。</span><span class="sxs-lookup"><span data-stu-id="36060-1060">The <xref:Microsoft.AspNetCore.Routing.Route> class can also perform URL generation by combining a set of route values with its route template.</span></span> <span data-ttu-id="36060-1061">論理的には、URL パスの照合とは逆のプロセスになります。</span><span class="sxs-lookup"><span data-stu-id="36060-1061">This is logically the reverse process of matching the URL path.</span></span>

> [!TIP]
> <span data-ttu-id="36060-1062">URL 生成を理解する方法として、どのような URL を生成したいのかを考えてください。そして、ルート テンプレートがその URL にどのように照合されるのかを考えてください。</span><span class="sxs-lookup"><span data-stu-id="36060-1062">To better understand URL generation, imagine what URL you want to generate and then think about how a route template would match that URL.</span></span> <span data-ttu-id="36060-1063">どのような値が生成されるでしょうか。</span><span class="sxs-lookup"><span data-stu-id="36060-1063">What values would be produced?</span></span> <span data-ttu-id="36060-1064"><xref:Microsoft.AspNetCore.Routing.Route> クラスにおける URL 生成のしくみと大体同じになります。</span><span class="sxs-lookup"><span data-stu-id="36060-1064">This is the rough equivalent of how URL generation works in the <xref:Microsoft.AspNetCore.Routing.Route> class.</span></span>

<span data-ttu-id="36060-1065">次の例では、一般的な ASP.NET Core MVC の既定のルートを使用します。</span><span class="sxs-lookup"><span data-stu-id="36060-1065">The following example uses a general ASP.NET Core MVC default route:</span></span>

```csharp
routes.MapRoute(
    name: "default",
    template: "{controller=Home}/{action=Index}/{id?}");
```

<span data-ttu-id="36060-1066">ルート値が `{ controller = Products, action = List }` の場合、URL `/Products/List` が生成されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1066">With the route values `{ controller = Products, action = List }`, the URL `/Products/List` is generated.</span></span> <span data-ttu-id="36060-1067">ルート値が対応ルート パラメーターの代替となり、URL パスが作られます。</span><span class="sxs-lookup"><span data-stu-id="36060-1067">The route values are substituted for the corresponding route parameters to form the URL path.</span></span> <span data-ttu-id="36060-1068">`id` は任意のルート パラメーターであるため、URL は `id` の値なしで正常に生成されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1068">Since `id` is an optional route parameter, the URL is successfully generated without a value for `id`.</span></span>

<span data-ttu-id="36060-1069">ルート値が `{ controller = Home, action = Index }` の場合、URL `/` が生成されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1069">With the route values `{ controller = Home, action = Index }`, the URL `/` is generated.</span></span> <span data-ttu-id="36060-1070">指定されたルート値は既定値と一致し、その既定値に対応するセグメントを省略しても問題は発生しません。</span><span class="sxs-lookup"><span data-stu-id="36060-1070">The provided route values match the default values, and the segments corresponding to the default values are safely omitted.</span></span>

<span data-ttu-id="36060-1071">生成された両方の URL では、次のルート定義 (`/Home/Index` と `/`) でラウンドトリップされ、URL の生成に使用された同じルート値が生成されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1071">Both URLs generated round-trip with the following route definition (`/Home/Index` and `/`) produce the same route values that were used to generate the URL.</span></span>

> [!NOTE]
> <span data-ttu-id="36060-1072">アプリで ASP.NET Core MVC が使用される場合、ルーティングを直接呼び出す代わりに、<xref:Microsoft.AspNetCore.Mvc.Routing.UrlHelper> を使用して URL を生成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="36060-1072">An app using ASP.NET Core MVC should use <xref:Microsoft.AspNetCore.Mvc.Routing.UrlHelper> to generate URLs instead of calling into routing directly.</span></span>

<span data-ttu-id="36060-1073">URL 生成の詳細については、「[URL 生成参照](#url-generation-reference)」セクションを参照してください。</span><span class="sxs-lookup"><span data-stu-id="36060-1073">For more information on URL generation, see the [Url generation reference](#url-generation-reference) section.</span></span>

## <a name="use-routing-middleware"></a><span data-ttu-id="36060-1074">ルーティング ミドルウェアの使用</span><span class="sxs-lookup"><span data-stu-id="36060-1074">Use Routing Middleware</span></span>

<span data-ttu-id="36060-1075">アプリのプロジェクト ファイルの [Microsoft.AspNetCore.App メタパッケージ](xref:fundamentals/metapackage-app)を参照します。</span><span class="sxs-lookup"><span data-stu-id="36060-1075">Reference the [Microsoft.AspNetCore.App metapackage](xref:fundamentals/metapackage-app) in the app's project file.</span></span>

<span data-ttu-id="36060-1076">`Startup.ConfigureServices` でサービス コンテナーにルーティングを追加した例:</span><span class="sxs-lookup"><span data-stu-id="36060-1076">Add routing to the service container in `Startup.ConfigureServices`:</span></span>

[!code-csharp[](routing/samples/2.x/RoutingSample/Startup.cs?name=snippet_ConfigureServices&highlight=3)]

<span data-ttu-id="36060-1077">ルートは `Startup.Configure` メソッドで設定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="36060-1077">Routes must be configured in the `Startup.Configure` method.</span></span> <span data-ttu-id="36060-1078">サンプル アプリでは次の API を使用します。</span><span class="sxs-lookup"><span data-stu-id="36060-1078">The sample app uses the following APIs:</span></span>

* <xref:Microsoft.AspNetCore.Routing.RouteBuilder>
* <span data-ttu-id="36060-1079"><xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapGet*>:HTTP GET 要求のみを照合します。</span><span class="sxs-lookup"><span data-stu-id="36060-1079"><xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapGet*>: Matches only HTTP GET requests.</span></span>
* <xref:Microsoft.AspNetCore.Builder.RoutingBuilderExtensions.UseRouter*>

[!code-csharp[](routing/samples/2.x/RoutingSample/Startup.cs?name=snippet_RouteHandler)]

<span data-ttu-id="36060-1080">下の表は、応答と所与の URI をまとめたものです。</span><span class="sxs-lookup"><span data-stu-id="36060-1080">The following table shows the responses with the given URIs.</span></span>

| <span data-ttu-id="36060-1081">URI</span><span class="sxs-lookup"><span data-stu-id="36060-1081">URI</span></span>                    | <span data-ttu-id="36060-1082">応答</span><span class="sxs-lookup"><span data-stu-id="36060-1082">Response</span></span>                                          |
| ---------------------- | ------------------------------------------------- |
| `/package/create/3`    | <span data-ttu-id="36060-1083">Hello!</span><span class="sxs-lookup"><span data-stu-id="36060-1083">Hello!</span></span> <span data-ttu-id="36060-1084">Route values: [operation, create], [id, 3]</span><span class="sxs-lookup"><span data-stu-id="36060-1084">Route values: [operation, create], [id, 3]</span></span> |
| `/package/track/-3`    | <span data-ttu-id="36060-1085">Hello!</span><span class="sxs-lookup"><span data-stu-id="36060-1085">Hello!</span></span> <span data-ttu-id="36060-1086">Route values: [operation, track], [id, -3]</span><span class="sxs-lookup"><span data-stu-id="36060-1086">Route values: [operation, track], [id, -3]</span></span> |
| `/package/track/-3/`   | <span data-ttu-id="36060-1087">Hello!</span><span class="sxs-lookup"><span data-stu-id="36060-1087">Hello!</span></span> <span data-ttu-id="36060-1088">Route values: [operation, track], [id, -3]</span><span class="sxs-lookup"><span data-stu-id="36060-1088">Route values: [operation, track], [id, -3]</span></span> |
| `/package/track/`      | <span data-ttu-id="36060-1089">要求はフォール スルーし、一致するものはありません。</span><span class="sxs-lookup"><span data-stu-id="36060-1089">The request falls through, no match.</span></span>              |
| `GET /hello/Joe`       | <span data-ttu-id="36060-1090">Hi, Joe!</span><span class="sxs-lookup"><span data-stu-id="36060-1090">Hi, Joe!</span></span>                                          |
| `POST /hello/Joe`      | <span data-ttu-id="36060-1091">要求はフォール スルーし、HTTP GET のみが一致します。</span><span class="sxs-lookup"><span data-stu-id="36060-1091">The request falls through, matches HTTP GET only.</span></span> |
| `GET /hello/Joe/Smith` | <span data-ttu-id="36060-1092">要求はフォール スルーし、一致するものはありません。</span><span class="sxs-lookup"><span data-stu-id="36060-1092">The request falls through, no match.</span></span>              |

<span data-ttu-id="36060-1093">このフレームワークでは、ルートを作成するために拡張メソッド セット (<xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions>) が提供されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1093">The framework provides a set of extension methods for creating routes (<xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions>):</span></span>

* <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapDelete*>
* <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapGet*>
* <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapMiddlewareDelete*>
* <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapMiddlewareGet*>
* <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapMiddlewarePost*>
* <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapMiddlewarePut*>
* <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapMiddlewareRoute*>
* <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapMiddlewareVerb*>
* <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapPost*>
* <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapPut*>
* <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapRoute*>
* <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapVerb*>

<span data-ttu-id="36060-1094">`Map[Verb]` メソッドは制約を利用し、メソッド名の HTTP Verb にルートを制限します。</span><span class="sxs-lookup"><span data-stu-id="36060-1094">The `Map[Verb]` methods use constraints to limit the route to the HTTP Verb in the method name.</span></span> <span data-ttu-id="36060-1095">たとえば、 <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapGet*> や <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapVerb*>を参照してください。</span><span class="sxs-lookup"><span data-stu-id="36060-1095">For example, see <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapGet*> and <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapVerb*>.</span></span>

## <a name="route-template-reference"></a><span data-ttu-id="36060-1096">ルート テンプレート参照</span><span class="sxs-lookup"><span data-stu-id="36060-1096">Route template reference</span></span>

<span data-ttu-id="36060-1097">中括弧 (`{ ... }`) 内のトークンは*ルート パラメーター*を定義します。ルートが一致した場合、これがバインドされます。</span><span class="sxs-lookup"><span data-stu-id="36060-1097">Tokens within curly braces (`{ ... }`) define *route parameters* that are bound if the route is matched.</span></span> <span data-ttu-id="36060-1098">1 つのルート セグメントで複数のルート パラメーターを定義できますが、リテラル値で区切る必要があります。</span><span class="sxs-lookup"><span data-stu-id="36060-1098">You can define more than one route parameter in a route segment, but they must be separated by a literal value.</span></span> <span data-ttu-id="36060-1099">たとえば、`{controller=Home}{action=Index}` は有効なルートになりません。`{controller}` と `{action}` の間にリテラル値がないためです。</span><span class="sxs-lookup"><span data-stu-id="36060-1099">For example, `{controller=Home}{action=Index}` isn't a valid route, since there's no literal value between `{controller}` and `{action}`.</span></span> <span data-ttu-id="36060-1100">このようなルート パラメーターには名前を付ける必要があります。付加的な属性を指定することもあります。</span><span class="sxs-lookup"><span data-stu-id="36060-1100">These route parameters must have a name and may have additional attributes specified.</span></span>

<span data-ttu-id="36060-1101">ルート パラメーター以外のリテラル テキスト (`{id}` など) とパス区切り `/` は URL のテキストに一致する必要があります。</span><span class="sxs-lookup"><span data-stu-id="36060-1101">Literal text other than route parameters (for example, `{id}`) and the path separator `/` must match the text in the URL.</span></span> <span data-ttu-id="36060-1102">テキスト照合は復号された URL パスを基盤とし、大文字と小文字が区別されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1102">Text matching is case-insensitive and based on the decoded representation of the URLs path.</span></span> <span data-ttu-id="36060-1103">リテラル ルート パラメーターの区切り記号 (`{` または `}`) を照合するには、文字を繰り返して区切り記号をエスケープします (`{{` または `}}`)。</span><span class="sxs-lookup"><span data-stu-id="36060-1103">To match a literal route parameter delimiter (`{` or `}`), escape the delimiter by repeating the character (`{{` or `}}`).</span></span>

<span data-ttu-id="36060-1104">任意のファイル拡張子が付いたファイル名のキャプチャを試行する URL パターンには、追加の考慮事項があります。</span><span class="sxs-lookup"><span data-stu-id="36060-1104">URL patterns that attempt to capture a file name with an optional file extension have additional considerations.</span></span> <span data-ttu-id="36060-1105">たとえば、テンプレート `files/{filename}.{ext?}` について考えてみます。</span><span class="sxs-lookup"><span data-stu-id="36060-1105">For example, consider the template `files/{filename}.{ext?}`.</span></span> <span data-ttu-id="36060-1106">`filename` と `ext` の両方の値が存在するときに、両方の値が入力されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1106">When values for both `filename` and `ext` exist, both values are populated.</span></span> <span data-ttu-id="36060-1107">URL に `filename` の値だけが存在する場合、末尾のピリオド (`.`) は任意であるため、このルートは一致となります。</span><span class="sxs-lookup"><span data-stu-id="36060-1107">If only a value for `filename` exists in the URL, the route matches because the trailing period (`.`) is  optional.</span></span> <span data-ttu-id="36060-1108">次の URL はこのルートに一致します。</span><span class="sxs-lookup"><span data-stu-id="36060-1108">The following URLs match this route:</span></span>

* `/files/myFile.txt`
* `/files/myFile`

<span data-ttu-id="36060-1109">ルート パラメーターのプレフィックスとしてアスタリスク (`*`) または二重アスタリスク (`**`) を使用し、URI の残りの部分にバインドできます。</span><span class="sxs-lookup"><span data-stu-id="36060-1109">You can use an asterisk (`*`) or double asterisk (`**`) as a prefix to a route parameter to bind to the rest of the URI.</span></span> <span data-ttu-id="36060-1110">これらは、*キャッチオール* パラメーターと呼ばれています。</span><span class="sxs-lookup"><span data-stu-id="36060-1110">These are called a *catch-all* parameters.</span></span> <span data-ttu-id="36060-1111">たとえば、`blog/{**slug}` は、`/blog` で始まり、その後に (`slug` ルート値に割り当てられる) 任意の値が続くあらゆる URI に一致します。</span><span class="sxs-lookup"><span data-stu-id="36060-1111">For example, `blog/{**slug}` matches any URI that starts with `/blog` and has any value following it, which is assigned to the `slug` route value.</span></span> <span data-ttu-id="36060-1112">キャッチオール パラメーターは空の文字列に一致することもあります。</span><span class="sxs-lookup"><span data-stu-id="36060-1112">Catch-all parameters can also match the empty string.</span></span>

<span data-ttu-id="36060-1113">キャッチオール パラメーターでは、パス区切り (`/`) 文字を含め、URL の生成にルートが使用されるときに適切な文字がエスケープされます。</span><span class="sxs-lookup"><span data-stu-id="36060-1113">The catch-all parameter escapes the appropriate characters when the route is used to generate a URL, including path separator (`/`) characters.</span></span> <span data-ttu-id="36060-1114">たとえば、ルート値が `{ path = "my/path" }` のルート `foo/{*path}` では、`foo/my%2Fpath` が生成されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1114">For example, the route `foo/{*path}` with route values `{ path = "my/path" }` generates `foo/my%2Fpath`.</span></span> <span data-ttu-id="36060-1115">エスケープされたスラッシュに注意してください。</span><span class="sxs-lookup"><span data-stu-id="36060-1115">Note the escaped forward slash.</span></span> <span data-ttu-id="36060-1116">パス区切り文字をラウンドトリップさせるには、`**` ルート パラメーター プレフィックスを使用します。</span><span class="sxs-lookup"><span data-stu-id="36060-1116">To round-trip path separator characters, use the `**` route parameter prefix.</span></span> <span data-ttu-id="36060-1117">`{ path = "my/path" }` のルート `foo/{**path}` では、`foo/my/path` が生成されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1117">The route `foo/{**path}` with `{ path = "my/path" }` generates `foo/my/path`.</span></span>

<span data-ttu-id="36060-1118">ルート パラメーターには、*既定値* が含まれることがあります。パラメーター名の後に既定値を指定し、等号 (`=`) で区切ることで指定されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1118">Route parameters may have *default values* designated by specifying the default value after the parameter name separated by an equals sign (`=`).</span></span> <span data-ttu-id="36060-1119">たとえば、`{controller=Home}` では、`controller` の既定値として `Home` が定義されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1119">For example, `{controller=Home}` defines `Home` as the default value for `controller`.</span></span> <span data-ttu-id="36060-1120">パラメーターの URL に値がない場合、既定値が使用されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1120">The default value is used if no value is present in the URL for the parameter.</span></span> <span data-ttu-id="36060-1121">ルート パラメーターは、`id?` のように、パラメーター名の終わりに疑問符 (`?`) を追加することでオプションとして扱われます。</span><span class="sxs-lookup"><span data-stu-id="36060-1121">Route parameters are made optional by appending a question mark (`?`) to the end of the parameter name, as in `id?`.</span></span> <span data-ttu-id="36060-1122">オプション値と既定ルート パラメーターの違いは、既定値を含むルート パラメーターは常に値を生成するのに対し、オプションのパラメーターには、要求 URL によって値が指定されたときにのみ値が与えられることにあります。</span><span class="sxs-lookup"><span data-stu-id="36060-1122">The difference between optional values and default route parameters is that a route parameter with a default value always produces a value&mdash;an optional parameter has a value only when a value is provided by the request URL.</span></span>

<span data-ttu-id="36060-1123">ルート パラメーターには、URL からバインドされるルート値に一致しなければならないという制約が含まれることがあります。</span><span class="sxs-lookup"><span data-stu-id="36060-1123">Route parameters may have constraints that must match the route value bound from the URL.</span></span> <span data-ttu-id="36060-1124">コロン (`:`) と制約名をルート パラメーター名の後に追加すると、ルート パラメーターの*インライン制約*が指定されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1124">Adding a colon (`:`) and constraint name after the route parameter name specifies an *inline constraint* on a route parameter.</span></span> <span data-ttu-id="36060-1125">その制約で引数が要求される場合、制約名の後にかっこ (`(...)`) で囲まれます。</span><span class="sxs-lookup"><span data-stu-id="36060-1125">If the constraint requires arguments, they're enclosed in parentheses (`(...)`) after the constraint name.</span></span> <span data-ttu-id="36060-1126">別のコロン (`:`) と制約名を追加することで、複数のインライン制約を指定できます。</span><span class="sxs-lookup"><span data-stu-id="36060-1126">Multiple inline constraints can be specified by appending another colon (`:`) and constraint name.</span></span>

<span data-ttu-id="36060-1127">制約名と引数が <xref:Microsoft.AspNetCore.Routing.IInlineConstraintResolver> サービスに渡され、URL 処理で使用する <xref:Microsoft.AspNetCore.Routing.IRouteConstraint> のインスタンスが作成されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1127">The constraint name and arguments are passed to the <xref:Microsoft.AspNetCore.Routing.IInlineConstraintResolver> service to create an instance of <xref:Microsoft.AspNetCore.Routing.IRouteConstraint> to use in URL processing.</span></span> <span data-ttu-id="36060-1128">たとえば、ルート テンプレート `blog/{article:minlength(10)}` によって、制約 `minlength` と引数 `10` が指定されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1128">For example, the route template `blog/{article:minlength(10)}` specifies a `minlength` constraint with the argument `10`.</span></span> <span data-ttu-id="36060-1129">ルート制約の詳細とこのフレームワークによって指定される制約のリストについては、「[ルート制約参照](#route-constraint-reference)」セクションを参照してください。</span><span class="sxs-lookup"><span data-stu-id="36060-1129">For more information on route constraints and a list of the constraints provided by the framework, see the [Route constraint reference](#route-constraint-reference) section.</span></span>

<span data-ttu-id="36060-1130">ルート パラメーターには、リンクを生成し、ページおよびアクションを URL と一致させるときにパラメーターの値を変換する、パラメーター トランスフォーマーが含まれている場合もあります。</span><span class="sxs-lookup"><span data-stu-id="36060-1130">Route parameters may also have parameter transformers, which transform a parameter's value when generating links and matching actions and pages to URLs.</span></span> <span data-ttu-id="36060-1131">制約と同様に、パラメーター トランスフォーマーをルート パラメーターにインラインで追加することができます。その場合、ルート パラメーター名の後にコロン (`:`) とトランスフォーマー名を追加します。</span><span class="sxs-lookup"><span data-stu-id="36060-1131">Like constraints, parameter transformers can be added inline to a route parameter by adding a colon (`:`) and transformer name after the route parameter name.</span></span> <span data-ttu-id="36060-1132">たとえば、ルート テンプレート `blog/{article:slugify}` では、`slugify` トランスフォーマーが指定されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1132">For example, the route template `blog/{article:slugify}` specifies a `slugify` transformer.</span></span> <span data-ttu-id="36060-1133">パラメーター トランスフォーマーの詳細については、「[パラメーター トランスフォーマー参照](#parameter-transformer-reference)」セクションを参照してください。</span><span class="sxs-lookup"><span data-stu-id="36060-1133">For more information on parameter transformers, see the [Parameter transformer reference](#parameter-transformer-reference) section.</span></span>

<span data-ttu-id="36060-1134">次の表は、ルート テンプレートの例とその動作をまとめたものです。</span><span class="sxs-lookup"><span data-stu-id="36060-1134">The following table demonstrates example route templates and their behavior.</span></span>

| <span data-ttu-id="36060-1135">ルート テンプレート</span><span class="sxs-lookup"><span data-stu-id="36060-1135">Route Template</span></span>                           | <span data-ttu-id="36060-1136">一致する URI の例</span><span class="sxs-lookup"><span data-stu-id="36060-1136">Example Matching URI</span></span>    | <span data-ttu-id="36060-1137">要求 URI&hellip;</span><span class="sxs-lookup"><span data-stu-id="36060-1137">The request URI&hellip;</span></span>                                                    |
| ---------------------------------------- | ----------------------- | -------------------------------------------------------------------------- |
| `hello`                                  | `/hello`                | <span data-ttu-id="36060-1138">単一パス `/hello` にのみ一致します。</span><span class="sxs-lookup"><span data-stu-id="36060-1138">Only matches the single path `/hello`.</span></span>                                     |
| `{Page=Home}`                            | `/`                     | <span data-ttu-id="36060-1139">一致し、`Page` が `Home` に設定されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1139">Matches and sets `Page` to `Home`.</span></span>                                         |
| `{Page=Home}`                            | `/Contact`              | <span data-ttu-id="36060-1140">一致し、`Page` が `Contact` に設定されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1140">Matches and sets `Page` to `Contact`.</span></span>                                      |
| `{controller}/{action}/{id?}`            | `/Products/List`        | <span data-ttu-id="36060-1141">`Products` コントローラーと `List` アクションにマッピングされます。</span><span class="sxs-lookup"><span data-stu-id="36060-1141">Maps to the `Products` controller and `List` action.</span></span>                       |
| `{controller}/{action}/{id?}`            | `/Products/Details/123` | <span data-ttu-id="36060-1142">`Products` コントローラーと `Details` アクションにマッピングされます (`id` は 123 に設定されます)。</span><span class="sxs-lookup"><span data-stu-id="36060-1142">Maps to the `Products` controller and  `Details` action (`id` set to 123).</span></span> |
| `{controller=Home}/{action=Index}/{id?}` | `/`                     | <span data-ttu-id="36060-1143">`Home` コントローラーと `Index` メソッドにマッピングされます (`id` は無視されます)。</span><span class="sxs-lookup"><span data-stu-id="36060-1143">Maps to the `Home` controller and `Index` method (`id` is ignored).</span></span>        |

<span data-ttu-id="36060-1144">一般的に、テンプレートの利用が最も簡単なルーティングの手法となります。</span><span class="sxs-lookup"><span data-stu-id="36060-1144">Using a template is generally the simplest approach to routing.</span></span> <span data-ttu-id="36060-1145">ルート テンプレート以外では、制約と既定値も指定できます。</span><span class="sxs-lookup"><span data-stu-id="36060-1145">Constraints and defaults can also be specified outside the route template.</span></span>

> [!TIP]
> <span data-ttu-id="36060-1146">[ログ](xref:fundamentals/logging/index)を有効にすると、<xref:Microsoft.AspNetCore.Routing.Route> など、組み込みのルーティング実装で要求を照合するしくみを確認できます。</span><span class="sxs-lookup"><span data-stu-id="36060-1146">Enable [Logging](xref:fundamentals/logging/index) to see how the built-in routing implementations, such as <xref:Microsoft.AspNetCore.Routing.Route>, match requests.</span></span>

## <a name="reserved-routing-names"></a><span data-ttu-id="36060-1147">ルーティングの予約名</span><span class="sxs-lookup"><span data-stu-id="36060-1147">Reserved routing names</span></span>

<span data-ttu-id="36060-1148">次のキーワードは予約名であり、ルート名やパラメーターとして使用できません。</span><span class="sxs-lookup"><span data-stu-id="36060-1148">The following keywords are reserved names and can't be used as route names or parameters:</span></span>

* `action`
* `area`
* `controller`
* `handler`
* `page`

## <a name="route-constraint-reference"></a><span data-ttu-id="36060-1149">ルート制約参照</span><span class="sxs-lookup"><span data-stu-id="36060-1149">Route constraint reference</span></span>

<span data-ttu-id="36060-1150">ルート制約は、受信 URL と一致し、URL パスがルート値にトークン化されたときに実行されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1150">Route constraints execute when a match has occurred to the incoming URL and the URL path is tokenized into route values.</span></span> <span data-ttu-id="36060-1151">ルート制約では、通常、ルート テンプレート経由で関連付けられるルート値を調べ、値が許容できるかどうかをはい/いいえで決定します。</span><span class="sxs-lookup"><span data-stu-id="36060-1151">Route constraints generally inspect the route value associated via the route template and make a yes/no decision about whether or not the value is acceptable.</span></span> <span data-ttu-id="36060-1152">一部のルート制約では、ルート値以外のデータを使用し、要求をルーティングできるかどうかが考慮されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1152">Some route constraints use data outside the route value to consider whether the request can be routed.</span></span> <span data-ttu-id="36060-1153">たとえば、<xref:Microsoft.AspNetCore.Routing.Constraints.HttpMethodRouteConstraint> はその HTTP Verb に基づいて要求を承認または却下します。</span><span class="sxs-lookup"><span data-stu-id="36060-1153">For example, the <xref:Microsoft.AspNetCore.Routing.Constraints.HttpMethodRouteConstraint> can accept or reject a request based on its HTTP verb.</span></span> <span data-ttu-id="36060-1154">制約は、要求のルーティングとリンクの生成で使用されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1154">Constraints are used in routing requests and link generation.</span></span>

> [!WARNING]
> <span data-ttu-id="36060-1155">**入力の検証**には制約を使用しないでください。</span><span class="sxs-lookup"><span data-stu-id="36060-1155">Don't use constraints for **input validation**.</span></span> <span data-ttu-id="36060-1156">**入力の検証**に制約が使用されると、無効な入力の結果、*400 - Bad Request* と適切なエラー メッセージではなく、*404 - Not Found* が表示されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1156">If constraints are used for **input validation**, invalid input results in a *404 - Not Found* response instead of a *400 - Bad Request* with an appropriate error message.</span></span> <span data-ttu-id="36060-1157">ルート制約は、特定のルートに対する入力の妥当性を検証するためではなく、似たようなルートの**違いを明らかにする**ために使用されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1157">Route constraints are used to **disambiguate** similar routes, not to validate the inputs for a particular route.</span></span>

<span data-ttu-id="36060-1158">次の表は、ルート制約の例とそれに求められる動作をまとめたものです。</span><span class="sxs-lookup"><span data-stu-id="36060-1158">The following table demonstrates example route constraints and their expected behavior.</span></span>

| <span data-ttu-id="36060-1159">制約</span><span class="sxs-lookup"><span data-stu-id="36060-1159">Constraint</span></span> | <span data-ttu-id="36060-1160">例</span><span class="sxs-lookup"><span data-stu-id="36060-1160">Example</span></span> | <span data-ttu-id="36060-1161">一致の例</span><span class="sxs-lookup"><span data-stu-id="36060-1161">Example matches</span></span> | <span data-ttu-id="36060-1162">メモ</span><span class="sxs-lookup"><span data-stu-id="36060-1162">Notes</span></span> |
|------------|---------|-----------------|-------|
| `int` | `{id:int}` | <span data-ttu-id="36060-1163">`123456789`、`-123456789`</span><span class="sxs-lookup"><span data-stu-id="36060-1163">`123456789`, `-123456789`</span></span> | <span data-ttu-id="36060-1164">任意の整数と一致します。</span><span class="sxs-lookup"><span data-stu-id="36060-1164">Matches any integer.</span></span>|
| `bool` | `{active:bool}` | <span data-ttu-id="36060-1165">`true`、`FALSE`</span><span class="sxs-lookup"><span data-stu-id="36060-1165">`true`, `FALSE`</span></span> | <span data-ttu-id="36060-1166">`true` または `false` に一致する。</span><span class="sxs-lookup"><span data-stu-id="36060-1166">Matches `true` or `false`.</span></span> <span data-ttu-id="36060-1167">大文字と小文字は区別されません</span><span class="sxs-lookup"><span data-stu-id="36060-1167">Case-insensitive.</span></span>|
| `datetime` | `{dob:datetime}` | <span data-ttu-id="36060-1168">`2016-12-31`、`2016-12-31 7:32pm`</span><span class="sxs-lookup"><span data-stu-id="36060-1168">`2016-12-31`, `2016-12-31 7:32pm`</span></span> | <span data-ttu-id="36060-1169">インバリアント カルチャの有効な `DateTime` 値に一致します。</span><span class="sxs-lookup"><span data-stu-id="36060-1169">Matches a valid `DateTime` value in the invariant culture.</span></span> <span data-ttu-id="36060-1170">前の警告を参照してください。</span><span class="sxs-lookup"><span data-stu-id="36060-1170">See preceding warning.</span></span>|
| `decimal` | `{price:decimal}` | <span data-ttu-id="36060-1171">`49.99`、`-1,000.01`</span><span class="sxs-lookup"><span data-stu-id="36060-1171">`49.99`, `-1,000.01`</span></span> | <span data-ttu-id="36060-1172">インバリアント カルチャの有効な `decimal` 値に一致します。</span><span class="sxs-lookup"><span data-stu-id="36060-1172">Matches a valid `decimal` value in the invariant culture.</span></span> <span data-ttu-id="36060-1173">前の警告を参照してください。</span><span class="sxs-lookup"><span data-stu-id="36060-1173">See  preceding warning.</span></span>|
| `double` | `{weight:double}` | <span data-ttu-id="36060-1174">`1.234`、`-1,001.01e8`</span><span class="sxs-lookup"><span data-stu-id="36060-1174">`1.234`, `-1,001.01e8`</span></span> | <span data-ttu-id="36060-1175">インバリアント カルチャの有効な `double` 値に一致します。</span><span class="sxs-lookup"><span data-stu-id="36060-1175">Matches a valid `double` value in the invariant culture.</span></span> <span data-ttu-id="36060-1176">前の警告を参照してください。</span><span class="sxs-lookup"><span data-stu-id="36060-1176">See  preceding warning.</span></span>|
| `float` | `{weight:float}` | <span data-ttu-id="36060-1177">`1.234`、`-1,001.01e8`</span><span class="sxs-lookup"><span data-stu-id="36060-1177">`1.234`, `-1,001.01e8`</span></span> | <span data-ttu-id="36060-1178">インバリアント カルチャの有効な `float` 値に一致します。</span><span class="sxs-lookup"><span data-stu-id="36060-1178">Matches a valid `float` value in the invariant culture.</span></span> <span data-ttu-id="36060-1179">前の警告を参照してください。</span><span class="sxs-lookup"><span data-stu-id="36060-1179">See  preceding warning.</span></span>|
| `guid` | `{id:guid}` | <span data-ttu-id="36060-1180">`CD2C1638-1638-72D5-1638-DEADBEEF1638`、`{CD2C1638-1638-72D5-1638-DEADBEEF1638}`</span><span class="sxs-lookup"><span data-stu-id="36060-1180">`CD2C1638-1638-72D5-1638-DEADBEEF1638`, `{CD2C1638-1638-72D5-1638-DEADBEEF1638}`</span></span> | <span data-ttu-id="36060-1181">有効な `Guid` 値に一致します。</span><span class="sxs-lookup"><span data-stu-id="36060-1181">Matches a valid `Guid` value.</span></span>|
| `long` | `{ticks:long}` | <span data-ttu-id="36060-1182">`123456789`、`-123456789`</span><span class="sxs-lookup"><span data-stu-id="36060-1182">`123456789`, `-123456789`</span></span> | <span data-ttu-id="36060-1183">有効な `long` 値に一致します。</span><span class="sxs-lookup"><span data-stu-id="36060-1183">Matches a valid `long` value.</span></span>|
| `minlength(value)` | `{username:minlength(4)}` | `Rick` | <span data-ttu-id="36060-1184">4 文字以上の文字列であることが必要です。</span><span class="sxs-lookup"><span data-stu-id="36060-1184">String must be at least 4 characters.</span></span>|
| `maxlength(value)` | `{filename:maxlength(8)}` | `MyFile` | <span data-ttu-id="36060-1185">文字列の長さは最大 8 文字です。</span><span class="sxs-lookup"><span data-stu-id="36060-1185">String has maximum of 8 characters.</span></span>|
| `length(length)` | `{filename:length(12)}` | `somefile.txt` | <span data-ttu-id="36060-1186">厳密に 12 文字の文字列であることが必要です。</span><span class="sxs-lookup"><span data-stu-id="36060-1186">String must be exactly 12 characters long.</span></span>|
| `length(min,max)` | `{filename:length(8,16)}` | `somefile.txt` | <span data-ttu-id="36060-1187">文字列の長さは 8 文字以上、最大で 16 文字とする必要があります。</span><span class="sxs-lookup"><span data-stu-id="36060-1187">String must be at least 8 and has maximum of 16 characters.</span></span>|
| `min(value)` | `{age:min(18)}` | `19` | <span data-ttu-id="36060-1188">18 以上の整数値であることが必要です。</span><span class="sxs-lookup"><span data-stu-id="36060-1188">Integer value must be at least 18.</span></span>|
| `max(value)` | `{age:max(120)}` | `91` | <span data-ttu-id="36060-1189">最大値が 120 の整数値。</span><span class="sxs-lookup"><span data-stu-id="36060-1189">Integer value maximum of 120.</span></span>|
| `range(min,max)` | `{age:range(18,120)}` | `91` | <span data-ttu-id="36060-1190">整数値は 18 以上、最大で 120 とする必要があります。</span><span class="sxs-lookup"><span data-stu-id="36060-1190">Integer value must be at least 18 and maximum of 120.</span></span>|
| `alpha` | `{name:alpha}` | `Rick` | <span data-ttu-id="36060-1191">文字列は、1 つまたは複数のアルファベット文字 (`a`-`z`) で構成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="36060-1191">String must consist of one or more alphabetical characters `a`-`z`.</span></span> <span data-ttu-id="36060-1192">大文字と小文字は区別されません</span><span class="sxs-lookup"><span data-stu-id="36060-1192">Case-insensitive.</span></span>|
| `regex(expression)` | `{ssn:regex(^\\d{{3}}-\\d{{2}}-\\d{{4}}$)}` | `123-45-6789` | <span data-ttu-id="36060-1193">文字列は正規表現と一致する必要があります。</span><span class="sxs-lookup"><span data-stu-id="36060-1193">String must match the regular expression.</span></span> <span data-ttu-id="36060-1194">正規表現の定義に関するヒントを参照してください。</span><span class="sxs-lookup"><span data-stu-id="36060-1194">See tips about defining a regular expression.</span></span>|
| `required` | `{name:required}` | `Rick` | <span data-ttu-id="36060-1195">URL 生成中、非パラメーターが提示されるように強制するために使用されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1195">Used to enforce that a non-parameter value is present during URL generation.</span></span>|

<span data-ttu-id="36060-1196">コロンで区切られた複数の制約を単一のパラメーターに適用することができます。</span><span class="sxs-lookup"><span data-stu-id="36060-1196">Multiple, colon-delimited constraints can be applied to a single parameter.</span></span> <span data-ttu-id="36060-1197">たとえば、次の制約では、パラメーターが 1 以上の整数値に制限されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1197">For example, the following constraint restricts a parameter to an integer value of 1 or greater:</span></span>

```csharp
[Route("users/{id:int:min(1)}")]
public User GetUserById(int id) { }
```

> [!WARNING]
> <span data-ttu-id="36060-1198">URL の妥当性を検証し、CLR 型 (`int` や `DateTime` など) に変換されるルート制約では、常にインバリアント カルチャが使用されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1198">Route constraints that verify the URL and are converted to a CLR type (such as `int` or `DateTime`) always use the invariant culture.</span></span> <span data-ttu-id="36060-1199">これらの制約では、URL がローカライズ不可であることが前提となります。</span><span class="sxs-lookup"><span data-stu-id="36060-1199">These constraints assume that the URL is non-localizable.</span></span> <span data-ttu-id="36060-1200">フレームワークから提供されるルート制約がルート値に格納されている値を変更することはありません。</span><span class="sxs-lookup"><span data-stu-id="36060-1200">The framework-provided route constraints don't modify the values stored in route values.</span></span> <span data-ttu-id="36060-1201">URL から解析されたルート値はすべて文字列として格納されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1201">All route values parsed from the URL are stored as strings.</span></span> <span data-ttu-id="36060-1202">たとえば、`float` 制約はルート値を浮動小数に変換しますが、変換された値は、浮動小数に変換できることを検証するためにだけ利用されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1202">For example, the `float` constraint attempts to convert the route value to a float, but the converted value is used only to verify it can be converted to a float.</span></span>

## <a name="regular-expressions"></a><span data-ttu-id="36060-1203">正規表現</span><span class="sxs-lookup"><span data-stu-id="36060-1203">Regular expressions</span></span>

<span data-ttu-id="36060-1204">ASP.NET Core フレームワークでは、正規表現コンストラクターに `RegexOptions.IgnoreCase | RegexOptions.Compiled | RegexOptions.CultureInvariant` が追加されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1204">The ASP.NET Core framework adds `RegexOptions.IgnoreCase | RegexOptions.Compiled | RegexOptions.CultureInvariant` to the regular expression constructor.</span></span> <span data-ttu-id="36060-1205">これらのメンバーの詳細については、「<xref:System.Text.RegularExpressions.RegexOptions>」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="36060-1205">See <xref:System.Text.RegularExpressions.RegexOptions> for a description of these members.</span></span>

<span data-ttu-id="36060-1206">正規表現では、ルーティングや C# 言語で使用されるものに似た区切り記号とトークンが使用されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1206">Regular expressions use delimiters and tokens similar to those used by routing and the C# language.</span></span> <span data-ttu-id="36060-1207">正規表現トークンはエスケープする必要があります。</span><span class="sxs-lookup"><span data-stu-id="36060-1207">Regular expression tokens must be escaped.</span></span> <span data-ttu-id="36060-1208">ルーティングで正規表現 `^\d{3}-\d{2}-\d{4}$` を使用するには、次のようにします。</span><span class="sxs-lookup"><span data-stu-id="36060-1208">To use the regular expression `^\d{3}-\d{2}-\d{4}$` in routing:</span></span>

* <span data-ttu-id="36060-1209">表現の場合、文字列内に指定された単一の円記号 `\` 文字を、ソース コード内で二重円記号 `\\` 文字とする必要があります。</span><span class="sxs-lookup"><span data-stu-id="36060-1209">The expression must have the single backslash `\` characters provided in the string as double backslash `\\` characters in the source code.</span></span>
* <span data-ttu-id="36060-1210">正規表現では、文字列エスケープ文字 `\` をエスケープするためには `\\` を使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="36060-1210">The regular expression must us `\\` in order to escape the `\` string escape character.</span></span>
* <span data-ttu-id="36060-1211">正規表現では、[逐語的文字列リテラル](/dotnet/csharp/language-reference/keywords/string)を使用する場合、`\\` を必要としません。</span><span class="sxs-lookup"><span data-stu-id="36060-1211">The regular expression doesn't require `\\` when using [verbatim string literals](/dotnet/csharp/language-reference/keywords/string).</span></span>

<span data-ttu-id="36060-1212">ルーティング パラメーター区切り記号文字である `{`、`}`、`[`、`]` をエスケープするには、`{{`、`}`、`[[`、`]]` のように表現の文字を二重にします。</span><span class="sxs-lookup"><span data-stu-id="36060-1212">To escape routing parameter delimiter characters `{`, `}`, `[`, `]`, double the characters in the expression `{{`, `}`, `[[`, `]]`.</span></span> <span data-ttu-id="36060-1213">次の表に、正規表現とエスケープ適用後のものを示します。</span><span class="sxs-lookup"><span data-stu-id="36060-1213">The following table shows a regular expression and the escaped version:</span></span>

| <span data-ttu-id="36060-1214">正規表現</span><span class="sxs-lookup"><span data-stu-id="36060-1214">Regular Expression</span></span>    | <span data-ttu-id="36060-1215">エスケープ適用後の正規表現</span><span class="sxs-lookup"><span data-stu-id="36060-1215">Escaped Regular Expression</span></span>     |
| --------------------- | ------------------------------ |
| `^\d{3}-\d{2}-\d{4}$` | `^\\d{{3}}-\\d{{2}}-\\d{{4}}$` |
| `^[a-z]{2}$`          | `^[[a-z]]{{2}}$`               |

<span data-ttu-id="36060-1216">ルーティングで使用される正規表現は、多くの場合、キャレット文字 `^` で始まり、文字列の開始位置と一致します。</span><span class="sxs-lookup"><span data-stu-id="36060-1216">Regular expressions used in routing often start with the caret `^` character and match starting position of the string.</span></span> <span data-ttu-id="36060-1217">表現は、多くの場合、ドル記号 `$` で終わり、文字列の末尾と一致します。</span><span class="sxs-lookup"><span data-stu-id="36060-1217">The expressions often end with the dollar sign `$` character and match end of the string.</span></span> <span data-ttu-id="36060-1218">`^` 文字と `$` 文字により、正規表現はルート パラメーター値全体に一致します。</span><span class="sxs-lookup"><span data-stu-id="36060-1218">The `^` and `$` characters ensure that the regular expression match the entire route parameter value.</span></span> <span data-ttu-id="36060-1219">`^` 文字と `$` 文字がなければ、正規表現は、文字列内のあらゆる部分文字列に一致します。それは多くの場合、意図に反することです。</span><span class="sxs-lookup"><span data-stu-id="36060-1219">Without the `^` and `$` characters, the regular expression match any substring within the string, which is often undesirable.</span></span> <span data-ttu-id="36060-1220">下の表では例を示し、それらが一致する、または一致しない理由について説明します。</span><span class="sxs-lookup"><span data-stu-id="36060-1220">The following table provides examples and explains why they match or fail to match.</span></span>

| <span data-ttu-id="36060-1221">式</span><span class="sxs-lookup"><span data-stu-id="36060-1221">Expression</span></span>   | <span data-ttu-id="36060-1222">String</span><span class="sxs-lookup"><span data-stu-id="36060-1222">String</span></span>    | <span data-ttu-id="36060-1223">一致したもの</span><span class="sxs-lookup"><span data-stu-id="36060-1223">Match</span></span> | <span data-ttu-id="36060-1224">コメント</span><span class="sxs-lookup"><span data-stu-id="36060-1224">Comment</span></span>               |
| ------------ | --------- | :---: |  -------------------- |
| `[a-z]{2}`   | <span data-ttu-id="36060-1225">hello</span><span class="sxs-lookup"><span data-stu-id="36060-1225">hello</span></span>     | <span data-ttu-id="36060-1226">はい</span><span class="sxs-lookup"><span data-stu-id="36060-1226">Yes</span></span>   | <span data-ttu-id="36060-1227">サブ文字列の一致</span><span class="sxs-lookup"><span data-stu-id="36060-1227">Substring matches</span></span>     |
| `[a-z]{2}`   | <span data-ttu-id="36060-1228">123abc456</span><span class="sxs-lookup"><span data-stu-id="36060-1228">123abc456</span></span> | <span data-ttu-id="36060-1229">はい</span><span class="sxs-lookup"><span data-stu-id="36060-1229">Yes</span></span>   | <span data-ttu-id="36060-1230">サブ文字列の一致</span><span class="sxs-lookup"><span data-stu-id="36060-1230">Substring matches</span></span>     |
| `[a-z]{2}`   | <span data-ttu-id="36060-1231">mz</span><span class="sxs-lookup"><span data-stu-id="36060-1231">mz</span></span>        | <span data-ttu-id="36060-1232">はい</span><span class="sxs-lookup"><span data-stu-id="36060-1232">Yes</span></span>   | <span data-ttu-id="36060-1233">一致する表現</span><span class="sxs-lookup"><span data-stu-id="36060-1233">Matches expression</span></span>    |
| `[a-z]{2}`   | <span data-ttu-id="36060-1234">MZ</span><span class="sxs-lookup"><span data-stu-id="36060-1234">MZ</span></span>        | <span data-ttu-id="36060-1235">はい</span><span class="sxs-lookup"><span data-stu-id="36060-1235">Yes</span></span>   | <span data-ttu-id="36060-1236">大文字と小文字の使い方が違う</span><span class="sxs-lookup"><span data-stu-id="36060-1236">Not case sensitive</span></span>    |
| `^[a-z]{2}$` | <span data-ttu-id="36060-1237">hello</span><span class="sxs-lookup"><span data-stu-id="36060-1237">hello</span></span>     | <span data-ttu-id="36060-1238">いいえ</span><span class="sxs-lookup"><span data-stu-id="36060-1238">No</span></span>    | <span data-ttu-id="36060-1239">上の `^` と `$` を参照</span><span class="sxs-lookup"><span data-stu-id="36060-1239">See `^` and `$` above</span></span> |
| `^[a-z]{2}$` | <span data-ttu-id="36060-1240">123abc456</span><span class="sxs-lookup"><span data-stu-id="36060-1240">123abc456</span></span> | <span data-ttu-id="36060-1241">いいえ</span><span class="sxs-lookup"><span data-stu-id="36060-1241">No</span></span>    | <span data-ttu-id="36060-1242">上の `^` と `$` を参照</span><span class="sxs-lookup"><span data-stu-id="36060-1242">See `^` and `$` above</span></span> |

<span data-ttu-id="36060-1243">正規表現構文の詳細については、[.NET Framework 正規表現](/dotnet/standard/base-types/regular-expression-language-quick-reference)に関するページを参照してください。</span><span class="sxs-lookup"><span data-stu-id="36060-1243">For more information on regular expression syntax, see [.NET Framework Regular Expressions](/dotnet/standard/base-types/regular-expression-language-quick-reference).</span></span>

<span data-ttu-id="36060-1244">既知の入力可能値の集まりにパラメーターを制限するには、正規表現を使用します。</span><span class="sxs-lookup"><span data-stu-id="36060-1244">To constrain a parameter to a known set of possible values, use a regular expression.</span></span> <span data-ttu-id="36060-1245">たとえば、`{action:regex(^(list|get|create)$)}` の場合、`action` ルート値は `list`、`get`、`create` とのみ照合されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1245">For example, `{action:regex(^(list|get|create)$)}` only matches the `action` route value to `list`, `get`, or `create`.</span></span> <span data-ttu-id="36060-1246">制約ディクショナリに渡された場合、文字列 `^(list|get|create)$` で同じものになります。</span><span class="sxs-lookup"><span data-stu-id="36060-1246">If passed into the constraints dictionary, the string `^(list|get|create)$` is equivalent.</span></span> <span data-ttu-id="36060-1247">(テンプレート内でインラインではなく) 制約ディクショナリに渡された制約が既知の制約に一致しない場合も、正規表現として扱われます。</span><span class="sxs-lookup"><span data-stu-id="36060-1247">Constraints that are passed in the constraints dictionary (not inline within a template) that don't match one of the known constraints are also treated as regular expressions.</span></span>

## <a name="custom-route-constraints"></a><span data-ttu-id="36060-1248">カスタム ルート制約</span><span class="sxs-lookup"><span data-stu-id="36060-1248">Custom route constraints</span></span>

<span data-ttu-id="36060-1249">組み込みのルート制約だけでなく、<xref:Microsoft.AspNetCore.Routing.IRouteConstraint> インターフェイスを実装してカスタム ルート制約を作成することができます。</span><span class="sxs-lookup"><span data-stu-id="36060-1249">In addition to the built-in route constraints, custom route constraints can be created by implementing the <xref:Microsoft.AspNetCore.Routing.IRouteConstraint> interface.</span></span> <span data-ttu-id="36060-1250"><xref:Microsoft.AspNetCore.Routing.IRouteConstraint> インターフェイスには、1 つのメソッド `Match` が含まれています。これは、制約が満たされている場合は `true` を、それ以外の場合は `false` を返します。</span><span class="sxs-lookup"><span data-stu-id="36060-1250">The <xref:Microsoft.AspNetCore.Routing.IRouteConstraint> interface contains a single method, `Match`, which returns `true` if the constraint is satisfied and `false` otherwise.</span></span>

<span data-ttu-id="36060-1251">カスタムの <xref:Microsoft.AspNetCore.Routing.IRouteConstraint> を使うには、アプリのサービス コンテナー内にあるアプリの <xref:Microsoft.AspNetCore.Routing.RouteOptions.ConstraintMap> に、ルート制約の種類を登録する必要があります。</span><span class="sxs-lookup"><span data-stu-id="36060-1251">To use a custom <xref:Microsoft.AspNetCore.Routing.IRouteConstraint>, the route constraint type must be registered with the app's <xref:Microsoft.AspNetCore.Routing.RouteOptions.ConstraintMap> in the app's service container.</span></span> <span data-ttu-id="36060-1252"><xref:Microsoft.AspNetCore.Routing.RouteOptions.ConstraintMap> は、ルート制約キーを、その制約を検証する <xref:Microsoft.AspNetCore.Routing.IRouteConstraint> の実装にマッピングするディクショナリです。</span><span class="sxs-lookup"><span data-stu-id="36060-1252">A <xref:Microsoft.AspNetCore.Routing.RouteOptions.ConstraintMap> is a dictionary that maps route constraint keys to <xref:Microsoft.AspNetCore.Routing.IRouteConstraint> implementations that validate those constraints.</span></span> <span data-ttu-id="36060-1253">アプリの <xref:Microsoft.AspNetCore.Routing.RouteOptions.ConstraintMap> は、`Startup.ConfigureServices` で、[services.AddRouting](xref:Microsoft.Extensions.DependencyInjection.RoutingServiceCollectionExtensions.AddRouting*) 呼び出しの一部として、または `services.Configure<RouteOptions>` を使って <xref:Microsoft.AspNetCore.Routing.RouteOptions> を直接構成することで、更新できます。</span><span class="sxs-lookup"><span data-stu-id="36060-1253">An app's <xref:Microsoft.AspNetCore.Routing.RouteOptions.ConstraintMap> can be updated in `Startup.ConfigureServices` either as part of a [services.AddRouting](xref:Microsoft.Extensions.DependencyInjection.RoutingServiceCollectionExtensions.AddRouting*) call or by configuring <xref:Microsoft.AspNetCore.Routing.RouteOptions> directly with `services.Configure<RouteOptions>`.</span></span> <span data-ttu-id="36060-1254">次に例を示します。</span><span class="sxs-lookup"><span data-stu-id="36060-1254">For example:</span></span>

```csharp
services.AddRouting(options =>
{
    options.ConstraintMap.Add("customName", typeof(MyCustomConstraint));
});
```

<span data-ttu-id="36060-1255">これで、制約の種類を登録するときに指定した名前を使って、通常の方法でルートに制約を適用できます。</span><span class="sxs-lookup"><span data-stu-id="36060-1255">The constraint can then be applied to routes in the usual manner, using the name specified when registering the constraint type.</span></span> <span data-ttu-id="36060-1256">次に例を示します。</span><span class="sxs-lookup"><span data-stu-id="36060-1256">For example:</span></span>

```csharp
[HttpGet("{id:customName}")]
public ActionResult<string> Get(string id)
```

## <a name="parameter-transformer-reference"></a><span data-ttu-id="36060-1257">パラメーター トランスフォーマー参照</span><span class="sxs-lookup"><span data-stu-id="36060-1257">Parameter transformer reference</span></span>

<span data-ttu-id="36060-1258">パラメーター トランスフォーマー:</span><span class="sxs-lookup"><span data-stu-id="36060-1258">Parameter transformers:</span></span>

* <span data-ttu-id="36060-1259"><xref:Microsoft.AspNetCore.Routing.Route> のリンクの生成時に実行されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1259">Execute when generating a link for a <xref:Microsoft.AspNetCore.Routing.Route>.</span></span>
* <span data-ttu-id="36060-1260">`Microsoft.AspNetCore.Routing.IOutboundParameterTransformer`を実装します。</span><span class="sxs-lookup"><span data-stu-id="36060-1260">Implement `Microsoft.AspNetCore.Routing.IOutboundParameterTransformer`.</span></span>
* <span data-ttu-id="36060-1261"><xref:Microsoft.AspNetCore.Routing.RouteOptions.ConstraintMap> を使用して構成されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1261">Are configured using <xref:Microsoft.AspNetCore.Routing.RouteOptions.ConstraintMap>.</span></span>
* <span data-ttu-id="36060-1262">パラメーターのルート値を取得し、それを新しい文字列値に変換します。</span><span class="sxs-lookup"><span data-stu-id="36060-1262">Take the parameter's route value and transform it to a new string value.</span></span>
* <span data-ttu-id="36060-1263">変換された値は生成されたリンクで使用されるようになります。</span><span class="sxs-lookup"><span data-stu-id="36060-1263">Result in using the transformed value in the generated link.</span></span>

<span data-ttu-id="36060-1264">たとえば、`Url.Action(new { article = "MyTestArticle" })` のルート パターン `blog\{article:slugify}` のカスタム `slugify` パラメーター トランスフォーマーでは、`blog\my-test-article` が生成されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1264">For example, a custom `slugify` parameter transformer in route pattern `blog\{article:slugify}` with `Url.Action(new { article = "MyTestArticle" })` generates `blog\my-test-article`.</span></span>

<span data-ttu-id="36060-1265">ルート パターンでパラメーター トランスフォーマーを使用するには、まず `Startup.ConfigureServices` で <xref:Microsoft.AspNetCore.Routing.RouteOptions.ConstraintMap> を使用してこれを構成します。</span><span class="sxs-lookup"><span data-stu-id="36060-1265">To use a parameter transformer in a route pattern, configure it first using <xref:Microsoft.AspNetCore.Routing.RouteOptions.ConstraintMap> in `Startup.ConfigureServices`:</span></span>

```csharp
services.AddRouting(options =>
{
    // Replace the type and the name used to refer to it with your own
    // IOutboundParameterTransformer implementation
    options.ConstraintMap["slugify"] = typeof(SlugifyParameterTransformer);
});
```

<span data-ttu-id="36060-1266">パラメーター トランスフォーマーは、エンドポイントが解決される URI を変換するためにフレームワークで使用されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1266">Parameter transformers are used by the framework to transform the URI where an endpoint resolves.</span></span> <span data-ttu-id="36060-1267">たとえば、ASP.NET Core MVC ではパラメーター トランスフォーマーを使用して、`area`、`controller`、`action`、`page` を照合するために使用されるルート値を変換します。</span><span class="sxs-lookup"><span data-stu-id="36060-1267">For example, ASP.NET Core MVC uses parameter transformers to transform the route value used to match an `area`, `controller`, `action`, and `page`.</span></span>

```csharp
routes.MapRoute(
    name: "default",
    template: "{controller:slugify=Home}/{action:slugify=Index}/{id?}");
```

<span data-ttu-id="36060-1268">上記のルートでは、アクション `SubscriptionManagementController.GetAll` は URI `/subscription-management/get-all` と一致します。</span><span class="sxs-lookup"><span data-stu-id="36060-1268">With the preceding route, the action `SubscriptionManagementController.GetAll` is matched with the URI `/subscription-management/get-all`.</span></span> <span data-ttu-id="36060-1269">パラメーター トランスフォーマーでは、リンクを生成するために使用されるルート値は変更されません。</span><span class="sxs-lookup"><span data-stu-id="36060-1269">A parameter transformer doesn't change the route values used to generate a link.</span></span> <span data-ttu-id="36060-1270">たとえば、`Url.Action("GetAll", "SubscriptionManagement")` では `/subscription-management/get-all` が出力されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1270">For example, `Url.Action("GetAll", "SubscriptionManagement")` outputs `/subscription-management/get-all`.</span></span>

<span data-ttu-id="36060-1271">ASP.NET Core では、生成されたルートと共にパラメーター トランスフォーマーを使用するための API 規則が提供されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1271">ASP.NET Core provides API conventions for using a parameter transformers with generated routes:</span></span>

* <span data-ttu-id="36060-1272">ASP.NET Core MVC には、`Microsoft.AspNetCore.Mvc.ApplicationModels.RouteTokenTransformerConvention` API 規則が備わっています。</span><span class="sxs-lookup"><span data-stu-id="36060-1272">ASP.NET Core MVC has the `Microsoft.AspNetCore.Mvc.ApplicationModels.RouteTokenTransformerConvention` API convention.</span></span> <span data-ttu-id="36060-1273">この規則では、指定されたパラメーター トランスフォーマーがアプリ内のすべての属性ルートに適用されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1273">This convention applies a specified parameter transformer to all attribute routes in the app.</span></span> <span data-ttu-id="36060-1274">パラメーター トランスフォーマーでは、置き換えられる属性ルート トークンが変換されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1274">The parameter transformer transforms attribute route tokens as they are replaced.</span></span> <span data-ttu-id="36060-1275">詳細については、「[パラメーター トランスフォーマーを使用してトークンの置換をカスタマイズする](/aspnet/core/mvc/controllers/routing#use-a-parameter-transformer-to-customize-token-replacement)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="36060-1275">For more information, see [Use a parameter transformer to customize token replacement](/aspnet/core/mvc/controllers/routing#use-a-parameter-transformer-to-customize-token-replacement).</span></span>
* <span data-ttu-id="36060-1276">Razor Pages には、`Microsoft.AspNetCore.Mvc.ApplicationModels.PageRouteTransformerConvention` API 規則があります。</span><span class="sxs-lookup"><span data-stu-id="36060-1276">Razor Pages has the `Microsoft.AspNetCore.Mvc.ApplicationModels.PageRouteTransformerConvention` API convention.</span></span> <span data-ttu-id="36060-1277">この規則では、指定されたパラメーター トランスフォーマーが、自動で検出されたすべての Razor Pages に適用されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1277">This convention applies a specified parameter transformer to all automatically discovered Razor Pages.</span></span> <span data-ttu-id="36060-1278">パラメーター トランスフォーマーでは、Razor Pages ルートのフォルダーとファイル名のセグメントが変換されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1278">The parameter transformer transforms the folder and file name segments of Razor Pages routes.</span></span> <span data-ttu-id="36060-1279">詳細については、[パラメーター トランスフォーマーを使用したページ ルートのカスタマイズ](/aspnet/core/razor-pages/razor-pages-conventions#use-a-parameter-transformer-to-customize-page-routes)に関する記事をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="36060-1279">For more information, see [Use a parameter transformer to customize page routes](/aspnet/core/razor-pages/razor-pages-conventions#use-a-parameter-transformer-to-customize-page-routes).</span></span>

## <a name="url-generation-reference"></a><span data-ttu-id="36060-1280">URL 生成参照</span><span class="sxs-lookup"><span data-stu-id="36060-1280">URL generation reference</span></span>

<span data-ttu-id="36060-1281">次の例では、ルートのリンクを生成する方法を確認できます。ルート値のディクショナリと <xref:Microsoft.AspNetCore.Routing.RouteCollection> が指定されています。</span><span class="sxs-lookup"><span data-stu-id="36060-1281">The following example shows how to generate a link to a route given a dictionary of route values and a <xref:Microsoft.AspNetCore.Routing.RouteCollection>.</span></span>

[!code-csharp[](routing/samples/2.x/RoutingSample/Startup.cs?name=snippet_Dictionary)]

<span data-ttu-id="36060-1282">上のサンプルの終わりで生成された <xref:Microsoft.AspNetCore.Routing.VirtualPathData.VirtualPath> は `/package/create/123` です。</span><span class="sxs-lookup"><span data-stu-id="36060-1282">The <xref:Microsoft.AspNetCore.Routing.VirtualPathData.VirtualPath> generated at the end of the preceding sample is `/package/create/123`.</span></span> <span data-ttu-id="36060-1283">ディクショナリにより、"Track Package Route" テンプレート `package/{operation}/{id}` のルート値 `operation` と `id` が提供されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1283">The dictionary supplies the `operation` and `id` route values of the "Track Package Route" template, `package/{operation}/{id}`.</span></span> <span data-ttu-id="36060-1284">詳細については、「[ルーティング ミドルウェアの使用](#use-routing-middleware)」セクションのサンプル コードまたは[サンプル アプリ](https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/fundamentals/routing/samples)を参照してください。</span><span class="sxs-lookup"><span data-stu-id="36060-1284">For details, see the sample code in the [Use Routing Middleware](#use-routing-middleware) section or the [sample app](https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/fundamentals/routing/samples).</span></span>

<span data-ttu-id="36060-1285"><xref:Microsoft.AspNetCore.Routing.VirtualPathContext> コンストラクターの 2 番目のパラメーターは*アンビエント値*の集合です。</span><span class="sxs-lookup"><span data-stu-id="36060-1285">The second parameter to the <xref:Microsoft.AspNetCore.Routing.VirtualPathContext> constructor is a collection of *ambient values*.</span></span> <span data-ttu-id="36060-1286">アンビエント値は、開発者が要求コンテキスト内で指定する必要がある値の数が制限されるため、使用すると便利です。</span><span class="sxs-lookup"><span data-stu-id="36060-1286">Ambient values are convenient to use because they limit the number of values a developer must specify within a request context.</span></span> <span data-ttu-id="36060-1287">現在の要求の現在のルート値は、リンク生成の場合、アンビエント値として見なされます。</span><span class="sxs-lookup"><span data-stu-id="36060-1287">The current route values of the current request are considered ambient values for link generation.</span></span> <span data-ttu-id="36060-1288">ASP.NET Core MVC アプリの `HomeController` の `About` アクションでは、コントローラー ルート値を指定し、`Index` アクションにリンクする必要はありません。`Home` のアンビエント値が使用されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1288">In an ASP.NET Core MVC app's `About` action of the `HomeController`, you don't need to specify the controller route value to link to the `Index` action&mdash;the ambient value of `Home` is used.</span></span>

<span data-ttu-id="36060-1289">パラメーターに一致しないアンビエント値は無視されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1289">Ambient values that don't match a parameter are ignored.</span></span> <span data-ttu-id="36060-1290">アンビエント値は、明示的に指定された値でアンビエント値がオーバーライドされる場合にも無視されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1290">Ambient values are also ignored when an explicitly provided value overrides the ambient value.</span></span> <span data-ttu-id="36060-1291">URL では左から右に照合されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1291">Matching occurs from left to right in the URL.</span></span>

<span data-ttu-id="36060-1292">明示的に指定されているが、ルートのセグメントと一致しない値は、クエリ文字列に追加されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1292">Values explicitly provided but that don't match a segment of the route are added to the query string.</span></span> <span data-ttu-id="36060-1293">次の表は、ルート テンプレート `{controller}/{action}/{id?}` の使用時の結果をまとめたものです。</span><span class="sxs-lookup"><span data-stu-id="36060-1293">The following table shows the result when using the route template `{controller}/{action}/{id?}`.</span></span>

| <span data-ttu-id="36060-1294">アンビエント値</span><span class="sxs-lookup"><span data-stu-id="36060-1294">Ambient Values</span></span>                     | <span data-ttu-id="36060-1295">明示的な値</span><span class="sxs-lookup"><span data-stu-id="36060-1295">Explicit Values</span></span>                        | <span data-ttu-id="36060-1296">結果</span><span class="sxs-lookup"><span data-stu-id="36060-1296">Result</span></span>                  |
| ---------------------------------- | -------------------------------------- | ----------------------- |
| <span data-ttu-id="36060-1297">controller = "Home"</span><span class="sxs-lookup"><span data-stu-id="36060-1297">controller = "Home"</span></span>                | <span data-ttu-id="36060-1298">action = "About"</span><span class="sxs-lookup"><span data-stu-id="36060-1298">action = "About"</span></span>                       | `/Home/About`           |
| <span data-ttu-id="36060-1299">controller = "Home"</span><span class="sxs-lookup"><span data-stu-id="36060-1299">controller = "Home"</span></span>                | <span data-ttu-id="36060-1300">controller = "Order", action = "About"</span><span class="sxs-lookup"><span data-stu-id="36060-1300">controller = "Order", action = "About"</span></span> | `/Order/About`          |
| <span data-ttu-id="36060-1301">controller = "Home", color = "Red"</span><span class="sxs-lookup"><span data-stu-id="36060-1301">controller = "Home", color = "Red"</span></span> | <span data-ttu-id="36060-1302">action = "About"</span><span class="sxs-lookup"><span data-stu-id="36060-1302">action = "About"</span></span>                       | `/Home/About`           |
| <span data-ttu-id="36060-1303">controller = "Home"</span><span class="sxs-lookup"><span data-stu-id="36060-1303">controller = "Home"</span></span>                | <span data-ttu-id="36060-1304">action = "About", color = "Red"</span><span class="sxs-lookup"><span data-stu-id="36060-1304">action = "About", color = "Red"</span></span>        | `/Home/About?color=Red` |

<span data-ttu-id="36060-1305">パラメーターに対応しない既定値がルートにあり、その値が明示的に指定される場合、それは既定値に一致する必要があります。</span><span class="sxs-lookup"><span data-stu-id="36060-1305">If a route has a default value that doesn't correspond to a parameter and that value is explicitly provided, it must match the default value:</span></span>

```csharp
routes.MapRoute("blog_route", "blog/{*slug}",
    defaults: new { controller = "Blog", action = "ReadPost" });
```

<span data-ttu-id="36060-1306">リンク生成では、`controller` と `action` について一致する値が指定されるときにのみ、このルートのリンクが生成されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1306">Link generation only generates a link for this route when the matching values for `controller` and `action` are provided.</span></span>

## <a name="complex-segments"></a><span data-ttu-id="36060-1307">複雑なセグメント</span><span class="sxs-lookup"><span data-stu-id="36060-1307">Complex segments</span></span>

<span data-ttu-id="36060-1308">複雑なセグメント (例: `[Route("/x{token}y")]`) は、リテラルを右から左に最短一致の方法で照合することによって処理されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1308">Complex segments (for example `[Route("/x{token}y")]`) are processed by matching up literals from right to left in a non-greedy way.</span></span> <span data-ttu-id="36060-1309">複雑なセグメントの一致方法に関する詳しい説明については、[こちらのコード](https://github.com/dotnet/AspNetCore/blob/release/2.2/src/Http/Routing/src/Patterns/RoutePatternMatcher.cs#L293)をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="36060-1309">See [this code](https://github.com/dotnet/AspNetCore/blob/release/2.2/src/Http/Routing/src/Patterns/RoutePatternMatcher.cs#L293) for a detailed explanation of how complex segments are matched.</span></span> <span data-ttu-id="36060-1310">この[コード サンプル](https://github.com/dotnet/AspNetCore/blob/release/2.2/src/Http/Routing/src/Patterns/RoutePatternMatcher.cs#L293)は ASP.NET Core では使われていませんが、複雑なセグメントに関する優れた説明が提供されています。</span><span class="sxs-lookup"><span data-stu-id="36060-1310">The [code sample](https://github.com/dotnet/AspNetCore/blob/release/2.2/src/Http/Routing/src/Patterns/RoutePatternMatcher.cs#L293) is not used by ASP.NET Core, but it provides a good explanation of complex segments.</span></span>
<!-- While that code is no longer used by ASP.NET Core for complex segment matching, it provides a good match to the current algorithm. The [current code](https://github.com/dotnet/AspNetCore/blob/91514c9af7e0f4c44029b51f05a01c6fe4c96e4c/src/Http/Routing/src/Matching/DfaMatcherBuilder.cs#L227-L244) is too abstracted from matching to be useful for understanding complex segment matching.
-->

::: moniker-end

::: moniker range="< aspnetcore-2.2"

<span data-ttu-id="36060-1311">ルーティングでは要求 URI をルート ハンドラーにマッピングし、受信要求を配布します。</span><span class="sxs-lookup"><span data-stu-id="36060-1311">Routing is responsible for mapping request URIs to route handlers and dispatching an incoming requests.</span></span> <span data-ttu-id="36060-1312">ルートはアプリに定義され、アプリの起動時に構成されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1312">Routes are defined in the app and configured when the app starts.</span></span> <span data-ttu-id="36060-1313">ルートは、要求に含まれている URL から値を任意で抽出できます。その値を要求処理に利用できます。</span><span class="sxs-lookup"><span data-stu-id="36060-1313">A route can optionally extract values from the URL contained in the request, and these values can then be used for request processing.</span></span> <span data-ttu-id="36060-1314">ルーティングでは、アプリからの構成済みルートを使用して、ルート ハンドラーにマッピングする URL を生成できます。</span><span class="sxs-lookup"><span data-stu-id="36060-1314">Using configured routes from the app, routing is able to generate URLs that map to route handlers.</span></span>

<span data-ttu-id="36060-1315">ASP.NET Core 2.1 で最新のルーティング シナリオを使用するには、`Startup.ConfigureServices` で[互換性バージョン](xref:mvc/compatibility-version)を MVC サービス登録に指定します。</span><span class="sxs-lookup"><span data-stu-id="36060-1315">To use the latest routing scenarios in ASP.NET Core 2.1, specify the [compatibility version](xref:mvc/compatibility-version) to the MVC services registration in `Startup.ConfigureServices`:</span></span>

```csharp
services.AddMvc()
    .SetCompatibilityVersion(CompatibilityVersion.Version_2_1);
```

> [!IMPORTANT]
> <span data-ttu-id="36060-1316">本文では、ASP.NET Core ルーティングについて詳しく取り上げます。</span><span class="sxs-lookup"><span data-stu-id="36060-1316">This document covers low-level ASP.NET Core routing.</span></span> <span data-ttu-id="36060-1317">ASP.NET Core MVC ルーティングの詳細については、「<xref:mvc/controllers/routing>」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="36060-1317">For information on ASP.NET Core MVC routing, see <xref:mvc/controllers/routing>.</span></span> <span data-ttu-id="36060-1318">Razor Pages のルーティング規則については、「<xref:razor-pages/razor-pages-conventions>」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="36060-1318">For information on routing conventions in Razor Pages, see <xref:razor-pages/razor-pages-conventions>.</span></span>

<span data-ttu-id="36060-1319">[サンプル コードを表示またはダウンロード](https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/fundamentals/routing/samples)します ([ダウンロード方法](xref:index#how-to-download-a-sample))。</span><span class="sxs-lookup"><span data-stu-id="36060-1319">[View or download sample code](https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/fundamentals/routing/samples) ([how to download](xref:index#how-to-download-a-sample))</span></span>

## <a name="routing-basics"></a><span data-ttu-id="36060-1320">ルーティングの基本</span><span class="sxs-lookup"><span data-stu-id="36060-1320">Routing basics</span></span>

<span data-ttu-id="36060-1321">ほとんどのアプリでは、URL を読みやすくてわかりやすいものにするために、基本的なでわかりやすいルーティング スキームを選択する必要があります。</span><span class="sxs-lookup"><span data-stu-id="36060-1321">Most apps should choose a basic and descriptive routing scheme so that URLs are readable and meaningful.</span></span> <span data-ttu-id="36060-1322">既定の規則ルート `{controller=Home}/{action=Index}/{id?}`:</span><span class="sxs-lookup"><span data-stu-id="36060-1322">The default conventional route `{controller=Home}/{action=Index}/{id?}`:</span></span>

* <span data-ttu-id="36060-1323">基本的でわかりやすいルーティング スキームをサポートしています。</span><span class="sxs-lookup"><span data-stu-id="36060-1323">Supports a basic and descriptive routing scheme.</span></span>
* <span data-ttu-id="36060-1324">UI ベースのアプリの便利な開始点となります。</span><span class="sxs-lookup"><span data-stu-id="36060-1324">Is a useful starting point for UI-based apps.</span></span>

<span data-ttu-id="36060-1325">開発者は一般的に、特殊な状況でのアプリのトラフィックが多い領域 (ブログや E コマース エンドポイントなど) に対しては、[属性ルーティング](xref:mvc/controllers/routing#attribute-routing)または専用規則ルートを使用して簡易ルートをさらに追加します。</span><span class="sxs-lookup"><span data-stu-id="36060-1325">Developers commonly add additional terse routes to high-traffic areas of an app in specialized situations (for example, blog and ecommerce endpoints) using [attribute routing](xref:mvc/controllers/routing#attribute-routing) or dedicated conventional routes.</span></span>

<span data-ttu-id="36060-1326">Web API では、属性ルーティングを使用して、HTTP 動詞で操作を表現するリソースのセットとしてアプリの機能をモデル化する必要があります。</span><span class="sxs-lookup"><span data-stu-id="36060-1326">Web APIs should use attribute routing to model the app's functionality as a set of resources where operations are represented by HTTP verbs.</span></span> <span data-ttu-id="36060-1327">つまり、同じ論理リソース上の多くの操作 (たとえば GET や POST) で、同じ URL を使用します。</span><span class="sxs-lookup"><span data-stu-id="36060-1327">This means that many operations (for example, GET, POST) on the same logical resource will use the same URL.</span></span> <span data-ttu-id="36060-1328">属性ルーティングでは、API のパブリック エンドポイント レイアウトを慎重に設計するために必要となるコントロールのレベルが提供されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1328">Attribute routing provides a level of control that's needed to carefully design an API's public endpoint layout.</span></span>

<span data-ttu-id="36060-1329">Razor Pages アプリでは、既定の規則ルーティングを使用して、アプリの *Pages* フォルダーの名前付きリソースを提供します。</span><span class="sxs-lookup"><span data-stu-id="36060-1329">Razor Pages apps use default conventional routing to serve named resources in the *Pages* folder of an app.</span></span> <span data-ttu-id="36060-1330">Razor Pages のルーティング動作をカスタマイズできる追加の規則を使用できます。</span><span class="sxs-lookup"><span data-stu-id="36060-1330">Additional conventions are available that allow you to customize Razor Pages routing behavior.</span></span> <span data-ttu-id="36060-1331">詳細については、次のトピックを参照してください。 <xref:razor-pages/index> および <xref:razor-pages/razor-pages-conventions></span><span class="sxs-lookup"><span data-stu-id="36060-1331">For more information, see <xref:razor-pages/index> and <xref:razor-pages/razor-pages-conventions>.</span></span>

<span data-ttu-id="36060-1332">URL 生成サポートを使用すると、アプリを相互にリンクする URL をハード コーディングすることなくアプリを開発できます。</span><span class="sxs-lookup"><span data-stu-id="36060-1332">URL generation support allows the app to be developed without hard-coding URLs to link the app together.</span></span> <span data-ttu-id="36060-1333">このサポートにより、基本的なルーティング構成を使用して作業を開始し、アプリのリソース レイアウトが決まった後でルートを変更することができます。</span><span class="sxs-lookup"><span data-stu-id="36060-1333">This support allows for starting with a basic routing configuration and modifying the routes after the app's resource layout is determined.</span></span>

<span data-ttu-id="36060-1334">ルーティングでは <xref:Microsoft.AspNetCore.Routing.IRouter> のルートの実装が次の目的で利用されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1334">Routing uses routes implementations of <xref:Microsoft.AspNetCore.Routing.IRouter> to:</span></span>

* <span data-ttu-id="36060-1335">受信要求を*ルート ハンドラー*にマッピングする。</span><span class="sxs-lookup"><span data-stu-id="36060-1335">Map incoming requests to *route handlers*.</span></span>
* <span data-ttu-id="36060-1336">応答で使用される URL を生成する。</span><span class="sxs-lookup"><span data-stu-id="36060-1336">Generate the URLs used in responses.</span></span>

<span data-ttu-id="36060-1337">既定では、アプリにはルート コレクションが 1 つあります。</span><span class="sxs-lookup"><span data-stu-id="36060-1337">By default, an app has a single collection of routes.</span></span> <span data-ttu-id="36060-1338">要求が到着すると、コレクション内のルートは、コレクションに存在する順序で処理されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1338">When a request arrives, the routes in the collection are processed in the order that they exist in the collection.</span></span> <span data-ttu-id="36060-1339">フレームワークでは、コレクション内の各ルートに対して <xref:Microsoft.AspNetCore.Routing.IRouter.RouteAsync*> メソッドを呼び出し、受信要求 URL とコレクション内のルートとの照合を試みます。</span><span class="sxs-lookup"><span data-stu-id="36060-1339">The framework attempts to match an incoming request URL to a route in the collection by calling the <xref:Microsoft.AspNetCore.Routing.IRouter.RouteAsync*> method on each route in the collection.</span></span> <span data-ttu-id="36060-1340">応答ではルーティングを使用し、ルート情報に基づいて URL (リダイレクトやリンクなど) を生成できます。そのため、URL をハードコーディングする必要がなく、保守管理が容易になります。</span><span class="sxs-lookup"><span data-stu-id="36060-1340">A response can use routing to generate URLs (for example, for redirection or links) based on route information and thus avoid hard-coded URLs, which helps maintainability.</span></span>

<span data-ttu-id="36060-1341">ルーティング システムには次の特性があります。</span><span class="sxs-lookup"><span data-stu-id="36060-1341">The routing system has the following characteristics:</span></span>

* <span data-ttu-id="36060-1342">ルート テンプレート構文は、トークン化されたルート パラメーターでルートを定義するために使用されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1342">Route template syntax is used to define routes with tokenized route parameters.</span></span>
* <span data-ttu-id="36060-1343">規則スタイルおよび属性スタイルのエンドポイント構成が許可されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1343">Conventional-style and attribute-style endpoint configuration is permitted.</span></span>
* <span data-ttu-id="36060-1344"><xref:Microsoft.AspNetCore.Routing.IRouteConstraint> は、URL パラメーターに特定のエンドポイント制約で有効な値が含まれているかどうかを確認するために使用されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1344"><xref:Microsoft.AspNetCore.Routing.IRouteConstraint> is used to determine whether a URL parameter contains a valid value for a given endpoint constraint.</span></span>
* <span data-ttu-id="36060-1345">MVC/Razor Pages などのアプリ モデルでは、ルーティング シナリオの予測可能な実装を持つ、すべてのルートを登録します。</span><span class="sxs-lookup"><span data-stu-id="36060-1345">App models, such as MVC/Razor Pages, register all of their routes, which have a predictable implementation of routing scenarios.</span></span>
* <span data-ttu-id="36060-1346">応答ではルーティングを使用し、ルート情報に基づいて URL (リダイレクトやリンクなど) を生成できます。そのため、URL をハードコーディングする必要がなく、保守管理が容易になります。</span><span class="sxs-lookup"><span data-stu-id="36060-1346">A response can use routing to generate URLs (for example, for redirection or links) based on route information and thus avoid hard-coded URLs, which helps maintainability.</span></span>
* <span data-ttu-id="36060-1347">URL の生成は、任意の拡張機能をサポートする、ルートに基づきます。</span><span class="sxs-lookup"><span data-stu-id="36060-1347">URL generation is based on routes, which support arbitrary extensibility.</span></span> <span data-ttu-id="36060-1348"><xref:Microsoft.AspNetCore.Mvc.IUrlHelper> では、URL を構築するためのメソッドが提供されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1348"><xref:Microsoft.AspNetCore.Mvc.IUrlHelper> offers methods to build URLs.</span></span>
<!-- fix [middleware](xref:fundamentals/middleware/index) -->
<span data-ttu-id="36060-1349">ルーティングは <xref:Microsoft.AspNetCore.Builder.RouterMiddleware> クラスにより[ミドルウェア](xref:fundamentals/middleware/index) パイプラインに接続されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1349">Routing is connected to the [middleware](xref:fundamentals/middleware/index) pipeline by the <xref:Microsoft.AspNetCore.Builder.RouterMiddleware> class.</span></span> <span data-ttu-id="36060-1350">[ASP.NET Core MVC](xref:mvc/overview) では、ミドルウェア パイプラインにその構成の一部としてルーティングが追加され、MVC および Razor Pages アプリでのルーティングが処理されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1350">[ASP.NET Core MVC](xref:mvc/overview) adds routing to the middleware pipeline as part of its configuration and handles routing in MVC and Razor Pages apps.</span></span> <span data-ttu-id="36060-1351">スタンドアロン コンポーネントとしてルーティングを利用する方法については、「[ルーティング ミドルウェアの使用](#use-routing-middleware)」セクションを参照してください。</span><span class="sxs-lookup"><span data-stu-id="36060-1351">To learn how to use routing as a standalone component, see the [Use Routing Middleware](#use-routing-middleware) section.</span></span>

### <a name="url-matching"></a><span data-ttu-id="36060-1352">URL 一致</span><span class="sxs-lookup"><span data-stu-id="36060-1352">URL matching</span></span>

<span data-ttu-id="36060-1353">URL 一致というプロセスでは、ルーティングによって、受信要求が*ハンドラー*に配布されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1353">URL matching is the process by which routing dispatches an incoming request to a *handler*.</span></span> <span data-ttu-id="36060-1354">このプロセスは URL パスのデータに基づきますが、要求内のあらゆるデータを考慮することもできます。</span><span class="sxs-lookup"><span data-stu-id="36060-1354">This process is based on data in the URL path but can be extended to consider any data in the request.</span></span> <span data-ttu-id="36060-1355">アプリの規模を大きくしたり、より複雑にしたりするとき、要求を個別のハンドラーに配布する機能が鍵となります。</span><span class="sxs-lookup"><span data-stu-id="36060-1355">The ability to dispatch requests to separate handlers is key to scaling the size and complexity of an app.</span></span>

<span data-ttu-id="36060-1356">受信要求は <xref:Microsoft.AspNetCore.Builder.RouterMiddleware> に入ります。これが各ルートで順に <xref:Microsoft.AspNetCore.Routing.IRouter.RouteAsync*> メソッドを呼び出します。</span><span class="sxs-lookup"><span data-stu-id="36060-1356">Incoming requests enter the <xref:Microsoft.AspNetCore.Builder.RouterMiddleware>, which calls the <xref:Microsoft.AspNetCore.Routing.IRouter.RouteAsync*> method on each route in sequence.</span></span> <span data-ttu-id="36060-1357"><xref:Microsoft.AspNetCore.Routing.IRouter> インスタンスでは、[RouteContext.Handler](xref:Microsoft.AspNetCore.Routing.RouteContext.Handler*) を非 null の <xref:Microsoft.AspNetCore.Http.RequestDelegate> に設定することで、要求を*処理する*かどうかを選択します。</span><span class="sxs-lookup"><span data-stu-id="36060-1357">The <xref:Microsoft.AspNetCore.Routing.IRouter> instance chooses whether to *handle* the request by setting the [RouteContext.Handler](xref:Microsoft.AspNetCore.Routing.RouteContext.Handler*) to a non-null <xref:Microsoft.AspNetCore.Http.RequestDelegate>.</span></span> <span data-ttu-id="36060-1358">要求に適したハンドラーがルートに見つかると、ルート処理が停止します。ハンドラーが呼び出され、要求を処理します。</span><span class="sxs-lookup"><span data-stu-id="36060-1358">If a route sets a handler for the request, route processing stops, and the handler is invoked to process the request.</span></span> <span data-ttu-id="36060-1359">要求を処理するためのルート ハンドラーが見つからない場合、ミドルウェアによって、要求が要求パイプラインの次のミドルウェアに渡されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1359">If no route handler is found to process the request, the middleware hands the request off to the next middleware in the request pipeline.</span></span>

<span data-ttu-id="36060-1360"><xref:Microsoft.AspNetCore.Routing.IRouter.RouteAsync*> に最初に入力されるのが、現在の要求に関連付けられている [RouteContext.HttpContext](xref:Microsoft.AspNetCore.Routing.RouteContext.HttpContext*) です。</span><span class="sxs-lookup"><span data-stu-id="36060-1360">The primary input to <xref:Microsoft.AspNetCore.Routing.IRouter.RouteAsync*> is the [RouteContext.HttpContext](xref:Microsoft.AspNetCore.Routing.RouteContext.HttpContext*) associated with the current request.</span></span> <span data-ttu-id="36060-1361">[RouteContext.Handler](xref:Microsoft.AspNetCore.Routing.RouteContext.Handler) と [RouteContext.RouteData](xref:Microsoft.AspNetCore.Routing.RouteContext.RouteData*) は、ルートが一致した後に設定される出力です。</span><span class="sxs-lookup"><span data-stu-id="36060-1361">The [RouteContext.Handler](xref:Microsoft.AspNetCore.Routing.RouteContext.Handler) and [RouteContext.RouteData](xref:Microsoft.AspNetCore.Routing.RouteContext.RouteData*) are outputs set after a route is matched.</span></span>

<span data-ttu-id="36060-1362">また、<xref:Microsoft.AspNetCore.Routing.IRouter.RouteAsync*> を呼び出す一致が見つかると、それまでに実行された要求処理に基づいて、[RouteContext.RouteData](xref:Microsoft.AspNetCore.Routing.RouteContext.RouteData) のプロパティが適切な値に設定されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1362">A match that calls <xref:Microsoft.AspNetCore.Routing.IRouter.RouteAsync*> also sets the properties of the [RouteContext.RouteData](xref:Microsoft.AspNetCore.Routing.RouteContext.RouteData) to appropriate values based on the request processing performed thus far.</span></span>

<span data-ttu-id="36060-1363">[RouteData.Values](xref:Microsoft.AspNetCore.Routing.RouteData.Values*) は、ルートから生成された*ルート値*のディクショナリです。</span><span class="sxs-lookup"><span data-stu-id="36060-1363">[RouteData.Values](xref:Microsoft.AspNetCore.Routing.RouteData.Values*) is a dictionary of *route values* produced from the route.</span></span> <span data-ttu-id="36060-1364">この値は通常、URL のトークン化で決定されます。この値を利用してユーザー入力を受け取ったり、アプリ内で決定をさらに配布したりできます。</span><span class="sxs-lookup"><span data-stu-id="36060-1364">These values are usually determined by tokenizing the URL and can be used to accept user input or to make further dispatching decisions inside the app.</span></span>

<span data-ttu-id="36060-1365">[RouteData.DataTokens](xref:Microsoft.AspNetCore.Routing.RouteData.DataTokens*) は、一致したルートに関連する追加データのプロパティ バッグです。</span><span class="sxs-lookup"><span data-stu-id="36060-1365">[RouteData.DataTokens](xref:Microsoft.AspNetCore.Routing.RouteData.DataTokens*) is a property bag of additional data related to the matched route.</span></span> <span data-ttu-id="36060-1366">一致したルートに基づいてアプリで決定を行えるように、<xref:Microsoft.AspNetCore.Routing.RouteData.DataTokens*> が提供されます。これは状態データと各ルートの関連付けをサポートするためのものです。</span><span class="sxs-lookup"><span data-stu-id="36060-1366"><xref:Microsoft.AspNetCore.Routing.RouteData.DataTokens*> are provided to support associating state data with each route so that the app can make decisions based on which route matched.</span></span> <span data-ttu-id="36060-1367">この値は開発者が定義するものです。ルーティングの動作に影響を与えることは**ありません**。</span><span class="sxs-lookup"><span data-stu-id="36060-1367">These values are developer-defined and do **not** affect the behavior of routing in any way.</span></span> <span data-ttu-id="36060-1368">また、[RouteData.DataTokens](xref:Microsoft.AspNetCore.Routing.RouteData.DataTokens*) に一時退避される値はどのような型でも構いません。一方、[RouteData.Values](xref:Microsoft.AspNetCore.Routing.RouteData.Values) の場合は、文字列間で変換できる必要があります。</span><span class="sxs-lookup"><span data-stu-id="36060-1368">Additionally, values stashed in [RouteData.DataTokens](xref:Microsoft.AspNetCore.Routing.RouteData.DataTokens*) can be of any type, in contrast to [RouteData.Values](xref:Microsoft.AspNetCore.Routing.RouteData.Values), which must be convertible to and from strings.</span></span>

<span data-ttu-id="36060-1369">[RouteData.Routers](xref:Microsoft.AspNetCore.Routing.RouteData.Routers) は、過去に要求に一致したルートの一覧です。</span><span class="sxs-lookup"><span data-stu-id="36060-1369">[RouteData.Routers](xref:Microsoft.AspNetCore.Routing.RouteData.Routers) is a list of the routes that took part in successfully matching the request.</span></span> <span data-ttu-id="36060-1370">ルートはルートの中に入れ子にすることができます。</span><span class="sxs-lookup"><span data-stu-id="36060-1370">Routes can be nested inside of one another.</span></span> <span data-ttu-id="36060-1371"><xref:Microsoft.AspNetCore.Routing.RouteData.Routers> プロパティは、結果的に一致をもたらしたルートの論理ツリーを通るパスを表します。</span><span class="sxs-lookup"><span data-stu-id="36060-1371">The <xref:Microsoft.AspNetCore.Routing.RouteData.Routers> property reflects the path through the logical tree of routes that resulted in a match.</span></span> <span data-ttu-id="36060-1372">一般的に、<xref:Microsoft.AspNetCore.Routing.RouteData.Routers> の最初の項目はルート コレクションであり、これは URL 生成に使用するものです。</span><span class="sxs-lookup"><span data-stu-id="36060-1372">Generally, the first item in <xref:Microsoft.AspNetCore.Routing.RouteData.Routers> is the route collection and should be used for URL generation.</span></span> <span data-ttu-id="36060-1373"><xref:Microsoft.AspNetCore.Routing.RouteData.Routers> の最後の項目は、一致したルート ハンドラーです。</span><span class="sxs-lookup"><span data-stu-id="36060-1373">The last item in <xref:Microsoft.AspNetCore.Routing.RouteData.Routers> is the route handler that matched.</span></span>

<a name="lg"></a>

### <a name="url-generation"></a><span data-ttu-id="36060-1374">URL 生成</span><span class="sxs-lookup"><span data-stu-id="36060-1374">URL generation</span></span>

<span data-ttu-id="36060-1375">URL 生成は、ルーティングにおいて、一連のルート値に基づいて URL パスを作成するプロセスです。</span><span class="sxs-lookup"><span data-stu-id="36060-1375">URL generation is the process by which routing can create a URL path based on a set of route values.</span></span> <span data-ttu-id="36060-1376">これにより、ルート ハンドラーとそれにアクセスする URL を論理的に分離できます。</span><span class="sxs-lookup"><span data-stu-id="36060-1376">This allows for a logical separation between route handlers and the URLs that access them.</span></span>

<span data-ttu-id="36060-1377">URL 生成は同様の繰り返しプロセスに従いますが、最初にユーザーまたはフレームワーク コードでルート コレクションの <xref:Microsoft.AspNetCore.Routing.IRouter.GetVirtualPath*> メソッドを呼び出します。</span><span class="sxs-lookup"><span data-stu-id="36060-1377">URL generation follows a similar iterative process, but it starts with user or framework code calling into the <xref:Microsoft.AspNetCore.Routing.IRouter.GetVirtualPath*> method of the route collection.</span></span> <span data-ttu-id="36060-1378">非 null の <xref:Microsoft.AspNetCore.Routing.VirtualPathData> が返されるまで、各*ルート* で順番に <xref:Microsoft.AspNetCore.Routing.IRouter.GetVirtualPath*> メソッドが呼び出されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1378">Each *route* has its <xref:Microsoft.AspNetCore.Routing.IRouter.GetVirtualPath*> method called in sequence until a non-null <xref:Microsoft.AspNetCore.Routing.VirtualPathData> is returned.</span></span>

<span data-ttu-id="36060-1379"><xref:Microsoft.AspNetCore.Routing.IRouter.GetVirtualPath*> の第一入力:</span><span class="sxs-lookup"><span data-stu-id="36060-1379">The primary inputs to <xref:Microsoft.AspNetCore.Routing.IRouter.GetVirtualPath*> are:</span></span>

* [<span data-ttu-id="36060-1380">VirtualPathContext.HttpContext</span><span class="sxs-lookup"><span data-stu-id="36060-1380">VirtualPathContext.HttpContext</span></span>](xref:Microsoft.AspNetCore.Routing.VirtualPathContext.HttpContext)
* [<span data-ttu-id="36060-1381">VirtualPathContext.Values</span><span class="sxs-lookup"><span data-stu-id="36060-1381">VirtualPathContext.Values</span></span>](xref:Microsoft.AspNetCore.Routing.VirtualPathContext.Values)
* [<span data-ttu-id="36060-1382">VirtualPathContext.AmbientValues</span><span class="sxs-lookup"><span data-stu-id="36060-1382">VirtualPathContext.AmbientValues</span></span>](xref:Microsoft.AspNetCore.Routing.VirtualPathContext.AmbientValues)

<span data-ttu-id="36060-1383">ルートでは <xref:Microsoft.AspNetCore.Routing.VirtualPathContext.Values> と <xref:Microsoft.AspNetCore.Routing.VirtualPathContext.AmbientValues> によって指定されるルート値を主に使用し、URL を生成できるかどうかと、どの値を含めるかを判断します。</span><span class="sxs-lookup"><span data-stu-id="36060-1383">Routes primarily use the route values provided by <xref:Microsoft.AspNetCore.Routing.VirtualPathContext.Values> and <xref:Microsoft.AspNetCore.Routing.VirtualPathContext.AmbientValues> to decide whether it's possible to generate a URL and what values to include.</span></span> <span data-ttu-id="36060-1384"><xref:Microsoft.AspNetCore.Routing.VirtualPathContext.AmbientValues> は、現在の要求を照合することで生成された一連のルート値です。</span><span class="sxs-lookup"><span data-stu-id="36060-1384">The <xref:Microsoft.AspNetCore.Routing.VirtualPathContext.AmbientValues> are the set of route values that were produced from matching the current request.</span></span> <span data-ttu-id="36060-1385">対照的に、<xref:Microsoft.AspNetCore.Routing.VirtualPathContext.Values> は、現在の操作に適した URL の生成方法を指定するルート値です。</span><span class="sxs-lookup"><span data-stu-id="36060-1385">In contrast, <xref:Microsoft.AspNetCore.Routing.VirtualPathContext.Values> are the route values that specify how to generate the desired URL for the current operation.</span></span> <span data-ttu-id="36060-1386">ルートで現在のコンテキストに関連付けられているサービスまたは追加データを取得する必要がある場合、<xref:Microsoft.AspNetCore.Routing.VirtualPathContext.HttpContext> が指定されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1386">The <xref:Microsoft.AspNetCore.Routing.VirtualPathContext.HttpContext> is provided in case a route should obtain services or additional data associated with the current context.</span></span>

> [!TIP]
> <span data-ttu-id="36060-1387">[VirtualPathContext.Values](xref:Microsoft.AspNetCore.Routing.VirtualPathContext.Values*) は [VirtualPathContext.AmbientValues](xref:Microsoft.AspNetCore.Routing.VirtualPathContext.AmbientValues*) のオーバーライド セットであると考えてください。</span><span class="sxs-lookup"><span data-stu-id="36060-1387">Think of [VirtualPathContext.Values](xref:Microsoft.AspNetCore.Routing.VirtualPathContext.Values*) as a set of overrides for the [VirtualPathContext.AmbientValues](xref:Microsoft.AspNetCore.Routing.VirtualPathContext.AmbientValues*).</span></span> <span data-ttu-id="36060-1388">URL 生成では、同じルートまたはルート値を利用することでリンクの URL 生成を生成するために、現在の要求からのルート値の再利用が試行されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1388">URL generation attempts to reuse route values from the current request to generate URLs for links using the same route or route values.</span></span>

<span data-ttu-id="36060-1389"><xref:Microsoft.AspNetCore.Routing.IRouter.GetVirtualPath*> の出力は <xref:Microsoft.AspNetCore.Routing.VirtualPathData> です。</span><span class="sxs-lookup"><span data-stu-id="36060-1389">The output of <xref:Microsoft.AspNetCore.Routing.IRouter.GetVirtualPath*> is a <xref:Microsoft.AspNetCore.Routing.VirtualPathData>.</span></span> <span data-ttu-id="36060-1390"><xref:Microsoft.AspNetCore.Routing.VirtualPathData> は <xref:Microsoft.AspNetCore.Routing.RouteData> の並列です。</span><span class="sxs-lookup"><span data-stu-id="36060-1390"><xref:Microsoft.AspNetCore.Routing.VirtualPathData> is a parallel of <xref:Microsoft.AspNetCore.Routing.RouteData>.</span></span> <span data-ttu-id="36060-1391"><xref:Microsoft.AspNetCore.Routing.VirtualPathData> には出力 URL として <xref:Microsoft.AspNetCore.Routing.VirtualPathData.VirtualPath> が含まれ、ルートで設定する追加プロパティがいくつか含まれます。</span><span class="sxs-lookup"><span data-stu-id="36060-1391"><xref:Microsoft.AspNetCore.Routing.VirtualPathData> contains the <xref:Microsoft.AspNetCore.Routing.VirtualPathData.VirtualPath> for the output URL and some additional properties that should be set by the route.</span></span>

<span data-ttu-id="36060-1392">[VirtualPathData.VirtualPath](xref:Microsoft.AspNetCore.Routing.VirtualPathData.VirtualPath*) プロパティには、ルートによって生成された*仮想パス*が含まれます。</span><span class="sxs-lookup"><span data-stu-id="36060-1392">The [VirtualPathData.VirtualPath](xref:Microsoft.AspNetCore.Routing.VirtualPathData.VirtualPath*) property contains the *virtual path* produced by the route.</span></span> <span data-ttu-id="36060-1393">必要に応じて、パスをさらに処理する必要がある場合があります。</span><span class="sxs-lookup"><span data-stu-id="36060-1393">Depending on your needs, you may need to process the path further.</span></span> <span data-ttu-id="36060-1394">生成された URL を HTML で表示するには、アプリの基礎パスを先頭に追加する必要があります。</span><span class="sxs-lookup"><span data-stu-id="36060-1394">If you want to render the generated URL in HTML, prepend the base path of the app.</span></span>

<span data-ttu-id="36060-1395">[VirtualPathData.Router](xref:Microsoft.AspNetCore.Routing.VirtualPathData.Router*) は URL を正常に生成したルートの参照です。</span><span class="sxs-lookup"><span data-stu-id="36060-1395">The [VirtualPathData.Router](xref:Microsoft.AspNetCore.Routing.VirtualPathData.Router*) is a reference to the route that successfully generated the URL.</span></span>

<span data-ttu-id="36060-1396">[VirtualPathData.DataTokens](xref:Microsoft.AspNetCore.Routing.VirtualPathData.DataTokens*) プロパティは、URL を生成したルートに関連する追加データのディクショナリです。</span><span class="sxs-lookup"><span data-stu-id="36060-1396">The [VirtualPathData.DataTokens](xref:Microsoft.AspNetCore.Routing.VirtualPathData.DataTokens*) properties is a dictionary of additional data related to the route that generated the URL.</span></span> <span data-ttu-id="36060-1397">これは [RouteData.DataTokens](xref:Microsoft.AspNetCore.Routing.RouteData.DataTokens*) の並列です。</span><span class="sxs-lookup"><span data-stu-id="36060-1397">This is the parallel of [RouteData.DataTokens](xref:Microsoft.AspNetCore.Routing.RouteData.DataTokens*).</span></span>

### <a name="create-routes"></a><span data-ttu-id="36060-1398">ルートを作成する</span><span class="sxs-lookup"><span data-stu-id="36060-1398">Create routes</span></span>

<span data-ttu-id="36060-1399">ルーティングにより、<xref:Microsoft.AspNetCore.Routing.IRouter> の標準実装として <xref:Microsoft.AspNetCore.Routing.Route> クラスが与えられます。</span><span class="sxs-lookup"><span data-stu-id="36060-1399">Routing provides the <xref:Microsoft.AspNetCore.Routing.Route> class as the standard implementation of <xref:Microsoft.AspNetCore.Routing.IRouter>.</span></span> <span data-ttu-id="36060-1400"><xref:Microsoft.AspNetCore.Routing.Route> では*ルート テンプレート* 構文を利用して、<xref:Microsoft.AspNetCore.Routing.IRouter.RouteAsync*> の呼び出し時に URL パスに対して照合するパターンを定義します。</span><span class="sxs-lookup"><span data-stu-id="36060-1400"><xref:Microsoft.AspNetCore.Routing.Route> uses the *route template* syntax to define patterns to match against the URL path when <xref:Microsoft.AspNetCore.Routing.IRouter.RouteAsync*> is called.</span></span> <span data-ttu-id="36060-1401"><xref:Microsoft.AspNetCore.Routing.Route> は同じルート テンプレートを利用し、<xref:Microsoft.AspNetCore.Routing.IRouter.GetVirtualPath*> の呼び出し時に URL を生成します。</span><span class="sxs-lookup"><span data-stu-id="36060-1401"><xref:Microsoft.AspNetCore.Routing.Route> uses the same route template to generate a URL when <xref:Microsoft.AspNetCore.Routing.IRouter.GetVirtualPath*> is called.</span></span>

<span data-ttu-id="36060-1402">ほとんどのアプリは、<xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> を呼び出すか、<xref:Microsoft.AspNetCore.Routing.IRouteBuilder> で定義されている同様の拡張メソッドの 1 つを呼び出してルートを作成します。</span><span class="sxs-lookup"><span data-stu-id="36060-1402">Most apps create routes by calling <xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> or one of the similar extension methods defined on <xref:Microsoft.AspNetCore.Routing.IRouteBuilder>.</span></span> <span data-ttu-id="36060-1403">いずれの <xref:Microsoft.AspNetCore.Routing.IRouteBuilder> 拡張メソッドでも、<xref:Microsoft.AspNetCore.Routing.Route> のインスタンスが作成され、それがルート コレクションに追加されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1403">Any of the <xref:Microsoft.AspNetCore.Routing.IRouteBuilder> extension methods create an instance of <xref:Microsoft.AspNetCore.Routing.Route> and add it to the route collection.</span></span>

<span data-ttu-id="36060-1404"><xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> では、ルート ハンドラー パラメーターは受け入れられません。</span><span class="sxs-lookup"><span data-stu-id="36060-1404"><xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> doesn't accept a route handler parameter.</span></span> <span data-ttu-id="36060-1405"><xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> は、<xref:Microsoft.AspNetCore.Routing.RouteBuilder.DefaultHandler*> によって処理されるルートを追加するだけです。</span><span class="sxs-lookup"><span data-stu-id="36060-1405"><xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> only adds routes that are handled by the <xref:Microsoft.AspNetCore.Routing.RouteBuilder.DefaultHandler*>.</span></span> <span data-ttu-id="36060-1406">既定のハンドラーは `IRouter` であり、そのハンドラーで要求が処理されない可能性があります。</span><span class="sxs-lookup"><span data-stu-id="36060-1406">The default handler is an `IRouter`, and the handler might not handle the request.</span></span> <span data-ttu-id="36060-1407">たとえば、ASP.NET Core MVC は通常、利用できるコントローラーやアクションに一致する要求のみを処理する既定のハンドラーとして構成されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1407">For example, ASP.NET Core MVC is typically configured as a default handler that only handles requests that match an available controller and action.</span></span> <span data-ttu-id="36060-1408">MVC でのルーティングの詳細については、「<xref:mvc/controllers/routing>」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="36060-1408">To learn more about routing in MVC, see <xref:mvc/controllers/routing>.</span></span>

<span data-ttu-id="36060-1409">次のコード例は、一般的な ASP.NET Core MVC ルート定義によって使用される <xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> 呼び出しの例です。</span><span class="sxs-lookup"><span data-stu-id="36060-1409">The following code example is an example of a <xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> call used by a typical ASP.NET Core MVC route definition:</span></span>

```csharp
routes.MapRoute(
    name: "default",
    template: "{controller=Home}/{action=Index}/{id?}");
```

<span data-ttu-id="36060-1410">このテンプレートでは URL パスが照合され、ルート値が抽出されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1410">This template matches a URL path and extracts the route values.</span></span> <span data-ttu-id="36060-1411">たとえば、`/Products/Details/17` というパスでは、`{ controller = Products, action = Details, id = 17 }` というルート値が生成されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1411">For example, the path `/Products/Details/17` generates the following route values: `{ controller = Products, action = Details, id = 17 }`.</span></span>

<span data-ttu-id="36060-1412">ルート値は、URL パスをセグメントに分割し、各セグメントと、ルート テンプレートの*ルート パラメーター* 名を照合することで決定されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1412">Route values are determined by splitting the URL path into segments and matching each segment with the *route parameter* name in the route template.</span></span> <span data-ttu-id="36060-1413">ルート パラメーターが指定されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1413">Route parameters are named.</span></span> <span data-ttu-id="36060-1414">パラメーターは、中かっこ `{ ... }` でパラメーター名を囲むことで定義されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1414">The parameters defined by enclosing the parameter name in braces `{ ... }`.</span></span>

<span data-ttu-id="36060-1415">上のテンプレートでは URL パス `/` の照合も行い、`{ controller = Home, action = Index }` という値を生成します。</span><span class="sxs-lookup"><span data-stu-id="36060-1415">The preceding template could also match the URL path `/` and produce the values `{ controller = Home, action = Index }`.</span></span> <span data-ttu-id="36060-1416">これは、ルート パラメーターの `{controller}` と `{action}` に既定値が与えられ、`id` ルート パラメーターが任意であるためです。</span><span class="sxs-lookup"><span data-stu-id="36060-1416">This occurs because the `{controller}` and `{action}` route parameters have default values and the `id` route parameter is optional.</span></span> <span data-ttu-id="36060-1417">ルート パラメーター名の後の等号 (`=`) とそれに続く値により、パラメーターの既定値が定義されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1417">An equals sign (`=`) followed by a value after the route parameter name defines a default value for the parameter.</span></span> <span data-ttu-id="36060-1418">ルート パラメーター名の後の疑問符 (`?`) により、オプションのパラメーターが定義されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1418">A question mark (`?`) after the route parameter name defines an optional parameter.</span></span>

<span data-ttu-id="36060-1419">既定値のルート パラメーターはルートが一致するとルート値を*常に*生成します。</span><span class="sxs-lookup"><span data-stu-id="36060-1419">Route parameters with a default value *always* produce a route value when the route matches.</span></span> <span data-ttu-id="36060-1420">省略可能なパラメーターでは、対応する URL パス セグメントがない場合、ルート値は生成されません。</span><span class="sxs-lookup"><span data-stu-id="36060-1420">Optional parameters don't produce a route value if there is no corresponding URL path segment.</span></span> <span data-ttu-id="36060-1421">ルート テンプレートのシナリオと構文の詳しい説明については、「[ルート テンプレート参照](#route-template-reference)」セクションを参照してください。</span><span class="sxs-lookup"><span data-stu-id="36060-1421">See the [Route template reference](#route-template-reference) section for a thorough description of route template scenarios and syntax.</span></span>

<span data-ttu-id="36060-1422">次の例では、ルート パラメーター定義 `{id:int}` により、`id` ルート パラメーターの[ルート制約](#route-constraint-reference)が定義されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1422">In the following example, the route parameter definition `{id:int}` defines a [route constraint](#route-constraint-reference) for the `id` route parameter:</span></span>

```csharp
routes.MapRoute(
    name: "default",
    template: "{controller=Home}/{action=Index}/{id:int}");
```

<span data-ttu-id="36060-1423">このテンプレートは `/Products/Details/Apples` ではなく、`/Products/Details/17` のような URL パスを照合します。</span><span class="sxs-lookup"><span data-stu-id="36060-1423">This template matches a URL path like `/Products/Details/17` but not `/Products/Details/Apples`.</span></span> <span data-ttu-id="36060-1424">ルート制約は <xref:Microsoft.AspNetCore.Routing.IRouteConstraint> を実装し、ルート値を調べて正しいことを確認します。</span><span class="sxs-lookup"><span data-stu-id="36060-1424">Route constraints implement <xref:Microsoft.AspNetCore.Routing.IRouteConstraint> and inspect route values to verify them.</span></span> <span data-ttu-id="36060-1425">この例では、ルート値 `id` は整数に変換できなければなりません。</span><span class="sxs-lookup"><span data-stu-id="36060-1425">In this example, the route value `id` must be convertible to an integer.</span></span> <span data-ttu-id="36060-1426">フレームワークによって提供されるルート制約については、「[ルート制約参照](#route-constraint-reference)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="36060-1426">See [route-constraint-reference](#route-constraint-reference) for an explanation of route constraints provided by the framework.</span></span>

<span data-ttu-id="36060-1427"><xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> の追加オーバーロードは、`constraints`、`dataTokens`、`defaults` の値を受け取ります。</span><span class="sxs-lookup"><span data-stu-id="36060-1427">Additional overloads of <xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> accept values for `constraints`, `dataTokens`, and `defaults`.</span></span> <span data-ttu-id="36060-1428">このようなパラメーターは一般的に、匿名型のオブジェクトを渡し、匿名型のプロパティ名がルート パラメーター名と一致するというような使われ方をします。</span><span class="sxs-lookup"><span data-stu-id="36060-1428">The typical usage of these parameters is to pass an anonymously typed object, where the property names of the anonymous type match route parameter names.</span></span>

<span data-ttu-id="36060-1429">次の <xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> 例では、同等のルートを作成します。</span><span class="sxs-lookup"><span data-stu-id="36060-1429">The following <xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> examples create equivalent routes:</span></span>

```csharp
routes.MapRoute(
    name: "default_route",
    template: "{controller}/{action}/{id?}",
    defaults: new { controller = "Home", action = "Index" });

routes.MapRoute(
    name: "default_route",
    template: "{controller=Home}/{action=Index}/{id?}");
```

> [!TIP]
> <span data-ttu-id="36060-1430">制約と既定値を定義するインライン構文は単純なルートの場合に便利です。</span><span class="sxs-lookup"><span data-stu-id="36060-1430">The inline syntax for defining constraints and defaults can be convenient for simple routes.</span></span> <span data-ttu-id="36060-1431">しかし、インライン構文でサポートされていない、データ トークンなどのシナリオがあります。</span><span class="sxs-lookup"><span data-stu-id="36060-1431">However, there are scenarios, such as data tokens, that aren't supported by inline syntax.</span></span>

<span data-ttu-id="36060-1432">次の例では、その他のいくつかのシナリオを示します。</span><span class="sxs-lookup"><span data-stu-id="36060-1432">The following example demonstrates a few additional scenarios:</span></span>

```csharp
routes.MapRoute(
    name: "blog",
    template: "Blog/{*article}",
    defaults: new { controller = "Blog", action = "ReadArticle" });
```

<span data-ttu-id="36060-1433">上記のテンプレートでは `/Blog/All-About-Routing/Introduction` のような URL パスを照合し、値 `{ controller = Blog, action = ReadArticle, article = All-About-Routing/Introduction }` を抽出します。</span><span class="sxs-lookup"><span data-stu-id="36060-1433">The preceding template matches a URL path like `/Blog/All-About-Routing/Introduction` and extracts the values `{ controller = Blog, action = ReadArticle, article = All-About-Routing/Introduction }`.</span></span> <span data-ttu-id="36060-1434">`controller` と `action` の既定のルート値は、テンプレートに対応するルート パラメーターがなくても、ルートにより生成されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1434">The default route values for `controller` and `action` are produced by the route even though there are no corresponding route parameters in the template.</span></span> <span data-ttu-id="36060-1435">既定値はルート テンプレートで指定できます。</span><span class="sxs-lookup"><span data-stu-id="36060-1435">Default values can be specified in the route template.</span></span> <span data-ttu-id="36060-1436">`article` ルート パラメーターは、ルート パラメーター名の前にアスタリスク (`*`) があるときに、*キャッチオール* として定義されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1436">The `article` route parameter is defined as a *catch-all* by the appearance of an asterisk (`*`) before the route parameter name.</span></span> <span data-ttu-id="36060-1437">キャッチオール ルート パラメーターは、URL パスの残りの部分をキャプチャします。空の文字列も照合できます。</span><span class="sxs-lookup"><span data-stu-id="36060-1437">Catch-all route parameters capture the remainder of the URL path and can also match the empty string.</span></span>

<span data-ttu-id="36060-1438">次の例では、ルート制約とデータ トークンを追加します。</span><span class="sxs-lookup"><span data-stu-id="36060-1438">The following example adds route constraints and data tokens:</span></span>

```csharp
routes.MapRoute(
    name: "us_english_products",
    template: "en-US/Products/{id}",
    defaults: new { controller = "Products", action = "Details" },
    constraints: new { id = new IntRouteConstraint() },
    dataTokens: new { locale = "en-US" });
```

<span data-ttu-id="36060-1439">上記のテンプレートでは `/en-US/Products/5` のような URL パスを照合し、値 `{ controller = Products, action = Details, id = 5 }` とデータ トークン `{ locale = en-US }` を抽出します。</span><span class="sxs-lookup"><span data-stu-id="36060-1439">The preceding template matches a URL path like `/en-US/Products/5` and extracts the values `{ controller = Products, action = Details, id = 5 }` and the data tokens `{ locale = en-US }`.</span></span>

![ローカル変数ウィンドウ トークン](routing/_static/tokens.png)

### <a name="route-class-url-generation"></a><span data-ttu-id="36060-1441">ルート クラス URL の生成</span><span class="sxs-lookup"><span data-stu-id="36060-1441">Route class URL generation</span></span>

<span data-ttu-id="36060-1442"><xref:Microsoft.AspNetCore.Routing.Route> クラスは、一連のルート値をそのルート テンプレートと組み合わせる方法でも URL を生成できます。</span><span class="sxs-lookup"><span data-stu-id="36060-1442">The <xref:Microsoft.AspNetCore.Routing.Route> class can also perform URL generation by combining a set of route values with its route template.</span></span> <span data-ttu-id="36060-1443">論理的には、URL パスの照合とは逆のプロセスになります。</span><span class="sxs-lookup"><span data-stu-id="36060-1443">This is logically the reverse process of matching the URL path.</span></span>

> [!TIP]
> <span data-ttu-id="36060-1444">URL 生成を理解する方法として、どのような URL を生成したいのかを考えてください。そして、ルート テンプレートがその URL にどのように照合されるのかを考えてください。</span><span class="sxs-lookup"><span data-stu-id="36060-1444">To better understand URL generation, imagine what URL you want to generate and then think about how a route template would match that URL.</span></span> <span data-ttu-id="36060-1445">どのような値が生成されるでしょうか。</span><span class="sxs-lookup"><span data-stu-id="36060-1445">What values would be produced?</span></span> <span data-ttu-id="36060-1446"><xref:Microsoft.AspNetCore.Routing.Route> クラスにおける URL 生成のしくみと大体同じになります。</span><span class="sxs-lookup"><span data-stu-id="36060-1446">This is the rough equivalent of how URL generation works in the <xref:Microsoft.AspNetCore.Routing.Route> class.</span></span>

<span data-ttu-id="36060-1447">次の例では、一般的な ASP.NET Core MVC の既定のルートを使用します。</span><span class="sxs-lookup"><span data-stu-id="36060-1447">The following example uses a general ASP.NET Core MVC default route:</span></span>

```csharp
routes.MapRoute(
    name: "default",
    template: "{controller=Home}/{action=Index}/{id?}");
```

<span data-ttu-id="36060-1448">ルート値が `{ controller = Products, action = List }` の場合、URL `/Products/List` が生成されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1448">With the route values `{ controller = Products, action = List }`, the URL `/Products/List` is generated.</span></span> <span data-ttu-id="36060-1449">ルート値が対応ルート パラメーターの代替となり、URL パスが作られます。</span><span class="sxs-lookup"><span data-stu-id="36060-1449">The route values are substituted for the corresponding route parameters to form the URL path.</span></span> <span data-ttu-id="36060-1450">`id` は任意のルート パラメーターであるため、URL は `id` の値なしで正常に生成されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1450">Since `id` is an optional route parameter, the URL is successfully generated without a value for `id`.</span></span>

<span data-ttu-id="36060-1451">ルート値が `{ controller = Home, action = Index }` の場合、URL `/` が生成されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1451">With the route values `{ controller = Home, action = Index }`, the URL `/` is generated.</span></span> <span data-ttu-id="36060-1452">指定されたルート値は既定値と一致し、その既定値に対応するセグメントを省略しても問題は発生しません。</span><span class="sxs-lookup"><span data-stu-id="36060-1452">The provided route values match the default values, and the segments corresponding to the default values are safely omitted.</span></span>

<span data-ttu-id="36060-1453">生成された両方の URL では、次のルート定義 (`/Home/Index` と `/`) でラウンドトリップされ、URL の生成に使用された同じルート値が生成されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1453">Both URLs generated round-trip with the following route definition (`/Home/Index` and `/`) produce the same route values that were used to generate the URL.</span></span>

> [!NOTE]
> <span data-ttu-id="36060-1454">アプリで ASP.NET Core MVC が使用される場合、ルーティングを直接呼び出す代わりに、<xref:Microsoft.AspNetCore.Mvc.Routing.UrlHelper> を使用して URL を生成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="36060-1454">An app using ASP.NET Core MVC should use <xref:Microsoft.AspNetCore.Mvc.Routing.UrlHelper> to generate URLs instead of calling into routing directly.</span></span>

<span data-ttu-id="36060-1455">URL 生成の詳細については、「[URL 生成参照](#url-generation-reference)」セクションを参照してください。</span><span class="sxs-lookup"><span data-stu-id="36060-1455">For more information on URL generation, see the [Url generation reference](#url-generation-reference) section.</span></span>

## <a name="use-routing-middleware"></a><span data-ttu-id="36060-1456">ルーティング ミドルウェアの使用</span><span class="sxs-lookup"><span data-stu-id="36060-1456">Use routing middleware</span></span>

<span data-ttu-id="36060-1457">アプリのプロジェクト ファイルの [Microsoft.AspNetCore.App メタパッケージ](xref:fundamentals/metapackage-app)を参照します。</span><span class="sxs-lookup"><span data-stu-id="36060-1457">Reference the [Microsoft.AspNetCore.App metapackage](xref:fundamentals/metapackage-app) in the app's project file.</span></span>

<span data-ttu-id="36060-1458">`Startup.ConfigureServices` でサービス コンテナーにルーティングを追加した例:</span><span class="sxs-lookup"><span data-stu-id="36060-1458">Add routing to the service container in `Startup.ConfigureServices`:</span></span>

[!code-csharp[](routing/samples/2.x/RoutingSample/Startup.cs?name=snippet_ConfigureServices&highlight=3)]

<span data-ttu-id="36060-1459">ルートは `Startup.Configure` メソッドで設定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="36060-1459">Routes must be configured in the `Startup.Configure` method.</span></span> <span data-ttu-id="36060-1460">サンプル アプリでは次の API を使用します。</span><span class="sxs-lookup"><span data-stu-id="36060-1460">The sample app uses the following APIs:</span></span>

* <xref:Microsoft.AspNetCore.Routing.RouteBuilder>
* <span data-ttu-id="36060-1461"><xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapGet*>:HTTP GET 要求のみを照合します。</span><span class="sxs-lookup"><span data-stu-id="36060-1461"><xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapGet*>: Matches only HTTP GET requests.</span></span>
* <xref:Microsoft.AspNetCore.Builder.RoutingBuilderExtensions.UseRouter*>

[!code-csharp[](routing/samples/2.x/RoutingSample/Startup.cs?name=snippet_RouteHandler)]

<span data-ttu-id="36060-1462">下の表は、応答と所与の URI をまとめたものです。</span><span class="sxs-lookup"><span data-stu-id="36060-1462">The following table shows the responses with the given URIs.</span></span>

| <span data-ttu-id="36060-1463">URI</span><span class="sxs-lookup"><span data-stu-id="36060-1463">URI</span></span>                    | <span data-ttu-id="36060-1464">応答</span><span class="sxs-lookup"><span data-stu-id="36060-1464">Response</span></span>                                          |
| ---------------------- | ------------------------------------------------- |
| `/package/create/3`    | <span data-ttu-id="36060-1465">Hello!</span><span class="sxs-lookup"><span data-stu-id="36060-1465">Hello!</span></span> <span data-ttu-id="36060-1466">Route values: [operation, create], [id, 3]</span><span class="sxs-lookup"><span data-stu-id="36060-1466">Route values: [operation, create], [id, 3]</span></span> |
| `/package/track/-3`    | <span data-ttu-id="36060-1467">Hello!</span><span class="sxs-lookup"><span data-stu-id="36060-1467">Hello!</span></span> <span data-ttu-id="36060-1468">Route values: [operation, track], [id, -3]</span><span class="sxs-lookup"><span data-stu-id="36060-1468">Route values: [operation, track], [id, -3]</span></span> |
| `/package/track/-3/`   | <span data-ttu-id="36060-1469">Hello!</span><span class="sxs-lookup"><span data-stu-id="36060-1469">Hello!</span></span> <span data-ttu-id="36060-1470">Route values: [operation, track], [id, -3]</span><span class="sxs-lookup"><span data-stu-id="36060-1470">Route values: [operation, track], [id, -3]</span></span> |
| `/package/track/`      | <span data-ttu-id="36060-1471">要求はフォール スルーし、一致するものはありません。</span><span class="sxs-lookup"><span data-stu-id="36060-1471">The request falls through, no match.</span></span>              |
| `GET /hello/Joe`       | <span data-ttu-id="36060-1472">Hi, Joe!</span><span class="sxs-lookup"><span data-stu-id="36060-1472">Hi, Joe!</span></span>                                          |
| `POST /hello/Joe`      | <span data-ttu-id="36060-1473">要求はフォール スルーし、HTTP GET のみが一致します。</span><span class="sxs-lookup"><span data-stu-id="36060-1473">The request falls through, matches HTTP GET only.</span></span> |
| `GET /hello/Joe/Smith` | <span data-ttu-id="36060-1474">要求はフォール スルーし、一致するものはありません。</span><span class="sxs-lookup"><span data-stu-id="36060-1474">The request falls through, no match.</span></span>              |

<span data-ttu-id="36060-1475">ルートを 1 つ構成する場合、<xref:Microsoft.AspNetCore.Builder.RoutingBuilderExtensions.UseRouter*> を呼び出し、`IRouter` インスタンスを渡します。</span><span class="sxs-lookup"><span data-stu-id="36060-1475">If you're configuring a single route, call <xref:Microsoft.AspNetCore.Builder.RoutingBuilderExtensions.UseRouter*> passing in an `IRouter` instance.</span></span> <span data-ttu-id="36060-1476"><xref:Microsoft.AspNetCore.Routing.RouteBuilder> を使用する必要はありません。</span><span class="sxs-lookup"><span data-stu-id="36060-1476">You won't need to use <xref:Microsoft.AspNetCore.Routing.RouteBuilder>.</span></span>

<span data-ttu-id="36060-1477">このフレームワークでは、ルートを作成するために拡張メソッド セット (<xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions>) が提供されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1477">The framework provides a set of extension methods for creating routes (<xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions>):</span></span>

* <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapDelete*>
* <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapGet*>
* <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapMiddlewareDelete*>
* <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapMiddlewareGet*>
* <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapMiddlewarePost*>
* <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapMiddlewarePut*>
* <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapMiddlewareRoute*>
* <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapMiddlewareVerb*>
* <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapPost*>
* <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapPut*>
* <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapRoute*>
* <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapVerb*>

<span data-ttu-id="36060-1478"><xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapGet*> など、リストされているメソッドの一部では、<xref:Microsoft.AspNetCore.Http.RequestDelegate> が必要です。</span><span class="sxs-lookup"><span data-stu-id="36060-1478">Some of listed methods, such as <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapGet*>, require a <xref:Microsoft.AspNetCore.Http.RequestDelegate>.</span></span> <span data-ttu-id="36060-1479"><xref:Microsoft.AspNetCore.Http.RequestDelegate> は、ルートが一致したとき、*ルート ハンドラー*として使用されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1479">The <xref:Microsoft.AspNetCore.Http.RequestDelegate> is used as the *route handler* when the route matches.</span></span> <span data-ttu-id="36060-1480">この仲間の他のメソッドでは、ルート ハンドラーとして使用されるミドルウェア パイプラインを構成できます。</span><span class="sxs-lookup"><span data-stu-id="36060-1480">Other methods in this family allow configuring a middleware pipeline for use as the route handler.</span></span> <span data-ttu-id="36060-1481">`Map*` メソッドで、<xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapRoute*> などのハンドラーを受け入れない場合、<xref:Microsoft.AspNetCore.Routing.RouteBuilder.DefaultHandler*> が使用されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1481">If the `Map*` method doesn't accept a handler, such as <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapRoute*>, it uses the <xref:Microsoft.AspNetCore.Routing.RouteBuilder.DefaultHandler*>.</span></span>

<span data-ttu-id="36060-1482">`Map[Verb]` メソッドは制約を利用し、メソッド名の HTTP Verb にルートを制限します。</span><span class="sxs-lookup"><span data-stu-id="36060-1482">The `Map[Verb]` methods use constraints to limit the route to the HTTP Verb in the method name.</span></span> <span data-ttu-id="36060-1483">たとえば、 <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapGet*> や <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapVerb*>を参照してください。</span><span class="sxs-lookup"><span data-stu-id="36060-1483">For example, see <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapGet*> and <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapVerb*>.</span></span>

## <a name="route-template-reference"></a><span data-ttu-id="36060-1484">ルート テンプレート参照</span><span class="sxs-lookup"><span data-stu-id="36060-1484">Route template reference</span></span>

<span data-ttu-id="36060-1485">中括弧 (`{ ... }`) 内のトークンは*ルート パラメーター*を定義します。ルートが一致した場合、これがバインドされます。</span><span class="sxs-lookup"><span data-stu-id="36060-1485">Tokens within curly braces (`{ ... }`) define *route parameters* that are bound if the route is matched.</span></span> <span data-ttu-id="36060-1486">1 つのルート セグメントで複数のルート パラメーターを定義できますが、リテラル値で区切る必要があります。</span><span class="sxs-lookup"><span data-stu-id="36060-1486">You can define more than one route parameter in a route segment, but they must be separated by a literal value.</span></span> <span data-ttu-id="36060-1487">たとえば、`{controller=Home}{action=Index}` は有効なルートになりません。`{controller}` と `{action}` の間にリテラル値がないためです。</span><span class="sxs-lookup"><span data-stu-id="36060-1487">For example, `{controller=Home}{action=Index}` isn't a valid route, since there's no literal value between `{controller}` and `{action}`.</span></span> <span data-ttu-id="36060-1488">このようなルート パラメーターには名前を付ける必要があります。付加的な属性を指定することもあります。</span><span class="sxs-lookup"><span data-stu-id="36060-1488">These route parameters must have a name and may have additional attributes specified.</span></span>

<span data-ttu-id="36060-1489">ルート パラメーター以外のリテラル テキスト (`{id}` など) とパス区切り `/` は URL のテキストに一致する必要があります。</span><span class="sxs-lookup"><span data-stu-id="36060-1489">Literal text other than route parameters (for example, `{id}`) and the path separator `/` must match the text in the URL.</span></span> <span data-ttu-id="36060-1490">テキスト照合は復号された URL パスを基盤とし、大文字と小文字が区別されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1490">Text matching is case-insensitive and based on the decoded representation of the URLs path.</span></span> <span data-ttu-id="36060-1491">リテラル ルート パラメーターの区切り記号 (`{` または `}`) を照合するには、文字を繰り返して区切り記号をエスケープします (`{{` または `}}`)。</span><span class="sxs-lookup"><span data-stu-id="36060-1491">To match a literal route parameter delimiter (`{` or `}`), escape the delimiter by repeating the character (`{{` or `}}`).</span></span>

<span data-ttu-id="36060-1492">任意のファイル拡張子が付いたファイル名のキャプチャを試行する URL パターンには、追加の考慮事項があります。</span><span class="sxs-lookup"><span data-stu-id="36060-1492">URL patterns that attempt to capture a file name with an optional file extension have additional considerations.</span></span> <span data-ttu-id="36060-1493">たとえば、テンプレート `files/{filename}.{ext?}` について考えてみます。</span><span class="sxs-lookup"><span data-stu-id="36060-1493">For example, consider the template `files/{filename}.{ext?}`.</span></span> <span data-ttu-id="36060-1494">`filename` と `ext` の両方の値が存在するときに、両方の値が入力されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1494">When values for both `filename` and `ext` exist, both values are populated.</span></span> <span data-ttu-id="36060-1495">URL に `filename` の値だけが存在する場合、末尾のピリオド (`.`) は任意であるため、このルートは一致となります。</span><span class="sxs-lookup"><span data-stu-id="36060-1495">If only a value for `filename` exists in the URL, the route matches because the trailing period (`.`) is  optional.</span></span> <span data-ttu-id="36060-1496">次の URL はこのルートに一致します。</span><span class="sxs-lookup"><span data-stu-id="36060-1496">The following URLs match this route:</span></span>

* `/files/myFile.txt`
* `/files/myFile`

<span data-ttu-id="36060-1497">ルート パラメーターのプレフィックスとしてアスタリスク (`*`) を使用し、URI の残りの部分にバインドできます。</span><span class="sxs-lookup"><span data-stu-id="36060-1497">You can use the asterisk (`*`) as a prefix to a route parameter to bind to the rest of the URI.</span></span> <span data-ttu-id="36060-1498">これは*キャッチオール* パラメーターと呼ばれています。</span><span class="sxs-lookup"><span data-stu-id="36060-1498">This is called a *catch-all* parameter.</span></span> <span data-ttu-id="36060-1499">たとえば、`blog/{*slug}` は、`/blog` で始まり、その後に (`slug` ルート値に割り当てられる) 任意の値が続くあらゆる URI に一致します。</span><span class="sxs-lookup"><span data-stu-id="36060-1499">For example, `blog/{*slug}` matches any URI that starts with `/blog` and has any value following it, which is assigned to the `slug` route value.</span></span> <span data-ttu-id="36060-1500">キャッチオール パラメーターは空の文字列に一致することもあります。</span><span class="sxs-lookup"><span data-stu-id="36060-1500">Catch-all parameters can also match the empty string.</span></span>

<span data-ttu-id="36060-1501">キャッチオール パラメーターでは、パス区切り (`/`) 文字を含め、URL の生成にルートが使用されるときに適切な文字がエスケープされます。</span><span class="sxs-lookup"><span data-stu-id="36060-1501">The catch-all parameter escapes the appropriate characters when the route is used to generate a URL, including path separator (`/`) characters.</span></span> <span data-ttu-id="36060-1502">たとえば、ルート値が `{ path = "my/path" }` のルート `foo/{*path}` では、`foo/my%2Fpath` が生成されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1502">For example, the route `foo/{*path}` with route values `{ path = "my/path" }` generates `foo/my%2Fpath`.</span></span> <span data-ttu-id="36060-1503">エスケープされたスラッシュに注意してください。</span><span class="sxs-lookup"><span data-stu-id="36060-1503">Note the escaped forward slash.</span></span>

<span data-ttu-id="36060-1504">ルート パラメーターには、*既定値* が含まれることがあります。パラメーター名の後に既定値を指定し、等号 (`=`) で区切ることで指定されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1504">Route parameters may have *default values* designated by specifying the default value after the parameter name separated by an equals sign (`=`).</span></span> <span data-ttu-id="36060-1505">たとえば、`{controller=Home}` では、`controller` の既定値として `Home` が定義されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1505">For example, `{controller=Home}` defines `Home` as the default value for `controller`.</span></span> <span data-ttu-id="36060-1506">パラメーターの URL に値がない場合、既定値が使用されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1506">The default value is used if no value is present in the URL for the parameter.</span></span> <span data-ttu-id="36060-1507">ルート パラメーターは、`id?` のように、パラメーター名の終わりに疑問符 (`?`) を追加することでオプションとして扱われます。</span><span class="sxs-lookup"><span data-stu-id="36060-1507">Route parameters are made optional by appending a question mark (`?`) to the end of the parameter name, as in `id?`.</span></span> <span data-ttu-id="36060-1508">オプション値と既定ルート パラメーターの違いは、既定値を含むルート パラメーターは常に値を生成するのに対し、オプションのパラメーターには、要求 URL によって値が指定されたときにのみ値が与えられることにあります。</span><span class="sxs-lookup"><span data-stu-id="36060-1508">The difference between optional values and default route parameters is that a route parameter with a default value always produces a value&mdash;an optional parameter has a value only when a value is provided by the request URL.</span></span>

<span data-ttu-id="36060-1509">ルート パラメーターには、URL からバインドされるルート値に一致しなければならないという制約が含まれることがあります。</span><span class="sxs-lookup"><span data-stu-id="36060-1509">Route parameters may have constraints that must match the route value bound from the URL.</span></span> <span data-ttu-id="36060-1510">コロン (`:`) と制約名をルート パラメーター名の後に追加すると、ルート パラメーターの*インライン制約*が指定されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1510">Adding a colon (`:`) and constraint name after the route parameter name specifies an *inline constraint* on a route parameter.</span></span> <span data-ttu-id="36060-1511">その制約で引数が要求される場合、制約名の後にかっこ (`(...)`) で囲まれます。</span><span class="sxs-lookup"><span data-stu-id="36060-1511">If the constraint requires arguments, they're enclosed in parentheses (`(...)`) after the constraint name.</span></span> <span data-ttu-id="36060-1512">別のコロン (`:`) と制約名を追加することで、複数のインライン制約を指定できます。</span><span class="sxs-lookup"><span data-stu-id="36060-1512">Multiple inline constraints can be specified by appending another colon (`:`) and constraint name.</span></span>

<span data-ttu-id="36060-1513">制約名と引数が <xref:Microsoft.AspNetCore.Routing.IInlineConstraintResolver> サービスに渡され、URL 処理で使用する <xref:Microsoft.AspNetCore.Routing.IRouteConstraint> のインスタンスが作成されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1513">The constraint name and arguments are passed to the <xref:Microsoft.AspNetCore.Routing.IInlineConstraintResolver> service to create an instance of <xref:Microsoft.AspNetCore.Routing.IRouteConstraint> to use in URL processing.</span></span> <span data-ttu-id="36060-1514">たとえば、ルート テンプレート `blog/{article:minlength(10)}` によって、制約 `minlength` と引数 `10` が指定されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1514">For example, the route template `blog/{article:minlength(10)}` specifies a `minlength` constraint with the argument `10`.</span></span> <span data-ttu-id="36060-1515">ルート制約の詳細とこのフレームワークによって指定される制約のリストについては、「[ルート制約参照](#route-constraint-reference)」セクションを参照してください。</span><span class="sxs-lookup"><span data-stu-id="36060-1515">For more information on route constraints and a list of the constraints provided by the framework, see the [Route constraint reference](#route-constraint-reference) section.</span></span>

<span data-ttu-id="36060-1516">次の表は、ルート テンプレートの例とその動作をまとめたものです。</span><span class="sxs-lookup"><span data-stu-id="36060-1516">The following table demonstrates example route templates and their behavior.</span></span>

| <span data-ttu-id="36060-1517">ルート テンプレート</span><span class="sxs-lookup"><span data-stu-id="36060-1517">Route Template</span></span>                           | <span data-ttu-id="36060-1518">一致する URI の例</span><span class="sxs-lookup"><span data-stu-id="36060-1518">Example Matching URI</span></span>    | <span data-ttu-id="36060-1519">要求 URI&hellip;</span><span class="sxs-lookup"><span data-stu-id="36060-1519">The request URI&hellip;</span></span>                                                    |
| ---------------------------------------- | ----------------------- | -------------------------------------------------------------------------- |
| `hello`                                  | `/hello`                | <span data-ttu-id="36060-1520">単一パス `/hello` にのみ一致します。</span><span class="sxs-lookup"><span data-stu-id="36060-1520">Only matches the single path `/hello`.</span></span>                                     |
| `{Page=Home}`                            | `/`                     | <span data-ttu-id="36060-1521">一致し、`Page` が `Home` に設定されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1521">Matches and sets `Page` to `Home`.</span></span>                                         |
| `{Page=Home}`                            | `/Contact`              | <span data-ttu-id="36060-1522">一致し、`Page` が `Contact` に設定されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1522">Matches and sets `Page` to `Contact`.</span></span>                                      |
| `{controller}/{action}/{id?}`            | `/Products/List`        | <span data-ttu-id="36060-1523">`Products` コントローラーと `List` アクションにマッピングされます。</span><span class="sxs-lookup"><span data-stu-id="36060-1523">Maps to the `Products` controller and `List` action.</span></span>                       |
| `{controller}/{action}/{id?}`            | `/Products/Details/123` | <span data-ttu-id="36060-1524">`Products` コントローラーと `Details` アクションにマッピングされます (`id` は 123 に設定されます)。</span><span class="sxs-lookup"><span data-stu-id="36060-1524">Maps to the `Products` controller and  `Details` action (`id` set to 123).</span></span> |
| `{controller=Home}/{action=Index}/{id?}` | `/`                     | <span data-ttu-id="36060-1525">`Home` コントローラーと `Index` メソッドにマッピングされます (`id` は無視されます)。</span><span class="sxs-lookup"><span data-stu-id="36060-1525">Maps to the `Home` controller and `Index` method (`id` is ignored).</span></span>        |

<span data-ttu-id="36060-1526">一般的に、テンプレートの利用が最も簡単なルーティングの手法となります。</span><span class="sxs-lookup"><span data-stu-id="36060-1526">Using a template is generally the simplest approach to routing.</span></span> <span data-ttu-id="36060-1527">ルート テンプレート以外では、制約と既定値も指定できます。</span><span class="sxs-lookup"><span data-stu-id="36060-1527">Constraints and defaults can also be specified outside the route template.</span></span>

> [!TIP]
> <span data-ttu-id="36060-1528">[ログ](xref:fundamentals/logging/index)を有効にすると、<xref:Microsoft.AspNetCore.Routing.Route> など、組み込みのルーティング実装で要求を照合するしくみを確認できます。</span><span class="sxs-lookup"><span data-stu-id="36060-1528">Enable [Logging](xref:fundamentals/logging/index) to see how the built-in routing implementations, such as <xref:Microsoft.AspNetCore.Routing.Route>, match requests.</span></span>

## <a name="route-constraint-reference"></a><span data-ttu-id="36060-1529">ルート制約参照</span><span class="sxs-lookup"><span data-stu-id="36060-1529">Route constraint reference</span></span>

<span data-ttu-id="36060-1530">ルート制約は、受信 URL と一致し、URL パスがルート値にトークン化されたときに実行されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1530">Route constraints execute when a match has occurred to the incoming URL and the URL path is tokenized into route values.</span></span> <span data-ttu-id="36060-1531">ルート制約では、通常、ルート テンプレート経由で関連付けられるルート値を調べ、値が許容できるかどうかをはい/いいえで決定します。</span><span class="sxs-lookup"><span data-stu-id="36060-1531">Route constraints generally inspect the route value associated via the route template and make a yes/no decision about whether or not the value is acceptable.</span></span> <span data-ttu-id="36060-1532">一部のルート制約では、ルート値以外のデータを使用し、要求をルーティングできるかどうかが考慮されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1532">Some route constraints use data outside the route value to consider whether the request can be routed.</span></span> <span data-ttu-id="36060-1533">たとえば、<xref:Microsoft.AspNetCore.Routing.Constraints.HttpMethodRouteConstraint> はその HTTP Verb に基づいて要求を承認または却下します。</span><span class="sxs-lookup"><span data-stu-id="36060-1533">For example, the <xref:Microsoft.AspNetCore.Routing.Constraints.HttpMethodRouteConstraint> can accept or reject a request based on its HTTP verb.</span></span> <span data-ttu-id="36060-1534">制約は、要求のルーティングとリンクの生成で使用されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1534">Constraints are used in routing requests and link generation.</span></span>

> [!WARNING]
> <span data-ttu-id="36060-1535">**入力の検証**には制約を使用しないでください。</span><span class="sxs-lookup"><span data-stu-id="36060-1535">Don't use constraints for **input validation**.</span></span> <span data-ttu-id="36060-1536">**入力の検証**に制約が使用されると、無効な入力の結果、*400 - Bad Request* と適切なエラー メッセージではなく、*404 - Not Found* が表示されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1536">If constraints are used for **input validation**, invalid input results in a *404 - Not Found* response instead of a *400 - Bad Request* with an appropriate error message.</span></span> <span data-ttu-id="36060-1537">ルート制約は、特定のルートに対する入力の妥当性を検証するためではなく、似たようなルートの**違いを明らかにする**ために使用されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1537">Route constraints are used to **disambiguate** similar routes, not to validate the inputs for a particular route.</span></span>

<span data-ttu-id="36060-1538">次の表は、ルート制約の例とそれに求められる動作をまとめたものです。</span><span class="sxs-lookup"><span data-stu-id="36060-1538">The following table demonstrates example route constraints and their expected behavior.</span></span>

| <span data-ttu-id="36060-1539">制約</span><span class="sxs-lookup"><span data-stu-id="36060-1539">constraint</span></span> | <span data-ttu-id="36060-1540">例</span><span class="sxs-lookup"><span data-stu-id="36060-1540">Example</span></span> | <span data-ttu-id="36060-1541">一致の例</span><span class="sxs-lookup"><span data-stu-id="36060-1541">Example Matches</span></span> | <span data-ttu-id="36060-1542">メモ</span><span class="sxs-lookup"><span data-stu-id="36060-1542">Notes</span></span> |
| ---------- | ------- | --------------- | ----- |
| `int` | `{id:int}` | <span data-ttu-id="36060-1543">`123456789`、`-123456789`</span><span class="sxs-lookup"><span data-stu-id="36060-1543">`123456789`, `-123456789`</span></span> | <span data-ttu-id="36060-1544">あらゆる整数に一致する</span><span class="sxs-lookup"><span data-stu-id="36060-1544">Matches any integer</span></span> |
| `bool` | `{active:bool}` | <span data-ttu-id="36060-1545">`true`、`FALSE`</span><span class="sxs-lookup"><span data-stu-id="36060-1545">`true`, `FALSE`</span></span> | <span data-ttu-id="36060-1546">`true` または `false` に一致する (大文字と小文字を区別しません)</span><span class="sxs-lookup"><span data-stu-id="36060-1546">Matches `true` or `false` (case-insensitive)</span></span> |
| `datetime` | `{dob:datetime}` | <span data-ttu-id="36060-1547">`2016-12-31`、`2016-12-31 7:32pm`</span><span class="sxs-lookup"><span data-stu-id="36060-1547">`2016-12-31`, `2016-12-31 7:32pm`</span></span> | <span data-ttu-id="36060-1548">インバリアント カルチャの有効な `DateTime` 値に一致します。</span><span class="sxs-lookup"><span data-stu-id="36060-1548">Matches a valid `DateTime` value in the invariant culture.</span></span> <span data-ttu-id="36060-1549">前の警告を参照してください。</span><span class="sxs-lookup"><span data-stu-id="36060-1549">See  preceding warning.</span></span>|
| `decimal` | `{price:decimal}` | <span data-ttu-id="36060-1550">`49.99`、`-1,000.01`</span><span class="sxs-lookup"><span data-stu-id="36060-1550">`49.99`, `-1,000.01`</span></span> | <span data-ttu-id="36060-1551">インバリアント カルチャの有効な `decimal` 値に一致します。</span><span class="sxs-lookup"><span data-stu-id="36060-1551">Matches a valid `decimal` value in the invariant culture.</span></span> <span data-ttu-id="36060-1552">前の警告を参照してください。</span><span class="sxs-lookup"><span data-stu-id="36060-1552">See  preceding warning.</span></span>|
| `double` | `{weight:double}` | <span data-ttu-id="36060-1553">`1.234`、`-1,001.01e8`</span><span class="sxs-lookup"><span data-stu-id="36060-1553">`1.234`, `-1,001.01e8`</span></span> | <span data-ttu-id="36060-1554">インバリアント カルチャの有効な `double` 値に一致します。</span><span class="sxs-lookup"><span data-stu-id="36060-1554">Matches a valid `double` value in the invariant culture.</span></span> <span data-ttu-id="36060-1555">前の警告を参照してください。</span><span class="sxs-lookup"><span data-stu-id="36060-1555">See  preceding warning.</span></span>|
| `float` | `{weight:float}` | <span data-ttu-id="36060-1556">`1.234`、`-1,001.01e8`</span><span class="sxs-lookup"><span data-stu-id="36060-1556">`1.234`, `-1,001.01e8`</span></span> | <span data-ttu-id="36060-1557">インバリアント カルチャの有効な `float` 値に一致します。</span><span class="sxs-lookup"><span data-stu-id="36060-1557">Matches a valid `float` value in the invariant culture.</span></span> <span data-ttu-id="36060-1558">前の警告を参照してください。</span><span class="sxs-lookup"><span data-stu-id="36060-1558">See  preceding warning.</span></span>|
| `guid` | `{id:guid}` | <span data-ttu-id="36060-1559">`CD2C1638-1638-72D5-1638-DEADBEEF1638`、`{CD2C1638-1638-72D5-1638-DEADBEEF1638}`</span><span class="sxs-lookup"><span data-stu-id="36060-1559">`CD2C1638-1638-72D5-1638-DEADBEEF1638`, `{CD2C1638-1638-72D5-1638-DEADBEEF1638}`</span></span> | <span data-ttu-id="36060-1560">有効な `Guid` 値に一致する</span><span class="sxs-lookup"><span data-stu-id="36060-1560">Matches a valid `Guid` value</span></span> |
| `long` | `{ticks:long}` | <span data-ttu-id="36060-1561">`123456789`、`-123456789`</span><span class="sxs-lookup"><span data-stu-id="36060-1561">`123456789`, `-123456789`</span></span> | <span data-ttu-id="36060-1562">有効な `long` 値に一致する</span><span class="sxs-lookup"><span data-stu-id="36060-1562">Matches a valid `long` value</span></span> |
| `minlength(value)` | `{username:minlength(4)}` | `Rick` | <span data-ttu-id="36060-1563">4 文字以上の文字列であることが必要</span><span class="sxs-lookup"><span data-stu-id="36060-1563">String must be at least 4 characters</span></span> |
| `maxlength(value)` | `{filename:maxlength(8)}` | `Richard` | <span data-ttu-id="36060-1564">8 文字以内の文字列であることが必要</span><span class="sxs-lookup"><span data-stu-id="36060-1564">String must be no more than 8 characters</span></span> |
| `length(length)` | `{filename:length(12)}` | `somefile.txt` | <span data-ttu-id="36060-1565">厳密に 12 文字の文字列であることが必要</span><span class="sxs-lookup"><span data-stu-id="36060-1565">String must be exactly 12 characters long</span></span> |
| `length(min,max)` | `{filename:length(8,16)}` | `somefile.txt` | <span data-ttu-id="36060-1566">8 文字以上、16 文字以内の文字列であることが必要</span><span class="sxs-lookup"><span data-stu-id="36060-1566">String must be at least 8 and no more than 16 characters long</span></span> |
| `min(value)` | `{age:min(18)}` | `19` | <span data-ttu-id="36060-1567">18 以上の整数値であることが必要</span><span class="sxs-lookup"><span data-stu-id="36060-1567">Integer value must be at least 18</span></span> |
| `max(value)` | `{age:max(120)}` | `91` | <span data-ttu-id="36060-1568">120 以下の整数値であることが必要</span><span class="sxs-lookup"><span data-stu-id="36060-1568">Integer value must be no more than 120</span></span> |
| `range(min,max)` | `{age:range(18,120)}` | `91` | <span data-ttu-id="36060-1569">18 以上、120 以下の整数値であることが必要</span><span class="sxs-lookup"><span data-stu-id="36060-1569">Integer value must be at least 18 but no more than 120</span></span> |
| `alpha` | `{name:alpha}` | `Rick` | <span data-ttu-id="36060-1570">1 つまたは複数のアルファベット文字で構成される文字列が必要 (`a`-`z`、大文字と小文字を区別)</span><span class="sxs-lookup"><span data-stu-id="36060-1570">String must consist of one or more alphabetical characters (`a`-`z`, case-insensitive)</span></span> |
| `regex(expression)` | `{ssn:regex(^\\d{{3}}-\\d{{2}}-\\d{{4}}$)}` | `123-45-6789` | <span data-ttu-id="36060-1571">正規表現に一致する文字列が必要 (正規表現の定義についてはヒントを参照)</span><span class="sxs-lookup"><span data-stu-id="36060-1571">String must match the regular expression (see tips about defining a regular expression)</span></span> |
| `required` | `{name:required}` | `Rick` | <span data-ttu-id="36060-1572">URL 生成中、非パラメーターが提示されるように強制する</span><span class="sxs-lookup"><span data-stu-id="36060-1572">Used to enforce that a non-parameter value is present during URL generation</span></span> |

<span data-ttu-id="36060-1573">コロンで区切られた複数の制約を単一のパラメーターに適用することができます。</span><span class="sxs-lookup"><span data-stu-id="36060-1573">Multiple, colon-delimited constraints can be applied to a single parameter.</span></span> <span data-ttu-id="36060-1574">たとえば、次の制約では、パラメーターが 1 以上の整数値に制限されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1574">For example, the following constraint restricts a parameter to an integer value of 1 or greater:</span></span>

```csharp
[Route("users/{id:int:min(1)}")]
public User GetUserById(int id) { }
```

> [!WARNING]
> <span data-ttu-id="36060-1575">URL の妥当性を検証し、CLR 型 (`int` や `DateTime` など) に変換されるルート制約では、常にインバリアント カルチャが使用されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1575">Route constraints that verify the URL and are converted to a CLR type (such as `int` or `DateTime`) always use the invariant culture.</span></span> <span data-ttu-id="36060-1576">これらの制約では、URL がローカライズ不可であることが前提となります。</span><span class="sxs-lookup"><span data-stu-id="36060-1576">These constraints assume that the URL is non-localizable.</span></span> <span data-ttu-id="36060-1577">フレームワークから提供されるルート制約がルート値に格納されている値を変更することはありません。</span><span class="sxs-lookup"><span data-stu-id="36060-1577">The framework-provided route constraints don't modify the values stored in route values.</span></span> <span data-ttu-id="36060-1578">URL から解析されたルート値はすべて文字列として格納されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1578">All route values parsed from the URL are stored as strings.</span></span> <span data-ttu-id="36060-1579">たとえば、`float` 制約はルート値を浮動小数に変換しますが、変換された値は、浮動小数に変換できることを検証するためにだけ利用されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1579">For example, the `float` constraint attempts to convert the route value to a float, but the converted value is used only to verify it can be converted to a float.</span></span>

## <a name="regular-expressions"></a><span data-ttu-id="36060-1580">正規表現</span><span class="sxs-lookup"><span data-stu-id="36060-1580">Regular expressions</span></span>

<span data-ttu-id="36060-1581">ASP.NET Core フレームワークでは、正規表現コンストラクターに `RegexOptions.IgnoreCase | RegexOptions.Compiled | RegexOptions.CultureInvariant` が追加されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1581">The ASP.NET Core framework adds `RegexOptions.IgnoreCase | RegexOptions.Compiled | RegexOptions.CultureInvariant` to the regular expression constructor.</span></span> <span data-ttu-id="36060-1582">これらのメンバーの詳細については、「<xref:System.Text.RegularExpressions.RegexOptions>」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="36060-1582">See <xref:System.Text.RegularExpressions.RegexOptions> for a description of these members.</span></span>

<span data-ttu-id="36060-1583">正規表現では、ルーティングや C# 言語で使用されるものに似た区切り記号とトークンが使用されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1583">Regular expressions use delimiters and tokens similar to those used by Routing and the C# language.</span></span> <span data-ttu-id="36060-1584">正規表現トークンはエスケープする必要があります。</span><span class="sxs-lookup"><span data-stu-id="36060-1584">Regular expression tokens must be escaped.</span></span> <span data-ttu-id="36060-1585">ルーティングで正規表現 `^\d{3}-\d{2}-\d{4}$` を使用するには、C# ソース ファイルで `\\` (二重円記号) 文字として文字列に `\` (単一の円記号) 文字を指定し、文字列エスケープ文字である `\` をエスケープする必要があります ([逐語的な文字列リテラル](/dotnet/csharp/language-reference/keywords/string)を使用しない限り)。</span><span class="sxs-lookup"><span data-stu-id="36060-1585">To use the regular expression `^\d{3}-\d{2}-\d{4}$` in routing, the expression must have the `\` (single backslash) characters provided in the string as `\\` (double backslash) characters in the C# source file in order to escape the `\` string escape character (unless using [verbatim string literals](/dotnet/csharp/language-reference/keywords/string)).</span></span> <span data-ttu-id="36060-1586">ルーティング パラメーター区切り記号文字 (`{`、`}`、`[`、`]`) をエスケープするには、表現の文字を二重にします (`{{`、`}`、`[[`、`]]`)。</span><span class="sxs-lookup"><span data-stu-id="36060-1586">To escape routing parameter delimiter characters (`{`, `}`, `[`, `]`), double the characters in the expression (`{{`, `}`, `[[`, `]]`).</span></span> <span data-ttu-id="36060-1587">次の表に、正規表現とエスケープ適用後のものを示します。</span><span class="sxs-lookup"><span data-stu-id="36060-1587">The following table shows a regular expression and the escaped version.</span></span>

| <span data-ttu-id="36060-1588">正規表現</span><span class="sxs-lookup"><span data-stu-id="36060-1588">Regular Expression</span></span>    | <span data-ttu-id="36060-1589">エスケープ適用後の正規表現</span><span class="sxs-lookup"><span data-stu-id="36060-1589">Escaped Regular Expression</span></span>     |
| --------------------- | ------------------------------ |
| `^\d{3}-\d{2}-\d{4}$` | `^\\d{{3}}-\\d{{2}}-\\d{{4}}$` |
| `^[a-z]{2}$`          | `^[[a-z]]{{2}}$`               |

<span data-ttu-id="36060-1590">ルーティングで使用される正規表現は、多くの場合、キャレット (`^`) 文字で始まり、文字列の開始位置と一致します。</span><span class="sxs-lookup"><span data-stu-id="36060-1590">Regular expressions used in routing often start with the caret (`^`) character and match starting position of the string.</span></span> <span data-ttu-id="36060-1591">表現は、多くの場合、ドル記号 (`$`) で終わり、文字列の末尾と一致します。</span><span class="sxs-lookup"><span data-stu-id="36060-1591">The expressions often end with the dollar sign (`$`) character and match end of the string.</span></span> <span data-ttu-id="36060-1592">`^` 文字と `$` 文字により、正規表現はルート パラメーター値全体に一致します。</span><span class="sxs-lookup"><span data-stu-id="36060-1592">The `^` and `$` characters ensure that the regular expression match the entire route parameter value.</span></span> <span data-ttu-id="36060-1593">`^` 文字と `$` 文字がなければ、正規表現は、文字列内のあらゆる部分文字列に一致します。それは多くの場合、意図に反することです。</span><span class="sxs-lookup"><span data-stu-id="36060-1593">Without the `^` and `$` characters, the regular expression match any substring within the string, which is often undesirable.</span></span> <span data-ttu-id="36060-1594">下の表では例を示し、それらが一致する、または一致しない理由について説明します。</span><span class="sxs-lookup"><span data-stu-id="36060-1594">The following table provides examples and explains why they match or fail to match.</span></span>

| <span data-ttu-id="36060-1595">式</span><span class="sxs-lookup"><span data-stu-id="36060-1595">Expression</span></span>   | <span data-ttu-id="36060-1596">String</span><span class="sxs-lookup"><span data-stu-id="36060-1596">String</span></span>    | <span data-ttu-id="36060-1597">一致したもの</span><span class="sxs-lookup"><span data-stu-id="36060-1597">Match</span></span> | <span data-ttu-id="36060-1598">コメント</span><span class="sxs-lookup"><span data-stu-id="36060-1598">Comment</span></span>               |
| ------------ | --------- | :---: |  -------------------- |
| `[a-z]{2}`   | <span data-ttu-id="36060-1599">hello</span><span class="sxs-lookup"><span data-stu-id="36060-1599">hello</span></span>     | <span data-ttu-id="36060-1600">はい</span><span class="sxs-lookup"><span data-stu-id="36060-1600">Yes</span></span>   | <span data-ttu-id="36060-1601">サブ文字列の一致</span><span class="sxs-lookup"><span data-stu-id="36060-1601">Substring matches</span></span>     |
| `[a-z]{2}`   | <span data-ttu-id="36060-1602">123abc456</span><span class="sxs-lookup"><span data-stu-id="36060-1602">123abc456</span></span> | <span data-ttu-id="36060-1603">はい</span><span class="sxs-lookup"><span data-stu-id="36060-1603">Yes</span></span>   | <span data-ttu-id="36060-1604">サブ文字列の一致</span><span class="sxs-lookup"><span data-stu-id="36060-1604">Substring matches</span></span>     |
| `[a-z]{2}`   | <span data-ttu-id="36060-1605">mz</span><span class="sxs-lookup"><span data-stu-id="36060-1605">mz</span></span>        | <span data-ttu-id="36060-1606">はい</span><span class="sxs-lookup"><span data-stu-id="36060-1606">Yes</span></span>   | <span data-ttu-id="36060-1607">一致する表現</span><span class="sxs-lookup"><span data-stu-id="36060-1607">Matches expression</span></span>    |
| `[a-z]{2}`   | <span data-ttu-id="36060-1608">MZ</span><span class="sxs-lookup"><span data-stu-id="36060-1608">MZ</span></span>        | <span data-ttu-id="36060-1609">はい</span><span class="sxs-lookup"><span data-stu-id="36060-1609">Yes</span></span>   | <span data-ttu-id="36060-1610">大文字と小文字の使い方が違う</span><span class="sxs-lookup"><span data-stu-id="36060-1610">Not case sensitive</span></span>    |
| `^[a-z]{2}$` | <span data-ttu-id="36060-1611">hello</span><span class="sxs-lookup"><span data-stu-id="36060-1611">hello</span></span>     | <span data-ttu-id="36060-1612">いいえ</span><span class="sxs-lookup"><span data-stu-id="36060-1612">No</span></span>    | <span data-ttu-id="36060-1613">上の `^` と `$` を参照</span><span class="sxs-lookup"><span data-stu-id="36060-1613">See `^` and `$` above</span></span> |
| `^[a-z]{2}$` | <span data-ttu-id="36060-1614">123abc456</span><span class="sxs-lookup"><span data-stu-id="36060-1614">123abc456</span></span> | <span data-ttu-id="36060-1615">いいえ</span><span class="sxs-lookup"><span data-stu-id="36060-1615">No</span></span>    | <span data-ttu-id="36060-1616">上の `^` と `$` を参照</span><span class="sxs-lookup"><span data-stu-id="36060-1616">See `^` and `$` above</span></span> |

<span data-ttu-id="36060-1617">正規表現構文の詳細については、[.NET Framework 正規表現](/dotnet/standard/base-types/regular-expression-language-quick-reference)に関するページを参照してください。</span><span class="sxs-lookup"><span data-stu-id="36060-1617">For more information on regular expression syntax, see [.NET Framework Regular Expressions](/dotnet/standard/base-types/regular-expression-language-quick-reference).</span></span>

<span data-ttu-id="36060-1618">既知の入力可能値の集まりにパラメーターを制限するには、正規表現を使用します。</span><span class="sxs-lookup"><span data-stu-id="36060-1618">To constrain a parameter to a known set of possible values, use a regular expression.</span></span> <span data-ttu-id="36060-1619">たとえば、`{action:regex(^(list|get|create)$)}` の場合、`action` ルート値は `list`、`get`、`create` とのみ照合されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1619">For example, `{action:regex(^(list|get|create)$)}` only matches the `action` route value to `list`, `get`, or `create`.</span></span> <span data-ttu-id="36060-1620">制約ディクショナリに渡された場合、文字列 `^(list|get|create)$` で同じものになります。</span><span class="sxs-lookup"><span data-stu-id="36060-1620">If passed into the constraints dictionary, the string `^(list|get|create)$` is equivalent.</span></span> <span data-ttu-id="36060-1621">(テンプレート内でインラインではなく) 制約ディクショナリに渡された制約が既知の制約に一致しない場合も、正規表現として扱われます。</span><span class="sxs-lookup"><span data-stu-id="36060-1621">Constraints that are passed in the constraints dictionary (not inline within a template) that don't match one of the known constraints are also treated as regular expressions.</span></span>

## <a name="custom-route-constraints"></a><span data-ttu-id="36060-1622">カスタム ルート制約</span><span class="sxs-lookup"><span data-stu-id="36060-1622">Custom Route Constraints</span></span>

<span data-ttu-id="36060-1623">組み込みのルート制約だけでなく、<xref:Microsoft.AspNetCore.Routing.IRouteConstraint> インターフェイスを実装してカスタム ルート制約を作成することができます。</span><span class="sxs-lookup"><span data-stu-id="36060-1623">In addition to the built-in route constraints, custom route constraints can be created by implementing the <xref:Microsoft.AspNetCore.Routing.IRouteConstraint> interface.</span></span> <span data-ttu-id="36060-1624"><xref:Microsoft.AspNetCore.Routing.IRouteConstraint> インターフェイスには、1 つのメソッド `Match` が含まれています。これは、制約が満たされている場合は `true` を、それ以外の場合は `false` を返します。</span><span class="sxs-lookup"><span data-stu-id="36060-1624">The <xref:Microsoft.AspNetCore.Routing.IRouteConstraint> interface contains a single method, `Match`, which returns `true` if the constraint is satisfied and `false` otherwise.</span></span>

<span data-ttu-id="36060-1625">カスタムの <xref:Microsoft.AspNetCore.Routing.IRouteConstraint> を使うには、アプリのサービス コンテナー内にあるアプリの <xref:Microsoft.AspNetCore.Routing.RouteOptions.ConstraintMap> に、ルート制約の種類を登録する必要があります。</span><span class="sxs-lookup"><span data-stu-id="36060-1625">To use a custom <xref:Microsoft.AspNetCore.Routing.IRouteConstraint>, the route constraint type must be registered with the app's <xref:Microsoft.AspNetCore.Routing.RouteOptions.ConstraintMap> in the app's service container.</span></span> <span data-ttu-id="36060-1626"><xref:Microsoft.AspNetCore.Routing.RouteOptions.ConstraintMap> は、ルート制約キーを、その制約を検証する <xref:Microsoft.AspNetCore.Routing.IRouteConstraint> の実装にマッピングするディクショナリです。</span><span class="sxs-lookup"><span data-stu-id="36060-1626">A <xref:Microsoft.AspNetCore.Routing.RouteOptions.ConstraintMap> is a dictionary that maps route constraint keys to <xref:Microsoft.AspNetCore.Routing.IRouteConstraint> implementations that validate those constraints.</span></span> <span data-ttu-id="36060-1627">アプリの <xref:Microsoft.AspNetCore.Routing.RouteOptions.ConstraintMap> は、`Startup.ConfigureServices` で、[services.AddRouting](xref:Microsoft.Extensions.DependencyInjection.RoutingServiceCollectionExtensions.AddRouting*) 呼び出しの一部として、または `services.Configure<RouteOptions>` を使って <xref:Microsoft.AspNetCore.Routing.RouteOptions> を直接構成することで、更新できます。</span><span class="sxs-lookup"><span data-stu-id="36060-1627">An app's <xref:Microsoft.AspNetCore.Routing.RouteOptions.ConstraintMap> can be updated in `Startup.ConfigureServices` either as part of a [services.AddRouting](xref:Microsoft.Extensions.DependencyInjection.RoutingServiceCollectionExtensions.AddRouting*) call or by configuring <xref:Microsoft.AspNetCore.Routing.RouteOptions> directly with `services.Configure<RouteOptions>`.</span></span> <span data-ttu-id="36060-1628">次に例を示します。</span><span class="sxs-lookup"><span data-stu-id="36060-1628">For example:</span></span>

```csharp
services.AddRouting(options =>
{
    options.ConstraintMap.Add("customName", typeof(MyCustomConstraint));
});
```

<span data-ttu-id="36060-1629">これで、制約の種類を登録するときに指定した名前を使って、通常の方法でルートに制約を適用できます。</span><span class="sxs-lookup"><span data-stu-id="36060-1629">The constraint can then be applied to routes in the usual manner, using the name specified when registering the constraint type.</span></span> <span data-ttu-id="36060-1630">次に例を示します。</span><span class="sxs-lookup"><span data-stu-id="36060-1630">For example:</span></span>

```csharp
[HttpGet("{id:customName}")]
public ActionResult<string> Get(string id)
```

## <a name="url-generation-reference"></a><span data-ttu-id="36060-1631">URL 生成参照</span><span class="sxs-lookup"><span data-stu-id="36060-1631">URL generation reference</span></span>

<span data-ttu-id="36060-1632">次の例では、ルートのリンクを生成する方法を確認できます。ルート値のディクショナリと <xref:Microsoft.AspNetCore.Routing.RouteCollection> が指定されています。</span><span class="sxs-lookup"><span data-stu-id="36060-1632">The following example shows how to generate a link to a route given a dictionary of route values and a <xref:Microsoft.AspNetCore.Routing.RouteCollection>.</span></span>

[!code-csharp[](routing/samples/2.x/RoutingSample/Startup.cs?name=snippet_Dictionary)]

<span data-ttu-id="36060-1633">上のサンプルの終わりで生成された <xref:Microsoft.AspNetCore.Routing.VirtualPathData.VirtualPath> は `/package/create/123` です。</span><span class="sxs-lookup"><span data-stu-id="36060-1633">The <xref:Microsoft.AspNetCore.Routing.VirtualPathData.VirtualPath> generated at the end of the preceding sample is `/package/create/123`.</span></span> <span data-ttu-id="36060-1634">ディクショナリにより、"Track Package Route" テンプレート `package/{operation}/{id}` のルート値 `operation` と `id` が提供されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1634">The dictionary supplies the `operation` and `id` route values of the "Track Package Route" template, `package/{operation}/{id}`.</span></span> <span data-ttu-id="36060-1635">詳細については、「[ルーティング ミドルウェアの使用](#use-routing-middleware)」セクションのサンプル コードまたは[サンプル アプリ](https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/fundamentals/routing/samples)を参照してください。</span><span class="sxs-lookup"><span data-stu-id="36060-1635">For details, see the sample code in the [Use Routing Middleware](#use-routing-middleware) section or the [sample app](https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/fundamentals/routing/samples).</span></span>

<span data-ttu-id="36060-1636"><xref:Microsoft.AspNetCore.Routing.VirtualPathContext> コンストラクターの 2 番目のパラメーターは*アンビエント値*の集合です。</span><span class="sxs-lookup"><span data-stu-id="36060-1636">The second parameter to the <xref:Microsoft.AspNetCore.Routing.VirtualPathContext> constructor is a collection of *ambient values*.</span></span> <span data-ttu-id="36060-1637">アンビエント値は、開発者が要求コンテキスト内で指定する必要がある値の数が制限されるため、使用すると便利です。</span><span class="sxs-lookup"><span data-stu-id="36060-1637">Ambient values are convenient to use because they limit the number of values a developer must specify within a request context.</span></span> <span data-ttu-id="36060-1638">現在の要求の現在のルート値は、リンク生成の場合、アンビエント値として見なされます。</span><span class="sxs-lookup"><span data-stu-id="36060-1638">The current route values of the current request are considered ambient values for link generation.</span></span> <span data-ttu-id="36060-1639">ASP.NET Core MVC アプリの `HomeController` の `About` アクションでは、コントローラー ルート値を指定し、`Index` アクションにリンクする必要はありません。`Home` のアンビエント値が使用されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1639">In an ASP.NET Core MVC app's `About` action of the `HomeController`, you don't need to specify the controller route value to link to the `Index` action&mdash;the ambient value of `Home` is used.</span></span>

<span data-ttu-id="36060-1640">パラメーターに一致しないアンビエント値は無視されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1640">Ambient values that don't match a parameter are ignored.</span></span> <span data-ttu-id="36060-1641">アンビエント値は、明示的に指定された値でアンビエント値がオーバーライドされる場合にも無視されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1641">Ambient values are also ignored when an explicitly provided value overrides the ambient value.</span></span> <span data-ttu-id="36060-1642">URL では左から右に照合されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1642">Matching occurs from left to right in the URL.</span></span>

<span data-ttu-id="36060-1643">明示的に指定されているが、ルートのセグメントと一致しない値は、クエリ文字列に追加されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1643">Values explicitly provided but that don't match a segment of the route are added to the query string.</span></span> <span data-ttu-id="36060-1644">次の表は、ルート テンプレート `{controller}/{action}/{id?}` の使用時の結果をまとめたものです。</span><span class="sxs-lookup"><span data-stu-id="36060-1644">The following table shows the result when using the route template `{controller}/{action}/{id?}`.</span></span>

| <span data-ttu-id="36060-1645">アンビエント値</span><span class="sxs-lookup"><span data-stu-id="36060-1645">Ambient Values</span></span>                     | <span data-ttu-id="36060-1646">明示的な値</span><span class="sxs-lookup"><span data-stu-id="36060-1646">Explicit Values</span></span>                        | <span data-ttu-id="36060-1647">結果</span><span class="sxs-lookup"><span data-stu-id="36060-1647">Result</span></span>                  |
| ---------------------------------- | -------------------------------------- | ----------------------- |
| <span data-ttu-id="36060-1648">controller = "Home"</span><span class="sxs-lookup"><span data-stu-id="36060-1648">controller = "Home"</span></span>                | <span data-ttu-id="36060-1649">action = "About"</span><span class="sxs-lookup"><span data-stu-id="36060-1649">action = "About"</span></span>                       | `/Home/About`           |
| <span data-ttu-id="36060-1650">controller = "Home"</span><span class="sxs-lookup"><span data-stu-id="36060-1650">controller = "Home"</span></span>                | <span data-ttu-id="36060-1651">controller = "Order", action = "About"</span><span class="sxs-lookup"><span data-stu-id="36060-1651">controller = "Order", action = "About"</span></span> | `/Order/About`          |
| <span data-ttu-id="36060-1652">controller = "Home", color = "Red"</span><span class="sxs-lookup"><span data-stu-id="36060-1652">controller = "Home", color = "Red"</span></span> | <span data-ttu-id="36060-1653">action = "About"</span><span class="sxs-lookup"><span data-stu-id="36060-1653">action = "About"</span></span>                       | `/Home/About`           |
| <span data-ttu-id="36060-1654">controller = "Home"</span><span class="sxs-lookup"><span data-stu-id="36060-1654">controller = "Home"</span></span>                | <span data-ttu-id="36060-1655">action = "About", color = "Red"</span><span class="sxs-lookup"><span data-stu-id="36060-1655">action = "About", color = "Red"</span></span>        | `/Home/About?color=Red` |

<span data-ttu-id="36060-1656">パラメーターに対応しない既定値がルートにあり、その値が明示的に指定される場合、それは既定値に一致する必要があります。</span><span class="sxs-lookup"><span data-stu-id="36060-1656">If a route has a default value that doesn't correspond to a parameter and that value is explicitly provided, it must match the default value:</span></span>

```csharp
routes.MapRoute("blog_route", "blog/{*slug}",
    defaults: new { controller = "Blog", action = "ReadPost" });
```

<span data-ttu-id="36060-1657">リンク生成では、`controller` と `action` について一致する値が指定されるときにのみ、このルートのリンクが生成されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1657">Link generation only generates a link for this route when the matching values for `controller` and `action` are provided.</span></span>

## <a name="complex-segments"></a><span data-ttu-id="36060-1658">複雑なセグメント</span><span class="sxs-lookup"><span data-stu-id="36060-1658">Complex segments</span></span>

<span data-ttu-id="36060-1659">複雑なセグメント (例: `[Route("/x{token}y")]`) は、リテラルを右から左に最短一致の方法で照合することによって処理されます。</span><span class="sxs-lookup"><span data-stu-id="36060-1659">Complex segments (for example `[Route("/x{token}y")]`) are processed by matching up literals from right to left in a non-greedy way.</span></span> <span data-ttu-id="36060-1660">複雑なセグメントの一致方法に関する詳しい説明については、[こちらのコード](https://github.com/aspnet/AspNetCore/blob/release/2.2/src/Http/Routing/src/Patterns/RoutePatternMatcher.cs#L293)をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="36060-1660">See [this code](https://github.com/aspnet/AspNetCore/blob/release/2.2/src/Http/Routing/src/Patterns/RoutePatternMatcher.cs#L293) for a detailed explanation of how complex segments are matched.</span></span> <span data-ttu-id="36060-1661">この[コード サンプル](https://github.com/aspnet/AspNetCore/blob/release/2.2/src/Http/Routing/src/Patterns/RoutePatternMatcher.cs#L293)は ASP.NET Core では使われていませんが、複雑なセグメントに関する優れた説明が提供されています。</span><span class="sxs-lookup"><span data-stu-id="36060-1661">The [code sample](https://github.com/aspnet/AspNetCore/blob/release/2.2/src/Http/Routing/src/Patterns/RoutePatternMatcher.cs#L293) is not used by ASP.NET Core, but it provides a good explanation of complex segments.</span></span>

::: moniker-end
